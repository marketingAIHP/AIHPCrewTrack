{"file_contents":{"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"replit.md":{"content":"# Replit.md\n\n## Overview\nThis project is a full-stack labor tracking and workforce management application. It enables administrators to manage employees and work sites, offering real-time location tracking, geofencing capabilities for field workers, and comprehensive attendance reporting. The application's core purpose is to streamline workforce management, enhance operational efficiency through accurate attendance and location data, and provide robust tools for oversight.\n\n## User Preferences\nPreferred communication style: Simple, everyday language.\n\n## Recent Updates (September 2025)\n- **Production-Ready Deployment**: Implemented comprehensive responsive design across all admin panels (dashboard, employee management, site management)\n- **Employee Management Enhancement**: Added site assignment functionality to employee creation form with proper backend handling\n- **Image Upload Fixes**: Resolved image upload stuck at 100% issue for both employee profiles and site images with improved error handling\n- **Error Handling Improvements**: Fixed delete employee error display while maintaining successful operation functionality\n- **Mobile Responsiveness**: Implemented mobile-first design with adaptive layouts (1-4 columns), responsive navigation, and optimized touch interfaces\n- **Backend Optimization**: Enhanced upload parameter handling and improved error responses for better user experience\n- **Production Testing**: All core features tested and verified working including employee creation, site assignment, image uploads, and deletions\n- **Adaptive Image Compression (September 3, 2025)**: Implemented intelligent image compression system with 96-97% size reduction, WebP format support, device-aware optimization, and progressive loading. Achieved dramatic performance improvements with thumbnail-first loading strategy.\n- **Critical API Fix (September 3, 2025)**: Resolved fundamental apiRequest parameter order mismatch causing \"Failed to execute fetch\" errors in employee creation/update forms. Fixed backend schema validation for partial employee updates. All CRUD operations now working correctly with proper error handling.\n- **Smart Compression Features Removal (September 3, 2025)**: Removed advanced smart compression preview thumbnails and related UI components per user request. Maintained core image compression functionality with basic adaptive loading.\n\n## System Architecture\n\n### UI/UX Decisions\nThe application uses React with Tailwind CSS and shadcn/ui for a modern, responsive interface. It features interactive image dialogs for profile management, custom map icons (red for employees, green for sites, blue for geofences), and professional HTML reports for email exports. Map controls are customized to remove default UI elements, providing a clean user experience. Notification displays are integrated via toast notifications and a header dropdown.\n\n### Technical Implementations\n**Frontend**: Built with React and TypeScript, leveraging TanStack React Query for server state management and Wouter for client-side routing. Vite is used for fast development and optimized production builds.\n**Backend**: Developed with Express.js and TypeScript, designed as a RESTful API with WebSocket support for real-time features. JWT-based authentication with bcrypt for password hashing ensures secure access.\n**Database**: Utilizes PostgreSQL with Neon serverless connection and Drizzle ORM for type-safe operations. The schema includes relational designs for admins, employees, work sites, location tracking, and attendance.\n\n### Feature Specifications\n*   **Authentication System**: Separate login flows for administrators and employees with JWT-based authentication, role-based access control, and bcrypt for secure password hashing. Includes geofence-based attendance validation for employees.\n*   **Location Tracking**: Real-time GPS tracking via browser geolocation API, with configurable geofencing for attendance validation and WebSocket integration for live updates.\n*   **Administrative Dashboard**: Provides CRUD operations for employee and site management, a live map visualization of employee locations and site boundaries, and analytics for attendance monitoring. Includes email export functionality for attendance reports.\n*   **Employee Interface**: A dedicated portal for workers to manage attendance with geofence validation, view site information, and track work hours.\n*   **Map Integration**: Interactive Google Maps with custom markers and controls, displaying real-time employee positions, work sites, and geofence boundaries. Features clickable markers and employee names for detailed profile navigation.\n*   **Data Validation & Security**: Strong password requirements, unique email validation for both admin and employee accounts, and organization uniqueness constraints. Robust error handling provides detailed validation messages.\n*   **Real-time Notifications**: WebSocket-based notifications alert administrators to employee check-in/out events, with toast notifications and a persistent notification history.\n*   **Profile Image Management**: Comprehensive system for uploading, previewing, and removing profile images for both admin and employee profiles, with cloud object storage. Images display consistently across all application interfaces including employee cards, active employee lists, on-site tracking, live map sidebar, and notifications.\n*   **Site Image Management**: Complete image upload and display system for work sites using the same authenticated storage infrastructure as profile images. Site images are processed through secure backend endpoints and display properly in site cards using the AuthenticatedImage component with automatic fallback to placeholder graphics.\n*   **Hierarchical Area Organization**: Work sites can be organized into logical areas for better management. Areas contain multiple work sites and provide hierarchical structure for large organizations with multiple locations or districts. Full CRUD operations for both areas and sites with validation to prevent deletion of areas with associated sites.\n\n### System Design Choices\nThe application follows a monorepo structure with shared TypeScript types for full-stack type safety. It prioritizes real-time data synchronization, robust error handling, and a clear separation of concerns between frontend, backend, and database layers. Location updates are optimized for server load and battery life (1-minute interval), and automatic check-out occurs when employees leave geofences. Caching is disabled for critical employee data to ensure data freshness.\n\n## External Dependencies\n\n*   **Database**: PostgreSQL (via Neon serverless)\n*   **Mapping & Geolocation**: Google Maps JavaScript API, Browser Geolocation API\n*   **Email Service**: SendGrid\n*   **Real-time Communication**: WebSockets\n*   **UI Components**: Radix UI primitives, shadcn/ui\n*   **Icons**: Lucide React\n*   **Authentication**: jsonwebtoken, bcrypt\n*   **ORM**: Drizzle ORM\n*   **Frontend Framework**: React\n*   **Backend Framework**: Express.js\n*   **Styling**: Tailwind CSS\n*   **State Management**: TanStack React Query\n*   **Routing**: Wouter\n*   **Build Tool**: Vite","size_bytes":7200},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2627},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":971},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });","size_bytes":482},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport compression from \"compression\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(compression()); // Enable gzip compression\napp.use(express.json({ limit: '10mb' })); // Increase limit for file uploads\napp.use(express.urlencoded({ extended: false, limit: '10mb' }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2223},"server/objectStorage.ts":{"content":"import { Storage, File } from \"@google-cloud/storage\";\nimport { Response } from \"express\";\nimport { randomUUID } from \"crypto\";\n\nconst REPLIT_SIDECAR_ENDPOINT = \"http://127.0.0.1:1106\";\n\n// The object storage client is used to interact with the object storage service.\nexport const objectStorageClient = new Storage({\n  credentials: {\n    audience: \"replit\",\n    subject_token_type: \"access_token\",\n    token_url: `${REPLIT_SIDECAR_ENDPOINT}/token`,\n    type: \"external_account\",\n    credential_source: {\n      url: `${REPLIT_SIDECAR_ENDPOINT}/credential`,\n      format: {\n        type: \"json\",\n        subject_token_field_name: \"access_token\",\n      },\n    },\n    universe_domain: \"googleapis.com\",\n  },\n  projectId: \"\",\n});\n\nexport class ObjectNotFoundError extends Error {\n  constructor() {\n    super(\"Object not found\");\n    this.name = \"ObjectNotFoundError\";\n    Object.setPrototypeOf(this, ObjectNotFoundError.prototype);\n  }\n}\n\n// The object storage service is used to interact with the object storage service.\nexport class ObjectStorageService {\n  constructor() {}\n\n  // Gets the public object search paths.\n  getPublicObjectSearchPaths(): Array<string> {\n    const pathsStr = process.env.PUBLIC_OBJECT_SEARCH_PATHS || \"\";\n    const paths = Array.from(\n      new Set(\n        pathsStr\n          .split(\",\")\n          .map((path) => path.trim())\n          .filter((path) => path.length > 0)\n      )\n    );\n    if (paths.length === 0) {\n      throw new Error(\n        \"PUBLIC_OBJECT_SEARCH_PATHS not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PUBLIC_OBJECT_SEARCH_PATHS env var (comma-separated paths).\"\n      );\n    }\n    return paths;\n  }\n\n  // Gets the private object directory.\n  getPrivateObjectDir(): string {\n    const dir = process.env.PRIVATE_OBJECT_DIR || \"\";\n    if (!dir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n    return dir;\n  }\n\n  // Search for a public object from the search paths.\n  async searchPublicObject(filePath: string): Promise<File | null> {\n    for (const searchPath of this.getPublicObjectSearchPaths()) {\n      const fullPath = `${searchPath}/${filePath}`;\n\n      // Full path format: /<bucket_name>/<object_name>\n      const { bucketName, objectName } = parseObjectPath(fullPath);\n      const bucket = objectStorageClient.bucket(bucketName);\n      const file = bucket.file(objectName);\n\n      // Check if file exists\n      const [exists] = await file.exists();\n      if (exists) {\n        return file;\n      }\n    }\n\n    return null;\n  }\n\n  // Downloads an object to the response.\n  async downloadObject(file: File, res: Response, cacheTtlSec: number = 3600) {\n    try {\n      // Get file metadata\n      const [metadata] = await file.getMetadata();\n      \n      // Set appropriate headers\n      res.set({\n        \"Content-Type\": metadata.contentType || \"application/octet-stream\",\n        \"Content-Length\": metadata.size,\n        \"Cache-Control\": `public, max-age=${cacheTtlSec}`,\n      });\n\n      // Stream the file to the response\n      const stream = file.createReadStream();\n\n      stream.on(\"error\", (err) => {\n        console.error(\"Stream error:\", err);\n        if (!res.headersSent) {\n          res.status(500).json({ error: \"Error streaming file\" });\n        }\n      });\n\n      stream.pipe(res);\n    } catch (error) {\n      console.error(\"Error downloading file:\", error);\n      if (!res.headersSent) {\n        res.status(500).json({ error: \"Error downloading file\" });\n      }\n    }\n  }\n\n  // Gets the upload URL for an object entity.\n  async getObjectEntityUploadURL(): Promise<string> {\n    const privateObjectDir = this.getPrivateObjectDir();\n    if (!privateObjectDir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n\n    const objectId = randomUUID();\n    const fullPath = `${privateObjectDir}/profile-images/${objectId}`;\n\n    const { bucketName, objectName } = parseObjectPath(fullPath);\n\n    // Sign URL for PUT method with TTL\n    return signObjectURL({\n      bucketName,\n      objectName,\n      method: \"PUT\",\n      ttlSec: 900,\n    });\n  }\n\n  // Gets the upload URL for a public object (site images).\n  async getPublicObjectUploadURL(): Promise<string> {\n    const publicSearchPaths = this.getPublicObjectSearchPaths();\n    if (publicSearchPaths.length === 0) {\n      throw new Error(\n        \"PUBLIC_OBJECT_SEARCH_PATHS not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PUBLIC_OBJECT_SEARCH_PATHS env var.\"\n      );\n    }\n\n    const objectId = randomUUID();\n    const publicPath = publicSearchPaths[0]; // Use first public path\n    const fullPath = `${publicPath}/site-images/${objectId}`;\n\n    const { bucketName, objectName } = parseObjectPath(fullPath);\n\n    // Sign URL for PUT method with TTL\n    return signObjectURL({\n      bucketName,\n      objectName,\n      method: \"PUT\",\n      ttlSec: 900,\n    });\n  }\n\n  // Gets the object entity file from the object path.\n  async getObjectEntityFile(objectPath: string): Promise<File> {\n    if (!objectPath.startsWith(\"/objects/\")) {\n      throw new ObjectNotFoundError();\n    }\n\n    const parts = objectPath.slice(1).split(\"/\");\n    if (parts.length < 2) {\n      throw new ObjectNotFoundError();\n    }\n\n    const entityId = parts.slice(1).join(\"/\");\n\n    // Try private directory first\n    let entityDir = this.getPrivateObjectDir();\n    if (!entityDir.endsWith(\"/\")) {\n      entityDir = `${entityDir}/`;\n    }\n    let objectEntityPath = `${entityDir}${entityId}`;\n    let { bucketName, objectName } = parseObjectPath(objectEntityPath);\n    let bucket = objectStorageClient.bucket(bucketName);\n    let objectFile = bucket.file(objectName);\n    let [exists] = await objectFile.exists();\n    \n    if (exists) {\n      return objectFile;\n    }\n\n    // If not found in private, try public directories (for site images)\n    const publicSearchPaths = this.getPublicObjectSearchPaths();\n    for (const publicPath of publicSearchPaths) {\n      let normalizedPublicPath = publicPath;\n      if (!normalizedPublicPath.endsWith(\"/\")) {\n        normalizedPublicPath = `${normalizedPublicPath}/`;\n      }\n      \n      objectEntityPath = `${normalizedPublicPath}${entityId}`;\n      ({ bucketName, objectName } = parseObjectPath(objectEntityPath));\n      bucket = objectStorageClient.bucket(bucketName);\n      objectFile = bucket.file(objectName);\n      [exists] = await objectFile.exists();\n      \n      if (exists) {\n        return objectFile;\n      }\n    }\n\n    throw new ObjectNotFoundError();\n  }\n\n  normalizeObjectEntityPath(rawPath: string): string {\n    if (!rawPath.startsWith(\"https://storage.googleapis.com/\")) {\n      return rawPath;\n    }\n  \n    // Extract the path from the URL by removing query parameters and domain\n    const url = new URL(rawPath);\n    const rawObjectPath = url.pathname;\n  \n    // Handle both private and public uploads\n    let objectEntityDir = this.getPrivateObjectDir();\n    if (!objectEntityDir.endsWith(\"/\")) {\n      objectEntityDir = `${objectEntityDir}/`;\n    }\n  \n    // Check if it's from private directory first\n    if (rawObjectPath.startsWith(objectEntityDir)) {\n      const entityId = rawObjectPath.slice(objectEntityDir.length);\n      return `/objects/${entityId}`;\n    }\n  \n    // Check if it's from public directory (for site images)\n    const publicSearchPaths = this.getPublicObjectSearchPaths();\n    for (const publicPath of publicSearchPaths) {\n      let normalizedPublicPath = publicPath;\n      if (!normalizedPublicPath.endsWith(\"/\")) {\n        normalizedPublicPath = `${normalizedPublicPath}/`;\n      }\n      \n      if (rawObjectPath.startsWith(normalizedPublicPath)) {\n        const entityId = rawObjectPath.slice(normalizedPublicPath.length);\n        return `/objects/${entityId}`;\n      }\n    }\n  \n    return rawObjectPath;\n  }\n\n  // Normalize object entity path and return it\n  async trySetObjectEntityPath(rawPath: string): Promise<string> {\n    const normalizedPath = this.normalizeObjectEntityPath(rawPath);\n    return normalizedPath;\n  }\n}\n\nfunction parseObjectPath(path: string): {\n  bucketName: string;\n  objectName: string;\n} {\n  if (!path.startsWith(\"/\")) {\n    path = `/${path}`;\n  }\n  const pathParts = path.split(\"/\");\n  if (pathParts.length < 3) {\n    throw new Error(\"Invalid path: must contain at least a bucket name\");\n  }\n\n  const bucketName = pathParts[1];\n  const objectName = pathParts.slice(2).join(\"/\");\n\n  return {\n    bucketName,\n    objectName,\n  };\n}\n\nasync function signObjectURL({\n  bucketName,\n  objectName,\n  method,\n  ttlSec,\n}: {\n  bucketName: string;\n  objectName: string;\n  method: \"GET\" | \"PUT\" | \"DELETE\" | \"HEAD\";\n  ttlSec: number;\n}): Promise<string> {\n  const request = {\n    bucket_name: bucketName,\n    object_name: objectName,\n    method,\n    expires_at: new Date(Date.now() + ttlSec * 1000).toISOString(),\n  };\n  const response = await fetch(\n    `${REPLIT_SIDECAR_ENDPOINT}/object-storage/signed-object-url`,\n    {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(request),\n    }\n  );\n  if (!response.ok) {\n    throw new Error(\n      `Failed to sign object URL, errorcode: ${response.status}, ` +\n        `make sure you're running on Replit`\n    );\n  }\n\n  const { signed_url: signedURL } = await response.json();\n  return signedURL;\n}","size_bytes":9500},"server/routes.ts":{"content":"import type { Express, Request, Response, NextFunction } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { WebSocketServer } from \"ws\";\nimport WebSocket from \"ws\";\nimport { storage } from \"./storage\";\nimport bcrypt from \"bcrypt\";\nimport jwt from \"jsonwebtoken\";\nimport { z } from \"zod\";\nimport {\n  adminLoginSchema,\n  employeeLoginSchema,\n  insertAdminSchema,\n  insertEmployeeSchema,\n  insertWorkSiteSchema,\n  insertAreaSchema,\n  insertDepartmentSchema,\n  insertLocationTrackingSchema,\n  insertAttendanceSchema,\n  updateEmployeeProfileSchema,\n  adminVerificationSchema,\n  adminActivationSchema,\n} from \"@shared/schema\";\nimport { sendEmail } from './sendgrid';\nimport * as XLSX from 'xlsx';\nimport { createObjectCsvWriter } from 'csv-writer';\nimport PDFDocument from 'pdfkit';\nimport { ObjectStorageService, ObjectNotFoundError } from './objectStorage';\nimport { ImageCompressionService } from './imageCompression';\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"your-secret-key\";\n\n// WebSocket connections for real-time notifications\nconst adminConnections = new Map<number, WebSocket[]>(); // adminId -> WebSocket[]\n\n// Notification stack to maintain last 5 transactions per admin\nconst notificationStacks = new Map<number, any[]>(); // adminId -> notifications[]\n\n// Helper to add notification to stack\nfunction addToNotificationStack(adminId: number, notification: any) {\n  const stack = notificationStacks.get(adminId) || [];\n  stack.unshift(notification); // Add to beginning\n  if (stack.length > 5) {\n    stack.pop(); // Remove oldest if more than 5\n  }\n  notificationStacks.set(adminId, stack);\n}\n\n// Helper function to send notification to admin\nfunction notifyAdmin(adminId: number, notification: any) {\n  // Add to notification stack first\n  addToNotificationStack(adminId, notification);\n  \n  const connections = adminConnections.get(adminId) || [];\n  console.log(`Attempting to notify admin ${adminId}, found ${connections.length} connections`);\n  \n  // Clean up closed connections first\n  const activeConnections = connections.filter(ws => ws.readyState === WebSocket.OPEN);\n  adminConnections.set(adminId, activeConnections);\n  \n  if (activeConnections.length === 0) {\n    console.log(`No active connections for admin ${adminId}`);\n    return;\n  }\n  \n  const message = JSON.stringify({\n    type: 'notification',\n    data: notification\n  });\n  \n  // Send to only the first active connection to avoid duplicates\n  const ws = activeConnections[0];\n  try {\n    ws.send(message);\n    console.log(`Notification sent to admin ${adminId} (using 1 connection out of ${activeConnections.length})`);\n  } catch (error) {\n    console.error(`Failed to send notification to admin ${adminId}:`, error);\n  }\n}\n\ninterface AuthenticatedRequest extends Request {\n  user?: {\n    id: number;\n    type: 'admin' | 'employee' | 'super_admin';\n  };\n}\n\n// Authentication middleware\nconst authenticateToken = (userType?: 'admin' | 'employee' | 'super_admin' | ('admin' | 'employee' | 'super_admin')[]) => {\n  return async (req: AuthenticatedRequest, res: Response, next: NextFunction) => {\n    const authHeader = req.headers['authorization'];\n    const token = authHeader && authHeader.split(' ')[1];\n\n    if (!token) {\n      return res.status(401).json({ message: 'Access token required' });\n    }\n\n    try {\n      const decoded = jwt.verify(token, JWT_SECRET) as any;\n      if (userType) {\n        const allowedTypes = Array.isArray(userType) ? userType : [userType];\n        if (!allowedTypes.includes(decoded.type)) {\n          return res.status(403).json({ message: 'Insufficient permissions' });\n        }\n      }\n      req.user = decoded;\n      next();\n    } catch (error) {\n      return res.status(403).json({ message: 'Invalid token' });\n    }\n  };\n};\n\n// Calculate distance between two coordinates (Haversine formula)\nfunction calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\n  const R = 6371e3; // Earth's radius in meters\n  const φ1 = lat1 * Math.PI / 180;\n  const φ2 = lat2 * Math.PI / 180;\n  const Δφ = (lat2 - lat1) * Math.PI / 180;\n  const Δλ = (lon2 - lon1) * Math.PI / 180;\n\n  const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +\n    Math.cos(φ1) * Math.cos(φ2) *\n    Math.sin(Δλ / 2) * Math.sin(Δλ / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n  return R * c; // Distance in meters\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Configuration endpoint\n  app.get('/api/config', (req, res) => {\n    res.json({\n      GOOGLE_MAPS_API_KEY: process.env.GOOGLE_MAPS_API_KEY\n    });\n  });\n\n  // Employee Authentication Routes\n  app.post('/api/employee/login', async (req, res) => {\n    try {\n      const { email, password } = employeeLoginSchema.parse(req.body);\n\n      const employee = await storage.getEmployeeByEmail(email);\n      if (!employee) {\n        return res.status(401).json({ message: 'Invalid credentials' });\n      }\n\n      const isValidPassword = await bcrypt.compare(password, employee.password);\n      if (!isValidPassword) {\n        return res.status(401).json({ message: 'Invalid credentials' });\n      }\n\n      const token = jwt.sign(\n        { id: employee.id, type: 'employee' },\n        JWT_SECRET,\n        { expiresIn: '24h' }\n      );\n\n      res.json({ \n        token,\n        employee: {\n          id: employee.id,\n          firstName: employee.firstName,\n          lastName: employee.lastName,\n          email: employee.email,\n          phone: employee.phone,\n          siteId: employee.siteId,\n          profileImage: employee.profileImage,\n        }\n      });\n    } catch (error) {\n      console.error('Employee login error:', error);\n      res.status(400).json({ message: 'Invalid request data' });\n    }\n  });\n\n  // Employee Profile Routes\n  app.get('/api/employee/profile', authenticateToken('employee'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const employee = await storage.getEmployee(req.user!.id);\n      if (!employee) {\n        return res.status(404).json({ message: 'Employee not found' });\n      }\n\n      res.json({\n        id: employee.id,\n        firstName: employee.firstName,\n        lastName: employee.lastName,\n        email: employee.email,\n        phone: employee.phone,\n        address: employee.address,\n        siteId: employee.siteId,\n        profileImage: employee.profileImage,\n      });\n    } catch (error) {\n      console.error('Error fetching employee profile:', error);\n      res.status(500).json({ message: 'Failed to fetch profile' });\n    }\n  });\n\n  // Employee profile update route (limited fields)\n  app.put('/api/employee/profile', authenticateToken('employee'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const validatedData = updateEmployeeProfileSchema.parse(req.body);\n      \n      // Normalize profile image URL if provided\n      if (validatedData.profileImage) {\n        const objectStorageService = new ObjectStorageService();\n        validatedData.profileImage = await objectStorageService.trySetObjectEntityPath(validatedData.profileImage);\n      }\n      \n      const employee = await storage.updateEmployee(req.user!.id, validatedData);\n      const { password, ...employeeData } = employee;\n      res.json(employeeData);\n    } catch (error) {\n      console.error('Error updating employee profile:', error);\n      if (error instanceof z.ZodError) {\n        const errorMessages = error.errors.map(err => `${err.path.join('.')}: ${err.message}`);\n        return res.status(400).json({ message: errorMessages.join(', ') });\n      }\n      res.status(400).json({ message: 'Failed to update profile' });\n    }\n  });\n\n  // Employee Work Site Route\n  app.get('/api/employee/site', authenticateToken('employee'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const employee = await storage.getEmployee(req.user!.id);\n      if (!employee || !employee.siteId) {\n        return res.status(404).json({ message: 'No work site assigned' });\n      }\n\n      const site = await storage.getWorkSite(employee.siteId);\n      if (!site) {\n        return res.status(404).json({ message: 'Work site not found' });\n      }\n\n      res.json(site);\n    } catch (error) {\n      console.error('Error fetching employee site:', error);\n      res.status(500).json({ message: 'Failed to fetch work site' });\n    }\n  });\n\n  // Employee Attendance Routes\n  app.get('/api/employee/attendance/current', authenticateToken('employee'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const attendance = await storage.getCurrentAttendance(req.user!.id);\n      res.json(attendance || null);\n    } catch (error) {\n      console.error('Error fetching current attendance:', error);\n      res.status(500).json({ message: 'Failed to fetch attendance' });\n    }\n  });\n\n  app.post('/api/employee/attendance/checkin', authenticateToken('employee'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const { latitude, longitude } = req.body;\n      const employeeId = req.user!.id;\n\n      // Get employee and assigned work site\n      const employee = await storage.getEmployee(employeeId);\n      if (!employee || !employee.siteId) {\n        return res.status(400).json({ message: 'No work site assigned' });\n      }\n\n      const site = await storage.getWorkSite(employee.siteId);\n      if (!site) {\n        return res.status(400).json({ message: 'Work site not found' });\n      }\n\n      // Check if employee is within geofence with improved accuracy\n      const distance = calculateDistance(\n        latitude,\n        longitude,\n        parseFloat(site.latitude),\n        parseFloat(site.longitude)\n      );\n\n      // Add buffer for GPS accuracy issues (typically 3-5m accuracy for mobile GPS)\n      const gpsAccuracyBuffer = 10; // meters\n      const effectiveRadius = site.geofenceRadius + gpsAccuracyBuffer;\n\n      console.log(`Geofence check: Distance=${Math.round(distance)}m, Radius=${site.geofenceRadius}m, EffectiveRadius=${effectiveRadius}m`);\n\n      if (distance > effectiveRadius) {\n        return res.status(400).json({ \n          message: `You must be within ${site.geofenceRadius}m of the work site to check in. You are ${Math.round(distance)}m away.`,\n          distance: Math.round(distance),\n          requiredRadius: site.geofenceRadius\n        });\n      }\n\n      // Check if already checked in\n      const currentAttendance = await storage.getCurrentAttendance(employeeId);\n      if (currentAttendance && !currentAttendance.checkOutTime) {\n        return res.status(400).json({ message: 'Already checked in' });\n      }\n\n      // Create attendance record\n      const attendance = await storage.createAttendance({\n        employeeId,\n        siteId: employee.siteId,\n        checkInLatitude: latitude.toString(),\n        checkInLongitude: longitude.toString(),\n      });\n\n      // Create location tracking record\n      await storage.createLocationTracking({\n        employeeId,\n        latitude: latitude.toString(),\n        longitude: longitude.toString(),\n        isOnSite: true,\n      });\n\n      // Send real-time notification to admin\n      console.log(`Sending check-in notification for employee ${employee.firstName} ${employee.lastName} to admin ${employee.adminId}`);\n      console.log(`Admin connections available:`, Array.from(adminConnections.keys()));\n      console.log(`Admin ${employee.adminId} connections count:`, adminConnections.get(employee.adminId)?.length || 0);\n      notifyAdmin(employee.adminId, {\n        type: 'employee_checkin',\n        message: `${employee.firstName} ${employee.lastName} checked in at ${site.name}`,\n        employee: {\n          id: employee.id,\n          name: `${employee.firstName} ${employee.lastName}`,\n          email: employee.email\n        },\n        site: {\n          id: site.id,\n          name: site.name,\n          address: site.address\n        },\n        timestamp: new Date().toISOString(),\n        location: { latitude, longitude }\n      });\n\n      res.json(attendance);\n    } catch (error) {\n      console.error('Error checking in:', error);\n      res.status(500).json({ message: 'Failed to check in' });\n    }\n  });\n\n  app.post('/api/employee/attendance/checkout', authenticateToken('employee'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const { latitude, longitude } = req.body;\n      const employeeId = req.user!.id;\n\n      // Get current attendance\n      const currentAttendance = await storage.getCurrentAttendance(employeeId);\n      if (!currentAttendance || currentAttendance.checkOutTime) {\n        return res.status(400).json({ message: 'Not currently checked in' });\n      }\n\n      // Update attendance record\n      const updatedAttendance = await storage.updateAttendance(currentAttendance.id, {\n        checkOutTime: new Date(),\n        checkOutLatitude: latitude.toString(),\n        checkOutLongitude: longitude.toString(),\n      });\n\n      // Create location tracking record\n      await storage.createLocationTracking({\n        employeeId,\n        latitude: latitude.toString(),\n        longitude: longitude.toString(),\n        isOnSite: false,\n      });\n\n      // Send real-time notification to admin\n      const employee = await storage.getEmployee(employeeId);\n      if (employee) {\n        const site = employee.siteId ? await storage.getWorkSite(employee.siteId) : null;\n        notifyAdmin(employee.adminId, {\n          type: 'employee_checkout',\n          message: `${employee.firstName} ${employee.lastName} checked out from ${site?.name || 'work site'}`,\n          employee: {\n            id: employee.id,\n            name: `${employee.firstName} ${employee.lastName}`,\n            email: employee.email\n          },\n          site: site ? {\n            id: site.id,\n            name: site.name,\n            address: site.address\n          } : null,\n          timestamp: new Date().toISOString(),\n          location: { latitude, longitude }\n        });\n      }\n\n      res.json(updatedAttendance);\n    } catch (error) {\n      console.error('Error checking out:', error);\n      res.status(500).json({ message: 'Failed to check out' });\n    }\n  });\n\n  const httpServer = createServer(app);\n  \n  // WebSocket server for real-time location updates\n  const wss = new WebSocketServer({ server: httpServer, path: '/ws' });\n  \n  // Store active WebSocket connections for employees\n  const employeeConnections = new Map<number, WebSocket>();\n\n  wss.on('connection', (ws, req) => {\n    const url = new URL(req.url!, `http://${req.headers.host}`);\n    const token = url.searchParams.get('token');\n    \n    if (!token) {\n      ws.close(1008, 'Token required');\n      return;\n    }\n\n    try {\n      const decoded = jwt.verify(token, JWT_SECRET) as any;\n      \n      if (decoded.type === 'admin') {\n        // Add admin connection to notifications map\n        const connections = adminConnections.get(decoded.id) || [];\n        connections.push(ws);\n        adminConnections.set(decoded.id, connections);\n        console.log(`Admin ${decoded.id} connected to WebSocket. Total connections: ${connections.length}`);\n        \n        // Send initial connection confirmation\n        ws.send(JSON.stringify({\n          type: 'connection_established',\n          message: 'Connected to notification system'\n        }));\n\n        // Send last 5 notifications if any (only for the first connection to avoid duplicates)\n        const existingConnections = adminConnections.get(decoded.id) || [];\n        if (existingConnections.length === 1) { // Only send history for first connection\n          const recentNotifications = notificationStacks.get(decoded.id) || [];\n          if (recentNotifications.length > 0) {\n            recentNotifications.forEach(notification => {\n              ws.send(JSON.stringify({\n                type: 'notification',\n                data: notification\n              }));\n            });\n          }\n        }\n      } else if (decoded.type === 'employee') {\n        employeeConnections.set(decoded.id, ws);\n      }\n\n      ws.on('close', () => {\n        if (decoded.type === 'admin') {\n          const connections = adminConnections.get(decoded.id) || [];\n          const updatedConnections = connections.filter(conn => conn !== ws);\n          if (updatedConnections.length > 0) {\n            adminConnections.set(decoded.id, updatedConnections);\n          } else {\n            adminConnections.delete(decoded.id);\n          }\n          console.log(`Admin ${decoded.id} disconnected. Remaining connections: ${updatedConnections.length}`);\n        } else if (decoded.type === 'employee') {\n          employeeConnections.delete(decoded.id);\n        }\n      });\n\n      ws.on('message', async (data) => {\n        try {\n          const message = JSON.parse(data.toString());\n          \n          if (message.type === 'location_update' && decoded.type === 'employee') {\n            const { latitude, longitude } = message;\n            const employee = await storage.getEmployee(decoded.id);\n            \n            if (employee && employee.siteId) {\n              const site = await storage.getWorkSite(employee.siteId);\n              \n              if (site) {\n                const distance = calculateDistance(\n                  parseFloat(latitude),\n                  parseFloat(longitude),\n                  parseFloat(site.latitude),\n                  parseFloat(site.longitude)\n                );\n                \n                const isOnSite = distance <= site.geofenceRadius;\n                \n                // Save location tracking\n                await storage.createLocationTracking({\n                  employeeId: decoded.id,\n                  latitude,\n                  longitude,\n                  isOnSite,\n                });\n\n                // Broadcast to admin\n                const adminWsList = adminConnections.get(employee.adminId);\n                if (adminWsList) {\n                  adminWsList.forEach(adminWs => {\n                    if (adminWs.readyState === WebSocket.OPEN) {\n                      adminWs.send(JSON.stringify({\n                    type: 'employee_location',\n                    employeeId: decoded.id,\n                    latitude,\n                    longitude,\n                    isOnSite,\n                        timestamp: new Date().toISOString(),\n                      }));\n                    }\n                  });\n                }\n              }\n            }\n          }\n        } catch (error) {\n          console.error('WebSocket message error:', error);\n        }\n      });\n\n    } catch (error) {\n      ws.close(1008, 'Invalid token');\n    }\n  });\n\n  // Add endpoint to get recent notifications\n  app.get('/api/admin/notifications/recent', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const adminId = req.user!.id;\n      const recentNotifications = notificationStacks.get(adminId) || [];\n      res.json(recentNotifications);\n    } catch (error) {\n      console.error('Error fetching recent notifications:', error);\n      res.status(500).json({ message: 'Failed to fetch notifications' });\n    }\n  });\n\n  // Admin Authentication Routes\n  app.post('/api/admin/signup', async (req, res) => {\n    try {\n      const validatedData = insertAdminSchema.parse(req.body);\n      \n      // Check if email already exists across both admin and employee tables\n      const emailExists = await storage.checkEmailExists(validatedData.email);\n      if (emailExists) {\n        return res.status(400).json({ \n          message: 'Email address already exists. Please use a different email address.' \n        });\n      }\n\n      // Check if organization already exists\n      const existingAdmin = await storage.getAdminByCompanyName(validatedData.companyName);\n      if (existingAdmin) {\n        return res.status(400).json({ \n          message: 'An admin account for this organization already exists. Only one admin account per organization is allowed.' \n        });\n      }\n\n      const hashedPassword = await bcrypt.hash(validatedData.password, 10);\n      \n      const admin = await storage.createAdmin({\n        ...validatedData,\n        password: hashedPassword,\n      });\n\n      const token = jwt.sign(\n        { id: admin.id, type: 'admin' },\n        JWT_SECRET,\n        { expiresIn: '24h' }\n      );\n\n      res.json({ \n        token, \n        admin: { \n          id: admin.id, \n          firstName: admin.firstName, \n          lastName: admin.lastName,\n          companyName: admin.companyName,\n          email: admin.email \n        } \n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        const errorMessages = error.errors.map(err => `${err.path.join('.')}: ${err.message}`);\n        return res.status(400).json({ message: errorMessages.join(', ') });\n      }\n      res.status(400).json({ message: error instanceof Error ? error.message : 'Signup failed' });\n    }\n  });\n\n  app.post('/api/admin/login', async (req, res) => {\n    try {\n      const { email, password } = adminLoginSchema.parse(req.body);\n      const admin = await storage.getAdminByEmail(email);\n      \n      if (!admin || !(await bcrypt.compare(password, admin.password))) {\n        return res.status(401).json({ message: 'Invalid credentials' });\n      }\n\n      // Check if admin is verified and active\n      if (!admin.isVerified) {\n        return res.status(401).json({ message: 'Email not verified. Please check your email and verify your account.' });\n      }\n\n      if (!admin.isActive) {\n        return res.status(401).json({ message: 'Account pending activation by Super Admin. Please contact support.' });\n      }\n\n      const token = jwt.sign(\n        { id: admin.id, type: 'admin' },\n        JWT_SECRET,\n        { expiresIn: '24h' }\n      );\n\n      res.json({ \n        token, \n        admin: { \n          id: admin.id, \n          firstName: admin.firstName, \n          lastName: admin.lastName,\n          companyName: admin.companyName,\n          email: admin.email,\n          role: admin.role \n        } \n      });\n    } catch (error) {\n      res.status(400).json({ message: 'Login failed' });\n    }\n  });\n\n  // Employee Authentication Routes\n  app.post('/api/employee/login', async (req, res) => {\n    try {\n      const { email, password } = employeeLoginSchema.parse(req.body);\n      const employee = await storage.getEmployeeByEmail(email);\n      \n      if (!employee || !(await bcrypt.compare(password, employee.password))) {\n        return res.status(401).json({ message: 'Invalid credentials' });\n      }\n\n      const token = jwt.sign(\n        { id: employee.id, type: 'employee' },\n        JWT_SECRET,\n        { expiresIn: '24h' }\n      );\n\n      res.json({ \n        token, \n        employee: { \n          id: employee.id, \n          firstName: employee.firstName, \n          lastName: employee.lastName,\n          email: employee.email,\n          siteId: employee.siteId\n        } \n      });\n    } catch (error) {\n      res.status(400).json({ message: 'Login failed' });\n    }\n  });\n\n  // Admin Dashboard Routes\n  app.get('/api/admin/dashboard', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const stats = await storage.getDashboardStats(req.user!.id);\n      \n      // Calculate \"on site now\" - employees checked in and within geofence\n      const employees = await storage.getEmployeesByAdmin(req.user!.id);\n      let onSiteCount = 0;\n      \n      for (const employee of employees) {\n        const currentAttendance = await storage.getCurrentAttendance(employee.id);\n        if (currentAttendance && employee.siteId) {\n          const location = await storage.getLatestEmployeeLocation(employee.id);\n          if (location) {\n            const assignedSite = await storage.getWorkSite(employee.siteId);\n            if (assignedSite) {\n              const distance = calculateDistance(\n                parseFloat(location.latitude),\n                parseFloat(location.longitude),\n                parseFloat(assignedSite.latitude),\n                parseFloat(assignedSite.longitude)\n              );\n              if (distance <= assignedSite.geofenceRadius) {\n                onSiteCount++;\n              }\n            }\n          }\n        }\n      }\n      \n      res.json({\n        ...stats,\n        onSiteNow: onSiteCount.toString()\n      });\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch dashboard stats' });\n    }\n  });\n\n  // Recent activities endpoint\n  app.get('/api/admin/recent-activities', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const days = parseInt(req.query.days as string) || 7;\n      const activities = await storage.getRecentActivities(req.user!.id, days);\n      res.json(activities);\n    } catch (error) {\n      console.error('Error fetching recent activities:', error);\n      res.status(500).json({ message: 'Failed to fetch recent activities' });\n    }\n  });\n\n  // Admin profile route\n  app.get('/api/admin/profile', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const adminId = req.user!.id;\n      const admin = await storage.getAdmin(adminId);\n      if (!admin) {\n        return res.status(404).json({ message: 'Admin not found' });\n      }\n      res.json({\n        id: admin.id,\n        firstName: admin.firstName,\n        lastName: admin.lastName,\n        email: admin.email,\n        profileImage: admin.profileImage,\n        createdAt: admin.createdAt\n      });\n    } catch (error) {\n      console.error('Error fetching admin profile:', error);\n      res.status(500).json({ message: 'Failed to fetch admin profile' });\n    }\n  });\n\n  // Update admin profile\n  app.put('/api/admin/profile', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const { firstName, lastName, email } = req.body;\n\n      if (!firstName || !lastName || !email) {\n        return res.status(400).json({ message: 'All fields are required' });\n      }\n\n      // Check if email is already taken by another admin\n      const existingAdmin = await storage.getAdminByEmail(email);\n      if (existingAdmin && existingAdmin.id !== req.user!.id) {\n        return res.status(400).json({ message: 'Email already in use' });\n      }\n\n      const updatedAdmin = await storage.updateAdmin(req.user!.id, {\n        firstName,\n        lastName,\n        email\n      });\n\n      res.json({\n        id: updatedAdmin.id,\n        firstName: updatedAdmin.firstName,\n        lastName: updatedAdmin.lastName,\n        email: updatedAdmin.email,\n        profileImage: updatedAdmin.profileImage,\n        createdAt: updatedAdmin.createdAt\n      });\n    } catch (error) {\n      console.error('Error updating admin profile:', error);\n      res.status(500).json({ message: 'Failed to update admin profile' });\n    }\n  });\n\n  // Change admin password\n  app.post('/api/admin/change-password', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const { currentPassword, newPassword } = req.body;\n\n      if (!currentPassword || !newPassword) {\n        return res.status(400).json({ message: 'Current and new passwords are required' });\n      }\n\n      const admin = await storage.getAdmin(req.user!.id);\n      if (!admin) {\n        return res.status(404).json({ message: 'Admin not found' });\n      }\n\n      // Verify current password\n      const isCurrentPasswordValid = await bcrypt.compare(currentPassword, admin.password);\n      if (!isCurrentPasswordValid) {\n        return res.status(400).json({ message: 'Current password is incorrect' });\n      }\n\n      // Hash new password\n      const hashedNewPassword = await bcrypt.hash(newPassword, 10);\n      \n      await storage.updateAdminPassword(req.user!.id, hashedNewPassword);\n\n      res.json({ message: 'Password updated successfully' });\n    } catch (error) {\n      console.error('Error changing admin password:', error);\n      res.status(500).json({ message: 'Failed to change password' });\n    }\n  });\n\n  // Update notification preferences (placeholder for now)\n  app.put('/api/admin/notification-preferences', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const preferences = req.body;\n      \n      // For now, we'll just return success. In a real app, you'd save these to the database\n      console.log('Notification preferences updated for admin:', req.user!.id, preferences);\n      \n      res.json({ message: 'Notification preferences updated successfully' });\n    } catch (error) {\n      console.error('Error updating notification preferences:', error);\n      res.status(500).json({ message: 'Failed to update notification preferences' });\n    }\n  });\n\n  // Object storage endpoints for profile images\n  app.post('/api/objects/upload', authenticateToken(['admin', 'employee']), async (req: AuthenticatedRequest, res) => {\n    try {\n      const objectStorageService = new ObjectStorageService();\n      const uploadURL = await objectStorageService.getObjectEntityUploadURL();\n      res.json({ uploadURL });\n    } catch (error) {\n      console.error('Error getting upload URL:', error);\n      res.status(500).json({ message: 'Failed to get upload URL' });\n    }\n  });\n\n  // Serve object storage images with adaptive compression\n  app.get('/objects/*', async (req, res) => {\n    try {\n      const objectPath = req.path; // Full path like /objects/profile-images/uuid\n      const objectStorageService = new ObjectStorageService();\n      const compressionService = new ImageCompressionService();\n      \n      // Get the file object\n      const file = await objectStorageService.getObjectEntityFile(objectPath);\n      \n      // Check if compression is requested via query params\n      const compress = req.query.compress === 'true' || req.query.size;\n      \n      if (compress && (objectPath.includes('profile-images') || objectPath.includes('site-images'))) {\n        // Get optimal compression settings\n        const compressionOptions = compressionService.getOptimalSettings(req);\n        \n        // Apply size override if specified\n        if (req.query.size) {\n          const size = req.query.size as string;\n          switch (size) {\n            case 'thumbnail':\n              compressionOptions.width = 150;\n              compressionOptions.height = 150;\n              break;\n            case 'medium':\n              compressionOptions.width = 400;\n              break;\n            case 'large':\n              compressionOptions.width = 800;\n              break;\n          }\n        }\n        \n        // Get original file buffer\n        const chunks: Buffer[] = [];\n        const stream = file.createReadStream();\n        \n        for await (const chunk of stream) {\n          chunks.push(chunk);\n        }\n        const originalBuffer = Buffer.concat(chunks);\n        \n        // Compress the image\n        const compressedBuffer = await compressionService.compressImage(originalBuffer, compressionOptions);\n        \n        // Set appropriate headers\n        res.set({\n          'Content-Type': compressionService.getContentType(compressionOptions.format!),\n          'Content-Length': compressedBuffer.length.toString(),\n          'Cache-Control': 'public, max-age=86400', // 24 hours\n          'Vary': 'Accept, User-Agent'\n        });\n        \n        res.send(compressedBuffer);\n      } else {\n        // Serve original file without compression\n        await objectStorageService.downloadObject(file, res);\n      }\n    } catch (error) {\n      console.error('Error serving object:', error);\n      res.status(404).json({ message: 'Object not found' });\n    }\n  });\n\n  // Upload and process site image\n  app.post('/api/admin/site-image', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const { imageURL } = req.body;\n\n      if (!imageURL) {\n        return res.status(400).json({ message: 'Image URL is required' });\n      }\n\n      const objectStorageService = new ObjectStorageService();\n      const objectPath = await objectStorageService.trySetObjectEntityPath(imageURL);\n\n      res.json({\n        siteImage: objectPath,\n        message: 'Site image processed successfully'\n      });\n    } catch (error) {\n      console.error('Error processing site image:', error);\n      res.status(500).json({ message: 'Failed to process site image' });\n    }\n  });\n\n  // Serve private objects with authentication\n  app.get('/objects/:objectPath(*)', authenticateToken(['admin', 'employee']), async (req: AuthenticatedRequest, res) => {\n    try {\n      const objectStorageService = new ObjectStorageService();\n      const objectFile = await objectStorageService.getObjectEntityFile(req.path);\n      objectStorageService.downloadObject(objectFile, res);\n    } catch (error) {\n      console.error('Error serving object:', error);\n      if (error instanceof ObjectNotFoundError) {\n        return res.sendStatus(404);\n      }\n      return res.sendStatus(500);\n    }\n  });\n\n  // Upload admin profile image\n  app.post('/api/admin/profile-image', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const { imageURL } = req.body;\n\n      if (!imageURL) {\n        return res.status(400).json({ message: 'Image URL is required' });\n      }\n\n      const objectStorageService = new ObjectStorageService();\n      const objectPath = await objectStorageService.trySetObjectEntityPath(imageURL);\n\n      // Update admin profile with object path\n      const updatedAdmin = await storage.updateAdmin(req.user!.id, {\n        profileImage: objectPath\n      });\n\n      res.json({\n        profileImage: updatedAdmin.profileImage,\n        message: 'Profile image updated successfully'\n      });\n    } catch (error) {\n      console.error('Error uploading admin profile image:', error);\n      res.status(500).json({ message: 'Failed to upload profile image' });\n    }\n  });\n\n  // Remove admin profile image\n  app.delete('/api/admin/profile-image', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      await storage.updateAdmin(req.user!.id, {\n        profileImage: null\n      });\n\n      res.json({ message: 'Profile image removed successfully' });\n    } catch (error) {\n      console.error('Error removing admin profile image:', error);\n      res.status(500).json({ message: 'Failed to remove profile image' });\n    }\n  });\n\n  // Upload employee profile image\n  app.post('/api/employee/profile-image', authenticateToken('employee'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const { imageURL } = req.body;\n\n      if (!imageURL) {\n        return res.status(400).json({ message: 'Image URL is required' });\n      }\n\n      const objectStorageService = new ObjectStorageService();\n      const objectPath = await objectStorageService.trySetObjectEntityPath(imageURL);\n\n      // Update employee profile with object path\n      const updatedEmployee = await storage.updateEmployee(req.user!.id, {\n        profileImage: objectPath\n      });\n\n      res.json({\n        profileImage: updatedEmployee.profileImage,\n        message: 'Profile image updated successfully'\n      });\n    } catch (error) {\n      console.error('Error uploading employee profile image:', error);\n      res.status(500).json({ message: 'Failed to upload profile image' });\n    }\n  });\n\n  // Remove employee profile image\n  app.delete('/api/employee/profile-image', authenticateToken('employee'), async (req: AuthenticatedRequest, res) => {\n    try {\n      await storage.updateEmployee(req.user!.id, {\n        profileImage: null\n      });\n\n      res.json({ message: 'Profile image removed successfully' });\n    } catch (error) {\n      console.error('Error removing employee profile image:', error);\n      res.status(500).json({ message: 'Failed to remove profile image' });\n    }\n  });\n\n  // Admin endpoints for managing employee profile images\n  app.post('/api/admin/employees/:id/profile-image', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const employeeId = parseInt(req.params.id);\n      const { imageURL } = req.body;\n\n      if (!imageURL) {\n        return res.status(400).json({ message: 'Image URL is required' });\n      }\n\n      // Check if this employee belongs to the admin\n      const adminEmployees = await storage.getEmployeesByAdmin(req.user!.id);\n      if (!adminEmployees.find(emp => emp.id === employeeId)) {\n        return res.status(403).json({ message: 'Access denied' });\n      }\n\n      const objectStorageService = new ObjectStorageService();\n      const objectPath = await objectStorageService.trySetObjectEntityPath(imageURL);\n\n      // Update employee profile with object path\n      const updatedEmployee = await storage.updateEmployee(employeeId, {\n        profileImage: objectPath\n      });\n\n      res.json({\n        profileImage: updatedEmployee.profileImage,\n        message: 'Employee profile image updated successfully'\n      });\n    } catch (error) {\n      console.error('Error uploading employee profile image:', error);\n      res.status(500).json({ message: 'Failed to upload profile image' });\n    }\n  });\n\n  app.delete('/api/admin/employees/:id/profile-image', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const employeeId = parseInt(req.params.id);\n\n      // Check if this employee belongs to the admin\n      const adminEmployees = await storage.getEmployeesByAdmin(req.user!.id);\n      if (!adminEmployees.find(emp => emp.id === employeeId)) {\n        return res.status(403).json({ message: 'Access denied' });\n      }\n\n      await storage.updateEmployee(employeeId, {\n        profileImage: null\n      });\n\n      res.json({ message: 'Employee profile image removed successfully' });\n    } catch (error) {\n      console.error('Error removing employee profile image:', error);\n      res.status(500).json({ message: 'Failed to remove profile image' });\n    }\n  });\n\n  // Department Management Routes\n  app.get('/api/admin/departments', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const departments = await storage.getDepartmentsByAdmin(req.user!.id);\n      res.json(departments);\n    } catch (error) {\n      console.error('Error fetching departments:', error);\n      res.status(500).json({ message: 'Failed to fetch departments' });\n    }\n  });\n\n  app.post('/api/admin/departments', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const validatedData = insertDepartmentSchema.parse({\n        ...req.body,\n        adminId: req.user!.id,\n      });\n\n      const department = await storage.createDepartment(validatedData);\n      res.json(department);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        const errorMessages = error.errors.map(err => `${err.path.join('.')}: ${err.message}`);\n        return res.status(400).json({ message: errorMessages.join(', ') });\n      }\n      console.error('Error creating department:', error);\n      res.status(500).json({ message: 'Failed to create department' });\n    }\n  });\n\n  app.put('/api/admin/departments/:id', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const departmentId = parseInt(req.params.id);\n      const { name, description } = req.body;\n\n      // Check if this department belongs to the admin\n      const department = await storage.getDepartment(departmentId);\n      if (!department || department.adminId !== req.user!.id) {\n        return res.status(403).json({ message: 'Access denied' });\n      }\n\n      const updatedDepartment = await storage.updateDepartment(departmentId, {\n        name,\n        description,\n      });\n\n      res.json(updatedDepartment);\n    } catch (error) {\n      console.error('Error updating department:', error);\n      res.status(500).json({ message: 'Failed to update department' });\n    }\n  });\n\n  app.delete('/api/admin/departments/:id', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const departmentId = parseInt(req.params.id);\n\n      // Check if this department belongs to the admin\n      const department = await storage.getDepartment(departmentId);\n      if (!department || department.adminId !== req.user!.id) {\n        return res.status(403).json({ message: 'Access denied' });\n      }\n\n      // Check if department has employees assigned\n      const employees = await storage.getEmployeesByDepartment(departmentId);\n      if (employees.length > 0) {\n        return res.status(400).json({ \n          message: 'Cannot delete department with assigned employees. Please reassign employees first.' \n        });\n      }\n\n      await storage.deleteDepartment(departmentId);\n      res.json({ message: 'Department deleted successfully' });\n    } catch (error) {\n      console.error('Error deleting department:', error);\n      res.status(500).json({ message: 'Failed to delete department' });\n    }\n  });\n\n  // Employee Management Routes\n  app.get('/api/admin/employees', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const employees = await storage.getEmployeesByAdmin(req.user!.id);\n      res.json(employees);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch employees' });\n    }\n  });\n\n  app.get('/api/admin/employees/:id', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const employeeId = parseInt(req.params.id);\n      const employee = await storage.getEmployee(employeeId);\n      \n      if (!employee) {\n        return res.status(404).json({ message: 'Employee not found' });\n      }\n\n      // Check if this employee belongs to the admin\n      const adminEmployees = await storage.getEmployeesByAdmin(req.user!.id);\n      if (!adminEmployees.find(emp => emp.id === employeeId)) {\n        return res.status(403).json({ message: 'Access denied' });\n      }\n\n      res.json(employee);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch employee' });\n    }\n  });\n\n  app.get('/api/admin/employees/:id/attendance', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const employeeId = parseInt(req.params.id);\n      const attendance = await storage.getEmployeeAttendanceHistory(employeeId, new Date(0));\n      res.json(attendance);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch attendance records' });\n    }\n  });\n\n  app.get('/api/admin/employees/:id/locations', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const employeeId = parseInt(req.params.id);\n      const locations = await storage.getEmployeeLocationHistory(employeeId);\n      res.json(locations);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch location history' });\n    }\n  });\n\n  app.post('/api/admin/employees', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      console.log('Employee creation request body:', JSON.stringify(req.body, null, 2));\n      \n      // Pre-process data before validation\n      const processedData = { ...req.body };\n      \n      // Convert departmentId to number if it's a string\n      if (processedData.departmentId) {\n        if (typeof processedData.departmentId === 'string') {\n          if (processedData.departmentId === 'none' || processedData.departmentId === '') {\n            processedData.departmentId = null;\n          } else {\n            processedData.departmentId = parseInt(processedData.departmentId);\n          }\n        }\n      }\n      \n      // Convert siteId to number if it's a string\n      if (processedData.siteId) {\n        if (typeof processedData.siteId === 'string') {\n          if (processedData.siteId === 'none' || processedData.siteId === '') {\n            processedData.siteId = null;\n          } else {\n            processedData.siteId = parseInt(processedData.siteId);\n          }\n        }\n      }\n      \n      // Remove adminId from validation since we set it manually\n      const validatedData = insertEmployeeSchema.omit({ adminId: true }).parse(processedData);\n      \n      console.log('Validated data:', JSON.stringify(validatedData, null, 2));\n      \n      // Check if email already exists across both admin and employee tables\n      const emailExists = await storage.checkEmailExists(validatedData.email);\n      if (emailExists) {\n        return res.status(400).json({ \n          message: 'Email address already exists. Please use a different email address.' \n        });\n      }\n\n      const hashedPassword = await bcrypt.hash(validatedData.password, 10);\n      \n      // Normalize profile image URL if provided\n      let profileImage = validatedData.profileImage;\n      if (profileImage) {\n        const objectStorageService = new ObjectStorageService();\n        profileImage = await objectStorageService.trySetObjectEntityPath(profileImage);\n      }\n      \n      // Auto-generate employeeId if not provided\n      let employeeId = validatedData.employeeId;\n      if (!employeeId) {\n        const employees = await storage.getEmployeesByAdmin(req.user!.id);\n        employeeId = `EMP${String(employees.length + 1).padStart(3, '0')}`;\n      }\n      \n      const employee = await storage.createEmployee({\n        ...validatedData,\n        employeeId,\n        password: hashedPassword,\n        profileImage,\n        adminId: req.user!.id,\n      });\n\n      res.status(201).json(employee);\n    } catch (error) {\n      console.error('Employee creation error:', error);\n      if (error instanceof z.ZodError) {\n        const errorMessages = error.errors.map(err => `${err.path.join('.')}: ${err.message}`);\n        return res.status(400).json({ message: errorMessages.join(', ') });\n      }\n      res.status(400).json({ message: error instanceof Error ? error.message : 'Failed to create employee' });\n    }\n  });\n\n  app.put('/api/admin/employees/:id', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      \n      // Pre-process data before validation\n      const processedData = { ...req.body };\n      \n      // Convert departmentId to number if it's a string\n      if (processedData.departmentId) {\n        if (typeof processedData.departmentId === 'string') {\n          if (processedData.departmentId === 'none' || processedData.departmentId === '') {\n            processedData.departmentId = null;\n          } else {\n            processedData.departmentId = parseInt(processedData.departmentId);\n          }\n        }\n      }\n      \n      // Convert siteId to number if it's a string\n      if (processedData.siteId) {\n        if (typeof processedData.siteId === 'string') {\n          if (processedData.siteId === 'none' || processedData.siteId === '') {\n            processedData.siteId = null;\n          } else {\n            processedData.siteId = parseInt(processedData.siteId);\n          }\n        }\n      }\n      \n      const validatedData = insertEmployeeSchema.omit({ \n        adminId: true, \n        password: true \n      }).partial().parse(processedData);\n      \n      // Handle password updates separately if provided in original body\n      let hashedPassword;\n      if (req.body.password) {\n        hashedPassword = await bcrypt.hash(req.body.password, 10);\n      }\n      \n      // Normalize profile image URL if provided\n      if (validatedData.profileImage) {\n        const objectStorageService = new ObjectStorageService();\n        validatedData.profileImage = await objectStorageService.trySetObjectEntityPath(validatedData.profileImage);\n      }\n      \n      const employee = await storage.updateEmployee(id, {\n        ...validatedData,\n        ...(hashedPassword && { password: hashedPassword })\n      });\n      res.json(employee);\n    } catch (error) {\n      console.error('Employee update error:', error);\n      if (error instanceof z.ZodError) {\n        const errorMessages = error.errors.map(err => `${err.path.join('.')}: ${err.message}`);\n        return res.status(400).json({ message: errorMessages.join(', ') });\n      }\n      res.status(400).json({ message: error instanceof Error ? error.message : 'Failed to update employee' });\n    }\n  });\n\n  app.delete('/api/admin/employees/:id', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteEmployee(id);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to delete employee' });\n    }\n  });\n\n  // Work Site Management Routes\n  app.get('/api/admin/sites', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const sites = await storage.getWorkSitesByAdmin(req.user!.id);\n      res.json(sites);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch work sites' });\n    }\n  });\n\n  app.post('/api/admin/sites', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      console.log('Site creation request body:', JSON.stringify(req.body, null, 2));\n      const validatedData = insertWorkSiteSchema.omit({ adminId: true }).parse(req.body);\n      console.log('Validated site data:', JSON.stringify(validatedData, null, 2));\n      \n      // Process site image URL if provided\n      let processedData = validatedData;\n      if (validatedData.siteImage) {\n        try {\n          const objectStorageService = new ObjectStorageService();\n          const objectPath = await objectStorageService.trySetObjectEntityPath(validatedData.siteImage);\n          processedData = {\n            ...validatedData,\n            siteImage: objectPath\n          };\n          console.log('Processed site image URL:', objectPath);\n        } catch (error) {\n          console.error('Error processing site image URL:', error);\n          // Continue without image rather than failing entire site creation\n          processedData = {\n            ...validatedData,\n            siteImage: undefined\n          };\n        }\n      }\n      \n      const site = await storage.createWorkSite({\n        ...processedData,\n        adminId: req.user!.id,\n      });\n\n      res.status(201).json(site);\n    } catch (error) {\n      console.error('Site creation error:', error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: error.errors.map(e => e.message).join(', ') });\n      }\n      res.status(400).json({ message: error instanceof Error ? error.message : 'Failed to create work site' });\n    }\n  });\n\n  app.put('/api/admin/sites/:id', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      console.log('Site update request body:', JSON.stringify(req.body, null, 2));\n      \n      const validatedData = insertWorkSiteSchema.partial().parse(req.body);\n      console.log('Validated site update data:', JSON.stringify(validatedData, null, 2));\n      \n      // Process site image URL if provided\n      let processedData = validatedData;\n      if (validatedData.siteImage) {\n        try {\n          const objectStorageService = new ObjectStorageService();\n          const objectPath = await objectStorageService.trySetObjectEntityPath(validatedData.siteImage);\n          processedData = {\n            ...validatedData,\n            siteImage: objectPath\n          };\n          console.log('Processed updated site image URL:', objectPath);\n        } catch (error) {\n          console.error('Error processing updated site image URL:', error);\n          // Continue with original data on image processing error\n        }\n      }\n      \n      const site = await storage.updateWorkSite(id, processedData);\n      res.json(site);\n    } catch (error) {\n      console.error('Site update error:', error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: error.errors.map(e => e.message).join(', ') });\n      }\n      res.status(400).json({ message: error instanceof Error ? error.message : 'Failed to update work site' });\n    }\n  });\n\n  app.delete('/api/admin/sites/:id', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      await storage.deleteWorkSite(id);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to delete work site' });\n    }\n  });\n\n  // Upload work site image\n  app.put('/api/admin/sites/:id/image', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const siteId = parseInt(req.params.id);\n      const { siteImageURL } = req.body;\n\n      if (!siteImageURL) {\n        return res.status(400).json({ message: 'Site image URL is required' });\n      }\n\n      // Check if this site belongs to the admin\n      const adminSites = await storage.getWorkSitesByAdmin(req.user!.id);\n      if (!adminSites.find(site => site.id === siteId)) {\n        return res.status(403).json({ message: 'Access denied' });\n      }\n\n      const objectStorageService = new ObjectStorageService();\n      const objectPath = await objectStorageService.trySetObjectEntityPath(siteImageURL);\n\n      // Update work site with object path\n      const updatedSite = await storage.updateWorkSite(siteId, {\n        siteImage: objectPath\n      });\n\n      res.json({\n        siteImage: updatedSite.siteImage,\n        message: 'Site image updated successfully'\n      });\n    } catch (error) {\n      console.error('Error uploading site image:', error);\n      res.status(500).json({ message: 'Failed to upload site image' });\n    }\n  });\n\n  // Remove work site image\n  app.delete('/api/admin/sites/:id/image', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const siteId = parseInt(req.params.id);\n\n      // Check if this site belongs to the admin\n      const adminSites = await storage.getWorkSitesByAdmin(req.user!.id);\n      if (!adminSites.find(site => site.id === siteId)) {\n        return res.status(403).json({ message: 'Access denied' });\n      }\n\n      await storage.updateWorkSite(siteId, {\n        siteImage: null\n      });\n\n      res.json({ message: 'Site image removed successfully' });\n    } catch (error) {\n      console.error('Error removing site image:', error);\n      res.status(500).json({ message: 'Failed to remove site image' });\n    }\n  });\n\n  // Areas Management Routes\n  app.get('/api/admin/areas', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const areas = await storage.getAreasByAdmin(req.user!.id);\n      res.json(areas);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch areas' });\n    }\n  });\n\n  app.post('/api/admin/areas', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const validatedData = insertAreaSchema.parse({\n        ...req.body,\n        adminId: req.user!.id,\n      });\n      const area = await storage.createArea(validatedData);\n      res.status(201).json(area);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: error.errors.map(e => e.message).join(', ') });\n      }\n      res.status(400).json({ message: 'Failed to create area' });\n    }\n  });\n\n  app.put('/api/admin/areas/:id', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const areaId = parseInt(req.params.id);\n      const validatedData = insertAreaSchema.partial().parse(req.body);\n      \n      // Check if this area belongs to the admin\n      const adminAreas = await storage.getAreasByAdmin(req.user!.id);\n      if (!adminAreas.find(area => area.id === areaId)) {\n        return res.status(403).json({ message: 'Access denied' });\n      }\n\n      const area = await storage.updateArea(areaId, validatedData);\n      res.json(area);\n    } catch (error) {\n      res.status(400).json({ message: 'Failed to update area' });\n    }\n  });\n\n  app.delete('/api/admin/areas/:id', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const areaId = parseInt(req.params.id);\n      \n      // Check if this area belongs to the admin\n      const adminAreas = await storage.getAreasByAdmin(req.user!.id);\n      if (!adminAreas.find(area => area.id === areaId)) {\n        return res.status(403).json({ message: 'Access denied' });\n      }\n\n      await storage.deleteArea(areaId);\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to delete area' });\n    }\n  });\n\n  // Employee Check-in/Check-out Routes\n  app.post('/api/employee/checkin', authenticateToken('employee'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const { latitude, longitude, siteId } = req.body;\n      \n      // Check if employee is already checked in\n      const currentAttendance = await storage.getCurrentAttendance(req.user!.id);\n      if (currentAttendance) {\n        return res.status(400).json({ message: 'Already checked in' });\n      }\n\n      const attendance = await storage.createAttendance({\n        employeeId: req.user!.id,\n        siteId: parseInt(siteId),\n        checkInLatitude: latitude,\n        checkInLongitude: longitude,\n      });\n\n      res.json(attendance);\n    } catch (error) {\n      res.status(400).json({ message: 'Check-in failed' });\n    }\n  });\n\n  app.post('/api/employee/checkout', authenticateToken('employee'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const { latitude, longitude } = req.body;\n      \n      const currentAttendance = await storage.getCurrentAttendance(req.user!.id);\n      if (!currentAttendance) {\n        return res.status(400).json({ message: 'Not currently checked in' });\n      }\n\n      const updatedAttendance = await storage.updateAttendance(currentAttendance.id, {\n        checkOutTime: new Date(),\n        checkOutLatitude: latitude,\n        checkOutLongitude: longitude,\n      });\n\n      res.json(updatedAttendance);\n    } catch (error) {\n      res.status(400).json({ message: 'Check-out failed' });\n    }\n  });\n\n  // Employee attendance history route (30-day filter)\n  app.get('/api/employee/attendance/history', authenticateToken('employee'), async (req: AuthenticatedRequest, res) => {\n    try {\n      // Get attendance history from last 30 days\n      const thirtyDaysAgo = new Date();\n      thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n      \n      const history = await storage.getEmployeeAttendanceHistory(req.user!.id, thirtyDaysAgo);\n      res.json(history);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch attendance history' });\n    }\n  });\n\n  // Location Tracking Routes\n  app.get('/api/admin/locations', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const employees = await storage.getEmployeesByAdmin(req.user!.id);\n      const locations = await Promise.all(\n        employees.map(async (employee) => {\n          // Only show locations for employees who are currently checked in\n          const currentAttendance = await storage.getCurrentAttendance(employee.id);\n          if (currentAttendance) {\n            const location = await storage.getLatestEmployeeLocation(employee.id);\n            \n            // Calculate if employee is within geofence\n            let isWithinGeofence = false;\n            const siteId = employee.siteId;\n            if (location && siteId) {\n              const assignedSite = await storage.getWorkSite(siteId);\n              if (assignedSite) {\n                const distance = calculateDistance(\n                  parseFloat(location.latitude),\n                  parseFloat(location.longitude),\n                  parseFloat(assignedSite.latitude),\n                  parseFloat(assignedSite.longitude)\n                );\n                isWithinGeofence = distance <= assignedSite.geofenceRadius;\n                console.log(`Employee ${employee.firstName} distance: ${distance}m, geofence: ${assignedSite.geofenceRadius}m, within: ${isWithinGeofence}`);\n              }\n            }\n            \n            return {\n              employee: {\n                ...employee,\n                isCheckedIn: true,\n                isActive: true\n              },\n              location: location ? {\n                ...location,\n                isWithinGeofence\n              } : null,\n            };\n          }\n          return null;\n        })\n      );\n      \n      // Filter out null values (employees not checked in)\n      const activeLocations = locations.filter(Boolean);\n      res.json(activeLocations);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch employee locations' });\n    }\n  });\n\n  app.post('/api/employee/location', authenticateToken('employee'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const { latitude, longitude } = req.body;\n      const employee = await storage.getEmployee(req.user!.id);\n      \n      if (!employee) {\n        return res.status(404).json({ message: 'Employee not found' });\n      }\n\n      // Calculate if employee is on site\n      const assignedSite = employee.siteId ? await storage.getWorkSite(employee.siteId) : null;\n      let isOnSite = false;\n      \n      if (assignedSite) {\n        const distance = calculateDistance(\n          parseFloat(latitude),\n          parseFloat(longitude),\n          parseFloat(assignedSite.latitude),\n          parseFloat(assignedSite.longitude)\n        );\n        isOnSite = distance <= assignedSite.geofenceRadius;\n      }\n\n      // Save location tracking\n      await storage.createLocationTracking({\n        employeeId: employee.id,\n        latitude,\n        longitude,\n        isOnSite,\n      });\n\n      res.json({ success: true, isOnSite });\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to update location' });\n    }\n  });\n\n  app.get('/api/employee/status', authenticateToken('employee'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const currentAttendance = await storage.getCurrentAttendance(req.user!.id);\n      const employee = await storage.getEmployee(req.user!.id);\n      \n      res.json({\n        isCheckedIn: !!currentAttendance,\n        attendance: currentAttendance,\n        assignedSite: employee?.siteId,\n      });\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch employee status' });\n    }\n  });\n\n  // Export Report endpoint\n  app.post('/api/admin/export-report', authenticateToken('admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const { email, fromEmail, subject, format = 'html' } = req.body;\n      \n      if (!email || !fromEmail || !subject) {\n        return res.status(400).json({ message: 'Email, fromEmail, and subject are required' });\n      }\n\n      // Validate format\n      const validFormats = ['html', 'pdf', 'excel', 'csv'];\n      if (!validFormats.includes(format)) {\n        return res.status(400).json({ message: 'Invalid format. Must be one of: html, pdf, excel, csv' });\n      }\n\n      // Get all employees for this admin\n      const employees = await storage.getEmployeesByAdmin(req.user!.id);\n      \n      // Get 30-day attendance data for all employees\n      const thirtyDaysAgo = new Date();\n      thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n      \n      const attendanceData = await Promise.all(\n        employees.map(async (employee) => {\n          const history = await storage.getEmployeeAttendanceHistory(employee.id, thirtyDaysAgo);\n          const site = employee.siteId ? await storage.getWorkSite(employee.siteId) : null;\n          \n          return {\n            employee,\n            site,\n            attendance: history\n          };\n        })\n      );\n\n      // Generate report based on format\n      let reportContent: string | Buffer;\n      let attachments: any[] = [];\n      let emailHtml = '';\n\n      if (format === 'html') {\n        reportContent = generateAttendanceReportHtml(attendanceData, thirtyDaysAgo);\n        emailHtml = reportContent;\n      } else if (format === 'pdf') {\n        try {\n          reportContent = await generatePdfReport(attendanceData, thirtyDaysAgo);\n          emailHtml = 'Please find the attendance report attached as a PDF file.';\n          attachments = [{\n            content: reportContent.toString('base64'),\n            filename: `attendance-report-${new Date().toISOString().split('T')[0]}.pdf`,\n            type: 'application/pdf',\n            disposition: 'attachment'\n          }];\n        } catch (pdfError) {\n          console.error('PDF generation failed, falling back to HTML:', pdfError);\n          // Fallback to HTML format if PDF generation fails\n          reportContent = generateAttendanceReportHtml(attendanceData, thirtyDaysAgo);\n          emailHtml = reportContent;\n          attachments = [];\n        }\n      } else if (format === 'excel') {\n        reportContent = await generateExcelReport(attendanceData, thirtyDaysAgo);\n        emailHtml = 'Please find the attendance report attached as an Excel file.';\n        attachments = [{\n          content: reportContent.toString('base64'),\n          filename: `attendance-report-${new Date().toISOString().split('T')[0]}.xlsx`,\n          type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n          disposition: 'attachment'\n        }];\n      } else if (format === 'csv') {\n        reportContent = await generateCsvReport(attendanceData, thirtyDaysAgo);\n        emailHtml = 'Please find the attendance report attached as a CSV file.';\n        attachments = [{\n          content: Buffer.from(reportContent).toString('base64'),\n          filename: `attendance-report-${new Date().toISOString().split('T')[0]}.csv`,\n          type: 'text/csv',\n          disposition: 'attachment'\n        }];\n      }\n      \n      // Validate email addresses\n      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n      if (!emailRegex.test(email) || !emailRegex.test(fromEmail)) {\n        return res.status(400).json({ message: 'Invalid email address format' });\n      }\n\n      console.log(`Sending attendance report (${format.toUpperCase()}) from ${fromEmail} to ${email}`);\n      console.log(`Report contains ${attendanceData.length} employees`);\n\n      // For SendGrid to work properly, the 'from' email should be verified\n      // We'll use a safer approach with a verified sender\n      let actualFromEmail = fromEmail;\n      \n      // If using Gmail, suggest using a verified sender to avoid spam filters\n      if (fromEmail.includes('@gmail.com') || fromEmail.includes('@yahoo.com') || fromEmail.includes('@hotmail.com')) {\n        console.warn(`Warning: Using ${fromEmail} as sender. For better delivery, verify this email in SendGrid.`);\n      }\n\n      // Send email\n      const emailSent = await sendEmail({\n        to: email,\n        from: actualFromEmail,\n        subject: subject,\n        html: emailHtml,\n        text: 'Please view this email in HTML format to see the attendance report.',\n        attachments: attachments\n      });\n\n      if (emailSent) {\n        res.json({ message: 'Report sent successfully' });\n      } else {\n        res.status(500).json({ message: 'Failed to send email (export failed)' });\n      }\n    } catch (error) {\n      console.error('Export report error:', error);\n      res.status(500).json({ message: 'Failed to generate and send report (export failed)' });\n    }\n  });\n\n  // Super Admin Routes\n  app.post('/api/super-admin/login', async (req, res) => {\n    try {\n      const { email, password } = adminLoginSchema.parse(req.body);\n\n      const admin = await storage.getAdminByEmail(email);\n      if (!admin || admin.role !== 'super_admin') {\n        return res.status(401).json({ message: 'Invalid credentials or insufficient permissions' });\n      }\n\n      const isValidPassword = await bcrypt.compare(password, admin.password);\n      if (!isValidPassword) {\n        return res.status(401).json({ message: 'Invalid credentials' });\n      }\n\n      const token = jwt.sign(\n        { id: admin.id, type: 'super_admin' },\n        JWT_SECRET,\n        { expiresIn: '24h' }\n      );\n\n      res.json({ \n        token,\n        admin: {\n          id: admin.id,\n          firstName: admin.firstName,\n          lastName: admin.lastName,\n          email: admin.email,\n          role: admin.role,\n        }\n      });\n    } catch (error) {\n      res.status(401).json({ message: 'Invalid credentials' });\n    }\n  });\n\n  // Super Admin - Get all pending admins\n  app.get('/api/super-admin/pending-admins', authenticateToken('super_admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const pendingAdmins = await storage.getPendingAdmins();\n      res.json(pendingAdmins);\n    } catch (error) {\n      res.status(500).json({ message: 'Failed to fetch pending admins' });\n    }\n  });\n\n  // Super Admin - Activate/Deactivate admin\n  app.put('/api/super-admin/activate-admin', authenticateToken('super_admin'), async (req: AuthenticatedRequest, res) => {\n    try {\n      const { adminId, isActive } = adminActivationSchema.parse(req.body);\n      \n      const updatedAdmin = await storage.updateAdminStatus(adminId, isActive);\n      res.json(updatedAdmin);\n    } catch (error) {\n      res.status(400).json({ message: 'Failed to update admin status' });\n    }\n  });\n\n  // Admin Email Verification\n  app.post('/api/admin/verify-email', async (req, res) => {\n    try {\n      const { token } = adminVerificationSchema.parse(req.body);\n      \n      const admin = await storage.verifyAdminEmail(token);\n      if (!admin) {\n        return res.status(400).json({ message: 'Invalid or expired verification token' });\n      }\n\n      res.json({ message: 'Email verified successfully. Your account is pending activation by a Super Admin.' });\n    } catch (error) {\n      res.status(400).json({ message: 'Invalid verification token' });\n    }\n  });\n\n  // Resend Verification Email\n  app.post('/api/admin/resend-verification', async (req, res) => {\n    try {\n      const { email } = req.body;\n      \n      const admin = await storage.getAdminByEmail(email);\n      if (!admin) {\n        return res.status(404).json({ message: 'Admin account not found' });\n      }\n\n      if (admin.isVerified) {\n        return res.status(400).json({ message: 'Email is already verified' });\n      }\n\n      // Generate new verification token\n      const verificationToken = jwt.sign(\n        { email: admin.email, timestamp: Date.now() },\n        JWT_SECRET,\n        { expiresIn: '24h' }\n      );\n\n      // Update admin with new token\n      await storage.updateAdmin(admin.id, { verificationToken });\n\n      // Send verification email\n      const verificationLink = `${req.protocol}://${req.get('host')}/admin/verify-email?token=${verificationToken}`;\n      \n      console.log('Resending verification email to:', email);\n      console.log('New verification link:', verificationLink);\n      \n      const emailSent = await sendEmail({\n        to: email,\n        from: process.env.SENDGRID_FROM_EMAIL || 'noreply@labourtrackr.com',\n        subject: 'Verify Your Admin Account - LabourTrackr',\n        html: `\n          <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n            <h2 style=\"color: #007cba;\">Email Verification - LabourTrackr</h2>\n            <p>Please verify your email address by clicking the button below:</p>\n            <div style=\"text-align: center; margin: 30px 0;\">\n              <a href=\"${verificationLink}\" style=\"background: #007cba; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block;\">Verify Email Address</a>\n            </div>\n            <p><strong>Important:</strong> This verification link will expire in 24 hours.</p>\n            <p>After email verification, a Super Admin will need to activate your account before you can access the system.</p>\n            <hr style=\"border: 1px solid #eee; margin: 20px 0;\">\n            <p style=\"color: #666; font-size: 12px;\">If you didn't request this verification, please ignore this email.</p>\n          </div>\n        `,\n        text: `Please verify your email by visiting: ${verificationLink}. This link expires in 24 hours.`\n      });\n\n      if (emailSent) {\n        res.json({ \n          message: 'Verification email sent successfully. Please check your email.',\n          details: 'A new verification email has been sent to your email address.'\n        });\n      } else {\n        console.error('Failed to resend verification email for admin:', email);\n        res.status(500).json({ \n          message: 'Failed to send verification email. Please contact support.',\n          error: 'Email delivery failed'\n        });\n      }\n    } catch (error) {\n      console.error('Resend verification error:', error);\n      res.status(500).json({ message: 'Failed to resend verification email' });\n    }\n  });\n\n  // Enhanced Admin Signup with email verification\n  app.post('/api/admin/signup', async (req, res) => {\n    try {\n      const validatedData = insertAdminSchema.parse(req.body);\n      \n      // Check if email already exists\n      const existingAdmin = await storage.getAdminByEmail(validatedData.email);\n      if (existingAdmin) {\n        return res.status(400).json({ message: 'Email already registered' });\n      }\n\n      const hashedPassword = await bcrypt.hash(validatedData.password, 10);\n      \n      // Generate verification token\n      const verificationToken = jwt.sign(\n        { email: validatedData.email, timestamp: Date.now() },\n        JWT_SECRET,\n        { expiresIn: '24h' }\n      );\n\n      const admin = await storage.createAdmin({\n        ...validatedData,\n        password: hashedPassword,\n        verificationToken,\n        isVerified: false,\n        isActive: false,\n      });\n\n      // Send verification email\n      const verificationLink = `${req.protocol}://${req.get('host')}/admin/verify-email?token=${verificationToken}`;\n      \n      console.log('Sending verification email to:', validatedData.email);\n      console.log('Verification link:', verificationLink);\n      \n      const emailSent = await sendEmail({\n        to: validatedData.email,\n        from: process.env.SENDGRID_FROM_EMAIL || 'noreply@labourtrackr.com',\n        subject: 'Verify Your Admin Account - LabourTrackr',\n        html: `\n          <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n            <h2 style=\"color: #007cba;\">Welcome to LabourTrackr!</h2>\n            <p>Thank you for signing up as an admin. Please verify your email address by clicking the button below:</p>\n            <div style=\"text-align: center; margin: 30px 0;\">\n              <a href=\"${verificationLink}\" style=\"background: #007cba; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block;\">Verify Email Address</a>\n            </div>\n            <p><strong>Important:</strong> This verification link will expire in 24 hours.</p>\n            <p>After email verification, a Super Admin will need to activate your account before you can access the system.</p>\n            <hr style=\"border: 1px solid #eee; margin: 20px 0;\">\n            <p style=\"color: #666; font-size: 12px;\">If you didn't request this account, please ignore this email.</p>\n          </div>\n        `,\n        text: `Welcome to LabourTrackr! Please verify your email by visiting: ${verificationLink}. This link expires in 24 hours.`\n      });\n\n      console.log('Email sent result:', emailSent);\n\n      if (emailSent) {\n        res.status(201).json({ \n          message: 'Account created successfully. Please check your email to verify your account.',\n          requiresVerification: true \n        });\n      } else {\n        res.status(201).json({ \n          message: 'Account created but verification email failed to send. Please contact support.',\n          requiresVerification: true \n        });\n      }\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        const errorMessages = error.errors.map(err => `${err.path.join('.')}: ${err.message}`);\n        return res.status(400).json({ message: errorMessages.join(', ') });\n      }\n      res.status(400).json({ message: 'Failed to create admin account' });\n    }\n  });\n\n  return httpServer;\n}\n\n// Helper function to generate HTML report\nfunction generateAttendanceReportHtml(attendanceData: any[], fromDate: Date): string {\n  const formatDate = (date: Date | string) => {\n    return new Date(date).toLocaleDateString('en-US', {\n      weekday: 'short',\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    });\n  };\n\n  const formatTime = (date: Date | string) => {\n    return new Date(date).toLocaleTimeString('en-US', {\n      hour: '2-digit',\n      minute: '2-digit',\n      hour12: true\n    });\n  };\n\n  const calculateHours = (checkIn: Date | string, checkOut: Date | string | null) => {\n    if (!checkOut) return 'In Progress';\n    const start = new Date(checkIn);\n    const end = new Date(checkOut);\n    const diffMs = end.getTime() - start.getTime();\n    const hours = Math.floor(diffMs / (1000 * 60 * 60));\n    const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\n    return `${hours}h ${minutes}m`;\n  };\n\n  return `\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset=\"utf-8\">\n      <title>Employee Attendance Report</title>\n      <style>\n        body { font-family: Arial, sans-serif; margin: 20px; }\n        .header { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px; }\n        .employee-section { margin-bottom: 30px; border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden; }\n        .employee-header { background: #e9ecef; padding: 15px; }\n        .attendance-table { width: 100%; border-collapse: collapse; }\n        .attendance-table th, .attendance-table td { padding: 10px; text-align: left; border-bottom: 1px solid #dee2e6; }\n        .attendance-table th { background: #f8f9fa; font-weight: bold; }\n        .no-data { text-align: center; padding: 20px; color: #6c757d; }\n        .summary { background: #e3f2fd; padding: 15px; border-radius: 4px; margin: 10px 0; }\n      </style>\n    </head>\n    <body>\n      <div class=\"header\">\n        <h1>Employee Attendance Report</h1>\n        <p><strong>Report Period:</strong> ${formatDate(fromDate)} - ${formatDate(new Date())}</p>\n        <p><strong>Generated on:</strong> ${formatDate(new Date())} at ${formatTime(new Date())}</p>\n      </div>\n\n      ${attendanceData.map(({ employee, site, attendance }) => `\n        <div class=\"employee-section\">\n          <div class=\"employee-header\">\n            <h2>${employee.firstName} ${employee.lastName}</h2>\n            <p><strong>Email:</strong> ${employee.email}</p>\n            <p><strong>Assigned Site:</strong> ${site ? site.name : 'No assigned site'}</p>\n            ${site ? `<p><strong>Site Address:</strong> ${site.address}</p>` : ''}\n          </div>\n          \n          <div class=\"summary\">\n            <strong>Summary:</strong> ${attendance.length} attendance records in the last 30 days\n          </div>\n\n          ${attendance.length > 0 ? `\n            <table class=\"attendance-table\">\n              <thead>\n                <tr>\n                  <th>Date</th>\n                  <th>Check In</th>\n                  <th>Check Out</th>\n                  <th>Hours Worked</th>\n                  <th>Site</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${attendance.map((record: any) => `\n                  <tr>\n                    <td>${formatDate(record.checkInTime)}</td>\n                    <td>${formatTime(record.checkInTime)}</td>\n                    <td>${record.checkOutTime ? formatTime(record.checkOutTime) : 'Still checked in'}</td>\n                    <td>${calculateHours(record.checkInTime, record.checkOutTime)}</td>\n                    <td>${site ? site.name : 'Unknown'}</td>\n                  </tr>\n                `).join('')}\n              </tbody>\n            </table>\n          ` : `\n            <div class=\"no-data\">\n              No attendance records found for this employee in the last 30 days.\n            </div>\n          `}\n        </div>\n      `).join('')}\n\n      <div class=\"header\">\n        <p><em>This report was automatically generated by the Labor Tracking System.</em></p>\n      </div>\n    </body>\n    </html>\n  `;\n}\n\n// Generate PDF report using PDFKit\nasync function generatePdfReport(attendanceData: any[], fromDate: Date): Promise<Buffer> {\n  return new Promise((resolve, reject) => {\n    try {\n      const doc = new PDFDocument({\n        size: 'A4',\n        margin: 50\n      });\n\n      const chunks: Buffer[] = [];\n      doc.on('data', (chunk) => chunks.push(chunk));\n      doc.on('end', () => resolve(Buffer.concat(chunks)));\n      doc.on('error', reject);\n\n      // Helper functions\n      const formatDate = (date: Date | string) => {\n        return new Date(date).toLocaleDateString('en-US', {\n          year: 'numeric',\n          month: 'long',\n          day: 'numeric'\n        });\n      };\n\n      const formatTime = (date: Date | string) => {\n        return new Date(date).toLocaleTimeString('en-US', {\n          hour: '2-digit',\n          minute: '2-digit',\n          hour12: true\n        });\n      };\n\n      const calculateHours = (checkIn: Date | string, checkOut: Date | string | null) => {\n        if (!checkOut) return 'In Progress';\n        const start = new Date(checkIn);\n        const end = new Date(checkOut);\n        const diffMs = end.getTime() - start.getTime();\n        const hours = Math.floor(diffMs / (1000 * 60 * 60));\n        const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));\n        return `${hours}h ${minutes}m`;\n      };\n\n      // Header\n      doc.fontSize(24).text('Employee Attendance Report', { align: 'center' });\n      doc.moveDown();\n      doc.fontSize(12)\n        .text(`Report Period: ${formatDate(fromDate)} - ${formatDate(new Date())}`)\n        .text(`Generated on: ${formatDate(new Date())} at ${formatTime(new Date())}`)\n        .moveDown(2);\n\n      // Employee data\n      attendanceData.forEach(({ employee, site, attendance }, index) => {\n        if (index > 0) {\n          doc.addPage();\n        }\n\n        // Employee header\n        doc.fontSize(18).text(`${employee.firstName} ${employee.lastName}`, { underline: true });\n        doc.moveDown(0.5);\n        doc.fontSize(12)\n          .text(`Email: ${employee.email}`)\n          .text(`Assigned Site: ${site ? site.name : 'No assigned site'}`)\n          .text(`Site Address: ${site ? site.address : 'N/A'}`)\n          .text(`Total Records: ${attendance.length} attendance records in the last 30 days`)\n          .moveDown();\n\n        if (attendance.length > 0) {\n          // Table header\n          const tableTop = doc.y;\n          const colWidths = [80, 80, 80, 80, 120];\n          const headers = ['Date', 'Check In', 'Check Out', 'Hours', 'Site'];\n          \n          let x = 50;\n          headers.forEach((header, i) => {\n            doc.rect(x, tableTop, colWidths[i], 25).stroke();\n            doc.fontSize(10).text(header, x + 5, tableTop + 8, { width: colWidths[i] - 10 });\n            x += colWidths[i];\n          });\n\n          // Table rows\n          let y = tableTop + 25;\n          attendance.forEach((record: any) => {\n            if (y > 700) { // New page if needed\n              doc.addPage();\n              y = 50;\n            }\n\n            x = 50;\n            const rowData = [\n              formatDate(record.checkInTime),\n              formatTime(record.checkInTime),\n              record.checkOutTime ? formatTime(record.checkOutTime) : 'Still in',\n              calculateHours(record.checkInTime, record.checkOutTime),\n              site ? site.name : 'Unknown'\n            ];\n\n            rowData.forEach((data, i) => {\n              doc.rect(x, y, colWidths[i], 20).stroke();\n              doc.fontSize(9).text(data, x + 3, y + 5, { width: colWidths[i] - 6, height: 15 });\n              x += colWidths[i];\n            });\n            y += 20;\n          });\n        } else {\n          doc.text('No attendance records found for this employee in the last 30 days.');\n        }\n      });\n\n      // Footer\n      doc.fontSize(10).text('This report was automatically generated by the Labor Tracking System.', 50, 750, {\n        align: 'center'\n      });\n\n      doc.end();\n    } catch (error) {\n      reject(error);\n    }\n  });\n}\n\n// Generate Excel report using XLSX\nasync function generateExcelReport(attendanceData: any[], fromDate: Date): Promise<Buffer> {\n  const workbook = XLSX.utils.book_new();\n  \n  // Summary sheet\n  const summaryData = attendanceData.map(({ employee, site, attendance }) => ({\n    'Employee Name': `${employee.firstName} ${employee.lastName}`,\n    'Email': employee.email,\n    'Assigned Site': site ? site.name : 'No assigned site',\n    'Site Address': site ? site.address : '',\n    'Total Records': attendance.length,\n    'Active Days': attendance.length\n  }));\n  \n  const summarySheet = XLSX.utils.json_to_sheet(summaryData);\n  XLSX.utils.book_append_sheet(workbook, summarySheet, 'Summary');\n  \n  // Detailed attendance sheet\n  const detailedData: any[] = [];\n  attendanceData.forEach(({ employee, site, attendance }) => {\n    attendance.forEach((record: any) => {\n      const checkIn = new Date(record.checkInTime);\n      const checkOut = record.checkOutTime ? new Date(record.checkOutTime) : null;\n      const hours = checkOut ? \n        Math.round((checkOut.getTime() - checkIn.getTime()) / (1000 * 60 * 60) * 100) / 100 : 0;\n      \n      detailedData.push({\n        'Employee Name': `${employee.firstName} ${employee.lastName}`,\n        'Email': employee.email,\n        'Date': checkIn.toLocaleDateString(),\n        'Check In Time': checkIn.toLocaleTimeString(),\n        'Check Out Time': checkOut ? checkOut.toLocaleTimeString() : 'Still checked in',\n        'Hours Worked': checkOut ? hours : 'In Progress',\n        'Site Name': site ? site.name : 'Unknown',\n        'Site Address': site ? site.address : ''\n      });\n    });\n  });\n  \n  const detailedSheet = XLSX.utils.json_to_sheet(detailedData);\n  XLSX.utils.book_append_sheet(workbook, detailedSheet, 'Detailed Attendance');\n  \n  return Buffer.from(XLSX.write(workbook, { type: 'buffer', bookType: 'xlsx' }));\n}\n\n// Generate CSV report\nasync function generateCsvReport(attendanceData: any[], fromDate: Date): Promise<string> {\n  const csvData: any[] = [];\n  \n  attendanceData.forEach(({ employee, site, attendance }) => {\n    attendance.forEach((record: any) => {\n      const checkIn = new Date(record.checkInTime);\n      const checkOut = record.checkOutTime ? new Date(record.checkOutTime) : null;\n      const hours = checkOut ? \n        Math.round((checkOut.getTime() - checkIn.getTime()) / (1000 * 60 * 60) * 100) / 100 : 0;\n      \n      csvData.push({\n        employee_name: `${employee.firstName} ${employee.lastName}`,\n        email: employee.email,\n        date: checkIn.toLocaleDateString(),\n        check_in_time: checkIn.toLocaleTimeString(),\n        check_out_time: checkOut ? checkOut.toLocaleTimeString() : 'Still checked in',\n        hours_worked: checkOut ? hours : 'In Progress',\n        site_name: site ? site.name : 'Unknown',\n        site_address: site ? site.address : ''\n      });\n    });\n  });\n  \n  // Convert to CSV format manually\n  if (csvData.length === 0) {\n    return 'employee_name,email,date,check_in_time,check_out_time,hours_worked,site_name,site_address\\n';\n  }\n  \n  const headers = Object.keys(csvData[0]);\n  const csvContent = [\n    headers.join(','),\n    ...csvData.map(row => \n      headers.map(header => {\n        const value = row[header];\n        // Escape commas and quotes in CSV\n        if (typeof value === 'string' && (value.includes(',') || value.includes('\"'))) {\n          return `\"${value.replace(/\"/g, '\"\"')}\"`;\n        }\n        return value;\n      }).join(',')\n    )\n  ].join('\\n');\n  \n  return csvContent;\n}\n","size_bytes":87758},"server/sendgrid.ts":{"content":"import { MailService } from '@sendgrid/mail';\n\nif (!process.env.SENDGRID_API_KEY) {\n  throw new Error(\"SENDGRID_API_KEY environment variable must be set\");\n}\n\nconst mailService = new MailService();\nmailService.setApiKey(process.env.SENDGRID_API_KEY);\n\ninterface EmailParams {\n  to: string;\n  from: string;\n  subject: string;\n  text?: string;\n  html?: string;\n  attachments?: Array<{\n    content: string;\n    filename: string;\n    type: string;\n    disposition: string;\n  }>;\n}\n\nexport async function sendEmail(params: EmailParams): Promise<boolean> {\n  try {\n    console.log('Attempting to send email:', {\n      to: params.to,\n      from: params.from,\n      subject: params.subject,\n      hasHtml: !!params.html,\n      hasText: !!params.text\n    });\n\n    const emailData: any = {\n      to: params.to,\n      from: params.from,\n      subject: params.subject,\n      text: params.text || 'Please view this email in HTML format to see the attendance report.',\n      html: params.html || '',\n    };\n\n    if (params.attachments && params.attachments.length > 0) {\n      emailData.attachments = params.attachments;\n    }\n\n    const result = await mailService.send(emailData);\n\n    console.log('SendGrid response:', result);\n    return true;\n  } catch (error) {\n    console.error('SendGrid email error:', error);\n    \n    // Log detailed error information\n    if (error && typeof error === 'object' && 'response' in error) {\n      const sgError = error as any;\n      console.error('SendGrid error details:', {\n        statusCode: sgError.code,\n        body: sgError.response?.body,\n        headers: sgError.response?.headers\n      });\n    }\n    \n    return false;\n  }\n}","size_bytes":1660},"server/storage.ts":{"content":"import {\n  admins,\n  employees,\n  workSites,\n  areas,\n  departments,\n  locationTracking,\n  attendance,\n  type Admin,\n  type Employee,\n  type WorkSite,\n  type Area,\n  type Department,\n  type LocationTracking,\n  type Attendance,\n  type InsertAdmin,\n  type InsertEmployee,\n  type InsertWorkSite,\n  type InsertArea,\n  type InsertDepartment,\n  type InsertLocationTracking,\n  type InsertAttendance,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, desc, sql } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // Admin operations\n  getAdmin(id: number): Promise<Admin | undefined>;\n  getAdminByEmail(email: string): Promise<Admin | undefined>;\n  getAdminByCompanyName(companyName: string): Promise<Admin | undefined>;\n  checkEmailExists(email: string): Promise<boolean>;\n  createAdmin(admin: InsertAdmin): Promise<Admin>;\n  updateAdmin(id: number, data: Partial<InsertAdmin>): Promise<Admin>;\n  updateAdminPassword(id: number, hashedPassword: string): Promise<void>;\n  \n  // Super Admin operations\n  getPendingAdmins(): Promise<Admin[]>;\n  updateAdminStatus(adminId: number, isActive: boolean): Promise<Admin>;\n  verifyAdminEmail(token: string): Promise<Admin | null>;\n  getAdminCount(): Promise<number>;\n  getSuperAdmins(): Promise<Admin[]>;\n\n  // Employee operations\n  getEmployee(id: number): Promise<Employee | undefined>;\n  getEmployeeByEmail(email: string): Promise<Employee | undefined>;\n  getEmployeesByAdmin(adminId: number): Promise<Employee[]>;\n  createEmployee(employee: InsertEmployee): Promise<Employee>;\n  updateEmployee(id: number, employee: Partial<InsertEmployee>): Promise<Employee>;\n  deleteEmployee(id: number): Promise<void>;\n\n  // Area operations\n  getArea(id: number): Promise<Area | undefined>;\n  getAreasByAdmin(adminId: number): Promise<Area[]>;\n  createArea(area: InsertArea): Promise<Area>;\n  updateArea(id: number, area: Partial<InsertArea>): Promise<Area>;\n  deleteArea(id: number): Promise<void>;\n\n  // Work site operations\n  getWorkSite(id: number): Promise<WorkSite | undefined>;\n  getWorkSitesByAdmin(adminId: number): Promise<WorkSite[]>;\n  createWorkSite(site: InsertWorkSite): Promise<WorkSite>;\n  updateWorkSite(id: number, site: Partial<InsertWorkSite>): Promise<WorkSite>;\n  deleteWorkSite(id: number): Promise<void>;\n\n  // Department operations\n  getDepartment(id: number): Promise<Department | undefined>;\n  getDepartmentsByAdmin(adminId: number): Promise<Department[]>;\n  createDepartment(department: InsertDepartment): Promise<Department>;\n  updateDepartment(id: number, department: Partial<InsertDepartment>): Promise<Department>;\n  deleteDepartment(id: number): Promise<void>;\n  getEmployeesByDepartment(departmentId: number): Promise<Employee[]>;\n\n  // Location tracking operations\n  createLocationTracking(location: InsertLocationTracking): Promise<LocationTracking>;\n  getLatestEmployeeLocation(employeeId: number): Promise<LocationTracking | undefined>;\n  getEmployeeLocationHistory(employeeId: number, date?: Date): Promise<LocationTracking[]>;\n\n  // Attendance operations\n  createAttendance(attendance: InsertAttendance): Promise<Attendance>;\n  updateAttendance(id: number, attendance: Partial<Attendance>): Promise<Attendance>;\n  getCurrentAttendance(employeeId: number): Promise<Attendance | undefined>;\n  getAttendanceByAdmin(adminId: number, date?: Date): Promise<Attendance[]>;\n  getEmployeeAttendanceHistory(employeeId: number, fromDate: Date): Promise<Attendance[]>;\n  getRecentActivities(adminId: number, days?: number): Promise<any[]>;\n\n  // Dashboard stats\n  getDashboardStats(adminId: number): Promise<{\n    activeEmployees: number;\n    workSites: number;\n    onSiteNow: number;\n    alerts: number;\n  }>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // Admin operations\n  async getAdmin(id: number): Promise<Admin | undefined> {\n    const [admin] = await db.select().from(admins).where(eq(admins.id, id));\n    return admin || undefined;\n  }\n\n  async updateAdmin(id: number, data: Partial<InsertAdmin>): Promise<Admin> {\n    const [admin] = await db\n      .update(admins)\n      .set(data)\n      .where(eq(admins.id, id))\n      .returning();\n    return admin;\n  }\n\n  async updateAdminPassword(id: number, hashedPassword: string): Promise<void> {\n    await db\n      .update(admins)\n      .set({ password: hashedPassword })\n      .where(eq(admins.id, id));\n  }\n\n  async getAdminByEmail(email: string): Promise<Admin | undefined> {\n    const [admin] = await db.select().from(admins).where(eq(admins.email, email));\n    return admin || undefined;\n  }\n\n  async getAdminByCompanyName(companyName: string): Promise<Admin | undefined> {\n    const [admin] = await db.select().from(admins).where(eq(admins.companyName, companyName));\n    return admin || undefined;\n  }\n\n  async checkEmailExists(email: string): Promise<boolean> {\n    // Check if email exists in admins table\n    const [adminResult] = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(admins)\n      .where(eq(admins.email, email));\n    \n    // Check if email exists in employees table\n    const [employeeResult] = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(employees)\n      .where(eq(employees.email, email));\n    \n    return adminResult.count > 0 || employeeResult.count > 0;\n  }\n\n  async createAdmin(admin: InsertAdmin): Promise<Admin> {\n    const [newAdmin] = await db.insert(admins).values(admin).returning();\n    return newAdmin;\n  }\n\n  async getAdminCount(): Promise<number> {\n    const [result] = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(admins);\n    return result.count;\n  }\n\n  async getSuperAdmins(): Promise<Admin[]> {\n    return db\n      .select()\n      .from(admins)\n      .where(eq(admins.role, 'super_admin'));\n  }\n\n  // Super Admin operations\n  async getPendingAdmins(): Promise<Admin[]> {\n    return db\n      .select()\n      .from(admins)\n      .where(and(eq(admins.isVerified, true), eq(admins.isActive, false)))\n      .orderBy(admins.createdAt);\n  }\n\n  async updateAdminStatus(adminId: number, isActive: boolean): Promise<Admin> {\n    const [updatedAdmin] = await db\n      .update(admins)\n      .set({ isActive })\n      .where(eq(admins.id, adminId))\n      .returning();\n    return updatedAdmin;\n  }\n\n  async verifyAdminEmail(token: string): Promise<Admin | null> {\n    const [admin] = await db\n      .select()\n      .from(admins)\n      .where(eq(admins.verificationToken, token));\n    \n    if (!admin) return null;\n\n    // Mark as verified\n    const [verifiedAdmin] = await db\n      .update(admins)\n      .set({ \n        isVerified: true, \n        verificationToken: null \n      })\n      .where(eq(admins.id, admin.id))\n      .returning();\n\n    return verifiedAdmin;\n  }\n\n  // Employee operations\n  async getEmployee(id: number): Promise<Employee | undefined> {\n    const [employee] = await db.select().from(employees).where(eq(employees.id, id));\n    return employee || undefined;\n  }\n\n  async getEmployeeByEmail(email: string): Promise<Employee | undefined> {\n    const [employee] = await db.select().from(employees).where(eq(employees.email, email));\n    return employee || undefined;\n  }\n\n  async getEmployeesByAdmin(adminId: number): Promise<any[]> {\n    return db\n      .select({\n        id: employees.id,\n        firstName: employees.firstName,\n        lastName: employees.lastName,\n        email: employees.email,\n        phone: employees.phone,\n        adminId: employees.adminId,\n        siteId: employees.siteId,\n        departmentId: employees.departmentId,\n        profileImage: employees.profileImage,\n        isActive: employees.isActive,\n        createdAt: employees.createdAt,\n        siteName: workSites.name,\n        departmentName: departments.name,\n      })\n      .from(employees)\n      .leftJoin(workSites, eq(employees.siteId, workSites.id))\n      .leftJoin(departments, eq(employees.departmentId, departments.id))\n      .where(eq(employees.adminId, adminId))\n      .orderBy(employees.firstName, employees.lastName);\n  }\n\n  async createEmployee(employee: InsertEmployee): Promise<Employee> {\n    const [newEmployee] = await db.insert(employees).values(employee).returning();\n    return newEmployee;\n  }\n\n  async updateEmployee(id: number, employee: Partial<InsertEmployee>): Promise<Employee> {\n    const [updatedEmployee] = await db\n      .update(employees)\n      .set(employee)\n      .where(eq(employees.id, id))\n      .returning();\n    return updatedEmployee;\n  }\n\n  async deleteEmployee(id: number): Promise<void> {\n    await db.delete(employees).where(eq(employees.id, id));\n  }\n\n  // Area operations\n  async getArea(id: number): Promise<Area | undefined> {\n    const [area] = await db.select().from(areas).where(eq(areas.id, id));\n    return area || undefined;\n  }\n\n  async getAreasByAdmin(adminId: number): Promise<Area[]> {\n    return db\n      .select()\n      .from(areas)\n      .where(and(eq(areas.adminId, adminId), eq(areas.isActive, true)))\n      .orderBy(areas.name);\n  }\n\n  async createArea(area: InsertArea): Promise<Area> {\n    const [newArea] = await db.insert(areas).values(area).returning();\n    return newArea;\n  }\n\n  async updateArea(id: number, area: Partial<InsertArea>): Promise<Area> {\n    const [updatedArea] = await db\n      .update(areas)\n      .set(area)\n      .where(eq(areas.id, id))\n      .returning();\n    return updatedArea;\n  }\n\n  async deleteArea(id: number): Promise<void> {\n    await db.delete(areas).where(eq(areas.id, id));\n  }\n\n  // Work site operations\n  async getWorkSite(id: number): Promise<WorkSite | undefined> {\n    const [site] = await db.select().from(workSites).where(eq(workSites.id, id));\n    return site || undefined;\n  }\n\n  async getWorkSitesByAdmin(adminId: number): Promise<WorkSite[]> {\n    return db.select().from(workSites).where(eq(workSites.adminId, adminId));\n  }\n\n  async createWorkSite(site: InsertWorkSite): Promise<WorkSite> {\n    const [newSite] = await db.insert(workSites).values(site).returning();\n    return newSite;\n  }\n\n  async updateWorkSite(id: number, site: Partial<InsertWorkSite>): Promise<WorkSite> {\n    const [updatedSite] = await db\n      .update(workSites)\n      .set(site)\n      .where(eq(workSites.id, id))\n      .returning();\n    return updatedSite;\n  }\n\n  async deleteWorkSite(id: number): Promise<void> {\n    await db.delete(workSites).where(eq(workSites.id, id));\n  }\n\n  // Department operations\n  async getDepartment(id: number): Promise<Department | undefined> {\n    const [department] = await db.select().from(departments).where(eq(departments.id, id));\n    return department || undefined;\n  }\n\n  async getDepartmentsByAdmin(adminId: number): Promise<Department[]> {\n    return db\n      .select()\n      .from(departments)\n      .where(and(eq(departments.adminId, adminId), eq(departments.isActive, true)))\n      .orderBy(departments.name);\n  }\n\n  async createDepartment(department: InsertDepartment): Promise<Department> {\n    const [newDepartment] = await db.insert(departments).values(department).returning();\n    return newDepartment;\n  }\n\n  async updateDepartment(id: number, department: Partial<InsertDepartment>): Promise<Department> {\n    const [updatedDepartment] = await db\n      .update(departments)\n      .set(department)\n      .where(eq(departments.id, id))\n      .returning();\n    return updatedDepartment;\n  }\n\n  async deleteDepartment(id: number): Promise<void> {\n    await db.delete(departments).where(eq(departments.id, id));\n  }\n\n  async getEmployeesByDepartment(departmentId: number): Promise<Employee[]> {\n    return db\n      .select()\n      .from(employees)\n      .where(eq(employees.departmentId, departmentId));\n  }\n\n  // Location tracking operations\n  async createLocationTracking(location: InsertLocationTracking): Promise<LocationTracking> {\n    const [newLocation] = await db.insert(locationTracking).values(location).returning();\n    return newLocation;\n  }\n\n  async getLatestEmployeeLocation(employeeId: number): Promise<LocationTracking | undefined> {\n    const [location] = await db\n      .select()\n      .from(locationTracking)\n      .where(eq(locationTracking.employeeId, employeeId))\n      .orderBy(desc(locationTracking.timestamp))\n      .limit(1);\n    return location || undefined;\n  }\n\n  async getEmployeeLocationHistory(employeeId: number, date?: Date): Promise<LocationTracking[]> {\n    if (date) {\n      const startOfDay = new Date(date);\n      startOfDay.setHours(0, 0, 0, 0);\n      const endOfDay = new Date(date);\n      endOfDay.setHours(23, 59, 59, 999);\n\n      return db\n        .select()\n        .from(locationTracking)\n        .where(\n          and(\n            eq(locationTracking.employeeId, employeeId),\n            sql`${locationTracking.timestamp} >= ${startOfDay}`,\n            sql`${locationTracking.timestamp} <= ${endOfDay}`\n          )\n        )\n        .orderBy(desc(locationTracking.timestamp));\n    }\n\n    return db\n      .select()\n      .from(locationTracking)\n      .where(eq(locationTracking.employeeId, employeeId))\n      .orderBy(desc(locationTracking.timestamp));\n  }\n\n  // Attendance operations\n  async createAttendance(attendanceData: InsertAttendance): Promise<Attendance> {\n    const [newAttendance] = await db.insert(attendance).values(attendanceData).returning();\n    return newAttendance;\n  }\n\n  async updateAttendance(id: number, attendanceData: Partial<InsertAttendance>): Promise<Attendance> {\n    const [updatedAttendance] = await db\n      .update(attendance)\n      .set(attendanceData)\n      .where(eq(attendance.id, id))\n      .returning();\n    return updatedAttendance;\n  }\n\n  async getCurrentAttendance(employeeId: number): Promise<Attendance | undefined> {\n    const [currentAttendance] = await db\n      .select()\n      .from(attendance)\n      .where(\n        and(\n          eq(attendance.employeeId, employeeId),\n          sql`${attendance.checkOutTime} IS NULL`\n        )\n      )\n      .orderBy(desc(attendance.checkInTime))\n      .limit(1);\n    return currentAttendance || undefined;\n  }\n\n\n\n  async getAttendanceByAdmin(adminId: number, date?: Date): Promise<Attendance[]> {\n    if (date) {\n      const startOfDay = new Date(date);\n      startOfDay.setHours(0, 0, 0, 0);\n      const endOfDay = new Date(date);\n      endOfDay.setHours(23, 59, 59, 999);\n\n      return db\n        .select({\n          id: attendance.id,\n          employeeId: attendance.employeeId,\n          siteId: attendance.siteId,\n          checkInTime: attendance.checkInTime,\n          checkOutTime: attendance.checkOutTime,\n          checkInLatitude: attendance.checkInLatitude,\n          checkInLongitude: attendance.checkInLongitude,\n          checkOutLatitude: attendance.checkOutLatitude,\n          checkOutLongitude: attendance.checkOutLongitude,\n        })\n        .from(attendance)\n        .innerJoin(employees, eq(attendance.employeeId, employees.id))\n        .where(\n          and(\n            eq(employees.adminId, adminId),\n            sql`${attendance.checkInTime} >= ${startOfDay}`,\n            sql`${attendance.checkInTime} <= ${endOfDay}`\n          )\n        )\n        .orderBy(desc(attendance.checkInTime));\n    }\n\n    return db\n      .select({\n        id: attendance.id,\n        employeeId: attendance.employeeId,\n        siteId: attendance.siteId,\n        checkInTime: attendance.checkInTime,\n        checkOutTime: attendance.checkOutTime,\n        checkInLatitude: attendance.checkInLatitude,\n        checkInLongitude: attendance.checkInLongitude,\n        checkOutLatitude: attendance.checkOutLatitude,\n        checkOutLongitude: attendance.checkOutLongitude,\n      })\n      .from(attendance)\n      .innerJoin(employees, eq(attendance.employeeId, employees.id))\n      .where(eq(employees.adminId, adminId))\n      .orderBy(desc(attendance.checkInTime));\n  }\n\n  async getEmployeeAttendanceHistory(employeeId: number, fromDate: Date): Promise<Attendance[]> {\n    return db\n      .select()\n      .from(attendance)\n      .where(\n        and(\n          eq(attendance.employeeId, employeeId),\n          sql`${attendance.checkInTime} >= ${fromDate}`\n        )\n      )\n      .orderBy(desc(attendance.checkInTime));\n  }\n\n  async getRecentActivities(adminId: number, days: number = 7): Promise<any[]> {\n    const fromDate = new Date();\n    fromDate.setDate(fromDate.getDate() - days);\n    fromDate.setHours(0, 0, 0, 0);\n\n    const activities = await db\n      .select({\n        id: attendance.id,\n        employeeId: attendance.employeeId,\n        siteId: attendance.siteId,\n        checkInTime: attendance.checkInTime,\n        checkOutTime: attendance.checkOutTime,\n        employeeFirstName: employees.firstName,\n        employeeLastName: employees.lastName,\n        employeeProfileImage: employees.profileImage,\n        employeeEmail: employees.email,\n        siteName: workSites.name,\n      })\n      .from(attendance)\n      .innerJoin(employees, eq(attendance.employeeId, employees.id))\n      .innerJoin(workSites, eq(attendance.siteId, workSites.id))\n      .where(\n        and(\n          eq(employees.adminId, adminId),\n          sql`${attendance.checkInTime} >= ${fromDate}`\n        )\n      )\n      .orderBy(desc(attendance.checkInTime))\n      .limit(20);\n\n    // Process activities to include both check-ins and check-outs\n    const processedActivities: any[] = [];\n    \n    activities.forEach((record) => {\n      // Add check-in activity\n      processedActivities.push({\n        id: `${record.id}-checkin`,\n        type: 'check-in',\n        timestamp: record.checkInTime,\n        employee: {\n          id: record.employeeId,\n          firstName: record.employeeFirstName,\n          lastName: record.employeeLastName,\n          profileImage: record.employeeProfileImage,\n          email: record.employeeEmail,\n        },\n        site: {\n          id: record.siteId,\n          name: record.siteName,\n        },\n      });\n\n      // Add check-out activity if exists\n      if (record.checkOutTime) {\n        processedActivities.push({\n          id: `${record.id}-checkout`,\n          type: 'check-out',\n          timestamp: record.checkOutTime,\n          employee: {\n            id: record.employeeId,\n            firstName: record.employeeFirstName,\n            lastName: record.employeeLastName,\n            profileImage: record.employeeProfileImage,\n            email: record.employeeEmail,\n          },\n          site: {\n            id: record.siteId,\n            name: record.siteName,\n          },\n        });\n      }\n    });\n\n    // Sort by timestamp descending\n    processedActivities.sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime());\n\n    return processedActivities.slice(0, 15); // Return top 15 activities\n  }\n\n  async getDashboardStats(adminId: number): Promise<{\n    activeEmployees: number;\n    workSites: number;\n    onSiteNow: number;\n    alerts: number;\n  }> {\n    // Get active employees count\n    const [activeEmployeesResult] = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(employees)\n      .where(and(eq(employees.adminId, adminId), eq(employees.isActive, true)));\n\n    // Get work sites count\n    const [workSitesResult] = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(workSites)\n      .where(and(eq(workSites.adminId, adminId), eq(workSites.isActive, true)));\n\n    // Get employees currently on site\n    const [onSiteResult] = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(attendance)\n      .innerJoin(employees, eq(attendance.employeeId, employees.id))\n      .where(\n        and(\n          eq(employees.adminId, adminId),\n          sql`${attendance.checkOutTime} IS NULL`\n        )\n      );\n\n    return {\n      activeEmployees: activeEmployeesResult.count,\n      workSites: workSitesResult.count,\n      onSiteNow: onSiteResult.count,\n      alerts: 0, // Placeholder for alert system\n    };\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":19786},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"shared/schema.ts":{"content":"import { pgTable, text, serial, integer, boolean, timestamp, decimal, jsonb } from \"drizzle-orm/pg-core\";\nimport { relations } from \"drizzle-orm\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Admin users table\nexport const admins = pgTable(\"admins\", {\n  id: serial(\"id\").primaryKey(),\n  firstName: text(\"first_name\").notNull(),\n  lastName: text(\"last_name\").notNull(),\n  companyName: text(\"company_name\").notNull(),\n  email: text(\"email\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  profileImage: text(\"profile_image\"),\n  role: text(\"role\").notNull().default(\"admin\"), // \"super_admin\" or \"admin\"\n  isVerified: boolean(\"is_verified\").default(false), // Email verification status\n  verificationToken: text(\"verification_token\"), // For email verification\n  isActive: boolean(\"is_active\").default(false), // Activated by super admin\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Labor employees table\nexport const employees = pgTable(\"employees\", {\n  id: serial(\"id\").primaryKey(),\n  employeeId: text(\"employee_id\"), // Custom employee ID (like \"EMP001\") - made optional to avoid conflicts\n  firstName: text(\"first_name\").notNull(),\n  lastName: text(\"last_name\").notNull(),\n  email: text(\"email\").notNull(),\n  phone: text(\"phone\"),\n  address: text(\"address\"), // Added for employee profile updates\n  password: text(\"password\").notNull(),\n  adminId: integer(\"admin_id\").notNull().references(() => admins.id),\n  siteId: integer(\"site_id\").references(() => workSites.id),\n  departmentId: integer(\"department_id\").references(() => departments.id),\n  profileImage: text(\"profile_image\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Departments table\nexport const departments = pgTable(\"departments\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  adminId: integer(\"admin_id\").notNull().references(() => admins.id),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Areas table for organizing work sites\nexport const areas = pgTable(\"areas\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  adminId: integer(\"admin_id\").notNull().references(() => admins.id),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Work sites table\nexport const workSites = pgTable(\"work_sites\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  address: text(\"address\").notNull(),\n  latitude: decimal(\"latitude\", { precision: 10, scale: 8 }).notNull(),\n  longitude: decimal(\"longitude\", { precision: 11, scale: 8 }).notNull(),\n  geofenceRadius: integer(\"geofence_radius\").notNull().default(200), // in meters\n  siteImage: text(\"site_image\"), // URL to site image in object storage\n  areaId: integer(\"area_id\").references(() => areas.id),\n  adminId: integer(\"admin_id\").notNull().references(() => admins.id),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Location tracking table\nexport const locationTracking = pgTable(\"location_tracking\", {\n  id: serial(\"id\").primaryKey(),\n  employeeId: integer(\"employee_id\").notNull().references(() => employees.id),\n  latitude: decimal(\"latitude\", { precision: 10, scale: 8 }).notNull(),\n  longitude: decimal(\"longitude\", { precision: 11, scale: 8 }).notNull(),\n  isOnSite: boolean(\"is_on_site\").notNull(),\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n});\n\n// Attendance tracking table\nexport const attendance = pgTable(\"attendance\", {\n  id: serial(\"id\").primaryKey(),\n  employeeId: integer(\"employee_id\").notNull().references(() => employees.id),\n  siteId: integer(\"site_id\").notNull().references(() => workSites.id),\n  checkInTime: timestamp(\"check_in_time\").defaultNow(),\n  checkOutTime: timestamp(\"check_out_time\"),\n  checkInLatitude: decimal(\"check_in_latitude\", { precision: 10, scale: 8 }),\n  checkInLongitude: decimal(\"check_in_longitude\", { precision: 11, scale: 8 }),\n  checkOutLatitude: decimal(\"check_out_latitude\", { precision: 10, scale: 8 }),\n  checkOutLongitude: decimal(\"check_out_longitude\", { precision: 11, scale: 8 }),\n});\n\n// Relations\nexport const adminsRelations = relations(admins, ({ many }) => ({\n  employees: many(employees),\n  workSites: many(workSites),\n  departments: many(departments),\n  areas: many(areas),\n}));\n\nexport const employeesRelations = relations(employees, ({ one, many }) => ({\n  admin: one(admins, {\n    fields: [employees.adminId],\n    references: [admins.id],\n  }),\n  assignedSite: one(workSites, {\n    fields: [employees.siteId],\n    references: [workSites.id],\n  }),\n  department: one(departments, {\n    fields: [employees.departmentId],\n    references: [departments.id],\n  }),\n  locationHistory: many(locationTracking),\n  attendanceHistory: many(attendance),\n}));\n\nexport const areasRelations = relations(areas, ({ one, many }) => ({\n  admin: one(admins, {\n    fields: [areas.adminId],\n    references: [admins.id],\n  }),\n  workSites: many(workSites),\n}));\n\nexport const workSitesRelations = relations(workSites, ({ one, many }) => ({\n  admin: one(admins, {\n    fields: [workSites.adminId],\n    references: [admins.id],\n  }),\n  area: one(areas, {\n    fields: [workSites.areaId],\n    references: [areas.id],\n  }),\n  assignedEmployees: many(employees),\n  attendanceRecords: many(attendance),\n}));\n\nexport const locationTrackingRelations = relations(locationTracking, ({ one }) => ({\n  employee: one(employees, {\n    fields: [locationTracking.employeeId],\n    references: [employees.id],\n  }),\n}));\n\nexport const departmentsRelations = relations(departments, ({ one, many }) => ({\n  admin: one(admins, {\n    fields: [departments.adminId],\n    references: [admins.id],\n  }),\n  employees: many(employees),\n}));\n\nexport const attendanceRelations = relations(attendance, ({ one }) => ({\n  employee: one(employees, {\n    fields: [attendance.employeeId],\n    references: [employees.id],\n  }),\n  site: one(workSites, {\n    fields: [attendance.siteId],\n    references: [workSites.id],\n  }),\n}));\n\n// Password validation schema\nconst passwordSchema = z.string()\n  .min(8, \"Password must be at least 8 characters long\")\n  .regex(/^(?=.*[a-zA-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]/, \n    \"Password must contain at least one letter, one number, and one special character\");\n\n// Insert schemas with password validation\nexport const insertAdminSchema = createInsertSchema(admins).omit({ \n  id: true, \n  createdAt: true \n}).extend({\n  password: passwordSchema,\n});\n\nexport const insertEmployeeSchema = createInsertSchema(employees).omit({ \n  id: true, \n  createdAt: true, \n  isActive: true \n}).extend({\n  password: passwordSchema,\n  departmentId: z.union([z.string(), z.number(), z.null()]).transform(val => val === null || val === 'none' ? null : typeof val === 'string' ? (val === 'none' ? null : parseInt(val)) : val).optional(),\n  siteId: z.union([z.string(), z.number(), z.null()]).transform(val => val === null || val === 'none' ? null : typeof val === 'string' ? (val === 'none' ? null : parseInt(val)) : val).optional(),\n  phone: z.string().optional(),\n});\n\n// Employee profile update schema (limited fields for employees)\nexport const updateEmployeeProfileSchema = z.object({\n  phone: z.string().min(10, \"Phone number must be at least 10 digits\"),\n  address: z.string().optional(),\n  profileImage: z.string().optional(),\n});\n\n// Admin verification schema\nexport const adminVerificationSchema = z.object({\n  token: z.string(),\n});\n\n// Super admin schemas for managing regular admins\nexport const adminActivationSchema = z.object({\n  adminId: z.number(),\n  isActive: z.boolean(),\n});\n\nexport const insertWorkSiteSchema = createInsertSchema(workSites).omit({ id: true, createdAt: true, isActive: true }).extend({\n  latitude: z.union([z.string(), z.number()]).transform(val => typeof val === 'string' ? val : val.toString()),\n  longitude: z.union([z.string(), z.number()]).transform(val => typeof val === 'string' ? val : val.toString()),\n  geofenceRadius: z.union([z.string(), z.number()]).transform(val => typeof val === 'string' ? parseInt(val) : val),\n  areaId: z.union([z.string(), z.number(), z.null()]).transform(val => val === null || val === 'none' ? null : typeof val === 'string' ? (val === 'none' ? null : parseInt(val)) : val).optional(),\n});\nexport const insertAreaSchema = createInsertSchema(areas).omit({ id: true, createdAt: true, isActive: true });\nexport const insertDepartmentSchema = createInsertSchema(departments).omit({ id: true, createdAt: true, isActive: true });\nexport const insertLocationTrackingSchema = createInsertSchema(locationTracking).omit({ id: true, timestamp: true });\nexport const insertAttendanceSchema = createInsertSchema(attendance).omit({ id: true, checkInTime: true });\n\n// Types\nexport type Admin = typeof admins.$inferSelect;\nexport type Employee = typeof employees.$inferSelect;\nexport type WorkSite = typeof workSites.$inferSelect;\nexport type Area = typeof areas.$inferSelect;\nexport type Department = typeof departments.$inferSelect;\nexport type LocationTracking = typeof locationTracking.$inferSelect;\nexport type Attendance = typeof attendance.$inferSelect;\n\nexport type InsertAdmin = z.infer<typeof insertAdminSchema>;\nexport type InsertEmployee = z.infer<typeof insertEmployeeSchema>;\nexport type InsertWorkSite = z.infer<typeof insertWorkSiteSchema>;\nexport type InsertArea = z.infer<typeof insertAreaSchema>;\nexport type InsertDepartment = z.infer<typeof insertDepartmentSchema>;\nexport type InsertLocationTracking = z.infer<typeof insertLocationTrackingSchema>;\nexport type InsertAttendance = z.infer<typeof insertAttendanceSchema>;\n\n// Auth schemas\nexport const adminLoginSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n});\n\nexport const employeeLoginSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n});\n\nexport type AdminLogin = z.infer<typeof adminLoginSchema>;\nexport type EmployeeLogin = z.infer<typeof employeeLoginSchema>;\nexport type UpdateEmployeeProfile = z.infer<typeof updateEmployeeProfileSchema>;\nexport type AdminVerification = z.infer<typeof adminVerificationSchema>;\nexport type AdminActivation = z.infer<typeof adminActivationSchema>;\n","size_bytes":10366},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport NotFound from \"@/pages/not-found\";\nimport AdminLogin from \"@/pages/admin-login\";\nimport AdminSignup from \"@/pages/admin-signup\";\nimport AdminDashboard from \"@/pages/admin-dashboard\";\nimport EmployeeManagement from \"@/pages/employee-management\";\nimport EmployeeProfile from \"@/pages/employee-profile\";\nimport SiteManagement from \"@/pages/site-management-fixed\";\nimport LiveTracking from \"@/pages/live-tracking\";\nimport MobileWorker from \"@/pages/mobile-worker\";\nimport EmployeeLogin from \"@/pages/employee-login\";\nimport EmployeeDashboard from \"@/pages/employee-dashboard\";\nimport ActiveEmployees from \"@/pages/active-employees\";\nimport WorkSitesList from \"@/pages/work-sites-list\";\nimport OnSiteNow from \"@/pages/on-site-now\";\nimport Notifications from \"@/pages/notifications\";\nimport AdminProfile from \"@/pages/admin-profile\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={AdminLogin} />\n      <Route path=\"/admin/login\" component={AdminLogin} />\n      <Route path=\"/admin/signup\" component={AdminSignup} />\n      <Route path=\"/admin/dashboard\" component={AdminDashboard} />\n      <Route path=\"/admin/employee-management\" component={EmployeeManagement} />\n      <Route path=\"/employee-management\" component={EmployeeManagement} />\n      <Route path=\"/admin/employees/:id\" component={EmployeeProfile} />\n      <Route path=\"/admin/employees/:id/profile\" component={EmployeeProfile} />\n      <Route path=\"/admin/active-employees\" component={ActiveEmployees} />\n      <Route path=\"/admin/sites\" component={SiteManagement} />\n      <Route path=\"/site-management\" component={SiteManagement} />\n      <Route path=\"/admin/work-sites\" component={WorkSitesList} />\n      <Route path=\"/admin/on-site-now\" component={OnSiteNow} />\n      <Route path=\"/admin/notifications\" component={Notifications} />\n      <Route path=\"/admin/profile\" component={AdminProfile} />\n      <Route path=\"/admin/tracking\" component={LiveTracking} />\n      <Route path=\"/admin/live-tracking\" component={LiveTracking} />\n      <Route path=\"/employee/login\" component={EmployeeLogin} />\n      <Route path=\"/employee/dashboard\" component={EmployeeDashboard} />\n      <Route path=\"/worker\" component={MobileWorker} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <Router />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":2756},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(0, 0%, 100%);\n  --foreground: hsl(20, 14.3%, 4.1%);\n  --muted: hsl(60, 4.8%, 95.9%);\n  --muted-foreground: hsl(25, 5.3%, 44.7%);\n  --popover: hsl(0, 0%, 100%);\n  --popover-foreground: hsl(20, 14.3%, 4.1%);\n  --card: hsl(0, 0%, 100%);\n  --card-foreground: hsl(20, 14.3%, 4.1%);\n  --border: hsl(20, 5.9%, 90%);\n  --input: hsl(20, 5.9%, 90%);\n  --primary: hsl(207, 90%, 54%);\n  --primary-foreground: hsl(211, 100%, 99%);\n  --secondary: hsl(60, 4.8%, 95.9%);\n  --secondary-foreground: hsl(24, 9.8%, 10%);\n  --accent: hsl(60, 4.8%, 95.9%);\n  --accent-foreground: hsl(24, 9.8%, 10%);\n  --destructive: hsl(0, 84.2%, 60.2%);\n  --destructive-foreground: hsl(60, 9.1%, 97.8%);\n  --ring: hsl(20, 14.3%, 4.1%);\n  --radius: 0.5rem;\n  --success: hsl(142, 71%, 45%);\n  --success-foreground: hsl(140, 100%, 97%);\n  --warning: hsl(32, 95%, 44%);\n  --warning-foreground: hsl(48, 96%, 89%);\n  --error: hsl(0, 84%, 60%);\n  --error-foreground: hsl(0, 0%, 98%);\n}\n\n.dark {\n  --background: hsl(240, 10%, 3.9%);\n  --foreground: hsl(0, 0%, 98%);\n  --muted: hsl(240, 3.7%, 15.9%);\n  --muted-foreground: hsl(240, 5%, 64.9%);\n  --popover: hsl(240, 10%, 3.9%);\n  --popover-foreground: hsl(0, 0%, 98%);\n  --card: hsl(240, 10%, 3.9%);\n  --card-foreground: hsl(0, 0%, 98%);\n  --border: hsl(240, 3.7%, 15.9%);\n  --input: hsl(240, 3.7%, 15.9%);\n  --primary: hsl(207, 90%, 54%);\n  --primary-foreground: hsl(211, 100%, 99%);\n  --secondary: hsl(240, 3.7%, 15.9%);\n  --secondary-foreground: hsl(0, 0%, 98%);\n  --accent: hsl(240, 3.7%, 15.9%);\n  --accent-foreground: hsl(0, 0%, 98%);\n  --destructive: hsl(0, 62.8%, 30.6%);\n  --destructive-foreground: hsl(0, 0%, 98%);\n  --ring: hsl(240, 4.9%, 83.9%);\n  --radius: 0.5rem;\n  --success: hsl(142, 71%, 45%);\n  --success-foreground: hsl(140, 100%, 97%);\n  --warning: hsl(32, 95%, 44%);\n  --warning-foreground: hsl(48, 96%, 89%);\n  --error: hsl(0, 84%, 60%);\n  --error-foreground: hsl(0, 0%, 98%);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    font-family: 'Inter', sans-serif;\n  }\n}\n\n@layer utilities {\n  .text-success {\n    color: var(--success);\n  }\n  \n  .text-warning {\n    color: var(--warning);\n  }\n  \n  .text-error {\n    color: var(--error);\n  }\n  \n  .bg-success {\n    background-color: var(--success);\n  }\n  \n  .bg-warning {\n    background-color: var(--warning);\n  }\n  \n  .bg-error {\n    background-color: var(--error);\n  }\n  \n  .border-success {\n    border-color: var(--success);\n  }\n  \n  .border-warning {\n    border-color: var(--warning);\n  }\n  \n  .border-error {\n    border-color: var(--error);\n  }\n}\n","size_bytes":2691},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/AuthenticatedImage.tsx":{"content":"import { useAuthenticatedImage } from '@/hooks/useAuthenticatedImage';\nimport React from 'react';\n\ninterface AuthenticatedImageProps {\n  src?: string;\n  alt: string;\n  className?: string;\n  onClick?: () => void;\n  fallback?: React.ReactNode;\n}\n\nexport const AuthenticatedImage = React.memo(function AuthenticatedImage({ \n  src, \n  alt, \n  className, \n  onClick, \n  fallback \n}: AuthenticatedImageProps) {\n  const { blobUrl, loading, error } = useAuthenticatedImage(src);\n\n  if (!src || error) {\n    return <>{fallback}</>;\n  }\n\n  if (loading) {\n    return (\n      <div className={`${className} animate-pulse bg-gray-200 flex items-center justify-center`}>\n        <div className=\"w-4 h-4 bg-gray-400 rounded-full\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <img\n      src={blobUrl}\n      alt={alt}\n      className={className}\n      onClick={onClick}\n      loading=\"lazy\"\n    />\n  );\n});","size_bytes":890},"client/src/components/EmployeeManagement.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog';\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from '@/components/ui/form';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { Search, UserPlus, MapPin, Phone, Mail, User, ChevronDown, ChevronRight } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { getAuthToken } from '@/lib/auth';\nimport { apiRequest } from '@/lib/queryClient';\n\nconst addEmployeeSchema = z.object({\n  firstName: z.string().min(1, 'First name is required'),\n  lastName: z.string().min(1, 'Last name is required'),\n  email: z.string().email('Please enter a valid email address'),\n  phone: z.string().min(10, 'Phone number must be at least 10 digits'),\n  password: z.string().min(8, 'Password must be at least 8 characters'),\n  siteId: z.string().optional(),\n  departmentId: z.string().optional(),\n});\n\ntype AddEmployeeData = z.infer<typeof addEmployeeSchema>;\n\ninterface Employee {\n  id: number;\n  firstName: string;\n  lastName: string;\n  email: string;\n  phone: string;\n  siteId?: number;\n  departmentId?: number;\n  profileImage?: string;\n  isActive: boolean;\n  siteName?: string;\n  departmentName?: string;\n}\n\ninterface WorkSite {\n  id: number;\n  name: string;\n  address: string;\n}\n\ninterface Department {\n  id: number;\n  name: string;\n  description?: string;\n}\n\ninterface EmployeeManagementProps {\n  isExpanded?: boolean;\n  onToggle?: () => void;\n}\n\nexport default function EmployeeManagement({ isExpanded = false, onToggle }: EmployeeManagementProps) {\n  const [searchTerm, setSearchTerm] = useState('');\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: employees = [], isLoading: employeesLoading } = useQuery<Employee[]>({\n    queryKey: ['/api/admin/employees'],\n    enabled: !!getAuthToken(),\n  });\n\n  const { data: workSites = [] } = useQuery<WorkSite[]>({\n    queryKey: ['/api/admin/sites'],\n    enabled: !!getAuthToken(),\n  });\n\n  const { data: departments = [] } = useQuery<Department[]>({\n    queryKey: ['/api/admin/departments'],\n    enabled: !!getAuthToken(),\n  });\n\n  const form = useForm<AddEmployeeData>({\n    resolver: zodResolver(addEmployeeSchema),\n    defaultValues: {\n      firstName: '',\n      lastName: '',\n      email: '',\n      phone: '',\n      password: '',\n      siteId: '',\n      departmentId: '',\n    },\n  });\n\n  const addEmployeeMutation = useMutation({\n    mutationFn: async (data: AddEmployeeData) => {\n      const payload = {\n        ...data,\n        siteId: data.siteId ? parseInt(data.siteId) : undefined,\n        departmentId: data.departmentId ? parseInt(data.departmentId) : undefined,\n      };\n      const token = getAuthToken();\n      const response = await fetch('/api/admin/employees', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n        body: JSON.stringify(payload),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || 'Failed to add employee');\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/employees'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/dashboard'] });\n      setIsAddDialogOpen(false);\n      form.reset();\n      toast({\n        title: 'Success',\n        description: 'Employee added successfully!',\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to add employee',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const filteredEmployees = employees.filter(employee =>\n    `${employee.firstName} ${employee.lastName}`.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    employee.email.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    employee.phone.includes(searchTerm)\n  );\n\n  const getInitials = (firstName: string, lastName: string) => {\n    return `${firstName.charAt(0)}${lastName.charAt(0)}`.toUpperCase();\n  };\n\n  const onSubmit = (data: AddEmployeeData) => {\n    addEmployeeMutation.mutate(data);\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex justify-between items-center\">\n          <CardTitle \n            className=\"flex items-center gap-2 cursor-pointer hover:text-blue-600 transition-colors\"\n            onClick={onToggle}\n          >\n            {isExpanded ? <ChevronDown className=\"h-5 w-5\" /> : <ChevronRight className=\"h-5 w-5\" />}\n            <User className=\"h-5 w-5\" />\n            Employee Management\n            <span className=\"text-sm font-normal text-gray-500 ml-2\">\n              ({employees.length} employees)\n            </span>\n          </CardTitle>\n          {isExpanded && (\n            <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\n            <DialogTrigger asChild>\n              <Button>\n                <UserPlus className=\"h-4 w-4 mr-2\" />\n                Add Employee\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"sm:max-w-md\">\n              <DialogHeader>\n                <DialogTitle>Add New Employee</DialogTitle>\n              </DialogHeader>\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"firstName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>First Name</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"John\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"lastName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Last Name</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Doe\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  <FormField\n                    control={form.control}\n                    name=\"email\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Email</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"john.doe@example.com\" type=\"email\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"phone\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Phone</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"(555) 123-4567\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"password\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Password</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"••••••••\" type=\"password\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"departmentId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Department (Optional)</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select a department\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"\">No department</SelectItem>\n                            {departments.map((dept) => (\n                              <SelectItem key={dept.id} value={dept.id.toString()}>\n                                {dept.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"siteId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Assigned Work Site (Optional)</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select a work site\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"\">No assignment</SelectItem>\n                            {workSites.map((site) => (\n                              <SelectItem key={site.id} value={site.id.toString()}>\n                                {site.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <div className=\"flex justify-end space-x-2 pt-4\">\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={() => setIsAddDialogOpen(false)}\n                      disabled={addEmployeeMutation.isPending}\n                    >\n                      Cancel\n                    </Button>\n                    <Button \n                      type=\"submit\" \n                      disabled={addEmployeeMutation.isPending}\n                    >\n                      {addEmployeeMutation.isPending ? 'Adding...' : 'Add Employee'}\n                    </Button>\n                  </div>\n                </form>\n              </Form>\n            </DialogContent>\n          </Dialog>\n          )}\n        </div>\n      </CardHeader>\n      {isExpanded && (\n        <CardContent>\n        {/* Search Bar */}\n        <div className=\"mb-6\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\n            <Input\n              placeholder=\"Search employees by name, email, or phone...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-10\"\n            />\n          </div>\n        </div>\n\n        {/* Employee Stats */}\n        <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6\">\n          <div className=\"bg-blue-50 rounded-lg p-4\">\n            <div className=\"flex items-center\">\n              <div className=\"bg-blue-100 rounded-lg p-2\">\n                <User className=\"h-5 w-5 text-blue-600\" />\n              </div>\n              <div className=\"ml-3\">\n                <p className=\"text-sm font-medium text-blue-600\">Total Employees</p>\n                <p className=\"text-2xl font-bold text-blue-900\">{employees.length}</p>\n              </div>\n            </div>\n          </div>\n          <div className=\"bg-green-50 rounded-lg p-4\">\n            <div className=\"flex items-center\">\n              <div className=\"bg-green-100 rounded-lg p-2\">\n                <User className=\"h-5 w-5 text-green-600\" />\n              </div>\n              <div className=\"ml-3\">\n                <p className=\"text-sm font-medium text-green-600\">Active Employees</p>\n                <p className=\"text-2xl font-bold text-green-900\">\n                  {employees.filter(emp => emp.isActive).length}\n                </p>\n              </div>\n            </div>\n          </div>\n          <div className=\"bg-orange-50 rounded-lg p-4\">\n            <div className=\"flex items-center\">\n              <div className=\"bg-orange-100 rounded-lg p-2\">\n                <User className=\"h-5 w-5 text-orange-600\" />\n              </div>\n              <div className=\"ml-3\">\n                <p className=\"text-sm font-medium text-orange-600\">With Departments</p>\n                <p className=\"text-2xl font-bold text-orange-900\">\n                  {employees.filter(emp => emp.departmentId).length}\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Employee List */}\n        {employeesLoading ? (\n          <div className=\"space-y-4\">\n            {[...Array(3)].map((_, i) => (\n              <div key={i} className=\"animate-pulse\">\n                <div className=\"flex items-center space-x-4 p-4 border rounded-lg\">\n                  <div className=\"bg-gray-200 rounded-full w-12 h-12\"></div>\n                  <div className=\"flex-1 space-y-2\">\n                    <div className=\"bg-gray-200 h-4 rounded w-1/4\"></div>\n                    <div className=\"bg-gray-200 h-3 rounded w-1/3\"></div>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        ) : filteredEmployees.length === 0 ? (\n          <div className=\"text-center text-gray-500 py-8\">\n            <User className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n            <p className=\"font-medium text-gray-900 mb-2\">\n              {searchTerm ? 'No employees found' : 'No employees yet'}\n            </p>\n            <p className=\"text-sm text-gray-600\">\n              {searchTerm \n                ? 'Try adjusting your search terms' \n                : 'Add your first employee to get started'\n              }\n            </p>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {filteredEmployees.map((employee) => (\n              <div key={employee.id} className=\"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50\">\n                <div className=\"flex items-center space-x-4\">\n                  <Avatar className=\"h-12 w-12\">\n                    {employee.profileImage ? (\n                      <AvatarImage src={employee.profileImage} alt={`${employee.firstName} ${employee.lastName}`} />\n                    ) : (\n                      <AvatarFallback className=\"bg-blue-100 text-blue-700\">\n                        {getInitials(employee.firstName, employee.lastName)}\n                      </AvatarFallback>\n                    )}\n                  </Avatar>\n                  <div>\n                    <h4 className=\"font-semibold text-gray-900\">\n                      {employee.firstName} {employee.lastName}\n                    </h4>\n                    <div className=\"flex items-center space-x-4 text-sm text-gray-600\">\n                      <div className=\"flex items-center\">\n                        <Mail className=\"h-4 w-4 mr-1\" />\n                        {employee.email}\n                      </div>\n                      <div className=\"flex items-center\">\n                        <Phone className=\"h-4 w-4 mr-1\" />\n                        {employee.phone}\n                      </div>\n                    </div>\n                    <div className=\"flex flex-wrap gap-2 mt-1\">\n                      {employee.departmentId && (\n                        <div className=\"flex items-center text-sm text-gray-600\">\n                          <User className=\"h-4 w-4 mr-1\" />\n                          {employee.departmentName || 'Department assigned'}\n                        </div>\n                      )}\n                      {employee.siteId && (\n                        <div className=\"flex items-center text-sm text-gray-600\">\n                          <MapPin className=\"h-4 w-4 mr-1\" />\n                          {employee.siteName || 'Site assigned'}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <Badge variant={employee.isActive ? \"default\" : \"secondary\"}>\n                    {employee.isActive ? 'Active' : 'Inactive'}\n                  </Badge>\n                  {employee.departmentId && (\n                    <Badge variant=\"outline\">\n                      <User className=\"h-3 w-3 mr-1\" />\n                      Department\n                    </Badge>\n                  )}\n                  {employee.siteId && (\n                    <Badge variant=\"outline\">\n                      <MapPin className=\"h-3 w-3 mr-1\" />\n                      Site\n                    </Badge>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n        </CardContent>\n      )}\n      {!isExpanded && (\n        <CardContent className=\"pt-0\">\n          <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n            <div className=\"bg-blue-50 rounded-lg p-4\">\n              <div className=\"flex items-center\">\n                <div className=\"bg-blue-100 rounded-lg p-2\">\n                  <User className=\"h-5 w-5 text-blue-600\" />\n                </div>\n                <div className=\"ml-3\">\n                  <p className=\"text-sm font-medium text-blue-600\">Total</p>\n                  <p className=\"text-xl font-bold text-blue-900\">{employees.length}</p>\n                </div>\n              </div>\n            </div>\n            <div className=\"bg-green-50 rounded-lg p-4\">\n              <div className=\"flex items-center\">\n                <div className=\"bg-green-100 rounded-lg p-2\">\n                  <User className=\"h-5 w-5 text-green-600\" />\n                </div>\n                <div className=\"ml-3\">\n                  <p className=\"text-sm font-medium text-green-600\">Active</p>\n                  <p className=\"text-xl font-bold text-green-900\">\n                    {employees.filter(emp => emp.isActive).length}\n                  </p>\n                </div>\n              </div>\n            </div>\n            <div className=\"bg-orange-50 rounded-lg p-4\">\n              <div className=\"flex items-center\">\n                <div className=\"bg-orange-100 rounded-lg p-2\">\n                  <User className=\"h-5 w-5 text-orange-600\" />\n                </div>\n                <div className=\"ml-3\">\n                  <p className=\"text-sm font-medium text-orange-600\">Departments</p>\n                  <p className=\"text-xl font-bold text-orange-900\">\n                    {employees.filter(emp => emp.departmentId).length}\n                  </p>\n                </div>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      )}\n    </Card>\n  );\n}","size_bytes":20443},"client/src/components/ExportReportDialog.tsx":{"content":"import { useState } from 'react';\nimport { useMutation } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog';\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from '@/components/ui/form';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { Download, Mail, Loader2, FileText, File, Table } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { getAuthToken } from '@/lib/auth';\n\nconst exportFormSchema = z.object({\n  email: z.string().email('Please enter a valid email address'),\n  fromEmail: z.string().email('Please enter a valid sender email address'),\n  subject: z.string().min(1, 'Subject is required').default('Employee Attendance Report - Last 30 Days'),\n  format: z.enum(['html', 'pdf', 'excel', 'csv']).default('html'),\n});\n\ntype ExportFormData = z.infer<typeof exportFormSchema>;\n\nconst formatOptions = [\n  { value: 'html', label: 'HTML Report', icon: FileText, description: 'Rich formatted report with charts' },\n  { value: 'pdf', label: 'PDF Document', icon: File, description: 'Professional PDF format' },\n  { value: 'excel', label: 'Excel Spreadsheet', icon: Table, description: 'Editable Excel file (.xlsx)' },\n  { value: 'csv', label: 'CSV Data', icon: Table, description: 'Comma-separated values' },\n];\n\ninterface ExportReportDialogProps {\n  children: React.ReactNode;\n}\n\nexport default function ExportReportDialog({ children }: ExportReportDialogProps) {\n  const [open, setOpen] = useState(false);\n  const { toast } = useToast();\n\n  const form = useForm<ExportFormData>({\n    resolver: zodResolver(exportFormSchema),\n    defaultValues: {\n      email: '',\n      fromEmail: '',\n      subject: 'Employee Attendance Report - Last 30 Days',\n      format: 'html' as const,\n    },\n  });\n\n  const exportMutation = useMutation({\n    mutationFn: async (data: ExportFormData) => {\n      const token = getAuthToken();\n      if (!token) {\n        throw new Error('No authentication token found. Please log in again.');\n      }\n\n      const response = await fetch('/api/admin/export-report', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n        body: JSON.stringify(data),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || 'Failed to send report');\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: 'Report Sent Successfully',\n        description: 'The attendance report has been sent to the specified email address.',\n      });\n      setOpen(false);\n      form.reset();\n    },\n    onError: (error) => {\n      toast({\n        title: 'Export Failed',\n        description: error.message || 'Failed to send the report. Please try again.',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const onSubmit = (data: ExportFormData) => {\n    exportMutation.mutate(data);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        {children}\n      </DialogTrigger>\n      <DialogContent className=\"sm:max-w-[425px]\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Mail className=\"h-5 w-5\" />\n            Export Attendance Report\n          </DialogTitle>\n          <DialogDescription>\n            Send a comprehensive 30-day attendance report via email. The report will include \n            check-in/out times, work sites, and attendance summaries for all employees.\n          </DialogDescription>\n        </DialogHeader>\n        \n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"fromEmail\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>From Email (Your Email)</FormLabel>\n                  <FormControl>\n                    <Input \n                      placeholder=\"admin@company.com\" \n                      type=\"email\"\n                      {...field} \n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            \n            <FormField\n              control={form.control}\n              name=\"email\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Send Report To</FormLabel>\n                  <FormControl>\n                    <Input \n                      placeholder=\"recipient@example.com\" \n                      type=\"email\"\n                      {...field} \n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            \n            <FormField\n              control={form.control}\n              name=\"subject\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Email Subject</FormLabel>\n                  <FormControl>\n                    <Input \n                      placeholder=\"Employee Attendance Report\"\n                      {...field} \n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"format\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>File Format</FormLabel>\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Select export format\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      {formatOptions.map((option) => {\n                        const IconComponent = option.icon;\n                        return (\n                          <SelectItem key={option.value} value={option.value}>\n                            <div className=\"flex items-center space-x-2\">\n                              <IconComponent className=\"h-4 w-4\" />\n                              <div className=\"flex flex-col\">\n                                <span className=\"font-medium\">{option.label}</span>\n                                <span className=\"text-xs text-muted-foreground\">{option.description}</span>\n                              </div>\n                            </div>\n                          </SelectItem>\n                        );\n                      })}\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            \n            <div className=\"flex justify-end space-x-2 pt-4\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setOpen(false)}\n                disabled={exportMutation.isPending}\n              >\n                Cancel\n              </Button>\n              <Button \n                type=\"submit\" \n                disabled={exportMutation.isPending}\n                className=\"min-w-[120px]\"\n              >\n                {exportMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Sending...\n                  </>\n                ) : (\n                  <>\n                    <Download className=\"mr-2 h-4 w-4\" />\n                    Send Report\n                  </>\n                )}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":8228},"client/src/components/MiniMap.tsx":{"content":"import { useEffect, useRef, useState } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { getAuthToken } from '@/lib/auth';\nimport { MapPin } from 'lucide-react';\n\ndeclare global {\n  interface Window {\n    google: any;\n    initMap: () => void;\n  }\n}\n\ninterface MiniMapProps {\n  height?: string;\n  showEmployeeCount?: boolean;\n}\n\nexport default function MiniMap({ height = '256px', showEmployeeCount = true }: MiniMapProps) {\n  const mapRef = useRef<HTMLDivElement>(null);\n  const [mapInstance, setMapInstance] = useState<any>(null);\n  const [isLoaded, setIsLoaded] = useState(false);\n  const [hasError, setHasError] = useState(false);\n\n  // Fetch configuration including Google Maps API key\n  const { data: config } = useQuery<{ GOOGLE_MAPS_API_KEY: string }>({\n    queryKey: ['/api/config'],\n  });\n\n  // Fetch work sites and employees data\n  const { data: sites = [] } = useQuery<any[]>({\n    queryKey: ['/api/admin/sites'],\n    enabled: !!getAuthToken(),\n  });\n\n  const { data: employees = [] } = useQuery<any[]>({\n    queryKey: ['/api/admin/employees'],\n    enabled: !!getAuthToken(),\n  });\n\n  // Load Google Maps API\n  useEffect(() => {\n    // Check if Google Maps is already loaded\n    if (window.google && window.google.maps) {\n      setIsLoaded(true);\n      return;\n    }\n\n    // Check if API key is available\n    if (!config?.GOOGLE_MAPS_API_KEY) {\n      console.warn('Google Maps API key not configured');\n      setHasError(true);\n      return;\n    }\n\n    // Check if script is already being loaded\n    const existingScript = document.querySelector('script[src*=\"maps.googleapis.com\"]');\n    if (existingScript) {\n      const checkGoogle = setInterval(() => {\n        if (window.google && window.google.maps) {\n          setIsLoaded(true);\n          clearInterval(checkGoogle);\n        }\n      }, 100);\n      return () => clearInterval(checkGoogle);\n    }\n\n    // Create unique callback name to avoid conflicts\n    const callbackName = `initMap_${Date.now()}`;\n    \n    // Create callback function\n    (window as any)[callbackName] = () => {\n      setIsLoaded(true);\n      delete (window as any)[callbackName]; // Cleanup\n    };\n\n    // Load Google Maps script\n    const script = document.createElement('script');\n    script.src = `https://maps.googleapis.com/maps/api/js?key=${config.GOOGLE_MAPS_API_KEY}&callback=${callbackName}&loading=async`;\n    script.async = true;\n    script.defer = true;\n    script.onerror = () => {\n      console.error('Failed to load Google Maps API - Invalid API key');\n      setHasError(true);\n      setIsLoaded(false);\n      delete (window as any)[callbackName]; // Cleanup\n    };\n    document.head.appendChild(script);\n\n    return () => {\n      // Cleanup\n      if (script.parentNode) {\n        script.parentNode.removeChild(script);\n      }\n      delete (window as any)[callbackName];\n    };\n  }, [config]);\n\n  // Initialize map when Google Maps is loaded\n  useEffect(() => {\n    if (!isLoaded || !mapRef.current || mapInstance || hasError || !window.google) return;\n\n    // Default center (can be customized based on sites)\n    let center = { lat: 37.7749, lng: -122.4194 }; // San Francisco default\n    \n    // If we have sites, center on the first one with valid coordinates\n    if (sites.length > 0) {\n      const lat = parseFloat(sites[0].latitude);\n      const lng = parseFloat(sites[0].longitude);\n      if (!isNaN(lat) && !isNaN(lng)) {\n        center = { lat, lng };\n      }\n    }\n\n    const map = new window.google.maps.Map(mapRef.current, {\n      zoom: sites.length > 0 ? 13 : 10,\n      center,\n      mapTypeId: 'roadmap',\n      disableDefaultUI: true,\n      gestureHandling: 'none',\n      zoomControl: false,\n      scrollwheel: false,\n      disableDoubleClickZoom: true,\n      draggable: false,\n      styles: [\n        {\n          featureType: 'poi',\n          elementType: 'labels',\n          stylers: [{ visibility: 'off' }]\n        }\n      ]\n    });\n\n    setMapInstance(map);\n  }, [isLoaded, sites]);\n\n  // Add markers for work sites\n  useEffect(() => {\n    if (!mapInstance || !sites.length) return;\n\n    // Clear existing markers (if any)\n    // Note: In a production app, you'd want to manage markers more efficiently\n\n    sites.forEach((site: any) => {\n      // Validate coordinates before using them\n      const lat = parseFloat(site.latitude);\n      const lng = parseFloat(site.longitude);\n      \n      if (site.latitude && site.longitude && !isNaN(lat) && !isNaN(lng)) {\n        const marker = new window.google.maps.Marker({\n          position: {\n            lat: lat,\n            lng: lng\n          },\n          map: mapInstance,\n          title: site.name,\n          icon: {\n            url: 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(`\n              <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\" fill=\"#3B82F6\" stroke=\"#1E40AF\" stroke-width=\"2\"/>\n                <circle cx=\"12\" cy=\"10\" r=\"3\" fill=\"white\"/>\n              </svg>\n            `),\n            scaledSize: new window.google.maps.Size(24, 24),\n            anchor: new window.google.maps.Point(12, 24)\n          }\n        });\n\n        // Add geofence circle\n        new window.google.maps.Circle({\n          strokeColor: '#3B82F6',\n          strokeOpacity: 0.4,\n          strokeWeight: 2,\n          fillColor: '#3B82F6',\n          fillOpacity: 0.1,\n          map: mapInstance,\n          center: {\n            lat: lat,\n            lng: lng\n          },\n          radius: site.geofenceRadius || 200\n        });\n      }\n    });\n  }, [mapInstance, sites]);\n\n  const activeEmployees = employees.filter((emp: any) => emp.isActive).length;\n\n  if (hasError || (!isLoaded && !window.google)) {\n    return (\n      <div \n        className=\"bg-gray-100 rounded-lg flex items-center justify-center\"\n        style={{ height }}\n      >\n        <div className=\"bg-white bg-opacity-95 rounded-lg p-6 text-center max-w-sm\">\n          <MapPin className=\"text-blue-500 text-3xl mb-3 mx-auto\" />\n          <p className=\"text-base font-semibold text-gray-900 mb-2\">Live Locations Map</p>\n          <p className=\"text-sm text-gray-600 mb-3\">\n            Map requires valid Google Maps API key\n          </p>\n          {showEmployeeCount && (\n            <div className=\"bg-gray-50 rounded-lg p-3\">\n              <p className=\"text-sm font-medium text-gray-700\">\n                {sites.length} work sites • {activeEmployees} active employees\n              </p>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"relative rounded-lg overflow-hidden\" style={{ height }}>\n      <div ref={mapRef} className=\"w-full h-full\" />\n      {showEmployeeCount && (\n        <div className=\"absolute bottom-3 left-3 bg-white bg-opacity-90 rounded-lg px-3 py-2 shadow-sm\">\n          <div className=\"flex items-center space-x-2\">\n            <MapPin className=\"text-primary text-sm\" />\n            <span className=\"text-xs font-medium text-gray-900\">\n              {sites.length} sites • {activeEmployees} employees\n            </span>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":7198},"client/src/components/NotificationDropdown.tsx":{"content":"import { useState } from 'react';\nimport { Bell, X, Clock, MapPin, User } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { useNotifications, type Notification } from '@/hooks/useNotifications';\nimport { AuthenticatedImage } from '@/components/AuthenticatedImage';\nimport { formatDistanceToNow } from 'date-fns';\n\nexport default function NotificationDropdown() {\n  const { notifications, isConnected, clearNotifications, markAsRead } = useNotifications();\n  const [isOpen, setIsOpen] = useState(false);\n\n  const formatTime = (timestamp: string) => {\n    return formatDistanceToNow(new Date(timestamp), { addSuffix: true });\n  };\n\n  const getNotificationIcon = (type: Notification['type']) => {\n    switch (type) {\n      case 'employee_checkin':\n        return <User className=\"h-4 w-4 text-green-600\" />;\n      case 'employee_checkout':\n        return <Clock className=\"h-4 w-4 text-orange-600\" />;\n      default:\n        return <Bell className=\"h-4 w-4\" />;\n    }\n  };\n\n  const getNotificationColor = (type: Notification['type']) => {\n    switch (type) {\n      case 'employee_checkin':\n        return 'bg-green-50 border-green-200';\n      case 'employee_checkout':\n        return 'bg-orange-50 border-orange-200';\n      default:\n        return 'bg-gray-50 border-gray-200';\n    }\n  };\n\n  return (\n    <DropdownMenu open={isOpen} onOpenChange={setIsOpen}>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"ghost\" size=\"sm\" className=\"relative\">\n          <Bell className=\"h-5 w-5\" />\n          {notifications.length > 0 && (\n            <Badge \n              variant=\"destructive\" \n              className=\"absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 flex items-center justify-center text-xs\"\n            >\n              {notifications.length > 9 ? '9+' : notifications.length}\n            </Badge>\n          )}\n          {!isConnected && (\n            <div className=\"absolute -top-1 -right-1 h-3 w-3 bg-red-500 rounded-full animate-pulse\" />\n          )}\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\" className=\"w-96 p-0\">\n        <div className=\"flex items-center justify-between p-4 border-b\">\n          <div className=\"flex items-center gap-2\">\n            <h3 className=\"font-semibold\">Notifications</h3>\n            {notifications.length > 0 && (\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {notifications.length}\n              </Badge>\n            )}\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Badge variant={isConnected ? \"default\" : \"destructive\"} className=\"text-xs\">\n              {isConnected ? \"Live\" : \"Offline\"}\n            </Badge>\n            {notifications.length > 0 && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={clearNotifications}\n                className=\"h-6 w-6 p-0\"\n              >\n                <X className=\"h-3 w-3\" />\n              </Button>\n            )}\n          </div>\n        </div>\n\n        {notifications.length === 0 ? (\n          <div className=\"p-6 text-center text-muted-foreground\">\n            <Bell className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n            <p className=\"font-medium\">No notifications</p>\n            <p className=\"text-sm\">Employee check-in/out alerts will appear here</p>\n          </div>\n        ) : (\n          <ScrollArea className=\"h-80\">\n            <div className=\"p-2\">\n              {notifications.map((notification, index) => (\n                <div\n                  key={`${notification.timestamp}-${index}`}\n                  className={`p-3 mb-2 rounded-lg border ${getNotificationColor(notification.type)} relative group hover:shadow-sm transition-shadow`}\n                >\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => markAsRead(index)}\n                    className=\"absolute top-1 right-1 h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity\"\n                  >\n                    <X className=\"h-3 w-3\" />\n                  </Button>\n                  \n                  <div className=\"flex items-start gap-3 pr-6\">\n                    <div className=\"mt-1 flex items-center space-x-2\">\n                      <AuthenticatedImage\n                        src={notification.employee.profileImage}\n                        alt={`${notification.employee.firstName} ${notification.employee.lastName}`}\n                        className=\"w-6 h-6 rounded-full object-cover\"\n                        fallback={\n                          <div className=\"w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center\">\n                            <span className=\"text-xs font-medium text-gray-600\">\n                              {notification.employee.firstName?.[0]}{notification.employee.lastName?.[0]}\n                            </span>\n                          </div>\n                        }\n                      />\n                      {getNotificationIcon(notification.type)}\n                    </div>\n                    <div className=\"flex-1 space-y-1\">\n                      <p className=\"text-sm font-medium text-gray-900\">\n                        {notification.message}\n                      </p>\n                      \n                      <div className=\"flex items-center gap-2 text-xs text-gray-600\">\n                        <User className=\"h-3 w-3\" />\n                        <span>{notification.employee.email}</span>\n                      </div>\n                      \n                      {notification.site && (\n                        <div className=\"flex items-center gap-2 text-xs text-gray-600\">\n                          <MapPin className=\"h-3 w-3\" />\n                          <span>{notification.site.name}</span>\n                        </div>\n                      )}\n                      \n                      <div className=\"flex items-center gap-2 text-xs text-gray-500\">\n                        <Clock className=\"h-3 w-3\" />\n                        <span>{formatTime(notification.timestamp)}</span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </ScrollArea>\n        )}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}","size_bytes":6589},"client/src/components/NotificationPanel.tsx":{"content":"import { Bell, X, Clock, MapPin, User } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Separator } from '@/components/ui/separator';\nimport { useNotifications, type Notification } from '@/hooks/useNotifications';\nimport { formatDistanceToNow } from 'date-fns';\n\nexport default function NotificationPanel() {\n  const { notifications, isConnected, clearNotifications, markAsRead } = useNotifications();\n\n  const formatTime = (timestamp: string) => {\n    return formatDistanceToNow(new Date(timestamp), { addSuffix: true });\n  };\n\n  const getNotificationIcon = (type: Notification['type']) => {\n    switch (type) {\n      case 'employee_checkin':\n        return <User className=\"h-4 w-4 text-green-600\" />;\n      case 'employee_checkout':\n        return <Clock className=\"h-4 w-4 text-orange-600\" />;\n      default:\n        return <Bell className=\"h-4 w-4\" />;\n    }\n  };\n\n  const getNotificationColor = (type: Notification['type']) => {\n    switch (type) {\n      case 'employee_checkin':\n        return 'bg-green-50 border-green-200';\n      case 'employee_checkout':\n        return 'bg-orange-50 border-orange-200';\n      default:\n        return 'bg-gray-50 border-gray-200';\n    }\n  };\n\n  return (\n    <Card className=\"w-full max-w-md\">\n      <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n        <CardTitle className=\"text-lg font-semibold flex items-center gap-2\">\n          <Bell className=\"h-5 w-5\" />\n          Notifications\n          {notifications.length > 0 && (\n            <Badge variant=\"secondary\" className=\"ml-2\">\n              {notifications.length}\n            </Badge>\n          )}\n        </CardTitle>\n        <div className=\"flex items-center gap-2\">\n          <Badge variant={isConnected ? \"default\" : \"destructive\"} className=\"text-xs\">\n            {isConnected ? \"Connected\" : \"Disconnected\"}\n          </Badge>\n          {notifications.length > 0 && (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={clearNotifications}\n              className=\"h-8 w-8 p-0\"\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          )}\n        </div>\n      </CardHeader>\n      <CardContent className=\"p-0\">\n        {notifications.length === 0 ? (\n          <div className=\"p-6 text-center text-muted-foreground\">\n            <Bell className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n            <p>No notifications yet</p>\n            <p className=\"text-sm\">You'll see employee check-in/out alerts here</p>\n          </div>\n        ) : (\n          <ScrollArea className=\"h-96\">\n            <div className=\"p-4 space-y-3\">\n              {notifications.map((notification, index) => (\n                <div\n                  key={`${notification.timestamp}-${index}`}\n                  className={`p-3 rounded-lg border ${getNotificationColor(notification.type)} relative group`}\n                >\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => markAsRead(index)}\n                    className=\"absolute top-1 right-1 h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity\"\n                  >\n                    <X className=\"h-3 w-3\" />\n                  </Button>\n                  \n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"mt-1\">\n                      {getNotificationIcon(notification.type)}\n                    </div>\n                    <div className=\"flex-1 space-y-1\">\n                      <p className=\"text-sm font-medium text-gray-900\">\n                        {notification.message}\n                      </p>\n                      \n                      <div className=\"flex items-center gap-2 text-xs text-gray-600\">\n                        <User className=\"h-3 w-3\" />\n                        <span>{notification.employee.email}</span>\n                      </div>\n                      \n                      {notification.site && (\n                        <div className=\"flex items-center gap-2 text-xs text-gray-600\">\n                          <MapPin className=\"h-3 w-3\" />\n                          <span>{notification.site.name}</span>\n                        </div>\n                      )}\n                      \n                      <div className=\"flex items-center gap-2 text-xs text-gray-500\">\n                        <Clock className=\"h-3 w-3\" />\n                        <span>{formatTime(notification.timestamp)}</span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </ScrollArea>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":4941},"client/src/components/ObjectUploader.tsx":{"content":"import { useState } from \"react\";\nimport type { ReactNode } from \"react\";\nimport Uppy from \"@uppy/core\";\nimport { DashboardModal } from \"@uppy/react\";\nimport \"@uppy/core/dist/style.min.css\";\nimport \"@uppy/dashboard/dist/style.min.css\";\nimport AwsS3 from \"@uppy/aws-s3\";\nimport type { UploadResult } from \"@uppy/core\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface ObjectUploaderProps {\n  maxNumberOfFiles?: number;\n  maxFileSize?: number;\n  allowedFileTypes?: string[];\n  onGetUploadParameters: () => Promise<{\n    method: \"PUT\";\n    url: string;\n  }>;\n  onComplete?: (\n    result: UploadResult<Record<string, unknown>, Record<string, unknown>>\n  ) => void;\n  buttonClassName?: string;\n  children: ReactNode;\n}\n\n/**\n * A file upload component that renders as a button and provides a modal interface for\n * file management.\n * \n * Features:\n * - Renders as a customizable button that opens a file upload modal\n * - Provides a modal interface for:\n *   - File selection\n *   - File preview\n *   - Upload progress tracking\n *   - Upload status display\n * \n * The component uses Uppy under the hood to handle all file upload functionality.\n * All file management features are automatically handled by the Uppy dashboard modal.\n * \n * @param props - Component props\n * @param props.maxNumberOfFiles - Maximum number of files allowed to be uploaded\n *   (default: 1)\n * @param props.maxFileSize - Maximum file size in bytes (default: 10MB)\n * @param props.allowedFileTypes - Array of allowed file types (default: [\"image/*\"])\n * @param props.onGetUploadParameters - Function to get upload parameters (method and URL).\n *   Typically used to fetch a presigned URL from the backend server for direct-to-S3\n *   uploads.\n * @param props.onComplete - Callback function called when upload is complete. Typically\n *   used to make post-upload API calls to update server state and set object ACL\n *   policies.\n * @param props.buttonClassName - Optional CSS class name for the button\n * @param props.children - Content to be rendered inside the button\n */\nexport function ObjectUploader({\n  maxNumberOfFiles = 1,\n  maxFileSize = 10485760, // 10MB default\n  allowedFileTypes = [\"image/*\"],\n  onGetUploadParameters,\n  onComplete,\n  buttonClassName,\n  children,\n}: ObjectUploaderProps) {\n  const [showModal, setShowModal] = useState(false);\n  const [uppy] = useState(() =>\n    new Uppy({\n      restrictions: {\n        maxNumberOfFiles,\n        maxFileSize,\n        allowedFileTypes,\n      },\n      autoProceed: false,\n    })\n      .use(AwsS3, {\n        shouldUseMultipart: false,\n        getUploadParameters: onGetUploadParameters,\n      })\n      .on(\"complete\", (result) => {\n        onComplete?.(result);\n        // Use setTimeout to prevent immediate closing from affecting parent dialogs\n        setTimeout(() => setShowModal(false), 100);\n      })\n  );\n\n  return (\n    <div>\n      <Button \n        onClick={(e) => {\n          e.stopPropagation();\n          setShowModal(true);\n        }} \n        className={buttonClassName}\n        type=\"button\"\n      >\n        {children}\n      </Button>\n\n      <DashboardModal\n        uppy={uppy}\n        open={showModal}\n        onRequestClose={() => setShowModal(false)}\n        proudlyDisplayPoweredByUppy={false}\n      />\n    </div>\n  );\n}","size_bytes":3282},"client/src/components/PersonIcon.tsx":{"content":"import React from 'react';\n\ninterface PersonIconProps {\n  size?: number;\n  color?: string;\n  className?: string;\n}\n\nexport function PersonIcon({ size = 24, color = '#ff0000', className = '' }: PersonIconProps) {\n  return (\n    <svg \n      width={size} \n      height={size} \n      viewBox=\"0 0 24 24\" \n      fill=\"none\" \n      className={className}\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      {/* Location pin outline */}\n      <path \n        d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z\" \n        fill={color}\n        stroke=\"#ffffff\"\n        strokeWidth=\"1\"\n      />\n      {/* Person figure inside the pin */}\n      <circle cx=\"12\" cy=\"8.5\" r=\"2\" fill=\"#ffffff\" />\n      <path \n        d=\"M8.5 13.5c0-1.5 1.57-2.5 3.5-2.5s3.5 1 3.5 2.5v1h-7v-1z\" \n        fill=\"#ffffff\"\n      />\n    </svg>\n  );\n}\n\nexport default PersonIcon;","size_bytes":864},"client/src/components/google-map.tsx":{"content":"import { useEffect, useRef } from 'react';\n\ninterface GoogleMapProps {\n  center: { lat: number; lng: number };\n  zoom?: number;\n  mapType?: 'roadmap' | 'satellite';\n  markers?: Array<{\n    position: { lat: number; lng: number };\n    title: string;\n    color?: string;\n    type?: 'employee' | 'site';\n    onClick?: () => void;\n  }>;\n  geofences?: Array<{\n    center: { lat: number; lng: number };\n    radius: number;\n    color?: string;\n  }>;\n  className?: string;\n  onMapClick?: (lat: number, lng: number) => void;\n}\n\nexport default function GoogleMap({\n  center,\n  zoom = 13,\n  mapType = 'roadmap',\n  markers = [],\n  geofences = [],\n  className = '',\n  onMapClick,\n}: GoogleMapProps) {\n  const mapRef = useRef<HTMLDivElement>(null);\n  const mapInstanceRef = useRef<google.maps.Map | null>(null);\n  const markersRef = useRef<google.maps.Marker[]>([]);\n  const circlesRef = useRef<google.maps.Circle[]>([]);\n\n  useEffect(() => {\n    // Ensure DOM element exists and is valid before creating map\n    if (!mapRef.current || !window.google?.maps) {\n      console.warn('Map container or Google Maps API not ready');\n      return;\n    }\n\n    // Additional validation - check if element is actually in DOM\n    if (!document.contains(mapRef.current)) {\n      console.warn('Map container element not in document');\n      return;\n    }\n\n    try {\n      // Initialize Google Map with error handling\n      mapInstanceRef.current = new google.maps.Map(mapRef.current, {\n        center,\n        zoom,\n        mapTypeId: mapType === 'satellite' ? 'satellite' : 'roadmap',\n        zoomControl: false,\n        mapTypeControl: false,\n        scaleControl: false,\n        streetViewControl: false,\n        rotateControl: false,\n        fullscreenControl: false,\n        disableDefaultUI: true,\n        scrollwheel: true, // Enable mouse wheel zoom\n        gestureHandling: 'auto', // Enable all gestures including zoom\n        styles: [\n          {\n            featureType: 'poi',\n            elementType: 'labels',\n            stylers: [{ visibility: 'off' }],\n          },\n        ],\n      });\n\n      // Add click listener with null check\n      if (onMapClick && mapInstanceRef.current) {\n        mapInstanceRef.current.addListener('click', (event: google.maps.MapMouseEvent) => {\n          if (event.latLng) {\n            onMapClick(event.latLng.lat(), event.latLng.lng());\n          }\n        });\n      }\n    } catch (error) {\n      console.error('Failed to initialize Google Map:', error);\n    }\n  }, []);\n\n  // Update map center when prop changes\n  useEffect(() => {\n    if (mapInstanceRef.current && center && typeof center.lat === 'number' && typeof center.lng === 'number') {\n      mapInstanceRef.current.setCenter(center);\n    }\n  }, [center]);\n\n  // Update markers\n  useEffect(() => {\n    if (!mapInstanceRef.current || !window.google?.maps) return;\n\n    // Clear existing markers safely\n    markersRef.current.forEach(marker => {\n      try {\n        marker.setMap(null);\n      } catch (error) {\n        console.warn('Error clearing marker:', error);\n      }\n    });\n    markersRef.current = [];\n\n    // Add new markers with custom icons\n    markers.forEach(markerData => {\n      let customIcon;\n      \n      if (markerData.type === 'site') {\n        // Create custom site icon SVG (building/location marker in green)\n        customIcon = {\n          url: `data:image/svg+xml;charset=UTF-8,${encodeURIComponent(`\n            <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n              <path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z\" \n                    fill=\"${markerData.color || '#22c55e'}\" stroke=\"#ffffff\" stroke-width=\"1\"/>\n              <rect x=\"8\" y=\"6\" width=\"8\" height=\"10\" rx=\"1\" fill=\"#ffffff\"/>\n              <rect x=\"9\" y=\"7\" width=\"2\" height=\"2\" fill=\"${markerData.color || '#22c55e'}\"/>\n              <rect x=\"13\" y=\"7\" width=\"2\" height=\"2\" fill=\"${markerData.color || '#22c55e'}\"/>\n              <rect x=\"9\" y=\"10\" width=\"2\" height=\"2\" fill=\"${markerData.color || '#22c55e'}\"/>\n              <rect x=\"13\" y=\"10\" width=\"2\" height=\"2\" fill=\"${markerData.color || '#22c55e'}\"/>\n              <rect x=\"11\" y=\"13\" width=\"2\" height=\"3\" fill=\"${markerData.color || '#22c55e'}\"/>\n            </svg>\n          `)}`,\n          scaledSize: new (window as any).google.maps.Size(32, 32),\n          anchor: new (window as any).google.maps.Point(16, 32),\n        };\n      } else {\n        // Create custom person icon SVG (default for employees)\n        customIcon = {\n          url: `data:image/svg+xml;charset=UTF-8,${encodeURIComponent(`\n            <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n              <path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z\" \n                    fill=\"${markerData.color || '#ff0000'}\" stroke=\"#ffffff\" stroke-width=\"1\"/>\n              <circle cx=\"12\" cy=\"8.5\" r=\"2\" fill=\"#ffffff\"/>\n              <path d=\"M8.5 13.5c0-1.5 1.57-2.5 3.5-2.5s3.5 1 3.5 2.5v1h-7v-1z\" fill=\"#ffffff\"/>\n            </svg>\n          `)}`,\n          scaledSize: new (window as any).google.maps.Size(32, 32),\n          anchor: new (window as any).google.maps.Point(16, 32),\n        };\n      }\n\n      const marker = new google.maps.Marker({\n        position: markerData.position,\n        map: mapInstanceRef.current,\n        title: markerData.title,\n        icon: customIcon,\n      });\n\n      // Add click listener if onClick is provided\n      if (markerData.onClick) {\n        (marker as any).addListener('click', markerData.onClick);\n      }\n\n      markersRef.current.push(marker);\n    });\n  }, [markers]);\n\n  // Update geofences\n  useEffect(() => {\n    if (!mapInstanceRef.current || !window.google?.maps) return;\n\n    // Clear existing circles safely\n    circlesRef.current.forEach(circle => {\n      try {\n        circle.setMap(null);\n      } catch (error) {\n        console.warn('Error clearing geofence circle:', error);\n      }\n    });\n    circlesRef.current = [];\n\n    // Add new circles\n    geofences.forEach(geofence => {\n      const circle = new google.maps.Circle({\n        center: geofence.center,\n        radius: geofence.radius,\n        map: mapInstanceRef.current,\n        fillColor: geofence.color || '#1976D2',\n        fillOpacity: 0.1,\n        strokeColor: geofence.color || '#1976D2',\n        strokeOpacity: 0.8,\n        strokeWeight: 2,\n        strokeDasharray: '5,5',\n      });\n\n      circlesRef.current.push(circle);\n    });\n  }, [geofences]);\n\n  // Update zoom when prop changes\n  useEffect(() => {\n    if (mapInstanceRef.current && typeof zoom === 'number') {\n      (mapInstanceRef.current as any).setZoom(zoom);\n    }\n  }, [zoom]);\n\n  // Update map type when prop changes\n  useEffect(() => {\n    if (mapInstanceRef.current) {\n      const mapTypeId = mapType === 'satellite' ? 'satellite' : 'roadmap';\n      (mapInstanceRef.current as any).setMapTypeId(mapTypeId);\n    }\n  }, [mapType]);\n\n  return (\n    <div className={`w-full h-full ${className}`}>\n      <div ref={mapRef} className=\"w-full h-full rounded-lg\" />\n      <style>{`\n        .gm-style-mtc { display: none !important; }\n        .gm-bundled-control { display: none !important; }\n        .gm-fullscreen-control { display: none !important; }\n        .gmnoprint { display: none !important; }\n        .gm-control-active { display: none !important; }\n        .gm-style .gm-style-mtc { display: none !important; }\n        [title=\"Toggle between map and satellite imagery\"] { display: none !important; }\n        .gm-style-cc { display: none !important; }\n        .gmnoprint div { display: none !important; }\n      `}</style>\n    </div>\n  );\n}\n\n// Load Google Maps API\nexport function loadGoogleMapsAPI(): Promise<void> {\n  return new Promise((resolve, reject) => {\n    if (typeof google !== 'undefined' && google.maps) {\n      resolve();\n      return;\n    }\n\n    const script = document.createElement('script');\n    script.src = `https://maps.googleapis.com/maps/api/js?key=${import.meta.env.VITE_GOOGLE_MAPS_API_KEY}&libraries=geometry`;\n    script.async = true;\n    script.defer = true;\n    \n    script.onload = () => resolve();\n    script.onerror = () => reject(new Error('Failed to load Google Maps API'));\n    \n    document.head.appendChild(script);\n  });\n}\n","size_bytes":8315},"client/src/hooks/use-geolocation.tsx":{"content":"import { useState, useEffect } from 'react';\n\ninterface GeolocationState {\n  latitude: number | null;\n  longitude: number | null;\n  error: string | null;\n  loading: boolean;\n}\n\ninterface UseGeolocationOptions {\n  enableHighAccuracy?: boolean;\n  timeout?: number;\n  maximumAge?: number;\n  watch?: boolean;\n}\n\nexport function useGeolocation(options: UseGeolocationOptions = {}) {\n  const [state, setState] = useState<GeolocationState>({\n    latitude: null,\n    longitude: null,\n    error: null,\n    loading: true,\n  });\n\n  const {\n    enableHighAccuracy = true,\n    timeout = 10000,\n    maximumAge = 60000,\n    watch = false,\n  } = options;\n\n  useEffect(() => {\n    if (!navigator.geolocation) {\n      setState({\n        latitude: null,\n        longitude: null,\n        error: 'Geolocation is not supported by this browser.',\n        loading: false,\n      });\n      return;\n    }\n\n    const handleSuccess = (position: GeolocationPosition) => {\n      setState({\n        latitude: position.coords.latitude,\n        longitude: position.coords.longitude,\n        error: null,\n        loading: false,\n      });\n    };\n\n    const handleError = (error: GeolocationPositionError) => {\n      let errorMessage = 'An unknown error occurred.';\n      \n      switch (error.code) {\n        case error.PERMISSION_DENIED:\n          errorMessage = 'Location access denied by user.';\n          break;\n        case error.POSITION_UNAVAILABLE:\n          errorMessage = 'Location information is unavailable.';\n          break;\n        case error.TIMEOUT:\n          errorMessage = 'Location request timed out.';\n          break;\n      }\n\n      setState({\n        latitude: null,\n        longitude: null,\n        error: errorMessage,\n        loading: false,\n      });\n    };\n\n    const geoOptions = {\n      enableHighAccuracy,\n      timeout,\n      maximumAge,\n    };\n\n    let watchId: number | undefined;\n\n    if (watch) {\n      watchId = navigator.geolocation.watchPosition(\n        handleSuccess,\n        handleError,\n        geoOptions\n      );\n    } else {\n      navigator.geolocation.getCurrentPosition(\n        handleSuccess,\n        handleError,\n        geoOptions\n      );\n    }\n\n    return () => {\n      if (watchId !== undefined) {\n        navigator.geolocation.clearWatch(watchId);\n      }\n    };\n  }, [enableHighAccuracy, timeout, maximumAge, watch]);\n\n  const requestPermission = async () => {\n    if (!navigator.permissions) {\n      return 'unsupported';\n    }\n\n    try {\n      const result = await navigator.permissions.query({ name: 'geolocation' });\n      return result.state;\n    } catch {\n      return 'unknown';\n    }\n  };\n\n  return {\n    ...state,\n    requestPermission,\n  };\n}\n","size_bytes":2673},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/hooks/use-websocket.tsx":{"content":"import { useEffect, useRef, useState } from 'react';\nimport { getAuthToken } from '@/lib/auth';\n\ninterface UseWebSocketOptions {\n  onMessage?: (data: any) => void;\n  onOpen?: () => void;\n  onClose?: () => void;\n  onError?: (error: Event) => void;\n}\n\nexport function useWebSocket(options: UseWebSocketOptions = {}) {\n  const [isConnected, setIsConnected] = useState(false);\n  const wsRef = useRef<WebSocket | null>(null);\n  const { onMessage, onOpen, onClose, onError } = options;\n\n  const connect = () => {\n    const token = getAuthToken();\n    if (!token) return;\n\n    const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n    const wsUrl = `${protocol}//${window.location.host}/ws?token=${token}`;\n    \n    wsRef.current = new WebSocket(wsUrl);\n\n    wsRef.current.onopen = () => {\n      setIsConnected(true);\n      onOpen?.();\n    };\n\n    wsRef.current.onclose = () => {\n      setIsConnected(false);\n      onClose?.();\n    };\n\n    wsRef.current.onerror = (error) => {\n      onError?.(error);\n    };\n\n    wsRef.current.onmessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        onMessage?.(data);\n      } catch (error) {\n        console.error('Failed to parse WebSocket message:', error);\n      }\n    };\n  };\n\n  const disconnect = () => {\n    if (wsRef.current) {\n      wsRef.current.close();\n      wsRef.current = null;\n    }\n  };\n\n  const sendMessage = (message: any) => {\n    if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify(message));\n    }\n  };\n\n  useEffect(() => {\n    connect();\n    return disconnect;\n  }, []);\n\n  return {\n    isConnected,\n    sendMessage,\n    reconnect: connect,\n    disconnect,\n  };\n}\n","size_bytes":1722},"client/src/hooks/useAuthenticatedImage.ts":{"content":"import { useState, useEffect } from 'react';\nimport { getAuthToken } from '@/lib/auth';\n\nexport function useAuthenticatedImage(imageUrl?: string) {\n  const [blobUrl, setBlobUrl] = useState<string>('');\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string>('');\n\n  useEffect(() => {\n    if (!imageUrl) {\n      setBlobUrl('');\n      return;\n    }\n\n    // If it's already a blob URL or doesn't need authentication, use it directly\n    if (imageUrl.startsWith('blob:') || !imageUrl.includes('/objects/')) {\n      setBlobUrl(imageUrl);\n      return;\n    }\n\n    let isCancelled = false;\n    setLoading(true);\n    setError('');\n\n    const fetchImage = async () => {\n      try {\n        const response = await fetch(imageUrl, {\n          headers: {\n            'Authorization': `Bearer ${getAuthToken()}`,\n          },\n        });\n\n        if (!response.ok) {\n          throw new Error(`Failed to load image: ${response.status}`);\n        }\n\n        const blob = await response.blob();\n        if (!isCancelled) {\n          const url = URL.createObjectURL(blob);\n          setBlobUrl(url);\n        }\n      } catch (err) {\n        if (!isCancelled) {\n          setError(err instanceof Error ? err.message : 'Failed to load image');\n          console.error('Failed to load authenticated image:', err);\n        }\n      } finally {\n        if (!isCancelled) {\n          setLoading(false);\n        }\n      }\n    };\n\n    fetchImage();\n\n    return () => {\n      isCancelled = true;\n      if (blobUrl && blobUrl.startsWith('blob:')) {\n        URL.revokeObjectURL(blobUrl);\n      }\n    };\n  }, [imageUrl]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (blobUrl && blobUrl.startsWith('blob:')) {\n        URL.revokeObjectURL(blobUrl);\n      }\n    };\n  }, [blobUrl]);\n\n  return { blobUrl, loading, error };\n}","size_bytes":1856},"client/src/hooks/useNotifications.ts":{"content":"import { useEffect, useState } from 'react';\nimport { getAuthToken } from '@/lib/auth';\nimport { useToast } from '@/hooks/use-toast';\n\nexport interface Notification {\n  type: 'employee_checkin' | 'employee_checkout';\n  message: string;\n  employee: {\n    id: number;\n    name: string;\n    email: string;\n  };\n  site: {\n    id: number;\n    name: string;\n    address: string;\n  } | null;\n  timestamp: string;\n  location: {\n    latitude: number;\n    longitude: number;\n  };\n}\n\nexport function useNotifications() {\n  const [notifications, setNotifications] = useState<Notification[]>([]);\n  const [isConnected, setIsConnected] = useState(false);\n  const { toast } = useToast();\n\n  // Load recent notifications from server on mount\n  useEffect(() => {\n    const loadRecentNotifications = async () => {\n      try {\n        const token = getAuthToken();\n        if (!token) return;\n\n        const response = await fetch('/api/admin/notifications/recent', {\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        });\n        \n        if (response.ok) {\n          const recentNotifications = await response.json();\n          setNotifications(recentNotifications);\n        }\n      } catch (error) {\n        console.error('Error loading recent notifications:', error);\n      }\n    };\n\n    loadRecentNotifications();\n  }, []);\n\n  useEffect(() => {\n    const token = getAuthToken();\n    if (!token) return;\n\n    let ws: WebSocket;\n    let reconnectTimer: NodeJS.Timeout;\n\n    const connect = () => {\n      const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n      const wsUrl = `${protocol}//${window.location.host}/ws?token=${token}`;\n      ws = new WebSocket(wsUrl);\n\n      ws.onopen = () => {\n        setIsConnected(true);\n        console.log('Connected to notification system');\n        // Clear any reconnect timer\n        if (reconnectTimer) {\n          clearTimeout(reconnectTimer);\n        }\n      };\n\n      ws.onclose = () => {\n        setIsConnected(false);\n        console.log('Disconnected from notification system');\n        // Attempt to reconnect after 3 seconds\n        reconnectTimer = setTimeout(connect, 3000);\n      };\n\n      ws.onerror = (error) => {\n        console.error('WebSocket error:', error);\n        setIsConnected(false);\n      };\n\n      ws.onmessage = (event) => {\n        try {\n          const message = JSON.parse(event.data);\n          \n          if (message.type === 'notification') {\n            const notification = message.data as Notification;\n            console.log('Received notification:', notification);\n            \n            // Add to notifications list (keep last 5, avoid duplicates)\n            setNotifications(prev => {\n              // Check if this notification already exists (by timestamp and type)\n              const isDuplicate = prev.some(n => \n                n.timestamp === notification.timestamp && \n                n.type === notification.type && \n                n.employee.id === notification.employee.id\n              );\n              \n              if (isDuplicate) {\n                console.log('Duplicate notification detected, skipping');\n                return prev;\n              }\n              \n              const newNotifications = [notification, ...prev];\n              return newNotifications.slice(0, 5); // Keep only last 5\n            });\n            \n            // Show toast notification\n            toast({\n              title: notification.type === 'employee_checkin' ? 'Employee Check-in' : 'Employee Check-out',\n              description: notification.message,\n              duration: 5000,\n            });\n          } else if (message.type === 'connection_established') {\n            console.log(message.message);\n          } else {\n            console.log('Received unknown message type:', message.type, message);\n          }\n        } catch (error) {\n          console.error('Error parsing notification:', error);\n        }\n      };\n    };\n\n    connect();\n\n    return () => {\n      if (reconnectTimer) {\n        clearTimeout(reconnectTimer);\n      }\n      if (ws) {\n        ws.close();\n      }\n    };\n  }, [toast]);\n\n  const clearNotifications = () => {\n    setNotifications([]);\n  };\n\n  const markAsRead = (index: number) => {\n    setNotifications(prev => prev.filter((_, i) => i !== index));\n  };\n\n  return {\n    notifications,\n    isConnected,\n    clearNotifications,\n    markAsRead\n  };\n}","size_bytes":4427},"client/src/hooks/useWebSocket.ts":{"content":"import { useEffect, useState, useRef } from 'react';\n\ninterface UseWebSocketProps {\n  onMessage?: (data: any) => void;\n  onConnect?: () => void;\n  onDisconnect?: () => void;\n}\n\nexport function useWebSocket({ onMessage, onConnect, onDisconnect }: UseWebSocketProps = {}) {\n  const [isConnected, setIsConnected] = useState(false);\n  const wsRef = useRef<WebSocket | null>(null);\n  const reconnectTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const isUnmountedRef = useRef(false);\n\n  const connect = () => {\n    if (isUnmountedRef.current) return;\n\n    try {\n      const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n      const wsUrl = `${protocol}//${window.location.host}/ws`;\n      \n      wsRef.current = new WebSocket(wsUrl);\n\n      wsRef.current.onopen = () => {\n        if (isUnmountedRef.current) return;\n        setIsConnected(true);\n        onConnect?.();\n        console.log('WebSocket connected');\n      };\n\n      wsRef.current.onmessage = (event) => {\n        if (isUnmountedRef.current) return;\n        try {\n          const data = JSON.parse(event.data);\n          onMessage?.(data);\n        } catch (error) {\n          console.error('Failed to parse WebSocket message:', error);\n        }\n      };\n\n      wsRef.current.onclose = () => {\n        if (isUnmountedRef.current) return;\n        setIsConnected(false);\n        onDisconnect?.();\n        console.log('WebSocket disconnected');\n\n        // Attempt to reconnect after 3 seconds\n        reconnectTimeoutRef.current = setTimeout(() => {\n          if (!isUnmountedRef.current) {\n            connect();\n          }\n        }, 3000);\n      };\n\n      wsRef.current.onerror = (error) => {\n        console.error('WebSocket error:', error);\n      };\n    } catch (error) {\n      console.error('Failed to create WebSocket connection:', error);\n    }\n  };\n\n  useEffect(() => {\n    connect();\n\n    return () => {\n      isUnmountedRef.current = true;\n      \n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n\n      if (wsRef.current) {\n        wsRef.current.close();\n      }\n    };\n  }, []);\n\n  const sendMessage = (data: any) => {\n    if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify(data));\n    }\n  };\n\n  return {\n    isConnected,\n    sendMessage,\n  };\n}","size_bytes":2347},"client/src/lib/auth.ts":{"content":"export interface Admin {\n  id: number;\n  firstName: string;\n  lastName: string;\n  companyName: string;\n  email: string;\n}\n\nexport interface Employee {\n  id: number;\n  firstName: string;\n  lastName: string;\n  email: string;\n  siteId?: number;\n}\n\nexport const getAuthToken = (): string | null => {\n  return localStorage.getItem('authToken');\n};\n\nexport const setAuthToken = (token: string): void => {\n  localStorage.setItem('authToken', token);\n};\n\nexport const removeAuthToken = (): void => {\n  localStorage.removeItem('authToken');\n};\n\nexport const getUser = (): Admin | Employee | null => {\n  const userStr = localStorage.getItem('user');\n  return userStr ? JSON.parse(userStr) : null;\n};\n\nexport const setUser = (user: Admin | Employee): void => {\n  localStorage.setItem('user', JSON.stringify(user));\n};\n\nexport const removeUser = (): void => {\n  localStorage.removeItem('user');\n};\n\nexport const getUserType = (): 'admin' | 'employee' | null => {\n  return localStorage.getItem('userType') as 'admin' | 'employee' | null;\n};\n\nexport const setUserType = (type: 'admin' | 'employee'): void => {\n  localStorage.setItem('userType', type);\n};\n\nexport const removeUserType = (): void => {\n  localStorage.removeItem('userType');\n};\n\nexport const logout = (): void => {\n  removeAuthToken();\n  removeUser();\n  removeUserType();\n};\n\nexport const isAuthenticated = (): boolean => {\n  return !!getAuthToken();\n};\n","size_bytes":1404},"client/src/lib/google-maps.ts":{"content":"declare global {\n  interface Window {\n    initMap: () => void;\n    google: typeof google;\n  }\n}\n\nlet isLoading = false;\nlet isLoaded = false;\n\nexport const loadGoogleMapsAPI = (): Promise<void> => {\n  return new Promise((resolve, reject) => {\n    // If already loaded, resolve immediately\n    if (isLoaded && window.google && window.google.maps) {\n      resolve();\n      return;\n    }\n\n    // If currently loading, wait for it to complete\n    if (isLoading) {\n      const checkLoaded = () => {\n        if (isLoaded && window.google && window.google.maps) {\n          resolve();\n        } else {\n          setTimeout(checkLoaded, 100);\n        }\n      };\n      checkLoaded();\n      return;\n    }\n\n    isLoading = true;\n\n    // Create callback function\n    window.initMap = () => {\n      isLoaded = true;\n      isLoading = false;\n      resolve();\n    };\n\n    // Get API key from server config\n    fetch('/api/config')\n      .then(res => res.json())\n      .then(config => {\n        // Create script element\n        const script = document.createElement('script');\n        script.src = `https://maps.googleapis.com/maps/api/js?key=${config.GOOGLE_MAPS_API_KEY}&callback=initMap&loading=async`;\n        script.async = true;\n        script.defer = true;\n    \n        script.onerror = () => {\n          isLoading = false;\n          reject(new Error('Failed to load Google Maps API'));\n        };\n\n        document.head.appendChild(script);\n      })\n      .catch(() => {\n        isLoading = false;\n        reject(new Error('Failed to fetch API configuration'));\n      });\n  });\n};\n\nexport const isGoogleMapsLoaded = (): boolean => {\n  return isLoaded && window.google && window.google.maps;\n};","size_bytes":1685},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\nimport { getAuthToken } from \"./auth\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nfunction getAuthHeaders(): Record<string, string> {\n  const token = getAuthToken();\n  const headers: Record<string, string> = {};\n  \n  if (token) {\n    headers['Authorization'] = `Bearer ${token}`;\n  }\n  \n  return headers;\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const headers = {\n    ...getAuthHeaders(),\n    ...(data ? { \"Content-Type\": \"application/json\" } : {}),\n  };\n\n  const res = await fetch(url, {\n    method,\n    headers,\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const headers = getAuthHeaders();\n    \n    const res = await fetch(queryKey.join(\"/\") as string, {\n      headers,\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: 2 * 60 * 1000, // 2 minutes for better performance\n      gcTime: 10 * 60 * 1000, // 10 minutes cache\n      retry: 1, // Single retry for better user experience\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1896},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/pages/active-employees.tsx":{"content":"import { useState } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { Link } from 'wouter';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { ArrowLeft, MapPin, Clock } from 'lucide-react';\nimport { getAuthToken } from '@/lib/auth';\nimport { Employee } from '@shared/schema';\n\ninterface Site {\n  id: number;\n  name: string;\n  address: string;\n}\n\nexport default function ActiveEmployees() {\n  const [profileImageModalOpen, setProfileImageModalOpen] = useState(false);\n  const [selectedProfileImage, setSelectedProfileImage] = useState<{url: string, name: string} | null>(null);\n  const { data: employees, isLoading: employeesLoading } = useQuery({\n    queryKey: ['/api/admin/employees'],\n    queryFn: async () => {\n      const response = await fetch('/api/admin/employees', {\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to fetch employees');\n      return response.json();\n    },\n  });\n\n  const { data: sites } = useQuery({\n    queryKey: ['/api/admin/sites'],\n    queryFn: async () => {\n      const response = await fetch('/api/admin/sites', {\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to fetch sites');\n      return response.json();\n    },\n  });\n\n  const getSiteName = (siteId: number) => {\n    const site = sites?.find((s: Site) => s.id === siteId);\n    return site?.name || 'Unknown Site';\n  };\n\n  const activeEmployees = employees?.filter((emp: Employee) => emp.isActive) || [];\n\n  if (employeesLoading) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <div className=\"flex items-center mb-6\">\n          <Link href=\"/admin/dashboard\">\n            <Button variant=\"ghost\" size=\"sm\" className=\"mr-4\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Dashboard\n            </Button>\n          </Link>\n          <h1 className=\"text-2xl font-bold\">Active Employees</h1>\n        </div>\n        <div className=\"grid gap-4\">\n          {[1, 2, 3].map((i) => (\n            <Card key={i} className=\"animate-pulse\">\n              <CardContent className=\"p-6\">\n                <div className=\"h-4 bg-gray-200 rounded w-1/3 mb-2\"></div>\n                <div className=\"h-3 bg-gray-200 rounded w-1/2\"></div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div className=\"flex items-center\">\n          <Link href=\"/admin/dashboard\">\n            <Button variant=\"ghost\" size=\"sm\" className=\"mr-4\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Dashboard\n            </Button>\n          </Link>\n          <h1 className=\"text-2xl font-bold\">Active Employees</h1>\n        </div>\n        <Badge variant=\"secondary\" className=\"text-lg px-3 py-1\">\n          {activeEmployees.length} Active\n        </Badge>\n      </div>\n\n      <div className=\"grid gap-4\">\n        {activeEmployees.length === 0 ? (\n          <Card>\n            <CardContent className=\"p-8 text-center\">\n              <p className=\"text-gray-500\">No active employees found</p>\n            </CardContent>\n          </Card>\n        ) : (\n          activeEmployees.map((employee: Employee) => (\n            <Card key={employee.id} className=\"hover:shadow-md transition-shadow\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center space-x-4\">\n                    <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\">\n                      {employee.profileImage ? (\n                        <img\n                          src={employee.profileImage}\n                          alt={`${employee.firstName} ${employee.lastName}`}\n                          className=\"w-12 h-12 rounded-full object-cover cursor-pointer hover:opacity-80 transition-opacity\"\n                          onClick={() => {\n                            setSelectedProfileImage({\n                              url: employee.profileImage!,\n                              name: `${employee.firstName} ${employee.lastName}`\n                            });\n                            setProfileImageModalOpen(true);\n                          }}\n                        />\n                      ) : (\n                        <span className=\"text-blue-600 font-semibold text-lg\">\n                          {employee.firstName[0]}{employee.lastName[0]}\n                        </span>\n                      )}\n                    </div>\n                    <div>\n                      <Link href={`/admin/employees/${employee.id}/profile`}>\n                        <h3 className=\"font-semibold text-lg hover:text-blue-600 cursor-pointer\">\n                          {employee.firstName} {employee.lastName}\n                        </h3>\n                      </Link>\n                      <p className=\"text-gray-600\">{employee.email}</p>\n                      <p className=\"text-gray-500 text-sm\">{employee.phone}</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"text-right space-y-2\">\n                    <div className=\"flex items-center text-gray-600\">\n                      <MapPin className=\"h-4 w-4 mr-1\" />\n                      <span className=\"text-sm\">{getSiteName(employee.siteId || 0)}</span>\n                    </div>\n                    <div className=\"flex items-center text-gray-600\">\n                      <Clock className=\"h-4 w-4 mr-1\" />\n                      <span className=\"text-sm\">\n                        Joined {employee.createdAt ? new Date(employee.createdAt).toLocaleDateString() : 'Unknown'}\n                      </span>\n                    </div>\n                    <Badge \n                      variant=\"default\" \n                      className=\"bg-green-100 text-green-800 hover:bg-green-200\"\n                    >\n                      Active\n                    </Badge>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))\n        )}\n      </div>\n\n      {/* Profile Image Modal */}\n      <Dialog open={profileImageModalOpen} onOpenChange={setProfileImageModalOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Profile Picture</DialogTitle>\n            <DialogDescription>\n              {selectedProfileImage?.name}\n            </DialogDescription>\n          </DialogHeader>\n          {selectedProfileImage && (\n            <div className=\"flex justify-center p-4\">\n              <img\n                src={selectedProfileImage.url}\n                alt={selectedProfileImage.name}\n                className=\"max-w-full max-h-96 object-contain rounded-lg\"\n              />\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":7341},"client/src/pages/admin-dashboard.tsx":{"content":"import { useEffect, useState } from 'react';\nimport { Link, useLocation } from 'wouter';\nimport { useQuery } from '@tanstack/react-query';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/hooks/use-toast';\nimport { getAuthToken, getUser, logout, getUserType } from '@/lib/auth';\n\nimport { \n  Users, \n  MapPin, \n  Clock, \n  AlertTriangle, \n  UserCheck, \n  UserPlus, \n  Plus,\n  FileText,\n  Settings,\n  Bell,\n  Download,\n  LogOut\n} from 'lucide-react';\nimport ExportReportDialog from '@/components/ExportReportDialog';\nimport NotificationDropdown from '@/components/NotificationDropdown';\nimport { AuthenticatedImage } from '@/components/AuthenticatedImage';\nimport { format, isToday, isYesterday, differenceInDays } from 'date-fns';\n\n\n\n// Helper functions for date formatting\nfunction formatDateLabel(date: Date): string {\n  if (isToday(date)) {\n    return 'Today';\n  } else if (isYesterday(date)) {\n    return 'Yesterday';\n  } else {\n    const daysDiff = differenceInDays(new Date(), date);\n    if (daysDiff < 7) {\n      return format(date, 'EEEE'); // Day name (e.g., \"Monday\")\n    } else {\n      return format(date, 'MMM d'); // Short date (e.g., \"Jan 15\")\n    }\n  }\n}\n\nfunction formatActivityTime(date: Date): string {\n  return format(date, 'h:mm a');\n}\n\nfunction groupActivitiesByDate(activities: any[]) {\n  const grouped: { [key: string]: any[] } = {};\n  \n  activities.forEach(activity => {\n    const date = new Date(activity.timestamp);\n    const dateKey = format(date, 'yyyy-MM-dd');\n    \n    if (!grouped[dateKey]) {\n      grouped[dateKey] = [];\n    }\n    grouped[dateKey].push(activity);\n  });\n  \n  return grouped;\n}\n\nexport default function AdminDashboard() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const user = getUser();\n  const userType = getUserType();\n\n\n  useEffect(() => {\n    if (!getAuthToken() || userType !== 'admin') {\n      toast({\n        title: 'Unauthorized',\n        description: 'Please log in as an admin to access this page.',\n        variant: 'destructive',\n      });\n      setLocation('/admin/login');\n    }\n  }, []);\n\n  const { data: adminProfile } = useQuery({\n    queryKey: ['/api/admin/profile'],\n    queryFn: async () => {\n      const response = await fetch('/api/admin/profile', {\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to fetch profile');\n      return response.json();\n    },\n  });\n\n  const { data: recentActivities = [], isLoading: activitiesLoading } = useQuery({\n    queryKey: ['/api/admin/recent-activities'],\n    queryFn: async () => {\n      const response = await fetch('/api/admin/recent-activities?days=7', {\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to fetch activities');\n      return response.json();\n    },\n  });\n\n  const { data: stats = {\n    activeEmployees: 0,\n    workSites: 0,\n    onSiteNow: 0,\n    alerts: 0\n  }, isLoading } = useQuery<{\n    activeEmployees: number;\n    workSites: number;\n    onSiteNow: number;\n    alerts: number;\n  }>({\n    queryKey: ['/api/admin/dashboard'],\n    enabled: !!getAuthToken() && userType === 'admin',\n  });\n\n  const handleLogout = () => {\n    logout();\n    toast({\n      title: 'Logged out',\n      description: 'You have been successfully logged out.',\n    });\n    setLocation('/admin/login');\n  };\n\n  if (!user || userType !== 'admin') {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100\">\n      {/* Header */}\n      <header className=\"bg-white/80 backdrop-blur-xl shadow-lg border-b border-white/20\">\n        <div className=\"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center py-4 lg:py-6\">\n            <Link href=\"/admin/dashboard\">\n              <div className=\"flex items-center cursor-pointer hover:opacity-80 transition-all duration-300 hover:scale-105\">\n                <div className=\"bg-gradient-to-br from-blue-600 to-indigo-700 rounded-xl w-10 h-10 sm:w-12 sm:h-12 flex items-center justify-center shadow-lg\">\n                  <Users className=\"text-white w-5 h-5 sm:w-6 sm:h-6\" />\n                </div>\n                <div className=\"ml-3 sm:ml-4 hidden sm:block\">\n                  <h1 className=\"text-xl sm:text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent\">\n                    WorkSite Tracker\n                  </h1>\n                  <p className=\"text-xs sm:text-sm text-gray-600 font-medium\">Admin Dashboard</p>\n                </div>\n              </div>\n            </Link>\n            <div className=\"flex items-center space-x-2 sm:space-x-4\">\n              <NotificationDropdown />\n              \n              <Link href=\"/admin/profile\">\n                <div className=\"flex items-center space-x-2 sm:space-x-3 cursor-pointer hover:opacity-80 transition-all duration-300 bg-gradient-to-r from-white/60 to-white/40 backdrop-blur-sm rounded-lg px-2 sm:px-4 py-1 sm:py-2 border border-white/20\">\n                  <div className=\"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center shadow-md\">\n                    <AuthenticatedImage\n                      src={adminProfile?.profileImage}\n                      alt={`${user?.firstName} ${user?.lastName}`}\n                      className=\"w-8 h-8 sm:w-10 sm:h-10 rounded-full object-cover\"\n                      fallback={\n                        <span className=\"text-xs sm:text-sm font-bold text-white\">\n                          {user?.firstName?.[0]}{user?.lastName?.[0]}\n                        </span>\n                      }\n                    />\n                  </div>\n                  <div className=\"hidden sm:block\">\n                    <span className=\"text-sm font-semibold text-gray-800 block\">\n                      {user?.firstName} {user?.lastName}\n                    </span>\n                    <span className=\"text-xs text-gray-600\">Administrator</span>\n                  </div>\n                </div>\n              </Link>\n              \n              <Button \n                variant=\"outline\" \n                size=\"sm\" \n                onClick={handleLogout}\n                className=\"bg-gradient-to-r from-red-50 to-pink-50 border-red-200 text-red-700 hover:from-red-100 hover:to-pink-100 hover:border-red-300 hover:text-red-800 font-medium shadow-sm transition-all duration-300 px-2 sm:px-3\"\n              >\n                <LogOut className=\"w-4 h-4 sm:mr-2\" />\n                <span className=\"hidden sm:inline\">Logout</span>\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Dashboard Content */}\n      <main className=\"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-8\">\n\n\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n          <Link href=\"/admin/work-sites\">\n            <Card className=\"hover:shadow-xl hover:scale-105 transition-all duration-300 cursor-pointer bg-gradient-to-br from-white to-blue-50 border-0 shadow-lg\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-semibold text-gray-600 mb-1\">Work Sites</p>\n                    <p className=\"text-3xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 bg-clip-text text-transparent\">\n                      {isLoading ? '...' : stats?.workSites || 0}\n                    </p>\n                    <p className=\"text-xs text-gray-500 mt-1\">Active locations</p>\n                  </div>\n                  <div className=\"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-3 shadow-lg\">\n                    <MapPin className=\"text-white w-6 h-6\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </Link>\n          \n          <Link href=\"/admin/on-site-now\">\n            <Card className=\"hover:shadow-xl hover:scale-105 transition-all duration-300 cursor-pointer bg-gradient-to-br from-white to-orange-50 border-0 shadow-lg\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-semibold text-gray-600 mb-1\">On Site Now</p>\n                    <p className=\"text-3xl font-bold bg-gradient-to-r from-orange-600 to-orange-800 bg-clip-text text-transparent\">\n                      {isLoading ? '...' : stats?.onSiteNow || 0}\n                    </p>\n                    <p className=\"text-xs text-gray-500 mt-1\">Currently active</p>\n                  </div>\n                  <div className=\"bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-3 shadow-lg\">\n                    <Clock className=\"text-white w-6 h-6\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </Link>\n          \n          <Link href=\"/admin/employee-management\">\n            <Card className=\"hover:shadow-xl hover:scale-105 transition-all duration-300 cursor-pointer bg-gradient-to-br from-white to-green-50 border-0 shadow-lg\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm font-semibold text-gray-600 mb-1\">Active Employees</p>\n                    <p className=\"text-3xl font-bold bg-gradient-to-r from-green-600 to-green-800 bg-clip-text text-transparent\">\n                      {isLoading ? '...' : stats?.activeEmployees || 0}\n                    </p>\n                    <p className=\"text-xs text-gray-500 mt-1\">Total workforce</p>\n                  </div>\n                  <div className=\"bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-3 shadow-lg\">\n                    <UserCheck className=\"text-white w-6 h-6\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </Link>\n\n          <Card className=\"hover:shadow-xl hover:scale-105 transition-all duration-300 cursor-pointer bg-gradient-to-br from-white to-purple-50 border-0 shadow-lg\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-semibold text-gray-600 mb-1\">Alerts</p>\n                  <p className=\"text-3xl font-bold bg-gradient-to-r from-purple-600 to-purple-800 bg-clip-text text-transparent\">\n                    {isLoading ? '...' : stats?.alerts || 0}\n                  </p>\n                  <p className=\"text-xs text-gray-500 mt-1\">Pending issues</p>\n                </div>\n                <div className=\"bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-3 shadow-lg\">\n                  <AlertTriangle className=\"text-white w-6 h-6\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Quick Actions */}\n        <Card className=\"mb-6 sm:mb-8 bg-gradient-to-r from-white to-slate-50 border-0 shadow-lg\">\n          <CardContent className=\"p-4 sm:p-6 lg:p-8\">\n            <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n              <h3 className=\"text-lg sm:text-xl lg:text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent\">Quick Actions</h3>\n              <div className=\"w-8 sm:w-12 h-1 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full\"></div>\n            </div>\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6\">\n              <a href=\"/admin/employee-management\" onClick={(e) => { e.preventDefault(); window.location.href = '/admin/employee-management'; }}>\n                <Button variant=\"outline\" className=\"w-full flex items-center p-3 sm:p-4 lg:p-6 h-auto bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200 hover:from-blue-100 hover:to-blue-200 hover:border-blue-300 transition-all duration-300 hover:scale-105 shadow-md\">\n                  <Users className=\"text-blue-600 w-5 h-5 sm:w-6 sm:h-6 mr-2 sm:mr-3\" />\n                  <div className=\"text-left\">\n                    <div className=\"font-semibold text-gray-900 text-sm sm:text-base\">Employee Management</div>\n                    <div className=\"text-xs text-gray-600\">Manage workforce</div>\n                  </div>\n                </Button>\n              </a>\n              <Link href=\"/admin/sites\">\n                <Button variant=\"outline\" className=\"w-full flex items-center p-6 h-auto bg-gradient-to-br from-green-50 to-green-100 border-green-200 hover:from-green-100 hover:to-green-200 hover:border-green-300 transition-all duration-300 hover:scale-105 shadow-md\">\n                  <Plus className=\"text-green-600 w-6 h-6 mr-3\" />\n                  <div className=\"text-left\">\n                    <div className=\"font-semibold text-gray-900\">Add Work Site</div>\n                    <div className=\"text-xs text-gray-600\">Create locations</div>\n                  </div>\n                </Button>\n              </Link>\n              <ExportReportDialog>\n                <Button variant=\"outline\" className=\"w-full flex items-center p-6 h-auto bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200 hover:from-orange-100 hover:to-orange-200 hover:border-orange-300 transition-all duration-300 hover:scale-105 shadow-md\">\n                  <Download className=\"text-orange-600 w-6 h-6 mr-3\" />\n                  <div className=\"text-left\">\n                    <div className=\"font-semibold text-gray-900\">Export Report</div>\n                    <div className=\"text-xs text-gray-600\">Download data</div>\n                  </div>\n                </Button>\n              </ExportReportDialog>\n              <Link href=\"/admin/profile\">\n                <Button variant=\"outline\" className=\"w-full flex items-center p-6 h-auto bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200 hover:from-purple-100 hover:to-purple-200 hover:border-purple-300 transition-all duration-300 hover:scale-105 shadow-md\">\n                  <Settings className=\"text-purple-600 w-6 h-6 mr-3\" />\n                  <div className=\"text-left\">\n                    <div className=\"font-semibold text-gray-900\">Settings</div>\n                    <div className=\"text-xs text-gray-600\">Configure system</div>\n                  </div>\n                </Button>\n              </Link>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Recent Activity */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 lg:gap-8 mb-6 sm:mb-8\">\n          {/* Recent Activity */}\n          <Card className=\"bg-gradient-to-br from-white to-slate-50 border-0 shadow-lg\">\n            <div className=\"p-4 sm:p-6 border-b border-slate-200 bg-gradient-to-r from-slate-50 to-slate-100\">\n              <h3 className=\"text-lg sm:text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent\">Recent Activity</h3>\n            </div>\n            <CardContent className=\"p-4 sm:p-6\">\n              <div className=\"space-y-4\">\n                {activitiesLoading ? (\n                  <div className=\"text-center text-gray-500 py-8\">\n                    <Clock className=\"mx-auto h-12 w-12 text-gray-400 mb-4 animate-spin\" />\n                    <p>Loading recent activity...</p>\n                  </div>\n                ) : recentActivities.length === 0 ? (\n                  <div className=\"text-center text-gray-500 py-8\">\n                    <Clock className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n                    <p>No recent activity</p>\n                    <p className=\"text-sm\">Employee check-ins/check-outs will appear here</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-6 max-h-96 overflow-y-auto\">\n                    {Object.entries(groupActivitiesByDate(recentActivities)).map(([dateKey, dayActivities]) => {\n                      const date = new Date(dateKey);\n                      return (\n                        <div key={dateKey} className=\"space-y-3\">\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"h-px bg-gray-200 flex-1\" />\n                            <span className=\"text-xs font-medium text-gray-500 px-2 bg-gray-50 rounded-full\">\n                              {formatDateLabel(date)}\n                            </span>\n                            <div className=\"h-px bg-gray-200 flex-1\" />\n                          </div>\n                          \n                          <div className=\"space-y-2\">\n                            {dayActivities.map((activity) => (\n                              <div\n                                key={activity.id}\n                                className=\"flex items-center gap-3 p-3 bg-gradient-to-r from-gray-50 to-slate-100 rounded-lg border border-gray-200 hover:shadow-sm transition-all\"\n                              >\n                                <AuthenticatedImage\n                                  src={activity.employee.profileImage}\n                                  alt={`${activity.employee.firstName} ${activity.employee.lastName}`}\n                                  className=\"w-8 h-8 rounded-full object-cover\"\n                                  fallback={\n                                    <div className=\"w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center\">\n                                      <span className=\"text-xs font-bold text-white\">\n                                        {activity.employee.firstName?.[0]}{activity.employee.lastName?.[0]}\n                                      </span>\n                                    </div>\n                                  }\n                                />\n                                \n                                <div className=\"flex-1 min-w-0\">\n                                  <div className=\"flex items-center gap-2\">\n                                    <span className=\"text-sm font-medium text-gray-900\">\n                                      {activity.employee.firstName} {activity.employee.lastName}\n                                    </span>\n                                    <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${\n                                      activity.type === 'check-in' \n                                        ? 'bg-green-100 text-green-800' \n                                        : 'bg-red-100 text-red-800'\n                                    }`}>\n                                      {activity.type === 'check-in' ? 'Check In' : 'Check Out'}\n                                    </span>\n                                  </div>\n                                  \n                                  <div className=\"flex items-center gap-4 mt-1\">\n                                    <div className=\"flex items-center gap-1 text-xs text-gray-600\">\n                                      <MapPin className=\"h-3 w-3\" />\n                                      <span>{activity.site.name}</span>\n                                    </div>\n                                    <div className=\"flex items-center gap-1 text-xs text-gray-500\">\n                                      <Clock className=\"h-3 w-3\" />\n                                      <span>{formatActivityTime(new Date(activity.timestamp))}</span>\n                                    </div>\n                                  </div>\n                                </div>\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Live Locations */}\n          <Card className=\"bg-gradient-to-br from-white to-slate-50 border-0 shadow-lg\">\n            <div className=\"p-6 border-b border-slate-200 bg-gradient-to-r from-slate-50 to-slate-100\">\n              <div className=\"flex justify-between items-center\">\n                <h3 className=\"text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent\">Live Locations</h3>\n                <Link href=\"/admin/tracking\">\n                  <Button variant=\"link\" className=\"text-blue-600 hover:text-blue-800 text-sm font-semibold\">\n                    View Full Map →\n                  </Button>\n                </Link>\n              </div>\n            </div>\n            <CardContent className=\"p-6\">\n              <div className=\"text-center text-gray-500 py-8\">\n                <MapPin className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n                <p className=\"font-medium text-gray-900 mb-2\">Real-time Location Tracking</p>\n                <p className=\"text-sm text-gray-600 mb-4\">\n                  Monitor employee locations and work site attendance\n                </p>\n                <div className=\"bg-gradient-to-r from-gray-50 to-slate-100 rounded-xl p-6 mb-4 border border-slate-200\">\n                  <div className=\"grid grid-cols-2 gap-6 text-sm\">\n                    <div className=\"text-center\">\n                      <div className=\"bg-blue-100 rounded-lg p-3 inline-block mb-2\">\n                        <MapPin className=\"text-blue-600 w-5 h-5\" />\n                      </div>\n                      <p className=\"font-semibold text-gray-700\">Work Sites</p>\n                      <p className=\"text-2xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 bg-clip-text text-transparent\">{stats?.workSites || 0}</p>\n                    </div>\n                    <div className=\"text-center\">\n                      <div className=\"bg-green-100 rounded-lg p-3 inline-block mb-2\">\n                        <UserCheck className=\"text-green-600 w-5 h-5\" />\n                      </div>\n                      <p className=\"font-semibold text-gray-700\">Active Employees</p>\n                      <p className=\"text-2xl font-bold bg-gradient-to-r from-green-600 to-green-800 bg-clip-text text-transparent\">{stats?.activeEmployees || 0}</p>\n                    </div>\n                  </div>\n                </div>\n                <Link href=\"/admin/tracking\">\n                  <Button className=\"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105\">\n                    <MapPin className=\"w-5 h-5 mr-2\" />\n                    Open Live Tracking Map\n                  </Button>\n                </Link>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </main>\n    </div>\n  );\n}\n","size_bytes":23205},"client/src/pages/admin-login.tsx":{"content":"import { useState } from 'react';\nimport { Link, useLocation } from 'wouter';\nimport { useMutation } from '@tanstack/react-query';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { Card, CardContent, CardHeader } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\nimport { setAuthToken, setUser, setUserType } from '@/lib/auth';\nimport { Users } from 'lucide-react';\n\nconst loginSchema = z.object({\n  email: z.string().email('Invalid email address'),\n  password: z.string().min(6, 'Password must be at least 6 characters'),\n  rememberMe: z.boolean().optional(),\n});\n\ntype LoginForm = z.infer<typeof loginSchema>;\n\nexport default function AdminLogin() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const form = useForm<LoginForm>({\n    resolver: zodResolver(loginSchema),\n    defaultValues: {\n      email: '',\n      password: '',\n      rememberMe: false,\n    },\n  });\n\n  const [showResendVerification, setShowResendVerification] = useState(false);\n  const [resendEmail, setResendEmail] = useState('');\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: LoginForm) => {\n      const response = await apiRequest('POST', '/api/admin/login', data);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setAuthToken(data.token);\n      setUser(data.admin);\n      setUserType('admin');\n      toast({\n        title: 'Success',\n        description: 'Logged in successfully',\n      });\n      setLocation('/admin/dashboard');\n    },\n    onError: (error) => {\n      const errorMessage = error.message || 'Login failed';\n      \n      // Check if it's an email verification error\n      if (errorMessage.includes('Email not verified')) {\n        setShowResendVerification(true);\n        setResendEmail(form.getValues('email'));\n      }\n      \n      toast({\n        title: 'Error',\n        description: errorMessage,\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const resendVerificationMutation = useMutation({\n    mutationFn: async (email: string) => {\n      const response = await apiRequest('POST', '/api/admin/resend-verification', { email });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: 'Success',\n        description: data.message || 'Verification email sent successfully',\n      });\n      setShowResendVerification(false);\n    },\n    onError: (error) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to send verification email',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const onSubmit = (data: LoginForm) => {\n    loginMutation.mutate(data);\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4 bg-gray-50\">\n      <Card className=\"w-full max-w-md shadow-xl\">\n        <CardHeader className=\"text-center space-y-4\">\n          <div className=\"bg-primary rounded-full w-16 h-16 flex items-center justify-center mx-auto\">\n            <Users className=\"text-white text-2xl\" />\n          </div>\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900\">WorkSite Tracker</h1>\n            <p className=\"text-gray-600 mt-2\">Admin Portal Login</p>\n          </div>\n        </CardHeader>\n        \n        <CardContent>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n            <div>\n              <Label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Email Address\n              </Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"admin@company.com\"\n                {...form.register('email')}\n                className=\"w-full\"\n              />\n              {form.formState.errors.email && (\n                <p className=\"text-error text-sm mt-1\">{form.formState.errors.email.message}</p>\n              )}\n            </div>\n            \n            <div>\n              <Label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Password\n              </Label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                placeholder=\"••••••••\"\n                {...form.register('password')}\n                className=\"w-full\"\n              />\n              {form.formState.errors.password && (\n                <p className=\"text-error text-sm mt-1\">{form.formState.errors.password.message}</p>\n              )}\n            </div>\n            \n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-2\">\n                <Checkbox id=\"rememberMe\" {...form.register('rememberMe')} />\n                <Label htmlFor=\"rememberMe\" className=\"text-sm text-gray-600\">\n                  Remember me\n                </Label>\n              </div>\n            </div>\n            \n            <Button\n              type=\"submit\"\n              className=\"w-full bg-primary hover:bg-blue-700 text-white\"\n              disabled={loginMutation.isPending}\n            >\n              {loginMutation.isPending ? 'Signing In...' : 'Sign In'}\n            </Button>\n\n            {showResendVerification && (\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-3\">\n                <p className=\"text-sm text-blue-800\">\n                  Your email is not verified. Need to resend the verification email?\n                </p>\n                <div className=\"flex gap-2\">\n                  <Input\n                    type=\"email\"\n                    placeholder=\"Enter your email\"\n                    value={resendEmail}\n                    onChange={(e) => setResendEmail(e.target.value)}\n                    className=\"flex-1\"\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => resendVerificationMutation.mutate(resendEmail)}\n                    disabled={resendVerificationMutation.isPending || !resendEmail}\n                  >\n                    {resendVerificationMutation.isPending ? 'Sending...' : 'Resend'}\n                  </Button>\n                </div>\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setShowResendVerification(false)}\n                  className=\"w-full text-gray-600\"\n                >\n                  Cancel\n                </Button>\n              </div>\n            )}\n            \n            <div className=\"text-center space-y-3\">\n              <p className=\"text-sm text-gray-600\">\n                Don't have an admin account?{' '}\n                <Link href=\"/admin/signup\" className=\"text-primary hover:underline font-medium\">\n                  Create one\n                </Link>\n              </p>\n              \n              <div className=\"relative\">\n                <div className=\"absolute inset-0 flex items-center\">\n                  <span className=\"w-full border-t\" />\n                </div>\n                <div className=\"relative flex justify-center text-xs uppercase\">\n                  <span className=\"bg-white px-2 text-gray-500\">Or</span>\n                </div>\n              </div>\n              \n              <div className=\"space-y-2\">\n                <p className=\"text-sm text-gray-600\">Are you an employee?</p>\n                <Button \n                  variant=\"outline\" \n                  onClick={() => setLocation('/employee/login')}\n                  className=\"w-full border-blue-200 text-blue-600 hover:bg-blue-50 hover:text-blue-700\"\n                >\n                  Employee Portal\n                </Button>\n              </div>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":8212},"client/src/pages/admin-profile.tsx":{"content":"import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Link } from 'wouter';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Input } from '@/components/ui/input';\nimport { Switch } from '@/components/ui/switch';\nimport { useToast } from '@/hooks/use-toast';\nimport { ArrowLeft, User, Mail, Calendar, Settings, Shield, Eye, EyeOff, Camera, Upload, X } from 'lucide-react';\nimport { ObjectUploader } from '@/components/ObjectUploader';\nimport { AuthenticatedImage } from '@/components/AuthenticatedImage';\nimport type { UploadResult } from '@uppy/core';\nimport { getAuthToken, getUser } from '@/lib/auth';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useState } from 'react';\nimport { apiRequest } from '@/lib/queryClient';\n\ninterface Admin {\n  id: number;\n  firstName: string;\n  lastName: string;\n  email: string;\n  profileImage?: string;\n  createdAt: string;\n}\n\n// Form schemas\nconst editProfileSchema = z.object({\n  firstName: z.string().min(1, \"First name is required\"),\n  lastName: z.string().min(1, \"Last name is required\"),\n  email: z.string().email(\"Please enter a valid email address\"),\n});\n\nconst securitySchema = z.object({\n  currentPassword: z.string().min(1, \"Current password is required\"),\n  newPassword: z.string()\n    .min(8, \"Password must be at least 8 characters\")\n    .regex(/^(?=.*[a-zA-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]/, \n      \"Password must contain letters, numbers, and special characters\"),\n  confirmPassword: z.string(),\n}).refine((data) => data.newPassword === data.confirmPassword, {\n  message: \"Passwords don't match\",\n  path: [\"confirmPassword\"],\n});\n\nconst notificationSchema = z.object({\n  emailNotifications: z.boolean(),\n  smsNotifications: z.boolean(),\n  pushNotifications: z.boolean(),\n  attendanceAlerts: z.boolean(),\n  securityAlerts: z.boolean(),\n  systemUpdates: z.boolean(),\n});\n\nexport default function AdminProfile() {\n  const currentUser = getUser();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [showCurrentPassword, setShowCurrentPassword] = useState(false);\n  const [showNewPassword, setShowNewPassword] = useState(false);\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n  const [isImageDialogOpen, setIsImageDialogOpen] = useState(false);\n  const [profileImageModalOpen, setProfileImageModalOpen] = useState(false);\n\n  const { data: admin, isLoading: adminLoading } = useQuery({\n    queryKey: ['/api/admin/profile'],\n    queryFn: async () => {\n      const response = await fetch(`/api/admin/profile`, {\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to fetch admin profile');\n      return response.json();\n    },\n  });\n\n  const { data: stats } = useQuery({\n    queryKey: ['/api/admin/dashboard'],\n    queryFn: async () => {\n      const response = await fetch('/api/admin/dashboard', {\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to fetch stats');\n      return response.json();\n    },\n  });\n\n  // Form configurations\n  const editProfileForm = useForm({\n    resolver: zodResolver(editProfileSchema),\n    defaultValues: {\n      firstName: admin?.firstName || '',\n      lastName: admin?.lastName || '',\n      email: admin?.email || '',\n    },\n  });\n\n  const securityForm = useForm({\n    resolver: zodResolver(securitySchema),\n    defaultValues: {\n      currentPassword: '',\n      newPassword: '',\n      confirmPassword: '',\n    },\n  });\n\n  const notificationForm = useForm({\n    resolver: zodResolver(notificationSchema),\n    defaultValues: {\n      emailNotifications: true,\n      smsNotifications: false,\n      pushNotifications: true,\n      attendanceAlerts: true,\n      securityAlerts: true,\n      systemUpdates: false,\n    },\n  });\n\n  // Mutations\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof editProfileSchema>) => {\n      const response = await fetch('/api/admin/profile', {\n        method: 'PUT',\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) throw new Error('Failed to update profile');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Profile Updated\",\n        description: \"Your profile has been successfully updated.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/profile'] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Update Failed\",\n        description: error.message || \"Failed to update profile.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updatePasswordMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof securitySchema>) => {\n      const response = await fetch('/api/admin/change-password', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          currentPassword: data.currentPassword,\n          newPassword: data.newPassword,\n        }),\n      });\n      if (!response.ok) throw new Error('Failed to change password');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Password Updated\",\n        description: \"Your password has been successfully changed.\",\n      });\n      securityForm.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Password Change Failed\",\n        description: error.message || \"Failed to change password.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateNotificationsMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof notificationSchema>) => {\n      const response = await fetch('/api/admin/notification-preferences', {\n        method: 'PUT',\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) throw new Error('Failed to update notification preferences');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Preferences Updated\",\n        description: \"Your notification preferences have been saved.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Update Failed\",\n        description: error.message || \"Failed to update notification preferences.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Profile image mutations\n  const uploadImageMutation = useMutation({\n    mutationFn: async (imageURL: string) => {\n      const response = await fetch('/api/admin/profile-image', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ imageURL }),\n      });\n      if (!response.ok) throw new Error('Failed to upload image');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Image Uploaded\",\n        description: \"Your profile image has been updated successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/profile'] });\n      setIsImageDialogOpen(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Upload Failed\",\n        description: error.message || \"Failed to upload profile image.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const removeImageMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch('/api/admin/profile-image', {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to remove image');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Image Removed\",\n        description: \"Your profile image has been removed successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/profile'] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Removal Failed\",\n        description: error.message || \"Failed to remove profile image.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Helper functions for image handling\n  const handleGetUploadParameters = async () => {\n    const response = await fetch('/api/objects/upload', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${getAuthToken()}`,\n      },\n    });\n    if (!response.ok) throw new Error('Failed to get upload parameters');\n    const { uploadURL } = await response.json();\n    return {\n      method: 'PUT' as const,\n      url: uploadURL,\n    };\n  };\n\n  const handleUploadComplete = (result: UploadResult<Record<string, unknown>, Record<string, unknown>>) => {\n    if (result.successful && result.successful.length > 0) {\n      const uploadedFile = result.successful[0];\n      if (uploadedFile.uploadURL) {\n        uploadImageMutation.mutate(uploadedFile.uploadURL);\n      }\n    }\n  };\n\n  // Update form defaults when admin data loads\n  if (admin && !editProfileForm.formState.isDirty) {\n    editProfileForm.setValue('firstName', admin.firstName);\n    editProfileForm.setValue('lastName', admin.lastName);\n    editProfileForm.setValue('email', admin.email);\n  }\n\n  if (adminLoading || !admin) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-gray-200 rounded w-1/3 mb-6\"></div>\n          <div className=\"h-64 bg-gray-200 rounded mb-4\"></div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      <div className=\"flex items-center mb-6\">\n        <Link href=\"/admin/dashboard\">\n          <Button variant=\"ghost\" size=\"sm\" className=\"mr-4\">\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back to Dashboard\n          </Button>\n        </Link>\n        <h1 className=\"text-2xl font-bold\">Admin Profile</h1>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Profile Overview */}\n        <Card className=\"lg:col-span-1\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <User className=\"h-5 w-5 mr-2\" />\n              Profile Information\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"text-center\">\n              <div className=\"relative w-20 h-20 mx-auto mb-4\">\n                <AuthenticatedImage\n                  src={admin.profileImage}\n                  alt=\"Profile\"\n                  className=\"w-20 h-20 rounded-full object-cover cursor-pointer hover:opacity-80 transition-opacity\"\n                  onClick={() => {\n                    if (admin.profileImage) {\n                      setProfileImageModalOpen(true);\n                    }\n                  }}\n                  fallback={\n                    <div className=\"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center\">\n                      <span className=\"text-blue-600 font-bold text-2xl\">\n                        {admin.firstName[0]}{admin.lastName[0]}\n                      </span>\n                    </div>\n                  }\n                />\n                <Dialog open={isImageDialogOpen} onOpenChange={setIsImageDialogOpen}>\n                  <DialogTrigger asChild>\n                    <Button\n                      size=\"sm\"\n                      className=\"absolute -bottom-1 -right-1 rounded-full w-6 h-6 p-0\"\n                    >\n                      <Camera className=\"h-3 w-3\" />\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent className=\"sm:max-w-md\">\n                    <DialogHeader>\n                      <DialogTitle>Profile Image</DialogTitle>\n                      <DialogDescription>\n                        Upload a new profile image or remove the current one.\n                      </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4\">\n                      <ObjectUploader\n                        maxNumberOfFiles={1}\n                        maxFileSize={5242880} // 5MB\n                        allowedFileTypes={[\"image/*\"]}\n                        onGetUploadParameters={handleGetUploadParameters}\n                        onComplete={handleUploadComplete}\n                        buttonClassName=\"w-full\"\n                      >\n                        <Upload className=\"h-4 w-4 mr-2\" />\n                        {uploadImageMutation.isPending ? 'Processing...' : 'Upload New Image'}\n                      </ObjectUploader>\n                      {admin.profileImage && (\n                        <Button\n                          variant=\"destructive\"\n                          onClick={() => removeImageMutation.mutate()}\n                          disabled={removeImageMutation.isPending}\n                          className=\"w-full\"\n                        >\n                          <X className=\"h-4 w-4 mr-2\" />\n                          {removeImageMutation.isPending ? 'Removing...' : 'Remove Image'}\n                        </Button>\n                      )}\n                    </div>\n                  </DialogContent>\n                </Dialog>\n              </div>\n              <h3 className=\"text-xl font-semibold\">{admin.firstName} {admin.lastName}</h3>\n              <Badge className=\"bg-blue-100 text-blue-800 mt-2\">\n                <Shield className=\"h-3 w-3 mr-1\" />\n                Administrator\n              </Badge>\n            </div>\n            \n            <div className=\"space-y-3 pt-4 border-t\">\n              <div className=\"flex items-center\">\n                <Mail className=\"h-4 w-4 mr-3 text-gray-500\" />\n                <span className=\"text-sm\">{admin.email}</span>\n              </div>\n              <div className=\"flex items-center\">\n                <Calendar className=\"h-4 w-4 mr-3 text-gray-500\" />\n                <span className=\"text-sm\">\n                  Admin since {new Date(admin.createdAt).toLocaleDateString()}\n                </span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Admin Statistics */}\n        <Card className=\"lg:col-span-2\">\n          <CardContent className=\"p-6\">\n            <Tabs defaultValue=\"overview\" className=\"w-full\">\n              <TabsList className=\"grid w-full grid-cols-2\">\n                <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n                <TabsTrigger value=\"settings\">Settings</TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"overview\" className=\"mt-6\">\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold\">System Overview</h3>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <Card className=\"p-4\">\n                      <div className=\"text-center\">\n                        <div className=\"text-2xl font-bold text-green-600\">\n                          {stats?.activeEmployees || 0}\n                        </div>\n                        <div className=\"text-sm text-gray-600\">Active Employees</div>\n                      </div>\n                    </Card>\n                    <Card className=\"p-4\">\n                      <div className=\"text-center\">\n                        <div className=\"text-2xl font-bold text-blue-600\">\n                          {stats?.workSites || 0}\n                        </div>\n                        <div className=\"text-sm text-gray-600\">Work Sites</div>\n                      </div>\n                    </Card>\n                    <Card className=\"p-4\">\n                      <div className=\"text-center\">\n                        <div className=\"text-2xl font-bold text-orange-600\">\n                          {stats?.onSiteNow || 0}\n                        </div>\n                        <div className=\"text-sm text-gray-600\">On Site Now</div>\n                      </div>\n                    </Card>\n                    <Card className=\"p-4\">\n                      <div className=\"text-center\">\n                        <div className=\"text-2xl font-bold text-red-600\">\n                          {stats?.alerts || 0}\n                        </div>\n                        <div className=\"text-sm text-gray-600\">Active Alerts</div>\n                      </div>\n                    </Card>\n                  </div>\n\n                  <div className=\"pt-4 border-t\">\n                    <h4 className=\"font-medium mb-3\">Quick Actions</h4>\n                    <div className=\"grid grid-cols-2 gap-3\">\n                      <Link href=\"/admin/employees\">\n                        <Button variant=\"outline\" className=\"w-full justify-start\">\n                          Manage Employees\n                        </Button>\n                      </Link>\n                      <Link href=\"/admin/sites\">\n                        <Button variant=\"outline\" className=\"w-full justify-start\">\n                          Manage Sites\n                        </Button>\n                      </Link>\n                      <Link href=\"/admin/live-tracking\">\n                        <Button variant=\"outline\" className=\"w-full justify-start\">\n                          Live Tracking\n                        </Button>\n                      </Link>\n                      <Link href=\"/admin/active-employees\">\n                        <Button variant=\"outline\" className=\"w-full justify-start\">\n                          View Employees\n                        </Button>\n                      </Link>\n                    </div>\n                  </div>\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"settings\" className=\"mt-6\">\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold flex items-center\">\n                    <Settings className=\"h-5 w-5 mr-2\" />\n                    Account Settings\n                  </h3>\n                  <div className=\"space-y-3\">\n                    <Card className=\"p-4\">\n                      <div className=\"flex justify-between items-center\">\n                        <div>\n                          <h4 className=\"font-medium\">Account Information</h4>\n                          <p className=\"text-sm text-gray-600\">Update your profile details</p>\n                        </div>\n                        <Dialog>\n                          <DialogTrigger asChild>\n                            <Button variant=\"outline\" size=\"sm\">\n                              Edit Profile\n                            </Button>\n                          </DialogTrigger>\n                          <DialogContent className=\"sm:max-w-[425px]\">\n                            <DialogHeader>\n                              <DialogTitle>Edit Profile</DialogTitle>\n                              <DialogDescription>\n                                Update your account information here.\n                              </DialogDescription>\n                            </DialogHeader>\n                            <Form {...editProfileForm}>\n                              <form onSubmit={editProfileForm.handleSubmit((data) => updateProfileMutation.mutate(data))} className=\"space-y-4\">\n                                <FormField\n                                  control={editProfileForm.control}\n                                  name=\"firstName\"\n                                  render={({ field }) => (\n                                    <FormItem>\n                                      <FormLabel>First Name</FormLabel>\n                                      <FormControl>\n                                        <Input placeholder=\"Enter first name\" {...field} />\n                                      </FormControl>\n                                      <FormMessage />\n                                    </FormItem>\n                                  )}\n                                />\n                                <FormField\n                                  control={editProfileForm.control}\n                                  name=\"lastName\"\n                                  render={({ field }) => (\n                                    <FormItem>\n                                      <FormLabel>Last Name</FormLabel>\n                                      <FormControl>\n                                        <Input placeholder=\"Enter last name\" {...field} />\n                                      </FormControl>\n                                      <FormMessage />\n                                    </FormItem>\n                                  )}\n                                />\n                                <FormField\n                                  control={editProfileForm.control}\n                                  name=\"email\"\n                                  render={({ field }) => (\n                                    <FormItem>\n                                      <FormLabel>Email</FormLabel>\n                                      <FormControl>\n                                        <Input placeholder=\"Enter email address\" {...field} />\n                                      </FormControl>\n                                      <FormMessage />\n                                    </FormItem>\n                                  )}\n                                />\n                                <DialogFooter>\n                                  <Button \n                                    type=\"submit\" \n                                    disabled={updateProfileMutation.isPending}\n                                  >\n                                    {updateProfileMutation.isPending ? \"Updating...\" : \"Update Profile\"}\n                                  </Button>\n                                </DialogFooter>\n                              </form>\n                            </Form>\n                          </DialogContent>\n                        </Dialog>\n                      </div>\n                    </Card>\n                    \n                    <Card className=\"p-4\">\n                      <div className=\"flex justify-between items-center\">\n                        <div>\n                          <h4 className=\"font-medium\">Security Settings</h4>\n                          <p className=\"text-sm text-gray-600\">Change password and security preferences</p>\n                        </div>\n                        <Dialog>\n                          <DialogTrigger asChild>\n                            <Button variant=\"outline\" size=\"sm\">\n                              Security\n                            </Button>\n                          </DialogTrigger>\n                          <DialogContent className=\"sm:max-w-[425px]\">\n                            <DialogHeader>\n                              <DialogTitle>Security Settings</DialogTitle>\n                              <DialogDescription>\n                                Change your password and security preferences.\n                              </DialogDescription>\n                            </DialogHeader>\n                            <Form {...securityForm}>\n                              <form onSubmit={securityForm.handleSubmit((data) => updatePasswordMutation.mutate(data))} className=\"space-y-4\">\n                                <FormField\n                                  control={securityForm.control}\n                                  name=\"currentPassword\"\n                                  render={({ field }) => (\n                                    <FormItem>\n                                      <FormLabel>Current Password</FormLabel>\n                                      <FormControl>\n                                        <div className=\"relative\">\n                                          <Input \n                                            type={showCurrentPassword ? \"text\" : \"password\"}\n                                            placeholder=\"Enter current password\" \n                                            {...field} \n                                          />\n                                          <Button\n                                            type=\"button\"\n                                            variant=\"ghost\"\n                                            size=\"sm\"\n                                            className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                                            onClick={() => setShowCurrentPassword(!showCurrentPassword)}\n                                          >\n                                            {showCurrentPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                                          </Button>\n                                        </div>\n                                      </FormControl>\n                                      <FormMessage />\n                                    </FormItem>\n                                  )}\n                                />\n                                <FormField\n                                  control={securityForm.control}\n                                  name=\"newPassword\"\n                                  render={({ field }) => (\n                                    <FormItem>\n                                      <FormLabel>New Password</FormLabel>\n                                      <FormControl>\n                                        <div className=\"relative\">\n                                          <Input \n                                            type={showNewPassword ? \"text\" : \"password\"}\n                                            placeholder=\"Enter new password\" \n                                            {...field} \n                                          />\n                                          <Button\n                                            type=\"button\"\n                                            variant=\"ghost\"\n                                            size=\"sm\"\n                                            className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                                            onClick={() => setShowNewPassword(!showNewPassword)}\n                                          >\n                                            {showNewPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                                          </Button>\n                                        </div>\n                                      </FormControl>\n                                      <FormMessage />\n                                    </FormItem>\n                                  )}\n                                />\n                                <FormField\n                                  control={securityForm.control}\n                                  name=\"confirmPassword\"\n                                  render={({ field }) => (\n                                    <FormItem>\n                                      <FormLabel>Confirm New Password</FormLabel>\n                                      <FormControl>\n                                        <div className=\"relative\">\n                                          <Input \n                                            type={showConfirmPassword ? \"text\" : \"password\"}\n                                            placeholder=\"Confirm new password\" \n                                            {...field} \n                                          />\n                                          <Button\n                                            type=\"button\"\n                                            variant=\"ghost\"\n                                            size=\"sm\"\n                                            className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                                            onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                                          >\n                                            {showConfirmPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                                          </Button>\n                                        </div>\n                                      </FormControl>\n                                      <FormMessage />\n                                    </FormItem>\n                                  )}\n                                />\n                                <DialogFooter>\n                                  <Button \n                                    type=\"submit\" \n                                    disabled={updatePasswordMutation.isPending}\n                                  >\n                                    {updatePasswordMutation.isPending ? \"Updating...\" : \"Change Password\"}\n                                  </Button>\n                                </DialogFooter>\n                              </form>\n                            </Form>\n                          </DialogContent>\n                        </Dialog>\n                      </div>\n                    </Card>\n\n                    <Card className=\"p-4\">\n                      <div className=\"flex justify-between items-center\">\n                        <div>\n                          <h4 className=\"font-medium\">Notification Preferences</h4>\n                          <p className=\"text-sm text-gray-600\">Manage alerts and notifications</p>\n                        </div>\n                        <Dialog>\n                          <DialogTrigger asChild>\n                            <Button variant=\"outline\" size=\"sm\">\n                              Configure\n                            </Button>\n                          </DialogTrigger>\n                          <DialogContent className=\"sm:max-w-[425px]\">\n                            <DialogHeader>\n                              <DialogTitle>Notification Preferences</DialogTitle>\n                              <DialogDescription>\n                                Configure your notification settings and alert preferences.\n                              </DialogDescription>\n                            </DialogHeader>\n                            <Form {...notificationForm}>\n                              <form onSubmit={notificationForm.handleSubmit((data) => updateNotificationsMutation.mutate(data))} className=\"space-y-4\">\n                                <div className=\"space-y-4\">\n                                  <div>\n                                    <h4 className=\"text-sm font-medium mb-3\">Communication Channels</h4>\n                                    <div className=\"space-y-3\">\n                                      <FormField\n                                        control={notificationForm.control}\n                                        name=\"emailNotifications\"\n                                        render={({ field }) => (\n                                          <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-3\">\n                                            <div className=\"space-y-0.5\">\n                                              <FormLabel className=\"text-base\">Email Notifications</FormLabel>\n                                              <div className=\"text-sm text-muted-foreground\">\n                                                Receive notifications via email\n                                              </div>\n                                            </div>\n                                            <FormControl>\n                                              <Switch checked={field.value} onCheckedChange={field.onChange} />\n                                            </FormControl>\n                                          </FormItem>\n                                        )}\n                                      />\n                                      <FormField\n                                        control={notificationForm.control}\n                                        name=\"pushNotifications\"\n                                        render={({ field }) => (\n                                          <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-3\">\n                                            <div className=\"space-y-0.5\">\n                                              <FormLabel className=\"text-base\">Push Notifications</FormLabel>\n                                              <div className=\"text-sm text-muted-foreground\">\n                                                Receive browser push notifications\n                                              </div>\n                                            </div>\n                                            <FormControl>\n                                              <Switch checked={field.value} onCheckedChange={field.onChange} />\n                                            </FormControl>\n                                          </FormItem>\n                                        )}\n                                      />\n                                    </div>\n                                  </div>\n                                  \n                                  <div>\n                                    <h4 className=\"text-sm font-medium mb-3\">Alert Types</h4>\n                                    <div className=\"space-y-3\">\n                                      <FormField\n                                        control={notificationForm.control}\n                                        name=\"attendanceAlerts\"\n                                        render={({ field }) => (\n                                          <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-3\">\n                                            <div className=\"space-y-0.5\">\n                                              <FormLabel className=\"text-base\">Attendance Alerts</FormLabel>\n                                              <div className=\"text-sm text-muted-foreground\">\n                                                Employee check-in/out notifications\n                                              </div>\n                                            </div>\n                                            <FormControl>\n                                              <Switch checked={field.value} onCheckedChange={field.onChange} />\n                                            </FormControl>\n                                          </FormItem>\n                                        )}\n                                      />\n                                      <FormField\n                                        control={notificationForm.control}\n                                        name=\"securityAlerts\"\n                                        render={({ field }) => (\n                                          <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-3\">\n                                            <div className=\"space-y-0.5\">\n                                              <FormLabel className=\"text-base\">Security Alerts</FormLabel>\n                                              <div className=\"text-sm text-muted-foreground\">\n                                                Important security notifications\n                                              </div>\n                                            </div>\n                                            <FormControl>\n                                              <Switch checked={field.value} onCheckedChange={field.onChange} />\n                                            </FormControl>\n                                          </FormItem>\n                                        )}\n                                      />\n                                      <FormField\n                                        control={notificationForm.control}\n                                        name=\"systemUpdates\"\n                                        render={({ field }) => (\n                                          <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-3\">\n                                            <div className=\"space-y-0.5\">\n                                              <FormLabel className=\"text-base\">System Updates</FormLabel>\n                                              <div className=\"text-sm text-muted-foreground\">\n                                                Platform updates and maintenance\n                                              </div>\n                                            </div>\n                                            <FormControl>\n                                              <Switch checked={field.value} onCheckedChange={field.onChange} />\n                                            </FormControl>\n                                          </FormItem>\n                                        )}\n                                      />\n                                    </div>\n                                  </div>\n                                </div>\n                                <DialogFooter>\n                                  <Button \n                                    type=\"submit\" \n                                    disabled={updateNotificationsMutation.isPending}\n                                  >\n                                    {updateNotificationsMutation.isPending ? \"Saving...\" : \"Save Preferences\"}\n                                  </Button>\n                                </DialogFooter>\n                              </form>\n                            </Form>\n                          </DialogContent>\n                        </Dialog>\n                      </div>\n                    </Card>\n                  </div>\n                </div>\n              </TabsContent>\n            </Tabs>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Profile Image Modal */}\n      <Dialog open={profileImageModalOpen} onOpenChange={setProfileImageModalOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Profile Picture</DialogTitle>\n            <DialogDescription>\n              {admin?.firstName} {admin?.lastName}\n            </DialogDescription>\n          </DialogHeader>\n          {admin?.profileImage && (\n            <div className=\"flex justify-center p-4\">\n              <AuthenticatedImage\n                src={admin.profileImage}\n                alt={`${admin.firstName} ${admin.lastName}`}\n                className=\"max-w-full max-h-96 object-contain rounded-lg\"\n                fallback={\n                  <div className=\"w-96 h-96 bg-gray-200 rounded-lg flex items-center justify-center\">\n                    <span className=\"text-gray-500\">Image not available</span>\n                  </div>\n                }\n              />\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":39884},"client/src/pages/admin-signup.tsx":{"content":"import { Link, useLocation } from 'wouter';\nimport { useMutation } from '@tanstack/react-query';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { Card, CardContent, CardHeader } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\nimport { setAuthToken, setUser, setUserType } from '@/lib/auth';\nimport { UserPlus } from 'lucide-react';\n\nconst signupSchema = z.object({\n  firstName: z.string().min(1, 'First name is required'),\n  lastName: z.string().min(1, 'Last name is required'),\n  companyName: z.string().min(1, 'Company name is required'),\n  email: z.string().email('Invalid email address'),\n  password: z.string()\n    .min(8, 'Password must be at least 8 characters long')\n    .regex(/^(?=.*[a-zA-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]/, \n      'Password must contain at least one letter, one number, and one special character'),\n  confirmPassword: z.string().min(8, 'Password confirmation is required'),\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"Passwords don't match\",\n  path: [\"confirmPassword\"],\n});\n\ntype SignupForm = z.infer<typeof signupSchema>;\n\nexport default function AdminSignup() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const form = useForm<SignupForm>({\n    resolver: zodResolver(signupSchema),\n    defaultValues: {\n      firstName: '',\n      lastName: '',\n      companyName: '',\n      email: '',\n      password: '',\n      confirmPassword: '',\n    },\n  });\n\n  const signupMutation = useMutation({\n    mutationFn: async (data: Omit<SignupForm, 'confirmPassword'>) => {\n      const response = await apiRequest('POST', '/api/admin/signup', data);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setAuthToken(data.token);\n      setUser(data.admin);\n      setUserType('admin');\n      toast({\n        title: 'Success',\n        description: 'Account created successfully',\n      });\n      setLocation('/admin/dashboard');\n    },\n    onError: (error) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Signup failed',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const onSubmit = (data: SignupForm) => {\n    const { confirmPassword, ...signupData } = data;\n    signupMutation.mutate(signupData);\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4 bg-gray-50\">\n      <Card className=\"w-full max-w-md shadow-xl\">\n        <CardHeader className=\"text-center space-y-4\">\n          <div className=\"bg-primary rounded-full w-16 h-16 flex items-center justify-center mx-auto\">\n            <UserPlus className=\"text-white text-2xl\" />\n          </div>\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900\">Create Admin Account</h1>\n            <p className=\"text-gray-600 mt-2\">Setup your organization</p>\n          </div>\n        </CardHeader>\n        \n        <CardContent>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"firstName\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  First Name\n                </Label>\n                <Input\n                  id=\"firstName\"\n                  placeholder=\"John\"\n                  {...form.register('firstName')}\n                />\n                {form.formState.errors.firstName && (\n                  <p className=\"text-error text-sm mt-1\">{form.formState.errors.firstName.message}</p>\n                )}\n              </div>\n              <div>\n                <Label htmlFor=\"lastName\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Last Name\n                </Label>\n                <Input\n                  id=\"lastName\"\n                  placeholder=\"Doe\"\n                  {...form.register('lastName')}\n                />\n                {form.formState.errors.lastName && (\n                  <p className=\"text-error text-sm mt-1\">{form.formState.errors.lastName.message}</p>\n                )}\n              </div>\n            </div>\n            \n            <div>\n              <Label htmlFor=\"companyName\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Company Name\n              </Label>\n              <Input\n                id=\"companyName\"\n                placeholder=\"ABC Construction Co.\"\n                {...form.register('companyName')}\n              />\n              {form.formState.errors.companyName && (\n                <p className=\"text-error text-sm mt-1\">{form.formState.errors.companyName.message}</p>\n              )}\n            </div>\n            \n            <div>\n              <Label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Email Address\n              </Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"admin@company.com\"\n                {...form.register('email')}\n              />\n              {form.formState.errors.email && (\n                <p className=\"text-error text-sm mt-1\">{form.formState.errors.email.message}</p>\n              )}\n            </div>\n            \n            <div>\n              <Label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Password\n              </Label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                placeholder=\"••••••••\"\n                {...form.register('password')}\n              />\n              <p className=\"text-xs text-gray-500 mt-1\">\n                Must be 8+ characters with letters, numbers, and special characters (@$!%*?&)\n              </p>\n              {form.formState.errors.password && (\n                <p className=\"text-error text-sm mt-1\">{form.formState.errors.password.message}</p>\n              )}\n            </div>\n            \n            <div>\n              <Label htmlFor=\"confirmPassword\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Confirm Password\n              </Label>\n              <Input\n                id=\"confirmPassword\"\n                type=\"password\"\n                placeholder=\"••••••••\"\n                {...form.register('confirmPassword')}\n              />\n              {form.formState.errors.confirmPassword && (\n                <p className=\"text-error text-sm mt-1\">{form.formState.errors.confirmPassword.message}</p>\n              )}\n            </div>\n            \n            <Button\n              type=\"submit\"\n              className=\"w-full bg-primary hover:bg-blue-700 text-white\"\n              disabled={signupMutation.isPending}\n            >\n              {signupMutation.isPending ? 'Creating Account...' : 'Create Admin Account'}\n            </Button>\n            \n            <div className=\"text-center\">\n              <p className=\"text-sm text-gray-600\">\n                Already have an account?{' '}\n                <Link href=\"/admin/login\" className=\"text-primary hover:underline font-medium\">\n                  Sign in\n                </Link>\n              </p>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":7546},"client/src/pages/employee-dashboard.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useLocation } from 'wouter';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { useToast } from '@/hooks/use-toast';\nimport { getAuthToken, getUserType } from '@/lib/auth';\nimport { apiRequest } from '@/lib/queryClient';\nimport { \n  MapPin, \n  Clock, \n  LogOut, \n  CheckCircle, \n  XCircle, \n  Navigation,\n  Building2,\n  User,\n  CalendarDays,\n  RefreshCw,\n  Calendar,\n  History,\n  Edit\n} from 'lucide-react';\nimport { EmployeeProfileDialog } from '@/components/EmployeeProfileDialog';\n\ninterface EmployeeData {\n  id: number;\n  firstName: string;\n  lastName: string;\n  email: string;\n  phone: string;\n  siteId: number | null;\n  profileImage?: string;\n}\n\ninterface WorkSite {\n  id: number;\n  name: string;\n  address: string;\n  latitude: number;\n  longitude: number;\n  geofenceRadius: number;\n}\n\ninterface AttendanceRecord {\n  id: number;\n  checkInTime: string;\n  checkOutTime: string | null;\n  isOnSite: boolean;\n}\n\nexport default function EmployeeDashboard() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [currentLocation, setCurrentLocation] = useState<{lat: number, lng: number} | null>(null);\n  const [locationError, setLocationError] = useState<string>('');\n  const [isGettingLocation, setIsGettingLocation] = useState(false);\n  const [isProfileDialogOpen, setIsProfileDialogOpen] = useState(false);\n\n  // Check authentication\n  useEffect(() => {\n    const token = getAuthToken();\n    const userType = getUserType();\n    \n    if (!token || userType !== 'employee') {\n      setLocation('/employee/login');\n      return;\n    }\n  }, [setLocation]);\n\n  // Get employee data\n  const { data: employee, isLoading: employeeLoading } = useQuery({\n    queryKey: ['/api/employee/profile'],\n    retry: false,\n    staleTime: 0, // Always refetch to get latest data\n    gcTime: 0, // Don't cache the response\n  });\n\n  // Get assigned work site\n  const { data: workSite, isLoading: siteLoading } = useQuery({\n    queryKey: ['/api/employee/site'],\n    retry: false,\n    enabled: !!(employee as EmployeeData)?.siteId,\n    staleTime: 0, // Always refetch to get latest data\n    gcTime: 0, // Don't cache the response\n  });\n\n  // Get current attendance\n  const { data: currentAttendance, isLoading: attendanceLoading } = useQuery({\n    queryKey: ['/api/employee/attendance/current'],\n    retry: false,\n    staleTime: 0, // Always refetch to get latest data\n    gcTime: 0, // Don't cache the response\n  });\n\n  // Get 30-day attendance history\n  const { data: attendanceHistory = [], isLoading: historyLoading } = useQuery({\n    queryKey: ['/api/employee/attendance/history'],\n    retry: false,\n    staleTime: 0,\n    gcTime: 0,\n  });\n\n  // Get location on component mount\n  useEffect(() => {\n    getCurrentLocation();\n  }, []);\n\n  // Auto-update location for checked-in employees - 1 minute intervals\n  useEffect(() => {\n    const interval = setInterval(() => {\n      // Only update location if employee is checked in\n      if (currentAttendance && !(currentAttendance as AttendanceRecord).checkOutTime) {\n        navigator.geolocation.getCurrentPosition(\n          (position) => {\n            const lat = position.coords.latitude;\n            const lng = position.coords.longitude;\n            \n            // Update current location state\n            setCurrentLocation({ lat, lng });\n            \n            // Check if still within geofence\n            if (workSite) {\n              const siteLat = parseFloat((workSite as WorkSite).latitude.toString());\n              const siteLng = parseFloat((workSite as WorkSite).longitude.toString());\n              const distance = calculateDistance(lat, lng, siteLat, siteLng);\n              const isWithinFence = distance <= (workSite as WorkSite).geofenceRadius;\n              \n              // If outside geofence, auto check-out\n              if (!isWithinFence) {\n                handleCheckOut();\n                toast({\n                  title: 'Auto Check-Out',\n                  description: 'You left the work site area. Automatically checked out.',\n                  variant: 'destructive',\n                });\n                return;\n              }\n            }\n            \n            // Send location to server for tracking\n            apiRequest('POST', '/api/employee/location', {\n              latitude: lat,\n              longitude: lng,\n            }).catch(console.error);\n          },\n          (error) => console.error('Location tracking error:', error),\n          { enableHighAccuracy: true }\n        );\n      }\n    }, 60000); // Update every 1 minute\n\n    return () => clearInterval(interval);\n  }, [currentAttendance, workSite]);\n\n  const getCurrentLocation = () => {\n    setIsGettingLocation(true);\n    setLocationError('');\n\n    if (!navigator.geolocation) {\n      setLocationError('Geolocation is not supported by your browser');\n      setIsGettingLocation(false);\n      return;\n    }\n\n    navigator.geolocation.getCurrentPosition(\n      (position) => {\n        setCurrentLocation({\n          lat: position.coords.latitude,\n          lng: position.coords.longitude,\n        });\n        setIsGettingLocation(false);\n      },\n      (error) => {\n        let errorMessage = 'Unable to get your location';\n        switch (error.code) {\n          case error.PERMISSION_DENIED:\n            errorMessage = 'Location access denied. Please enable location services.';\n            break;\n          case error.POSITION_UNAVAILABLE:\n            errorMessage = 'Location information unavailable.';\n            break;\n          case error.TIMEOUT:\n            errorMessage = 'Location request timed out.';\n            break;\n        }\n        setLocationError(errorMessage);\n        setIsGettingLocation(false);\n      },\n      {\n        enableHighAccuracy: true,\n        timeout: 10000,\n        maximumAge: 0,\n      }\n    );\n  };\n\n  // Check if employee is within geofence and calculate distance\n  const getDistanceInfo = () => {\n    if (!currentLocation || !workSite) return { isWithin: false, distance: 0 };\n    \n    const site = workSite as WorkSite;\n    const distance = calculateDistance(\n      currentLocation.lat,\n      currentLocation.lng,\n      parseFloat(site.latitude.toString()),\n      parseFloat(site.longitude.toString())\n    );\n    \n    return {\n      isWithin: distance <= site.geofenceRadius,\n      distance: Math.round(distance)\n    };\n  };\n\n  // Check if employee is within geofence\n  const isWithinGeofence = () => {\n    return getDistanceInfo().isWithin;\n  };\n\n  // Calculate distance between two points\n  const calculateDistance = (lat1: number, lon1: number, lat2: number, lon2: number) => {\n    const R = 6371e3; // Earth's radius in meters\n    const φ1 = lat1 * Math.PI/180;\n    const φ2 = lat2 * Math.PI/180;\n    const Δφ = (lat2-lat1) * Math.PI/180;\n    const Δλ = (lon2-lon1) * Math.PI/180;\n\n    const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +\n              Math.cos(φ1) * Math.cos(φ2) *\n              Math.sin(Δλ/2) * Math.sin(Δλ/2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\n\n    return R * c;\n  };\n\n  // Check in mutation\n  const checkInMutation = useMutation({\n    mutationFn: async () => {\n      if (!currentLocation) throw new Error('Location not available');\n      \n      const response = await apiRequest('POST', '/api/employee/attendance/checkin', {\n        latitude: currentLocation.lat,\n        longitude: currentLocation.lng,\n      });\n      return response;\n    },\n    onSuccess: () => {\n      toast({\n        title: 'Checked In',\n        description: 'Successfully marked attendance.',\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/employee/attendance/current'] });\n      \n      // Start location tracking\n      if (currentLocation) {\n        apiRequest('POST', '/api/employee/location', {\n          latitude: currentLocation.lat,\n          longitude: currentLocation.lng,\n        }).catch(console.error);\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Check-in Failed',\n        description: error.message || 'Unable to check in. Please try again.',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // Check out mutation\n  const checkOutMutation = useMutation({\n    mutationFn: async () => {\n      if (!currentLocation) throw new Error('Location not available');\n      \n      const response = await apiRequest('POST', '/api/employee/attendance/checkout', {\n        latitude: currentLocation.lat,\n        longitude: currentLocation.lng,\n      });\n      return response;\n    },\n    onSuccess: () => {\n      toast({\n        title: 'Checked Out',\n        description: 'Successfully marked departure.',\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/employee/attendance/current'] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Check-out Failed',\n        description: error.message || 'Unable to check out. Please try again.',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const handleLogout = () => {\n    localStorage.removeItem('token');\n    localStorage.removeItem('userType');\n    setLocation('/employee/login');\n  };\n\n  const handleCheckIn = () => {\n    if (!isWithinGeofence()) {\n      toast({\n        title: 'Location Required',\n        description: 'You must be at the work site to check in.',\n        variant: 'destructive',\n      });\n      return;\n    }\n    checkInMutation.mutate();\n  };\n\n  const handleCheckOut = () => {\n    checkOutMutation.mutate();\n  };\n\n  const handleRefresh = () => {\n    queryClient.invalidateQueries({ queryKey: ['/api/employee/profile'] });\n    queryClient.invalidateQueries({ queryKey: ['/api/employee/site'] });\n    queryClient.invalidateQueries({ queryKey: ['/api/employee/attendance/current'] });\n    toast({\n      title: 'Refreshed',\n      description: 'Data updated successfully',\n    });\n  };\n\n  // Calculate working hours for a record\n  const calculateWorkingHours = (checkInTime: string, checkOutTime?: string) => {\n    if (!checkOutTime) return 0;\n    const start = new Date(checkInTime);\n    const end = new Date(checkOutTime);\n    const diffMs = end.getTime() - start.getTime();\n    return diffMs / (1000 * 60 * 60); // Convert to hours\n  };\n\n  // Calculate today's total hours\n  const calculateTodayHours = () => {\n    if (!attendanceHistory || !(attendanceHistory as any[])?.length) return 0;\n    \n    const today = new Date().toDateString();\n    let todayTotal = 0;\n    \n    (attendanceHistory as any[]).forEach((record: any) => {\n      const recordDate = new Date(record.checkInTime).toDateString();\n      if (recordDate === today) {\n        const hours = calculateWorkingHours(record.checkInTime, record.checkOutTime);\n        todayTotal += hours;\n      }\n    });\n    \n    // If currently checked in, add hours from current session\n    if (currentAttendance && !(currentAttendance as any).checkOutTime) {\n      const currentDate = new Date((currentAttendance as any).checkInTime).toDateString();\n      if (currentDate === today) {\n        const hoursFromCurrentSession = calculateWorkingHours(\n          (currentAttendance as any).checkInTime, \n          new Date().toISOString()\n        );\n        todayTotal += hoursFromCurrentSession;\n      }\n    }\n    \n    return todayTotal;\n  };\n\n  // Format hours to display (e.g., \"8.5h\" or \"8h 30m\")\n  const formatHours = (hours: number) => {\n    if (hours === 0) return \"0h\";\n    const wholeHours = Math.floor(hours);\n    const minutes = Math.round((hours - wholeHours) * 60);\n    \n    if (minutes === 0) {\n      return `${wholeHours}h`;\n    } else {\n      return `${wholeHours}h ${minutes}m`;\n    }\n  };\n\n  if (employeeLoading || siteLoading || attendanceLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 p-4\">\n        <div className=\"max-w-4xl mx-auto space-y-6\">\n          <Skeleton className=\"h-16 w-full\" />\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <Skeleton className=\"h-48 w-full\" />\n            <Skeleton className=\"h-48 w-full\" />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow-sm border-b\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center h-16\">\n            <div className=\"flex items-center space-x-3\">\n              <Building2 className=\"h-8 w-8 text-blue-600\" />\n              <div>\n                <h1 className=\"text-xl font-semibold text-gray-900\">WorkTracker</h1>\n                <p className=\"text-sm text-gray-500\">Employee Dashboard</p>\n              </div>\n            </div>\n            \n            <div className=\"flex items-center space-x-4\">\n              {employee && (\n                <div className=\"text-right cursor-pointer\" onClick={() => setIsProfileDialogOpen(true)}>\n                  <p className=\"text-sm font-medium text-gray-900 hover:text-blue-600\">\n                    {(employee as EmployeeData).firstName} {(employee as EmployeeData).lastName}\n                  </p>\n                  <p className=\"text-xs text-gray-500\">{(employee as EmployeeData).email}</p>\n                </div>\n              )}\n              <Button variant=\"outline\" size=\"sm\" onClick={handleRefresh}>\n                <RefreshCw className=\"h-4 w-4\" />\n              </Button>\n              <Button variant=\"outline\" onClick={handleLogout}>\n                <LogOut className=\"h-4 w-4 mr-2\" />\n                Logout\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"space-y-6\">\n          {/* Quick Actions */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            {/* Attendance Card */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <Clock className=\"h-5 w-5\" />\n                  <span>Attendance</span>\n                </CardTitle>\n                <CardDescription>\n                  Mark your attendance for today\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {currentAttendance && !(currentAttendance as AttendanceRecord).checkOutTime ? (\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center space-x-2\">\n                      <CheckCircle className=\"h-5 w-5 text-green-600\" />\n                      <span className=\"text-green-600 font-medium\">Checked In</span>\n                      <Badge variant=\"secondary\">\n                        {new Date((currentAttendance as AttendanceRecord).checkInTime).toLocaleTimeString()}\n                      </Badge>\n                    </div>\n                    <Button \n                      onClick={handleCheckOut}\n                      variant=\"destructive\"\n                      className=\"w-full\"\n                      disabled={checkOutMutation.isPending}\n                    >\n                      {checkOutMutation.isPending ? 'Checking Out...' : 'Check Out'}\n                    </Button>\n                  </div>\n                ) : (\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center space-x-2\">\n                      <XCircle className=\"h-5 w-5 text-gray-400\" />\n                      <span className=\"text-gray-600\">Not Checked In</span>\n                    </div>\n                    \n                    {locationError && (\n                      <Alert variant=\"destructive\">\n                        <AlertDescription>{locationError}</AlertDescription>\n                      </Alert>\n                    )}\n                    \n                    {!currentLocation && (\n                      <Button \n                        onClick={getCurrentLocation}\n                        variant=\"outline\"\n                        className=\"w-full\"\n                        disabled={isGettingLocation}\n                      >\n                        <Navigation className=\"h-4 w-4 mr-2\" />\n                        {isGettingLocation ? 'Getting Location...' : 'Get My Location'}\n                      </Button>\n                    )}\n                    \n                    {currentLocation && workSite && (\n                      <div className=\"space-y-2\">\n                        <div className=\"flex items-center justify-between text-sm\">\n                          <span>Status:</span>\n                          <Badge variant={isWithinGeofence() ? \"default\" : \"secondary\"}>\n                            {isWithinGeofence() ? 'On Site' : 'Away from Site'}\n                          </Badge>\n                        </div>\n                        <Button \n                          onClick={handleCheckIn}\n                          className=\"w-full\"\n                          disabled={!isWithinGeofence() || checkInMutation.isPending}\n                        >\n                          {checkInMutation.isPending ? 'Checking In...' : 'Check In'}\n                        </Button>\n                      </div>\n                    )}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            {/* Work Site Info */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <MapPin className=\"h-5 w-5\" />\n                  <span>Work Site</span>\n                </CardTitle>\n                <CardDescription>\n                  Your assigned work location\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                {workSite ? (\n                  <div className=\"space-y-3\">\n                    <div>\n                      <h3 className=\"font-medium text-gray-900\">{(workSite as WorkSite).name}</h3>\n                      <p className=\"text-sm text-gray-600\">{(workSite as WorkSite).address}</p>\n                    </div>\n                    \n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span>Geofence Radius:</span>\n                      <Badge variant=\"outline\">{(workSite as WorkSite).geofenceRadius}m</Badge>\n                    </div>\n                    \n                    {currentLocation && (\n                      <div className=\"flex items-center justify-between text-sm\">\n                        <span>Distance:</span>\n                        <Badge variant=\"outline\">\n                          {(() => {\n                            const { isWithin, distance } = getDistanceInfo();\n                            return isWithin ? '0m (On Site)' : `${distance}m`;\n                          })()}\n                        </Badge>\n                      </div>\n                    )}\n                    \n                    {currentLocation && (\n                      <div className=\"flex items-center justify-between text-sm\">\n                        <span>Status:</span>\n                        <Badge variant={isWithinGeofence() ? \"default\" : \"secondary\"}>\n                          {isWithinGeofence() ? 'On Site' : 'Away from Site'}\n                        </Badge>\n                      </div>\n                    )}\n                  </div>\n                ) : (\n                  <div className=\"text-center text-gray-500 py-4\">\n                    <p>No work site assigned</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Today's Hours */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <Clock className=\"h-5 w-5\" />\n                <span>Today's Hours</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-center\">\n                <p className=\"text-3xl font-bold text-blue-600 mb-2\">\n                  {formatHours(calculateTodayHours())}\n                </p>\n                {currentAttendance && !(currentAttendance as AttendanceRecord).checkOutTime ? (\n                  <div>\n                    <Badge variant=\"default\" className=\"mb-2\">Currently Working</Badge>\n                    <p className=\"text-sm text-gray-600\">\n                      Started at {new Date((currentAttendance as AttendanceRecord).checkInTime).toLocaleTimeString()}\n                    </p>\n                  </div>\n                ) : (\n                  <p className=\"text-sm text-gray-600\">\n                    {calculateTodayHours() > 0 ? 'Total hours worked today' : 'Not currently checked in'}\n                  </p>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* 30-Day Attendance History */}\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle className=\"flex items-center space-x-2\">\n                    <History className=\"h-5 w-5\" />\n                    <span>Attendance History (Last 30 Days)</span>\n                  </CardTitle>\n                  <CardDescription>\n                    Your check-in and check-out records\n                  </CardDescription>\n                </div>\n                <div className=\"text-right\">\n                  <p className=\"text-sm text-gray-600\">Today's Total</p>\n                  <p className=\"text-xl font-bold text-blue-600\">{formatHours(calculateTodayHours())}</p>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {historyLoading ? (\n                <div className=\"space-y-3\">\n                  {[...Array(5)].map((_, i) => (\n                    <Skeleton key={i} className=\"h-16 w-full\" />\n                  ))}\n                </div>\n              ) : attendanceHistory.length === 0 ? (\n                <div className=\"text-center py-8 text-gray-500\">\n                  <Calendar className=\"h-12 w-12 mx-auto mb-3 text-gray-300\" />\n                  <p>No attendance records in the last 30 days</p>\n                  <p className=\"text-sm text-gray-400\">Your check-ins and check-outs will appear here</p>\n                </div>\n              ) : (\n                <div className=\"space-y-3 max-h-64 overflow-y-auto\">\n                  {attendanceHistory.map((record: any) => (\n                    <div \n                      key={record.id} \n                      className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg border\"\n                    >\n                      <div className=\"flex items-center space-x-3\">\n                        <div className=\"flex flex-col\">\n                          <span className=\"text-sm font-medium text-gray-900\">\n                            {new Date(record.checkInTime).toLocaleDateString()}\n                          </span>\n                          <span className=\"text-xs text-gray-500\">\n                            Check-in: {new Date(record.checkInTime).toLocaleTimeString()}\n                          </span>\n                          {record.checkOutTime && (\n                            <span className=\"text-xs text-gray-500\">\n                              Check-out: {new Date(record.checkOutTime).toLocaleTimeString()}\n                            </span>\n                          )}\n                        </div>\n                      </div>\n                      \n                      <div className=\"flex items-center space-x-3\">\n                        {record.checkOutTime ? (\n                          <Badge variant=\"outline\" className=\"text-green-600 border-green-600\">\n                            Completed\n                          </Badge>\n                        ) : (\n                          <Badge variant=\"destructive\">\n                            Still Active\n                          </Badge>\n                        )}\n                        \n                        <div className=\"text-right\">\n                          <span className=\"text-sm font-medium text-gray-900\">\n                            {record.checkOutTime ? formatHours(calculateWorkingHours(record.checkInTime, record.checkOutTime)) : 'In Progress'}\n                          </span>\n                          {!record.checkOutTime && (\n                            <p className=\"text-xs text-gray-500\">\n                              {formatHours(calculateWorkingHours(record.checkInTime, new Date().toISOString()))} so far\n                            </p>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </main>\n\n      {/* Profile Dialog */}\n      {employee && (\n        <EmployeeProfileDialog\n          employee={employee as EmployeeData}\n          isOpen={isProfileDialogOpen}\n          onClose={() => setIsProfileDialogOpen(false)}\n        />\n      )}\n    </div>\n  );\n}","size_bytes":25539},"client/src/pages/employee-login.tsx":{"content":"import { useState } from 'react';\nimport { useLocation } from 'wouter';\nimport { useMutation } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Separator } from '@/components/ui/separator';\nimport { useToast } from '@/hooks/use-toast';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { apiRequest } from '@/lib/queryClient';\nimport { Building2, Users, Lock, Mail } from 'lucide-react';\n\nconst employeeLoginSchema = z.object({\n  email: z.string().email('Please enter a valid email address'),\n  password: z.string().min(1, 'Password is required'),\n});\n\ntype EmployeeLoginForm = z.infer<typeof employeeLoginSchema>;\n\nexport default function EmployeeLogin() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [error, setError] = useState<string>('');\n\n  const form = useForm<EmployeeLoginForm>({\n    resolver: zodResolver(employeeLoginSchema),\n    defaultValues: {\n      email: '',\n      password: '',\n    },\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: EmployeeLoginForm) => {\n      const response = await fetch('/api/employee/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || 'Login failed');\n      }\n\n      return response.json();\n    },\n    onSuccess: (data) => {\n      localStorage.setItem('authToken', data.token);\n      localStorage.setItem('userType', 'employee');\n      toast({\n        title: 'Welcome!',\n        description: 'Successfully logged in as employee.',\n      });\n      setLocation('/employee/dashboard');\n    },\n    onError: (error: any) => {\n      setError(error.message || 'Login failed. Please try again.');\n    },\n  });\n\n  const onSubmit = (data: EmployeeLoginForm) => {\n    setError('');\n    loginMutation.mutate(data);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-md space-y-6\">\n        {/* Header */}\n        <div className=\"text-center space-y-2\">\n          <div className=\"flex items-center justify-center space-x-2\">\n            <Building2 className=\"h-8 w-8 text-blue-600\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">WorkTracker</h1>\n          </div>\n          <p className=\"text-gray-600\">Employee Portal</p>\n        </div>\n\n        {/* Login Card */}\n        <Card className=\"w-full shadow-lg\">\n          <CardHeader className=\"space-y-1\">\n            <CardTitle className=\"text-2xl text-center flex items-center justify-center space-x-2\">\n              <Users className=\"h-5 w-5\" />\n              <span>Employee Sign In</span>\n            </CardTitle>\n            <CardDescription className=\"text-center\">\n              Enter your credentials to access your work dashboard\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {error && (\n              <Alert variant=\"destructive\">\n                <AlertDescription>{error}</AlertDescription>\n              </Alert>\n            )}\n\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email</FormLabel>\n                      <FormControl>\n                        <div className=\"relative\">\n                          <Mail className=\"absolute left-3 top-3 h-4 w-4 text-gray-400\" />\n                          <Input \n                            {...field} \n                            type=\"email\" \n                            placeholder=\"your.email@company.com\"\n                            className=\"pl-10\"\n                            disabled={loginMutation.isPending}\n                          />\n                        </div>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"password\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Password</FormLabel>\n                      <FormControl>\n                        <div className=\"relative\">\n                          <Lock className=\"absolute left-3 top-3 h-4 w-4 text-gray-400\" />\n                          <Input \n                            {...field} \n                            type=\"password\" \n                            placeholder=\"Enter your password\"\n                            className=\"pl-10\"\n                            disabled={loginMutation.isPending}\n                          />\n                        </div>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <Button \n                  type=\"submit\" \n                  className=\"w-full\" \n                  disabled={loginMutation.isPending}\n                >\n                  {loginMutation.isPending ? 'Signing In...' : 'Sign In'}\n                </Button>\n              </form>\n            </Form>\n\n            <Separator />\n\n            <div className=\"text-center space-y-2\">\n              <p className=\"text-sm text-gray-600\">\n                Are you an administrator?\n              </p>\n              <Button \n                variant=\"outline\" \n                onClick={() => setLocation('/admin/login')}\n                className=\"w-full\"\n              >\n                Go to Admin Portal\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Footer */}\n        <div className=\"text-center text-sm text-gray-500\">\n          <p>Contact your administrator if you need help accessing your account</p>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":6559},"client/src/pages/employee-management-simple.tsx":{"content":"import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Link } from 'wouter';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useToast } from '@/hooks/use-toast';\nimport { ArrowLeft, Users, Plus, MapPin, Clock, Edit, Trash2, Camera, Upload, X, Eye, EyeOff, Image } from 'lucide-react';\nimport { getAuthToken } from '@/lib/auth';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useState, useMemo } from 'react';\nimport { apiRequest } from '@/lib/queryClient';\nimport { ObjectUploader } from '@/components/ObjectUploader';\nimport { AuthenticatedImage } from '@/components/AuthenticatedImage';\n\ninterface Employee {\n  id: number;\n  employeeId: string;\n  firstName: string;\n  lastName: string;\n  email: string;\n  departmentId?: number;\n  profileImage?: string;\n  isActive: boolean;\n  createdAt: string;\n}\n\ninterface Department {\n  id: number;\n  name: string;\n  description?: string;\n}\n\n// Form schemas\nconst createEmployeeSchema = z.object({\n  employeeId: z.string().min(1, \"Employee ID is required\"),\n  firstName: z.string().min(1, \"First name is required\"),\n  lastName: z.string().min(1, \"Last name is required\"),\n  email: z.string().email(\"Please enter a valid email address\"),\n  password: z.string()\n    .min(8, \"Password must be at least 8 characters\")\n    .regex(/^(?=.*[a-zA-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]/, \n      \"Password must contain letters, numbers, and special characters\"),\n  departmentId: z.string().optional(),\n});\n\nconst editEmployeeSchema = z.object({\n  employeeId: z.string().min(1, \"Employee ID is required\"),\n  firstName: z.string().min(1, \"First name is required\"),\n  lastName: z.string().min(1, \"Last name is required\"),\n  email: z.string().email(\"Please enter a valid email address\"),\n  departmentId: z.string().optional(),\n});\n\nconst createDepartmentSchema = z.object({\n  name: z.string().min(1, \"Department name is required\"),\n  description: z.string().optional(),\n});\n\nexport default function EmployeeManagementSimple() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isCreateEmployeeOpen, setIsCreateEmployeeOpen] = useState(false);\n  const [isCreateDepartmentOpen, setIsCreateDepartmentOpen] = useState(false);\n  const [editingEmployee, setEditingEmployee] = useState<Employee | null>(null);\n  const [showPassword, setShowPassword] = useState(false);\n  const [employeeImageURL, setEmployeeImageURL] = useState<string>('');\n  const [profileImageModalOpen, setProfileImageModalOpen] = useState(false);\n  const [selectedProfileImage, setSelectedProfileImage] = useState<{url: string, name: string} | null>(null);\n\n  // Fetch employees and departments\n  const { data: employees = [], isLoading: employeesLoading } = useQuery<Employee[]>({\n    queryKey: ['/api/admin/employees'],\n    staleTime: 5 * 60 * 1000, // 5 minutes\n    gcTime: 10 * 60 * 1000, // 10 minutes\n  });\n\n  const { data: departments = [], isLoading: departmentsLoading } = useQuery<Department[]>({\n    queryKey: ['/api/admin/departments'],\n    staleTime: 5 * 60 * 1000, // 5 minutes  \n    gcTime: 10 * 60 * 1000, // 10 minutes\n  });\n\n  // Create employee form\n  const createEmployeeForm = useForm({\n    resolver: zodResolver(createEmployeeSchema),\n    defaultValues: {\n      employeeId: '',\n      firstName: '',\n      lastName: '',\n      email: '',\n      password: '',\n      departmentId: 'none',\n    },\n  });\n\n  // Edit employee form\n  const editEmployeeForm = useForm({\n    resolver: zodResolver(editEmployeeSchema),\n    defaultValues: {\n      employeeId: '',\n      firstName: '',\n      lastName: '',\n      email: '',\n      departmentId: 'none',\n    },\n  });\n\n  // Create department form\n  const createDepartmentForm = useForm({\n    resolver: zodResolver(createDepartmentSchema),\n    defaultValues: {\n      name: '',\n      description: '',\n    },\n  });\n\n  // Create employee mutation\n  const createEmployeeMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof createEmployeeSchema>) => {\n      const response = await fetch('/api/admin/employees', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n        body: JSON.stringify({\n          ...data,\n          profileImage: employeeImageURL || undefined,\n          departmentId: data.departmentId && data.departmentId !== 'none' ? parseInt(data.departmentId) : undefined,\n        }),\n      });\n      if (!response.ok) throw new Error('Failed to create employee');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Success\", description: \"Employee created successfully\" });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/employees'] });\n      setIsCreateEmployeeOpen(false);\n      setEmployeeImageURL('');\n      createEmployeeForm.reset();\n    },\n    onError: (error: any) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Update employee mutation\n  const updateEmployeeMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: z.infer<typeof editEmployeeSchema> }) => {\n      const response = await fetch(`/api/admin/employees/${id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n        body: JSON.stringify({\n          ...data,\n          profileImage: employeeImageURL || undefined,\n          departmentId: data.departmentId && data.departmentId !== 'none' ? parseInt(data.departmentId) : undefined,\n        }),\n      });\n      if (!response.ok) throw new Error('Failed to update employee');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Success\", description: \"Employee updated successfully\" });\n      // Invalidate all related queries to ensure fresh data\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/employees'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/locations'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/dashboard'] });\n      setEditingEmployee(null);\n      setEmployeeImageURL('');\n      editEmployeeForm.reset();\n    },\n    onError: (error: any) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Delete employee mutation\n  const deleteEmployeeMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const response = await fetch(`/api/admin/employees/${id}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to delete employee');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Success\", description: \"Employee deleted successfully\" });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/employees'] });\n    },\n    onError: (error: any) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Create department mutation\n  const createDepartmentMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof createDepartmentSchema>) => {\n      const response = await fetch('/api/admin/departments', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) throw new Error('Failed to create department');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Success\", description: \"Department created successfully\" });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/departments'] });\n      setIsCreateDepartmentOpen(false);\n      createDepartmentForm.reset();\n    },\n    onError: (error: any) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const onCreateEmployee = (data: z.infer<typeof createEmployeeSchema>) => {\n    createEmployeeMutation.mutate(data);\n  };\n\n  const onUpdateEmployee = (data: z.infer<typeof editEmployeeSchema>) => {\n    if (editingEmployee) {\n      updateEmployeeMutation.mutate({ id: editingEmployee.id, data });\n    }\n  };\n\n  const onCreateDepartment = (data: z.infer<typeof createDepartmentSchema>) => {\n    createDepartmentMutation.mutate(data);\n  };\n\n  // Image upload functions\n  const handleGetUploadParameters = async () => {\n    const response = await fetch('/api/objects/upload', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${getAuthToken()}`,\n      },\n    });\n    if (!response.ok) throw new Error('Failed to get upload URL');\n    const data = await response.json();\n    return {\n      method: 'PUT' as const,\n      url: data.uploadURL,\n    };\n  };\n\n  const handleUploadComplete = (result: any) => {\n    if (result.successful && result.successful.length > 0) {\n      const uploadedFile = result.successful[0];\n      // Try multiple possible image URL properties from the upload result\n      const imageURL = uploadedFile.uploadURL || \n                       uploadedFile.url || \n                       uploadedFile.source ||\n                       (uploadedFile.response && uploadedFile.response.uploadURL);\n      \n      if (imageURL) {\n        setEmployeeImageURL(imageURL);\n        \n        // Convert Google Storage URL to object path for optimistic updates\n        const convertToObjectPath = (url: string) => {\n          if (url.includes('/.private/profile-images/')) {\n            const match = url.match(/\\.private\\/profile-images\\/([^?]+)/);\n            return match ? `/objects/profile-images/${match[1]}` : url;\n          }\n          return url;\n        };\n        \n        const objectPath = convertToObjectPath(imageURL);\n        \n        // If we're editing an employee, immediately update their profile image in the cache\n        if (editingEmployee) {\n          const updatedEmployee = { ...editingEmployee, profileImage: objectPath };\n          setEditingEmployee(updatedEmployee);\n          \n          // Optimistically update the employee list cache\n          queryClient.setQueryData(['/api/admin/employees'], (oldData: any) => {\n            if (!oldData) return oldData;\n            return oldData.map((emp: any) => \n              emp.id === editingEmployee.id \n                ? { ...emp, profileImage: objectPath }\n                : emp\n            );\n          });\n          \n          // Also update other cache entries that might display this employee\n          queryClient.setQueryData(['/api/admin/locations'], (oldData: any) => {\n            if (!oldData) return oldData;\n            return oldData.map((item: any) => \n              item.employee?.id === editingEmployee.id \n                ? { ...item, employee: { ...item.employee, profileImage: objectPath } }\n                : item\n            );\n          });\n        }\n        \n        toast({ title: \"Success\", description: \"Image uploaded successfully!\" });\n      } else {\n        console.error('Upload result:', result);\n        toast({ \n          title: \"Warning\", \n          description: \"Image uploaded but URL not found. Please try again.\", \n          variant: \"destructive\" \n        });\n      }\n    }\n  };\n\n  const handleEditEmployee = (employee: Employee) => {\n    setEditingEmployee(employee);\n    setEmployeeImageURL(employee.profileImage || '');\n    editEmployeeForm.reset({\n      employeeId: employee.employeeId || '',\n      firstName: employee.firstName,\n      lastName: employee.lastName, \n      email: employee.email,\n      departmentId: employee.departmentId?.toString() || 'none',\n    });\n  };\n\n  const getDepartmentName = useMemo(() => {\n    const departmentMap = new Map(departments.map((d) => [d.id, d.name]));\n    return (departmentId?: number) => {\n      if (!departmentId) return 'No Department';\n      return departmentMap.get(departmentId) || 'Unknown Department';\n    };\n  }, [departments]);\n\n  const departmentStats = useMemo(() => {\n    return departments.map((dept) => ({\n      ...dept,\n      employeeCount: employees.filter((emp) => emp.departmentId === dept.id).length\n    }));\n  }, [departments, employees]);\n\n  if (employeesLoading || departmentsLoading) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-gray-200 rounded w-1/3 mb-6\"></div>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {[...Array(6)].map((_, i) => (\n              <div key={i} className=\"h-48 bg-gray-200 rounded\"></div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div className=\"flex items-center\">\n          <Link href=\"/admin/dashboard\">\n            <Button variant=\"ghost\" size=\"sm\" className=\"mr-4\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Dashboard\n            </Button>\n          </Link>\n          <h1 className=\"text-2xl font-bold flex items-center\">\n            <Users className=\"h-6 w-6 mr-2\" />\n            Employee Management\n          </h1>\n        </div>\n        <div className=\"flex gap-2\">\n          <Dialog open={isCreateDepartmentOpen} onOpenChange={setIsCreateDepartmentOpen}>\n            <DialogTrigger asChild>\n              <Button variant=\"outline\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Department\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Create New Department</DialogTitle>\n                <DialogDescription>\n                  Add a new department to organize your employees.\n                </DialogDescription>\n              </DialogHeader>\n              <Form {...createDepartmentForm}>\n                <form onSubmit={createDepartmentForm.handleSubmit(onCreateDepartment)} className=\"space-y-4\">\n                  <FormField\n                    control={createDepartmentForm.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Department Name</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Enter department name\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={createDepartmentForm.control}\n                    name=\"description\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Description (Optional)</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Enter department description\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <DialogFooter>\n                    <Button type=\"submit\" disabled={createDepartmentMutation.isPending}>\n                      {createDepartmentMutation.isPending ? 'Creating...' : 'Create Department'}\n                    </Button>\n                  </DialogFooter>\n                </form>\n              </Form>\n            </DialogContent>\n          </Dialog>\n\n          <Dialog open={isCreateEmployeeOpen} onOpenChange={setIsCreateEmployeeOpen}>\n            <DialogTrigger asChild>\n              <Button>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Employee\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-md\">\n              <DialogHeader>\n                <DialogTitle>Create New Employee</DialogTitle>\n                <DialogDescription>\n                  Add a new employee to your workforce.\n                </DialogDescription>\n              </DialogHeader>\n              <Form {...createEmployeeForm}>\n                <form onSubmit={createEmployeeForm.handleSubmit(onCreateEmployee)} className=\"space-y-4\">\n                  <FormField\n                    control={createEmployeeForm.control}\n                    name=\"employeeId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Employee ID</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"EMP001\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <FormField\n                      control={createEmployeeForm.control}\n                      name=\"firstName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>First Name</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"John\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={createEmployeeForm.control}\n                      name=\"lastName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Last Name</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Doe\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  <FormField\n                    control={createEmployeeForm.control}\n                    name=\"email\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Email</FormLabel>\n                        <FormControl>\n                          <Input type=\"email\" placeholder=\"john.doe@example.com\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={createEmployeeForm.control}\n                    name=\"password\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Password</FormLabel>\n                        <FormControl>\n                          <div className=\"relative\">\n                            <Input\n                              type={showPassword ? \"text\" : \"password\"}\n                              placeholder=\"Enter password\"\n                              {...field}\n                            />\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                              onClick={() => setShowPassword(!showPassword)}\n                            >\n                              {showPassword ? (\n                                <EyeOff className=\"h-4 w-4\" />\n                              ) : (\n                                <Eye className=\"h-4 w-4\" />\n                              )}\n                            </Button>\n                          </div>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={createEmployeeForm.control}\n                    name=\"departmentId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Department</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger>\n                              <SelectValue placeholder=\"Select department\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            <SelectItem value=\"none\">No Department</SelectItem>\n                            {departments.map((dept) => (\n                              <SelectItem key={dept.id} value={dept.id.toString()}>\n                                {dept.name}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  \n                  {/* Employee Image Upload Section */}\n                  <div>\n                    <FormLabel>Profile Image</FormLabel>\n                    {employeeImageURL && (\n                      <div className=\"mb-3\">\n                        <p className=\"text-sm text-gray-600 mb-2\">Current Image:</p>\n                        <img \n                          src={employeeImageURL} \n                          alt=\"Employee preview\"\n                          className=\"w-20 h-20 object-cover rounded-full border\"\n                        />\n                      </div>\n                    )}\n                    <ObjectUploader\n                      maxNumberOfFiles={1}\n                      maxFileSize={10485760} // 10MB\n                      onGetUploadParameters={handleGetUploadParameters}\n                      onComplete={handleUploadComplete}\n                      buttonClassName=\"w-full\"\n                    >\n                      <div className=\"flex items-center justify-center gap-2\">\n                        <Camera className=\"h-4 w-4\" />\n                        <span>{employeeImageURL ? 'Change Profile Image' : 'Upload Profile Image'}</span>\n                      </div>\n                    </ObjectUploader>\n                    <p className=\"text-xs text-gray-500 mt-1\">\n                      Upload a clear photo of the employee. Supported formats: JPG, PNG. Max size: 10MB.\n                    </p>\n                  </div>\n                  <DialogFooter>\n                    <Button type=\"submit\" disabled={createEmployeeMutation.isPending}>\n                      {createEmployeeMutation.isPending ? 'Creating...' : 'Create Employee'}\n                    </Button>\n                  </DialogFooter>\n                </form>\n              </Form>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      {/* Department Overview */}\n      {departmentStats.length > 0 && (\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <MapPin className=\"h-5 w-5 mr-2\" />\n              Departments\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n              {departmentStats.map((dept) => (\n                <div key={dept.id} className=\"bg-gray-50 p-3 rounded-lg\">\n                  <h4 className=\"font-medium\">{dept.name}</h4>\n                  <p className=\"text-sm text-gray-600\">{dept.employeeCount} employees</p>\n                  {dept.description && (\n                    <p className=\"text-xs text-gray-500 mt-1\">{dept.description}</p>\n                  )}\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Employees Grid */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {employees.map((employee) => (\n          <Card key={employee.id} className=\"hover:shadow-lg transition-shadow\">\n            <CardHeader className=\"pb-3\">\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center relative\">\n                    <AuthenticatedImage\n                      src={employee.profileImage}\n                      alt={`${employee.firstName} ${employee.lastName}`}\n                      className=\"w-12 h-12 rounded-full object-cover cursor-pointer hover:opacity-80 transition-opacity\"\n                      onClick={() => {\n                        if (employee.profileImage) {\n                          setSelectedProfileImage({\n                            url: employee.profileImage,\n                            name: `${employee.firstName} ${employee.lastName}`\n                          });\n                          setProfileImageModalOpen(true);\n                        }\n                      }}\n                      fallback={\n                        <span className=\"text-blue-600 font-bold\">\n                          {employee.firstName[0]}{employee.lastName[0]}\n                        </span>\n                      }\n                    />\n                  </div>\n                  <div>\n                    <CardTitle className=\"text-lg\">{employee.firstName} {employee.lastName}</CardTitle>\n                    <p className=\"text-sm text-gray-600\">{employee.email}</p>\n                  </div>\n                </div>\n                <div className=\"flex items-center space-x-1\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => handleEditEmployee(employee)}\n                  >\n                    <Edit className=\"h-4 w-4\" />\n                  </Button>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => deleteEmployeeMutation.mutate(employee.id)}\n                    disabled={deleteEmployeeMutation.isPending}\n                  >\n                    <Trash2 className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm text-gray-600\">Department:</span>\n                <Badge variant=\"secondary\">{getDepartmentName(employee.departmentId)}</Badge>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm text-gray-600\">Status:</span>\n                <Badge variant={employee.isActive ? \"default\" : \"secondary\"}>\n                  {employee.isActive ? \"Active\" : \"Inactive\"}\n                </Badge>\n              </div>\n              <div className=\"text-xs text-gray-500\">\n                Employee ID: {employee.employeeId} • System ID: {employee.id} • Created: {new Date(employee.createdAt).toLocaleDateString()}\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {employees.length === 0 && (\n        <Card className=\"text-center py-12\">\n          <CardContent>\n            <Users className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No Employees Yet</h3>\n            <p className=\"text-gray-600 mb-4\">Get started by adding your first employee to the system.</p>\n            <Dialog open={isCreateEmployeeOpen} onOpenChange={setIsCreateEmployeeOpen}>\n              <DialogTrigger asChild>\n                <Button>\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add First Employee\n                </Button>\n              </DialogTrigger>\n            </Dialog>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Edit Employee Dialog */}\n      <Dialog open={!!editingEmployee} onOpenChange={(open) => {\n        if (!open) setEditingEmployee(null);\n      }}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Edit Employee</DialogTitle>\n            <DialogDescription>\n              Update employee information.\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...editEmployeeForm}>\n            <form onSubmit={editEmployeeForm.handleSubmit(onUpdateEmployee)} className=\"space-y-4\">\n              <FormField\n                control={editEmployeeForm.control}\n                name=\"employeeId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Employee ID</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"EMP001\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={editEmployeeForm.control}\n                  name=\"firstName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>First Name</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"John\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={editEmployeeForm.control}\n                  name=\"lastName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Last Name</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Doe\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n              <FormField\n                control={editEmployeeForm.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Email</FormLabel>\n                    <FormControl>\n                      <Input type=\"email\" placeholder=\"john.doe@example.com\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={editEmployeeForm.control}\n                name=\"departmentId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Department</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select department\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"none\">No Department</SelectItem>\n                        {departments.map((dept) => (\n                          <SelectItem key={dept.id} value={dept.id.toString()}>\n                            {dept.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              {/* Employee Image Upload Section */}\n              <div>\n                <FormLabel>Profile Image</FormLabel>\n                {employeeImageURL && (\n                  <div className=\"mb-3\">\n                    <p className=\"text-sm text-gray-600 mb-2\">Current Image:</p>\n                    <AuthenticatedImage\n                      src={employeeImageURL}\n                      alt=\"Employee preview\"\n                      className=\"w-20 h-20 object-cover rounded-full border\"\n                      fallback={\n                        <div className=\"w-20 h-20 bg-gray-200 rounded-full border flex items-center justify-center\">\n                          <Camera className=\"h-8 w-8 text-gray-400\" />\n                        </div>\n                      }\n                    />\n                  </div>\n                )}\n                <ObjectUploader\n                  maxNumberOfFiles={1}\n                  maxFileSize={10485760} // 10MB\n                  onGetUploadParameters={handleGetUploadParameters}\n                  onComplete={handleUploadComplete}\n                  buttonClassName=\"w-full\"\n                >\n                  <div className=\"flex items-center justify-center gap-2\">\n                    <Camera className=\"h-4 w-4\" />\n                    <span>{employeeImageURL ? 'Change Profile Image' : 'Upload Profile Image'}</span>\n                  </div>\n                </ObjectUploader>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  Upload a clear photo of the employee. Supported formats: JPG, PNG. Max size: 10MB.\n                </p>\n              </div>\n              <DialogFooter>\n                <Button type=\"submit\" disabled={updateEmployeeMutation.isPending}>\n                  {updateEmployeeMutation.isPending ? 'Updating...' : 'Update Employee'}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Profile Image Modal */}\n      <Dialog open={profileImageModalOpen} onOpenChange={setProfileImageModalOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Profile Picture</DialogTitle>\n            <DialogDescription>\n              {selectedProfileImage?.name}\n            </DialogDescription>\n          </DialogHeader>\n          {selectedProfileImage && (\n            <div className=\"flex justify-center p-4\">\n              <AuthenticatedImage\n                src={selectedProfileImage.url}\n                alt={selectedProfileImage.name}\n                className=\"max-w-full max-h-96 object-contain rounded-lg\"\n                fallback={\n                  <div className=\"w-96 h-96 bg-gray-200 rounded-lg flex items-center justify-center\">\n                    <span className=\"text-gray-500\">Image not available</span>\n                  </div>\n                }\n              />\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":35327},"client/src/pages/employee-management.tsx":{"content":"import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Link } from 'wouter';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useToast } from '@/hooks/use-toast';\nimport { ArrowLeft, Users, Plus, MapPin, Clock, Edit, Trash2, Camera, Upload, X, Eye, EyeOff } from 'lucide-react';\nimport { AdaptiveImage } from '../components/AdaptiveImage';\nimport { CompressedImagePreview } from '../components/CompressedImagePreview';\n\nimport { getAuthToken } from '@/lib/auth';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useState } from 'react';\nimport { apiRequest } from '@/lib/queryClient';\nimport { ObjectUploader } from '@/components/ObjectUploader';\nimport type { UploadResult } from '@uppy/core';\n\ninterface Employee {\n  id: number;\n  employeeId?: string;\n  firstName: string;\n  lastName: string;\n  email: string;\n  phone?: string;\n  departmentId?: number;\n  siteId?: number;\n  profileImage?: string;\n  isActive: boolean;\n  createdAt: string;\n}\n\ninterface Department {\n  id: number;\n  name: string;\n  description?: string;\n}\n\n// Form schemas\nconst createEmployeeSchema = z.object({\n  employeeId: z.string().optional(),\n  firstName: z.string().min(1, \"First name is required\"),\n  lastName: z.string().min(1, \"Last name is required\"),\n  email: z.string().email(\"Please enter a valid email address\"),\n  phone: z.string().optional(),\n  password: z.string()\n    .min(8, \"Password must be at least 8 characters\")\n    .regex(/^(?=.*[a-zA-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]/, \n      \"Password must contain letters, numbers, and special characters\"),\n  departmentId: z.string().optional(),\n  siteId: z.string().optional(),\n});\n\nconst editEmployeeSchema = z.object({\n  firstName: z.string().min(1, \"First name is required\"),\n  lastName: z.string().min(1, \"Last name is required\"),\n  email: z.string().email(\"Please enter a valid email address\"),\n  phone: z.string().optional(),\n  departmentId: z.string().optional(),\n  siteId: z.string().optional(),\n});\n\nconst createDepartmentSchema = z.object({\n  name: z.string().min(1, \"Department name is required\"),\n  description: z.string().optional(),\n});\n\nexport default function EmployeeManagement() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isCreateEmployeeOpen, setIsCreateEmployeeOpen] = useState(false);\n  const [isCreateDepartmentOpen, setIsCreateDepartmentOpen] = useState(false);\n  const [editingEmployee, setEditingEmployee] = useState<Employee | null>(null);\n  const [showPassword, setShowPassword] = useState(false);\n  const [imageDialogEmployee, setImageDialogEmployee] = useState<Employee | null>(null);\n  const isAuthenticated = !!getAuthToken();\n\n  // Fetch employees\n  const { data: employees = [], isLoading: employeesLoading } = useQuery({\n    queryKey: ['/api/admin/employees'],\n    queryFn: async () => {\n      const response = await fetch(`/api/admin/employees`, {\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to fetch employees');\n      return response.json();\n    },\n  });\n\n  // Fetch departments\n  const { data: departments = [], isLoading: departmentsLoading } = useQuery({\n    queryKey: ['/api/admin/departments'],\n    queryFn: async () => {\n      const response = await fetch(`/api/admin/departments`, {\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to fetch departments');\n      return response.json();\n    },\n  });\n\n  // Fetch work sites\n  const { data: workSites = [], isLoading: workSitesLoading } = useQuery({\n    queryKey: ['/api/admin/sites'],\n    enabled: isAuthenticated,\n    staleTime: 5 * 60 * 1000,\n    gcTime: 10 * 60 * 1000,\n  });\n\n  // Forms\n  const createEmployeeForm = useForm<z.infer<typeof createEmployeeSchema>>({\n    resolver: zodResolver(createEmployeeSchema),\n    defaultValues: {\n      employeeId: '',\n      firstName: '',\n      lastName: '',\n      email: '',\n      phone: '',\n      password: '',\n      departmentId: 'none',\n      siteId: 'none',\n    },\n  });\n\n  const editEmployeeForm = useForm<z.infer<typeof editEmployeeSchema>>({\n    resolver: zodResolver(editEmployeeSchema),\n    defaultValues: {\n      firstName: '',\n      lastName: '',\n      email: '',\n      phone: '',\n      departmentId: 'none',\n      siteId: 'none',\n    },\n  });\n\n  const createDepartmentForm = useForm<z.infer<typeof createDepartmentSchema>>({\n    resolver: zodResolver(createDepartmentSchema),\n    defaultValues: {\n      name: '',\n      description: '',\n    },\n  });\n\n  // Mutations\n  const createEmployeeMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof createEmployeeSchema>) => {\n      const payload = {\n        ...data,\n        departmentId: data.departmentId && data.departmentId !== 'none' ? parseInt(data.departmentId) : null,\n        siteId: data.siteId && data.siteId !== 'none' ? parseInt(data.siteId) : null,\n        phone: data.phone || undefined,\n        employeeId: data.employeeId || undefined,\n      };\n      console.log('Sending employee creation payload:', payload);\n      return await apiRequest('POST', '/api/admin/employees', payload);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Employee Created\",\n        description: \"New employee has been added successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/employees'] });\n      setIsCreateEmployeeOpen(false);\n      createEmployeeForm.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Creation Failed\",\n        description: error.message || \"Failed to create employee.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateEmployeeMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: z.infer<typeof editEmployeeSchema> }) => {\n      const payload = {\n        ...data,\n        departmentId: data.departmentId && data.departmentId !== 'none' ? parseInt(data.departmentId) : null,\n        siteId: data.siteId && data.siteId !== 'none' ? parseInt(data.siteId) : null,\n        phone: data.phone || undefined,\n      };\n      console.log('Sending employee update payload:', payload);\n      return await apiRequest('PUT', `/api/admin/employees/${id}`, payload);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Employee Updated\",\n        description: \"Employee information has been updated successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/employees'] });\n      setEditingEmployee(null);\n      editEmployeeForm.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Update Failed\",\n        description: error.message || \"Failed to update employee.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteEmployeeMutation = useMutation({\n    mutationFn: async (id: number) => {\n      try {\n        const response = await fetch(`/api/admin/employees/${id}`, {\n          method: 'DELETE',\n          headers: {\n            'Authorization': `Bearer ${getAuthToken()}`,\n            'Content-Type': 'application/json',\n          },\n        });\n        \n        if (!response.ok) {\n          const errorData = await response.json().catch(() => ({ message: 'Failed to delete employee' }));\n          throw new Error(errorData.message || 'Failed to delete employee');\n        }\n        \n        // For 204 No Content responses, we don't need to parse JSON\n        if (response.status === 204) {\n          return { success: true };\n        }\n        \n        return await response.json();\n      } catch (error: any) {\n        console.error('Delete employee error:', error);\n        throw error;\n      }\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Employee Deleted\",\n        description: \"Employee has been removed successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/employees'] });\n    },\n    onError: (error: any) => {\n      console.error('Delete employee mutation error:', error);\n      toast({\n        title: \"Deletion Failed\",\n        description: error.message || \"Failed to delete employee.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createDepartmentMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof createDepartmentSchema>) => {\n      return await apiRequest('POST', '/api/admin/departments', data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Department Created\",\n        description: \"New department has been added successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/departments'] });\n      setIsCreateDepartmentOpen(false);\n      createDepartmentForm.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Creation Failed\",\n        description: error.message || \"Failed to create department.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Profile image mutations\n  const uploadEmployeeImageMutation = useMutation({\n    mutationFn: async ({ employeeId, imageURL }: { employeeId: number; imageURL: string }) => {\n      const response = await fetch(`/api/admin/employees/${employeeId}/profile-image`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ imageURL }),\n      });\n      if (!response.ok) throw new Error('Failed to upload image');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Image Uploaded\",\n        description: \"Employee profile image has been updated successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/employees'] });\n      setImageDialogEmployee(null);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Upload Failed\",\n        description: error.message || \"Failed to upload profile image.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const removeEmployeeImageMutation = useMutation({\n    mutationFn: async (employeeId: number) => {\n      const response = await fetch(`/api/admin/employees/${employeeId}/profile-image`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to remove image');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Image Removed\",\n        description: \"Employee profile image has been removed successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/employees'] });\n      setImageDialogEmployee(null);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Removal Failed\",\n        description: error.message || \"Failed to remove profile image.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Helper functions\n  const handleGetUploadParameters = async () => {\n    try {\n      const response = await fetch('/api/objects/upload', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n          'Content-Type': 'application/json',\n        },\n      });\n      \n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({ message: 'Failed to get upload parameters' }));\n        throw new Error(errorData.message || 'Failed to get upload parameters');\n      }\n      \n      const { uploadURL } = await response.json();\n      console.log('Got upload parameters:', { uploadURL });\n      \n      return {\n        method: 'PUT' as const,\n        url: uploadURL,\n      };\n    } catch (error) {\n      console.error('Upload parameters error:', error);\n      throw error;\n    }\n  };\n\n  const handleUploadComplete = (result: UploadResult<Record<string, unknown>, Record<string, unknown>>) => {\n    console.log('Upload complete result:', result);\n    if (result.successful && result.successful.length > 0 && imageDialogEmployee) {\n      const uploadedFile = result.successful[0];\n      console.log('Uploaded file details:', uploadedFile);\n      \n      // Try multiple possible fields for the upload URL\n      const imageURL = uploadedFile.uploadURL || (uploadedFile.response as any)?.uploadURL || (uploadedFile as any).url;\n      \n      if (imageURL) {\n        uploadEmployeeImageMutation.mutate({\n          employeeId: imageDialogEmployee.id,\n          imageURL: imageURL,\n        });\n      } else {\n        console.error('No upload URL found in result:', uploadedFile);\n        toast({\n          title: \"Upload Error\",\n          description: \"Image uploaded but URL not found. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n    } else {\n      console.error('Upload failed or no employee selected:', { result, imageDialogEmployee });\n      toast({\n        title: \"Upload Failed\",\n        description: \"Image upload was not successful. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const getDepartmentName = (departmentId?: number) => {\n    if (!departmentId) return 'No Department';\n    const department = departments.find((d: Department) => d.id === departmentId);\n    return department?.name || 'Unknown Department';\n  };\n\n  const getSiteName = (siteId?: number) => {\n    if (!siteId) return 'No Site Assigned';\n    const site = Array.isArray(workSites) ? workSites.find((s: any) => s.id === siteId) : null;\n    return site?.name || 'Unknown Site';\n  };\n\n  const handleEditEmployee = (employee: Employee) => {\n    setEditingEmployee(employee);\n    editEmployeeForm.setValue('firstName', employee.firstName);\n    editEmployeeForm.setValue('lastName', employee.lastName);\n    editEmployeeForm.setValue('email', employee.email);\n    editEmployeeForm.setValue('phone', employee.phone || '');\n    editEmployeeForm.setValue('departmentId', employee.departmentId?.toString() || 'none');\n    editEmployeeForm.setValue('siteId', employee.siteId?.toString() || 'none');\n  };\n\n  if (employeesLoading || departmentsLoading) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <div className=\"animate-pulse\">\n          <div className=\"h-8 bg-gray-200 rounded w-1/3 mb-6\"></div>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {[...Array(6)].map((_, i) => (\n              <div key={i} className=\"h-48 bg-gray-200 rounded\"></div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-3 sm:p-4 lg:p-6\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between mb-4 sm:mb-6 gap-4\">\n        <div className=\"flex items-center\">\n          <Link href=\"/admin/dashboard\">\n            <Button variant=\"ghost\" size=\"sm\" className=\"mr-2 sm:mr-4\">\n              <ArrowLeft className=\"h-4 w-4 mr-1 sm:mr-2\" />\n              <span className=\"hidden sm:inline\">Back to Dashboard</span>\n              <span className=\"sm:hidden\">Back</span>\n            </Button>\n          </Link>\n          <h1 className=\"text-xl sm:text-2xl font-bold flex items-center\">\n            <Users className=\"h-5 w-5 sm:h-6 sm:w-6 mr-2\" />\n            <span className=\"hidden sm:inline\">Employee Management</span>\n            <span className=\"sm:hidden\">Employees</span>\n          </h1>\n        </div>\n        <div className=\"flex gap-2\">\n          <Dialog open={isCreateDepartmentOpen} onOpenChange={setIsCreateDepartmentOpen}>\n            <DialogTrigger asChild>\n              <Button variant=\"outline\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Department\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-md max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>Create New Department</DialogTitle>\n                <DialogDescription>\n                  Add a new department to organize your employees.\n                </DialogDescription>\n              </DialogHeader>\n              <Form {...createDepartmentForm}>\n                <form onSubmit={createDepartmentForm.handleSubmit((data) => createDepartmentMutation.mutate(data))} className=\"space-y-4\">\n                  <FormField\n                    control={createDepartmentForm.control}\n                    name=\"name\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Department Name</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Enter department name\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={createDepartmentForm.control}\n                    name=\"description\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Description (Optional)</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Enter department description\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <DialogFooter>\n                    <Button type=\"submit\" disabled={createDepartmentMutation.isPending}>\n                      {createDepartmentMutation.isPending ? 'Creating...' : 'Create Department'}\n                    </Button>\n                  </DialogFooter>\n                </form>\n              </Form>\n            </DialogContent>\n          </Dialog>\n          <Dialog open={isCreateEmployeeOpen} onOpenChange={(open) => {\n            setIsCreateEmployeeOpen(open);\n            if (!open) {\n              createEmployeeForm.reset();\n            }\n          }}>\n            <DialogTrigger asChild>\n              <Button>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Employee\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"sm:max-w-2xl max-h-[95vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>Create New Employee</DialogTitle>\n                <DialogDescription>\n                  Add a new employee to your workforce.\n                </DialogDescription>\n              </DialogHeader>\n              <Form {...createEmployeeForm}>\n                <form onSubmit={createEmployeeForm.handleSubmit((data) => createEmployeeMutation.mutate(data))} className=\"space-y-6\">\n                  \n                  {/* Employee ID */}\n                  <FormField\n                    control={createEmployeeForm.control}\n                    name=\"employeeId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Employee ID</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"EMP001\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  {/* Name Fields */}\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                    <FormField\n                      control={createEmployeeForm.control}\n                      name=\"firstName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>First Name</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"John\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={createEmployeeForm.control}\n                      name=\"lastName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Last Name</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"Doe\" {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  {/* Contact Information */}\n                  <FormField\n                    control={createEmployeeForm.control}\n                    name=\"email\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Email</FormLabel>\n                        <FormControl>\n                          <Input type=\"email\" placeholder=\"john.doe@example.com\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  \n                  <FormField\n                    control={createEmployeeForm.control}\n                    name=\"phone\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Phone Number</FormLabel>\n                        <FormControl>\n                          <Input type=\"tel\" placeholder=\"+1 (555) 123-4567\" {...field} />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  {/* Password */}\n                  <FormField\n                    control={createEmployeeForm.control}\n                    name=\"password\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Password</FormLabel>\n                        <FormControl>\n                          <div className=\"relative\">\n                            <Input \n                              type={showPassword ? \"text\" : \"password\"} \n                              placeholder=\"Enter password\" \n                              {...field} \n                            />\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                              onClick={() => setShowPassword(!showPassword)}\n                            >\n                              {showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                            </Button>\n                          </div>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  {/* Assignment Fields */}\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                    <FormField\n                      control={createEmployeeForm.control}\n                      name=\"departmentId\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Department</FormLabel>\n                          <Select onValueChange={field.onChange} value={field.value || \"\"}>\n                            <FormControl>\n                              <SelectTrigger>\n                                <SelectValue placeholder=\"Select department\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"none\">No Department</SelectItem>\n                              {departments.map((dept: Department) => (\n                                <SelectItem key={dept.id} value={dept.id.toString()}>\n                                  {dept.name}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    \n                    <FormField\n                      control={createEmployeeForm.control}\n                      name=\"siteId\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Work Site Assignment</FormLabel>\n                          <Select onValueChange={field.onChange} value={field.value || \"\"}>\n                            <FormControl>\n                              <SelectTrigger>\n                                <SelectValue placeholder=\"Select work site\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"none\">No Site Assignment</SelectItem>\n                              {Array.isArray(workSites) && workSites.length > 0 ? (\n                                workSites.map((site: any) => (\n                                  <SelectItem key={site.id} value={site.id.toString()}>\n                                    {site.name}\n                                  </SelectItem>\n                                ))\n                              ) : (\n                                <SelectItem value=\"loading\" disabled>\n                                  {workSitesLoading ? 'Loading sites...' : 'No work sites available'}\n                                </SelectItem>\n                              )}\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n\n                  <DialogFooter>\n                    <Button type=\"button\" variant=\"outline\" onClick={() => {\n                      setIsCreateEmployeeOpen(false);\n                      createEmployeeForm.reset();\n                    }}>\n                      Cancel\n                    </Button>\n                    <Button type=\"submit\" disabled={createEmployeeMutation.isPending}>\n                      {createEmployeeMutation.isPending ? 'Creating...' : 'Create Employee'}\n                    </Button>\n                  </DialogFooter>\n                </form>\n              </Form>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      {/* Departments Section */}\n      {departments.length > 0 && (\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Departments ({departments.length})</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex flex-wrap gap-2\">\n              {departments.map((dept: Department) => (\n                <Badge key={dept.id} variant=\"outline\" className=\"text-sm\">\n                  {dept.name}\n                  {dept.description && (\n                    <span className=\"ml-1 text-gray-500\">- {dept.description}</span>\n                  )}\n                </Badge>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Employees Grid */}\n\n\n      {/* Employees Grid */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {employees.map((employee: Employee) => (\n          <Card key={employee.id} className=\"hover:shadow-lg transition-shadow\">\n            <CardHeader className=\"pb-3\">\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"relative\">\n                    {employee.profileImage ? (\n                      <AdaptiveImage\n                        src={employee.profileImage}\n                        alt={`${employee.firstName} ${employee.lastName}`}\n                        className=\"w-12 h-12 rounded-full object-cover\"\n                        sizes=\"thumbnail\"\n                        fallback={\n                          <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\">\n                            <span className=\"text-blue-600 font-bold\">\n                              {employee.firstName[0]}{employee.lastName[0]}\n                            </span>\n                          </div>\n                        }\n                      />\n                    ) : (\n                      <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\">\n                        <span className=\"text-blue-600 font-bold\">\n                          {employee.firstName[0]}{employee.lastName[0]}\n                        </span>\n                      </div>\n                    )}\n                    <Dialog open={imageDialogEmployee?.id === employee.id} onOpenChange={(open) => !open && setImageDialogEmployee(null)}>\n                      <DialogTrigger asChild>\n                        <Button\n                          size=\"sm\"\n                          className=\"absolute -bottom-1 -right-1 rounded-full w-6 h-6 p-0\"\n                          onClick={() => setImageDialogEmployee(employee)}\n                        >\n                          <Camera className=\"h-3 w-3\" />\n                        </Button>\n                      </DialogTrigger>\n                      <DialogContent className=\"sm:max-w-md\">\n                        <DialogHeader>\n                          <DialogTitle>Employee Profile Image</DialogTitle>\n                          <DialogDescription>\n                            Upload a new profile image for {employee.firstName} {employee.lastName} or remove the current one.\n                          </DialogDescription>\n                        </DialogHeader>\n                        <div className=\"space-y-4\">\n                          {employee.profileImage && (\n                            <div className=\"flex justify-center mb-4\">\n                              <AdaptiveImage\n                                src={employee.profileImage}\n                                alt={`${employee.firstName} ${employee.lastName}`}\n                                className=\"w-24 h-24 rounded-full object-cover border-4 border-white shadow-lg\"\n                                sizes=\"thumbnail\"\n                                fallback={\n                                  <div className=\"w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center\">\n                                    <span className=\"text-blue-600 font-bold text-lg\">\n                                      {employee.firstName[0]}{employee.lastName[0]}\n                                    </span>\n                                  </div>\n                                }\n                              />\n                            </div>\n                          )}\n                          <ObjectUploader\n                            maxNumberOfFiles={1}\n                            maxFileSize={5242880} // 5MB\n                            allowedFileTypes={[\"image/*\"]}\n                            onGetUploadParameters={handleGetUploadParameters}\n                            onComplete={handleUploadComplete}\n                            buttonClassName=\"w-full\"\n                          >\n                            <Upload className=\"h-4 w-4 mr-2\" />\n                            {uploadEmployeeImageMutation.isPending ? 'Processing...' : 'Upload New Image'}\n                          </ObjectUploader>\n                          {employee.profileImage && (\n                            <Button\n                              variant=\"destructive\"\n                              onClick={() => removeEmployeeImageMutation.mutate(employee.id)}\n                              disabled={removeEmployeeImageMutation.isPending}\n                              className=\"w-full\"\n                            >\n                              <X className=\"h-4 w-4 mr-2\" />\n                              {removeEmployeeImageMutation.isPending ? 'Removing...' : 'Remove Image'}\n                            </Button>\n                          )}\n                        </div>\n                      </DialogContent>\n                    </Dialog>\n                  </div>\n                  <div>\n                    <CardTitle className=\"text-lg\">{employee.firstName} {employee.lastName}</CardTitle>\n                    <p className=\"text-sm text-gray-600\">{employee.email}</p>\n                  </div>\n                </div>\n                <Badge variant={employee.isActive ? \"default\" : \"secondary\"}>\n                  {employee.isActive ? \"Active\" : \"Inactive\"}\n                </Badge>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <div className=\"flex items-center text-sm text-gray-600\">\n                <Users className=\"h-4 w-4 mr-2\" />\n                {getDepartmentName(employee.departmentId)}\n              </div>\n              <div className=\"flex items-center text-sm text-gray-600\">\n                <MapPin className=\"h-4 w-4 mr-2\" />\n                {getSiteName(employee.siteId)}\n              </div>\n              <div className=\"flex items-center text-sm text-gray-600\">\n                <Clock className=\"h-4 w-4 mr-2\" />\n                Joined {new Date(employee.createdAt).toLocaleDateString()}\n              </div>\n              <div className=\"flex justify-end space-x-2 pt-2\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => handleEditEmployee(employee)}\n                >\n                  <Edit className=\"h-4 w-4 mr-1\" />\n                  Edit\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => deleteEmployeeMutation.mutate(employee.id)}\n                  disabled={deleteEmployeeMutation.isPending}\n                >\n                  <Trash2 className=\"h-4 w-4 mr-1\" />\n                  Delete\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {employees.length === 0 && (\n        <Card className=\"text-center py-12\">\n          <CardContent>\n            <Users className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No Employees Yet</h3>\n            <p className=\"text-gray-600 mb-4\">Get started by adding your first employee to the system.</p>\n            <Button onClick={() => setIsCreateEmployeeOpen(true)}>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add First Employee\n            </Button>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Edit Employee Dialog */}\n      <Dialog open={!!editingEmployee} onOpenChange={(open) => !open && setEditingEmployee(null)}>\n        <DialogContent className=\"sm:max-w-2xl max-h-[95vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Edit Employee</DialogTitle>\n            <DialogDescription>\n              Update employee information.\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...editEmployeeForm}>\n            <form onSubmit={editEmployeeForm.handleSubmit((data) => \n              editingEmployee && updateEmployeeMutation.mutate({ id: editingEmployee.id, data })\n            )} className=\"space-y-6\">\n              \n              {/* Name Fields */}\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                <FormField\n                  control={editEmployeeForm.control}\n                  name=\"firstName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>First Name</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Enter first name\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={editEmployeeForm.control}\n                  name=\"lastName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Last Name</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Enter last name\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              {/* Contact Information */}\n              <FormField\n                control={editEmployeeForm.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Email</FormLabel>\n                    <FormControl>\n                      <Input type=\"email\" placeholder=\"Enter email address\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={editEmployeeForm.control}\n                name=\"phone\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Phone Number</FormLabel>\n                    <FormControl>\n                      <Input type=\"tel\" placeholder=\"Enter phone number\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Assignment Fields */}\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                <FormField\n                  control={editEmployeeForm.control}\n                  name=\"departmentId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Department</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value || \"none\"}>\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select department\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"none\">No Department</SelectItem>\n                          {departments.map((dept: Department) => (\n                            <SelectItem key={dept.id} value={dept.id.toString()}>\n                              {dept.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={editEmployeeForm.control}\n                  name=\"siteId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Work Site Assignment</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value || \"none\"}>\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"Select work site\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"none\">No Site Assignment</SelectItem>\n                          {Array.isArray(workSites) && workSites.map((site: any) => (\n                            <SelectItem key={site.id} value={site.id.toString()}>\n                              {site.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <DialogFooter>\n                <Button type=\"button\" variant=\"outline\" onClick={() => setEditingEmployee(null)}>\n                  Cancel\n                </Button>\n                <Button type=\"submit\" disabled={updateEmployeeMutation.isPending}>\n                  {updateEmployeeMutation.isPending ? 'Updating...' : 'Update Employee'}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":41282},"client/src/pages/employee-profile.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { Link, useLocation, useParams } from 'wouter';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { useToast } from '@/hooks/use-toast';\nimport { getAuthToken, getUserType } from '@/lib/auth';\nimport { \n  ArrowLeft,\n  User, \n  MapPin, \n  Clock, \n  Navigation,\n  Building2,\n  Calendar,\n  Phone,\n  Mail,\n  CheckCircle,\n  XCircle,\n  Camera,\n  Upload,\n  X\n} from 'lucide-react';\n\ninterface Employee {\n  id: number;\n  firstName: string;\n  lastName: string;\n  email: string;\n  phone: string;\n  siteId: number | null;\n  profileImage?: string;\n  isActive: boolean;\n  createdAt: string;\n}\n\ninterface WorkSite {\n  id: number;\n  name: string;\n  address: string;\n  latitude: number;\n  longitude: number;\n  geofenceRadius: number;\n}\n\ninterface AttendanceRecord {\n  id: number;\n  checkInTime: string;\n  checkOutTime: string | null;\n  checkInLatitude: string;\n  checkInLongitude: string;\n  siteId: number;\n}\n\ninterface LocationRecord {\n  id: number;\n  latitude: string;\n  longitude: string;\n  timestamp: string;\n  isWithinGeofence: boolean;\n}\n\nexport default function EmployeeProfile() {\n  const params = useParams();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const employeeId = parseInt(params.id || '0');\n  const [isImageDialogOpen, setIsImageDialogOpen] = useState(false);\n\n  useEffect(() => {\n    if (!getAuthToken() || getUserType() !== 'admin') {\n      toast({\n        title: 'Unauthorized',\n        description: 'Please log in as an admin to access this page.',\n        variant: 'destructive',\n      });\n      setLocation('/admin/login');\n    }\n  }, []);\n\n  const { data: employee, isLoading: loadingEmployee } = useQuery<Employee>({\n    queryKey: [`/api/admin/employees/${employeeId}`],\n    enabled: !!getAuthToken() && getUserType() === 'admin' && !!employeeId,\n  });\n\n  const { data: sites = [] } = useQuery<WorkSite[]>({\n    queryKey: ['/api/admin/sites'],\n    enabled: !!getAuthToken() && getUserType() === 'admin',\n  });\n\n  const { data: attendance = [] } = useQuery<AttendanceRecord[]>({\n    queryKey: [`/api/admin/employees/${employeeId}/attendance`],\n    enabled: !!getAuthToken() && getUserType() === 'admin' && !!employeeId,\n  });\n\n  const { data: locations = [] } = useQuery<LocationRecord[]>({\n    queryKey: [`/api/admin/employees/${employeeId}/locations`],\n    enabled: !!getAuthToken() && getUserType() === 'admin' && !!employeeId,\n  });\n\n  // Profile image mutations (for admin to update employee profile)\n  const uploadImageMutation = useMutation({\n    mutationFn: async (imageData: string) => {\n      const response = await fetch(`/api/admin/employees/${employeeId}/profile-image`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ imageData }),\n      });\n      if (!response.ok) throw new Error('Failed to upload image');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Image Uploaded\",\n        description: \"Employee profile image has been updated successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [`/api/admin/employees/${employeeId}`] });\n      setIsImageDialogOpen(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Upload Failed\",\n        description: error.message || \"Failed to upload profile image.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const removeImageMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch(`/api/admin/employees/${employeeId}/profile-image`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to remove image');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Image Removed\",\n        description: \"Employee profile image has been removed successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: [`/api/admin/employees/${employeeId}`] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Removal Failed\",\n        description: error.message || \"Failed to remove profile image.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Helper functions for image handling\n  const handleImageUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        const imageData = e.target?.result as string;\n        uploadImageMutation.mutate(imageData);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const assignedSite = employee?.siteId ? sites.find(site => site.id === employee.siteId) : null;\n  const recentAttendance = attendance.slice(0, 5);\n  const recentLocations = locations.slice(0, 10);\n\n  if (!getAuthToken() || getUserType() !== 'admin') {\n    return null;\n  }\n\n  if (loadingEmployee) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n          <Skeleton className=\"h-8 w-64 mb-8\" />\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n            <Skeleton className=\"h-64\" />\n            <Skeleton className=\"h-64\" />\n            <Skeleton className=\"h-64\" />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!employee) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n          <Alert variant=\"destructive\">\n            <AlertDescription>Employee not found.</AlertDescription>\n          </Alert>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow-sm border-b\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center py-4\">\n            <div className=\"flex items-center\">\n              <Link href=\"/admin/employees\">\n                <Button variant=\"ghost\" size=\"sm\" className=\"mr-4\">\n                  <ArrowLeft className=\"h-4 w-4\" />\n                </Button>\n              </Link>\n              <h1 className=\"text-xl font-semibold text-gray-900\">\n                {employee.firstName} {employee.lastName}\n              </h1>\n            </div>\n            <div className=\"flex space-x-2\">\n              <Link href=\"/admin/tracking\">\n                <Button variant=\"outline\">\n                  <MapPin className=\"h-4 w-4 mr-2\" />\n                  Live Tracking\n                </Button>\n              </Link>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          {/* Employee Information */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <User className=\"h-5 w-5\" />\n                <span>Employee Information</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-center mb-4\">\n                <div className=\"relative\">\n                  {employee.profileImage ? (\n                    <img \n                      src={employee.profileImage} \n                      alt=\"Employee Profile\" \n                      className=\"w-20 h-20 rounded-full object-cover\"\n                    />\n                  ) : (\n                    <div className=\"w-20 h-20 bg-gray-300 rounded-full flex items-center justify-center\">\n                      <span className=\"text-2xl font-medium text-gray-700\">\n                        {employee.firstName[0]}{employee.lastName[0]}\n                      </span>\n                    </div>\n                  )}\n                  <Dialog open={isImageDialogOpen} onOpenChange={setIsImageDialogOpen}>\n                    <DialogTrigger asChild>\n                      <Button\n                        size=\"sm\"\n                        className=\"absolute -bottom-1 -right-1 rounded-full w-6 h-6 p-0\"\n                      >\n                        <Camera className=\"h-3 w-3\" />\n                      </Button>\n                    </DialogTrigger>\n                    <DialogContent className=\"sm:max-w-md\">\n                      <DialogHeader>\n                        <DialogTitle>Employee Profile Image</DialogTitle>\n                        <DialogDescription>\n                          Upload a new profile image for {employee.firstName} {employee.lastName} or remove the current one.\n                        </DialogDescription>\n                      </DialogHeader>\n                      <div className=\"space-y-4\">\n                        <div>\n                          <input\n                            type=\"file\"\n                            accept=\"image/*\"\n                            onChange={handleImageUpload}\n                            className=\"hidden\"\n                            id=\"employee-image-upload\"\n                          />\n                          <label htmlFor=\"employee-image-upload\">\n                            <Button \n                              variant=\"outline\" \n                              className=\"w-full cursor-pointer\"\n                              disabled={uploadImageMutation.isPending}\n                            >\n                              <Upload className=\"h-4 w-4 mr-2\" />\n                              {uploadImageMutation.isPending ? 'Uploading...' : 'Upload New Image'}\n                            </Button>\n                          </label>\n                        </div>\n                        {employee.profileImage && (\n                          <Button\n                            variant=\"destructive\"\n                            onClick={() => removeImageMutation.mutate()}\n                            disabled={removeImageMutation.isPending}\n                            className=\"w-full\"\n                          >\n                            <X className=\"h-4 w-4 mr-2\" />\n                            {removeImageMutation.isPending ? 'Removing...' : 'Remove Image'}\n                          </Button>\n                        )}\n                      </div>\n                    </DialogContent>\n                  </Dialog>\n                </div>\n              </div>\n              \n              <div className=\"text-center\">\n                <h3 className=\"text-lg font-semibold text-gray-900\">\n                  {employee.firstName} {employee.lastName}\n                </h3>\n                <p className=\"text-sm text-gray-500\">ID: EMP{employee.id.toString().padStart(3, '0')}</p>\n              </div>\n\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center space-x-2\">\n                  <Mail className=\"h-4 w-4 text-gray-400\" />\n                  <span className=\"text-sm text-gray-600\">{employee.email}</span>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <Phone className=\"h-4 w-4 text-gray-400\" />\n                  <span className=\"text-sm text-gray-600\">{employee.phone}</span>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <Calendar className=\"h-4 w-4 text-gray-400\" />\n                  <span className=\"text-sm text-gray-600\">\n                    Joined {new Date(employee.createdAt).toLocaleDateString()}\n                  </span>\n                </div>\n              </div>\n\n              <div className=\"pt-4 border-t\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm font-medium text-gray-600\">Status</span>\n                  <Badge \n                    variant={employee.isActive ? \"default\" : \"secondary\"}\n                    className={employee.isActive ? \"bg-green-500 text-white\" : \"\"}\n                  >\n                    {employee.isActive ? 'Active' : 'Inactive'}\n                  </Badge>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Work Site Assignment */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <Building2 className=\"h-5 w-5\" />\n                <span>Work Site Assignment</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {assignedSite ? (\n                <div className=\"space-y-4\">\n                  <div>\n                    <h3 className=\"font-medium text-gray-900\">{assignedSite.name}</h3>\n                    <p className=\"text-sm text-gray-600 flex items-center mt-1\">\n                      <Navigation className=\"h-4 w-4 mr-1\" />\n                      {assignedSite.address}\n                    </p>\n                  </div>\n                  \n                  <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                    <div>\n                      <p className=\"font-medium text-gray-700\">Latitude</p>\n                      <p className=\"text-gray-600\">{assignedSite.latitude}</p>\n                    </div>\n                    <div>\n                      <p className=\"font-medium text-gray-700\">Longitude</p>\n                      <p className=\"text-gray-600\">{assignedSite.longitude}</p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-center justify-between text-sm\">\n                    <span className=\"font-medium text-gray-700\">Geofence Radius</span>\n                    <Badge variant=\"outline\">{assignedSite.geofenceRadius}m</Badge>\n                  </div>\n                  \n                  <Link href={`/admin/tracking?siteId=${assignedSite.id}`}>\n                    <Button className=\"w-full\">\n                      <MapPin className=\"w-4 h-4 mr-2\" />\n                      View on Map\n                    </Button>\n                  </Link>\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <Building2 className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                  <p className=\"text-gray-500\">No site assigned</p>\n                  <p className=\"text-sm text-gray-400\">This employee is not assigned to any work site</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Recent Activity */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <Clock className=\"h-5 w-5\" />\n                <span>Recent Activity</span>\n              </CardTitle>\n              <CardDescription>Latest attendance records</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {recentAttendance.length > 0 ? (\n                <div className=\"space-y-3\">\n                  {recentAttendance.map((record) => (\n                    <div key={record.id} className=\"flex items-center justify-between text-sm\">\n                      <div>\n                        <p className=\"font-medium text-gray-900\">\n                          {new Date(record.checkInTime).toLocaleDateString()}\n                        </p>\n                        <p className=\"text-gray-600\">\n                          {new Date(record.checkInTime).toLocaleTimeString()} - \n                          {record.checkOutTime ? new Date(record.checkOutTime).toLocaleTimeString() : 'Active'}\n                        </p>\n                      </div>\n                      <div className=\"flex items-center\">\n                        {record.checkOutTime ? (\n                          <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                        ) : (\n                          <Clock className=\"h-4 w-4 text-orange-500\" />\n                        )}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <Clock className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                  <p className=\"text-gray-500\">No recent activity</p>\n                  <p className=\"text-sm text-gray-400\">Attendance records will appear here</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Location History */}\n        <Card className=\"mt-8\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center space-x-2\">\n              <Navigation className=\"h-5 w-5\" />\n              <span>Recent Location History</span>\n            </CardTitle>\n            <CardDescription>Latest GPS location updates</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {recentLocations.length > 0 ? (\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50\">\n                    <tr>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        Timestamp\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        Location\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        Status\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\n                    {recentLocations.map((location) => (\n                      <tr key={location.id}>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                          {new Date(location.timestamp).toLocaleString()}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">\n                          {parseFloat(location.latitude).toFixed(6)}, {parseFloat(location.longitude).toFixed(6)}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <Badge \n                            variant={location.isWithinGeofence ? \"default\" : \"secondary\"}\n                            className={location.isWithinGeofence ? \"bg-green-500 text-white\" : \"bg-yellow-500 text-white\"}\n                          >\n                            {location.isWithinGeofence ? 'On Site' : 'Off Site'}\n                          </Badge>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            ) : (\n              <div className=\"text-center py-8\">\n                <Navigation className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                <p className=\"text-gray-500\">No location history</p>\n                <p className=\"text-sm text-gray-400\">GPS tracking data will appear here</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </main>\n    </div>\n  );\n}","size_bytes":19943},"client/src/pages/employee-test.tsx":{"content":"import { useLocation } from 'wouter';\n\nexport default function EmployeeTest() {\n  const [location] = useLocation();\n  \n  console.log(\"Current location:\", location);\n  console.log(\"Employee Test component rendered\");\n  \n  return (\n    <div className=\"container mx-auto p-6 bg-green-50 min-h-screen\">\n      <h1 className=\"text-4xl font-bold text-green-600 mb-4\">🎉 Employee Management Page Working!</h1>\n      <div className=\"bg-white p-6 rounded-lg shadow-lg\">\n        <p className=\"text-lg mb-4\">Current URL: <code className=\"bg-gray-100 px-2 py-1 rounded\">{location}</code></p>\n        <p className=\"text-gray-700 mb-2\">This is the dedicated employee management page.</p>\n        <p className=\"text-gray-700 mb-4\">If you can see this GREEN background, the routing is working correctly!</p>\n        <div className=\"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4\">\n          <strong>Success!</strong> The Employee Management route is functioning properly.\n        </div>\n        <p className=\"text-sm text-gray-600\">Time: {new Date().toLocaleTimeString()}</p>\n      </div>\n    </div>\n  );\n}","size_bytes":1119},"client/src/pages/live-tracking-old.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { Link, useLocation } from 'wouter';\nimport { useQuery } from '@tanstack/react-query';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { useToast } from '@/hooks/use-toast';\nimport { getAuthToken, getUserType } from '@/lib/auth';\nimport { useWebSocket } from '@/hooks/use-websocket';\nimport GoogleMap from '@/components/google-map';\nimport { loadGoogleMapsAPI } from '@/lib/google-maps';\nimport { \n  ArrowLeft, \n  Download, \n  Users, \n  MapPin, \n  Plus, \n  Minus, \n  Maximize \n} from 'lucide-react';\n\ninterface EmployeeLocation {\n  employee: any;\n  location: any;\n}\n\nexport default function LiveTracking() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [mapLoaded, setMapLoaded] = useState(false);\n  const [employeeLocations, setEmployeeLocations] = useState<EmployeeLocation[]>([]);\n  const [mapCenter, setMapCenter] = useState({ lat: 28.44065, lng: 77.08154 }); // Default to Delhi area\n  const [isFullscreen, setIsFullscreen] = useState(false);\n\n  useEffect(() => {\n    const token = getAuthToken();\n    const userType = getUserType();\n    \n    if (!token || userType !== 'admin') {\n      toast({\n        title: 'Unauthorized',\n        description: 'Please log in as an admin to access this page.',\n        variant: 'destructive',\n      });\n      setLocation('/admin/login');\n      return;\n    }\n\n    // Load Google Maps API only once\n    if (!mapLoaded) {\n      loadGoogleMapsAPI()\n        .then(() => setMapLoaded(true))\n        .catch((error) => {\n          console.error('Failed to load Google Maps:', error);\n          toast({\n            title: 'Error',\n            description: 'Failed to load Google Maps. Map features will not work.',\n            variant: 'destructive',\n          });\n        });\n    }\n\n    // Listen for fullscreen changes\n    const handleFullscreenChange = () => {\n      setIsFullscreen(!!document.fullscreenElement);\n    };\n\n    // Listen for escape key to exit fullscreen\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        setIsFullscreen(false);\n      }\n    };\n\n    document.addEventListener('fullscreenchange', handleFullscreenChange);\n    document.addEventListener('keydown', handleKeyDown);\n\n    return () => {\n      document.removeEventListener('fullscreenchange', handleFullscreenChange);\n      document.removeEventListener('keydown', handleKeyDown);\n    };\n  }, []);\n\n  const { data: locations = [], isLoading } = useQuery({\n    queryKey: ['/api/admin/locations'],\n    enabled: !!getAuthToken() && getUserType() === 'admin',\n    refetchInterval: 30000, // Refetch every 30 seconds\n  });\n\n  const { data: sites = [] } = useQuery({\n    queryKey: ['/api/admin/sites'],\n    enabled: !!getAuthToken() && getUserType() === 'admin',\n  });\n\n  // WebSocket for real-time updates\n  const { isConnected } = useWebSocket({\n    onMessage: (data) => {\n      if (data.type === 'employee_location') {\n        setEmployeeLocations(prev => {\n          const updated = prev.map(item => \n            item.employee.id === data.employeeId \n              ? {\n                  ...item,\n                  location: data.location\n                }\n              : item\n          );\n          \n          // If employee not found, add them\n          if (!prev.find(item => item.employee.id === data.employeeId)) {\n            updated.push({\n              employee: data.employee,\n              location: data.location\n            });\n          }\n          \n          return updated;\n        });\n      }\n    }\n  });\n\n  // Update employee locations from query data (no map center update to avoid loops)\n  useEffect(() => {\n    if (locations && Array.isArray(locations)) {\n      setEmployeeLocations(locations);\n    }\n  }, [locations]);\n\n  const getMapMarkers = () => {\n    return employeeLocations\n      .filter(item => item.location)\n      .map(item => ({\n        id: item.employee.id.toString(),\n        position: {\n          lat: parseFloat(item.location.latitude),\n          lng: parseFloat(item.location.longitude),\n        },\n        title: `${item.employee.firstName} ${item.employee.lastName}`,\n        color: item.location.isOnSite ? 'green' : 'yellow' as 'green' | 'yellow',\n      }));\n  };\n\n  const getMapGeofences = () => {\n    return Array.isArray(sites) ? sites.map((site: any) => ({\n      id: site.id.toString(),\n      center: {\n        lat: parseFloat(site.latitude),\n        lng: parseFloat(site.longitude),\n      },\n      radius: site.geofenceRadius,\n      color: '#1976D2',\n    })) : [];\n  };\n\n  const getSiteName = (siteId: number) => {\n    const site = Array.isArray(sites) ? sites.find((s: any) => s.id === siteId) : null;\n    return site?.name || 'Unknown Site';\n  };\n\n  // Map control functions\n  const toggleFullscreen = () => {\n    setIsFullscreen(prev => {\n      const newFullscreenState = !prev;\n      \n      // Handle browser fullscreen\n      if (newFullscreenState) {\n        // Entering fullscreen\n        document.documentElement.requestFullscreen?.();\n      } else {\n        // Exiting fullscreen\n        if (document.fullscreenElement) {\n          document.exitFullscreen?.();\n        }\n      }\n      \n      return newFullscreenState;\n    });\n  };\n\n  // Navigate to employee profile\n  const goToEmployeeProfile = (employeeId: number) => {\n    setLocation(`/admin/employees/${employeeId}`);\n  };\n\n  if (!getAuthToken() || getUserType() !== 'admin') {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow-sm border-b\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center py-4\">\n            <div className=\"flex items-center\">\n              <Link href=\"/admin/dashboard\">\n                <Button variant=\"ghost\" size=\"sm\" className=\"mr-4\">\n                  <ArrowLeft />\n                </Button>\n              </Link>\n              <h1 className=\"text-xl font-semibold text-gray-900\">Live Employee Tracking</h1>\n            </div>\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"flex items-center space-x-2\">\n                <div className={`w-3 h-3 rounded-full animate-pulse ${isConnected ? 'bg-success' : 'bg-error'}`}></div>\n                <span className=\"text-sm text-gray-600\">\n                  {isConnected ? 'Live Updates' : 'Disconnected'}\n                </span>\n              </div>\n              <Button className=\"bg-primary text-white hover:bg-blue-700\">\n                <Download className=\"mr-2 h-4 w-4\" />\n                Export Data\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-8\">\n          {/* Employee List Sidebar */}\n          <div className=\"lg:col-span-1\">\n            <Card>\n              <div className=\"p-4 border-b border-gray-200\">\n                <h3 className=\"font-semibold text-gray-900\">Active Employees</h3>\n                <p className=\"text-sm text-gray-600\">\n                  {employeeLocations.filter(item => item.location).length} currently tracked\n                </p>\n              </div>\n              <CardContent className=\"p-4 space-y-3 max-h-96 overflow-y-auto\">\n                {isLoading ? (\n                  <div className=\"text-center py-4\">\n                    <p className=\"text-sm text-gray-500\">Loading employees...</p>\n                  </div>\n                ) : employeeLocations.length === 0 ? (\n                  <div className=\"text-center py-8\">\n                    <Users className=\"mx-auto h-8 w-8 text-gray-400 mb-2\" />\n                    <p className=\"text-sm text-gray-500\">No employees tracked</p>\n                  </div>\n                ) : (\n                  employeeLocations.map((item) => (\n                    <div \n                      key={item.employee.id} \n                      onClick={() => goToEmployeeProfile(item.employee.id)}\n                      className=\"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors\"\n                    >\n                      <div className=\"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center\">\n                        <span className=\"text-xs font-medium text-gray-700\">\n                          {item.employee.firstName[0]}{item.employee.lastName[0]}\n                        </span>\n                      </div>\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm font-medium text-gray-900 hover:text-blue-600\">\n                          {item.employee.firstName} {item.employee.lastName}\n                        </p>\n                        <p className=\"text-xs text-gray-600\">\n                          {item.employee.siteId ? getSiteName(item.employee.siteId) : 'No site assigned'}\n                        </p>\n                      </div>\n                      <div className={`w-2 h-2 rounded-full ${\n                        item.location?.isOnSite ? 'bg-success' : \n                        item.location ? 'bg-warning' : 'bg-gray-400'\n                      }`}></div>\n                    </div>\n                  ))\n                )}\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Main Map Area */}\n          <div className=\"lg:col-span-3\">\n            <Card className=\"overflow-hidden\">\n              <div className=\"p-4 border-b border-gray-200\">\n                <div className=\"flex justify-between items-center\">\n                  <h3 className=\"font-semibold text-gray-900\">Real-Time Location Map</h3>\n                  <div className=\"flex space-x-2\">\n                    <Button variant=\"outline\" size=\"sm\">Satellite</Button>\n                    <Button size=\"sm\" className=\"bg-primary text-white\">Map</Button>\n                  </div>\n                </div>\n              </div>\n              \n              {/* Interactive Map Container */}\n              <div className={`${isFullscreen ? 'fixed inset-0 z-50 bg-white' : 'h-96 lg:h-[500px]'} relative`}>\n                {mapLoaded ? (\n                  <GoogleMap\n                    center={mapCenter}\n                    zoom={12}\n                    markers={getMapMarkers()}\n                    geofences={getMapGeofences()}\n                    className=\"w-full h-full\"\n                  />\n                ) : (\n                  <div className=\"w-full h-full bg-gray-100 flex items-center justify-center\">\n                    <div className=\"text-center\">\n                      <MapPin className=\"mx-auto h-12 w-12 text-gray-400 mb-2\" />\n                      <p className=\"text-gray-600\">Loading map...</p>\n                    </div>\n                  </div>\n                )}\n                \n                {/* Map Controls */}\n                <div className=\"absolute top-4 right-4 bg-white rounded-lg shadow-lg p-2\">\n                  <Button variant=\"ghost\" size=\"sm\" onClick={toggleFullscreen} title=\"Toggle Fullscreen\">\n                    <Maximize className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n              \n              {/* Map Legend */}\n              <div className=\"p-4 border-t border-gray-200 bg-gray-50\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex space-x-6\">\n                    <div className=\"flex items-center space-x-2\">\n                      <div className=\"w-3 h-3 bg-success rounded-full\"></div>\n                      <span className=\"text-sm text-gray-600\">On Site</span>\n                    </div>\n                    <div className=\"flex items-center space-x-2\">\n                      <div className=\"w-3 h-3 bg-warning rounded-full\"></div>\n                      <span className=\"text-sm text-gray-600\">Outside Boundary</span>\n                    </div>\n                    <div className=\"flex items-center space-x-2\">\n                      <div className=\"w-3 h-3 border-2 border-dashed border-primary rounded-full\"></div>\n                      <span className=\"text-sm text-gray-600\">Site Boundary</span>\n                    </div>\n                  </div>\n                  <div className=\"text-sm text-gray-500\">\n                    Last updated: <span className=\"font-medium\">just now</span>\n                  </div>\n                </div>\n              </div>\n            </Card>\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}\n","size_bytes":12720},"client/src/pages/live-tracking.tsx":{"content":"import React, { useState, useRef, useCallback } from 'react';\nimport { useLocation } from 'wouter';\nimport { useQuery } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { useToast } from '@/hooks/use-toast';\nimport { getAuthToken, getUserType } from '@/lib/auth';\nimport { loadGoogleMapsAPI } from '@/lib/google-maps';\nimport GoogleMap from '@/components/google-map';\nimport { useWebSocket } from '@/hooks/useWebSocket';\nimport { \n  ArrowLeft, \n  Download, \n  Users, \n  MapPin, \n  Plus,\n  Minus,\n  Maximize \n} from 'lucide-react';\nimport ExportReportDialog from '@/components/ExportReportDialog';\n\ninterface EmployeeLocation {\n  employee: any;\n  location: any;\n}\n\nexport default function LiveTracking() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [mapLoaded, setMapLoaded] = useState(false);\n  const [employeeLocations, setEmployeeLocations] = useState<EmployeeLocation[]>([]);\n  const [mapCenter, setMapCenter] = useState({ lat: 28.44065, lng: 77.08154 }); // Default to Delhi area\n  const [mapZoom, setMapZoom] = useState(12);\n  const [mapType, setMapType] = useState<'roadmap' | 'satellite'>('roadmap');\n  const [isFullscreen, setIsFullscreen] = useState(false);\n  const [profileImageModalOpen, setProfileImageModalOpen] = useState(false);\n  const [selectedProfileImage, setSelectedProfileImage] = useState<{url: string, name: string} | null>(null);\n  const initializeCalledRef = useRef(false);\n\n  // Initialize component only once\n  React.useEffect(() => {\n    if (initializeCalledRef.current) return;\n    initializeCalledRef.current = true;\n\n    const token = getAuthToken();\n    const userType = getUserType();\n    \n    if (!token || userType !== 'admin') {\n      toast({\n        title: 'Unauthorized',\n        description: 'Please log in as an admin to access this page.',\n        variant: 'destructive',\n      });\n      setLocation('/admin/login');\n      return;\n    }\n\n    // Load Google Maps API\n    loadGoogleMapsAPI()\n      .then(() => setMapLoaded(true))\n      .catch((error) => {\n        console.error('Failed to load Google Maps:', error);\n        toast({\n          title: 'Error',\n          description: 'Failed to load Google Maps. Map features will not work.',\n          variant: 'destructive',\n        });\n      });\n\n    // Fullscreen event listeners\n    const handleFullscreenChange = () => {\n      setIsFullscreen(!!document.fullscreenElement);\n    };\n\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        setIsFullscreen(false);\n      }\n    };\n\n    document.addEventListener('fullscreenchange', handleFullscreenChange);\n    document.addEventListener('keydown', handleKeyDown);\n\n    return () => {\n      document.removeEventListener('fullscreenchange', handleFullscreenChange);\n      document.removeEventListener('keydown', handleKeyDown);\n    };\n  }, []);\n\n  const { data: locations = [], isLoading } = useQuery({\n    queryKey: ['/api/admin/locations'],\n    enabled: !!getAuthToken() && getUserType() === 'admin',\n    refetchInterval: 60000, // Update every 1 minute\n  });\n\n  const { data: sites = [] } = useQuery({\n    queryKey: ['/api/admin/sites'],\n    enabled: !!getAuthToken() && getUserType() === 'admin',\n  });\n\n  // WebSocket for real-time updates\n  const { isConnected } = useWebSocket({\n    onMessage: (data) => {\n      if (data.type === 'employee_location') {\n        setEmployeeLocations(prev => {\n          const updated = prev.map(item => \n            item.employee.id === data.employeeId \n              ? { ...item, location: data.location }\n              : item\n          );\n          \n          if (!prev.find(item => item.employee.id === data.employeeId)) {\n            updated.push({\n              employee: data.employee,\n              location: data.location\n            });\n          }\n          \n          return updated;\n        });\n      }\n    }\n  });\n\n  const getStatusColor = (employee: any, location: any) => {\n    if (!location) return 'bg-gray-500';\n    \n    // Check if employee has a siteId (assigned site) - handle both camelCase and snake_case\n    const siteId = employee.siteId || employee.site_id;\n    if (!siteId) return 'bg-gray-500';\n    \n    // Find the assigned site\n    const assignedSite = Array.isArray(sites) ? sites.find((site: any) => site.id === siteId) : null;\n    \n    if (!assignedSite) return 'bg-gray-500';\n    \n    // Check if location is within the geofence using isWithinGeofence from server\n    if (location.isWithinGeofence) {\n      return 'bg-green-500';\n    }\n    \n    return 'bg-red-500';\n  };\n\n  const getStatusText = (employee: any, location: any) => {\n    console.log('Employee data:', employee);\n    console.log('Location data:', location);\n    \n    if (!location) return 'No Location';\n    \n    // Check if employee has a siteId (assigned site) - handle both camelCase and snake_case\n    const siteId = employee.siteId || employee.site_id;\n    if (!siteId) {\n      console.log('No site ID found for employee:', employee.firstName);\n      return 'No Assigned Site';\n    }\n    \n    // Find the assigned site\n    const assignedSite = Array.isArray(sites) ? sites.find((site: any) => site.id === siteId) : null;\n    \n    if (!assignedSite) {\n      console.log('No matching site found for site ID:', siteId);\n      return 'Unknown Site';\n    }\n    \n    // Use server-calculated isWithinGeofence status\n    if (location.isWithinGeofence) {\n      return `On Site: ${assignedSite.name}`;\n    }\n    \n    return 'Outside Site Boundary';\n  };\n\n  const calculateDistance = (lat1: number, lon1: number, lat2: number, lon2: number) => {\n    const R = 6371000;\n    const dLat = (lat2 - lat1) * Math.PI / 180;\n    const dLon = (lon2 - lon1) * Math.PI / 180;\n    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +\n              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\n              Math.sin(dLon/2) * Math.sin(dLon/2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\n    return R * c;\n  };\n\n  const getSiteName = (siteId: number) => {\n    const site = Array.isArray(sites) ? sites.find((s: any) => s.id === siteId) : null;\n    return site?.name || 'Unknown Site';\n  };\n\n  const handleZoom = useCallback((direction: 'in' | 'out') => {\n    setMapZoom(prev => {\n      if (direction === 'in') {\n        return Math.min(prev + 1, 20);\n      } else {\n        return Math.max(prev - 1, 1);\n      }\n    });\n  }, []);\n\n  const toggleMapType = useCallback(() => {\n    setMapType(prev => prev === 'roadmap' ? 'satellite' : 'roadmap');\n  }, []);\n\n  const toggleFullscreen = useCallback(() => {\n    setIsFullscreen(prev => {\n      const newFullscreenState = !prev;\n      \n      if (newFullscreenState) {\n        document.documentElement.requestFullscreen?.();\n      } else {\n        if (document.fullscreenElement) {\n          document.exitFullscreen?.();\n        }\n      }\n      \n      return newFullscreenState;\n    });\n  }, []);\n\n  const goToEmployeeProfile = useCallback((employeeId: number) => {\n    setLocation(`/admin/employees/${employeeId}`);\n  }, [setLocation]);\n\n  // Function to zoom to specific employee location\n  const zoomToEmployee = useCallback((lat: number, lng: number) => {\n    setMapCenter({ lat, lng });\n    setMapZoom(18); // Close zoom level to see the employee clearly\n  }, []);\n\n  const getMapMarkers = () => {\n    const markers: any[] = [];\n    \n    // Add employee markers (red person icons)\n    if (Array.isArray(locations)) {\n      locations.forEach((item: any) => {\n        if (item.location?.latitude && item.location?.longitude) {\n          const lat = parseFloat(item.location.latitude);\n          const lng = parseFloat(item.location.longitude);\n          \n          if (!isNaN(lat) && !isNaN(lng)) {\n            markers.push({\n              position: { lat, lng },\n              title: `${item.employee.firstName} ${item.employee.lastName}`,\n              color: '#ff0000', // Red color for employees\n              type: 'employee',\n              onClick: () => zoomToEmployee(lat, lng),\n            });\n          }\n        }\n      });\n    }\n    \n    // Add site markers (green building icons)\n    if (Array.isArray(sites)) {\n      sites.forEach((site: any) => {\n        const lat = parseFloat(site.latitude);\n        const lng = parseFloat(site.longitude);\n        \n        if (!isNaN(lat) && !isNaN(lng)) {\n          markers.push({\n            position: { lat, lng },\n            title: `Work Site: ${site.name}`,\n            color: '#22c55e', // Green color for sites\n            type: 'site',\n            onClick: () => zoomToEmployee(lat, lng), // Can also zoom to site\n          });\n        }\n      });\n    }\n    \n    return markers;\n  };\n\n  const getMapGeofences = () => {\n    if (!Array.isArray(sites)) return [];\n    \n    return sites.map((site: any) => {\n      const lat = parseFloat(site.latitude);\n      const lng = parseFloat(site.longitude);\n      const radius = parseFloat(site.geofenceRadius);\n      \n      if (!isNaN(lat) && !isNaN(lng) && !isNaN(radius)) {\n        return {\n          center: { lat, lng },\n          radius: radius,\n          color: '#1976D2',\n        };\n      }\n      return null;\n    }).filter((item): item is { center: { lat: number; lng: number }; radius: number; color: string } => item !== null);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-4\">\n      <div className=\"max-w-7xl mx-auto space-y-6\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-4\">\n            <Button variant=\"ghost\" onClick={() => setLocation('/admin/dashboard')}>\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Dashboard\n            </Button>\n            <h1 className=\"text-2xl font-bold text-gray-900\">Live Employee Tracking</h1>\n          </div>\n          \n          <div className=\"flex items-center space-x-4\">\n            <div className=\"flex items-center space-x-2\">\n              <div className=\"w-3 h-3 bg-green-500 rounded-full animate-pulse\"></div>\n              <span className=\"text-sm text-gray-600\">\n                {isConnected ? 'Live Updates' : 'Connecting...'}\n              </span>\n            </div>\n            <ExportReportDialog>\n              <Button variant=\"outline\">\n                <Download className=\"h-4 w-4 mr-2\" />\n                Export Data\n              </Button>\n            </ExportReportDialog>\n          </div>\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Currently Tracked</CardTitle>\n              <Users className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">\n                {Array.isArray(locations) ? locations.length : 0}\n              </div>\n              <p className=\"text-xs text-muted-foreground\">employees online</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">On Site</CardTitle>\n              <MapPin className=\"h-4 w-4 text-green-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-green-600\">\n                {Array.isArray(locations) ? \n                  locations.filter((item: any) => {\n                    console.log('Employee:', item.employee.firstName, 'isWithinGeofence:', item.location?.isWithinGeofence);\n                    return item.location?.isWithinGeofence === true;\n                  }).length : 0\n                }\n              </div>\n              <p className=\"text-xs text-muted-foreground\">within boundaries</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Outside Boundary</CardTitle>\n              <MapPin className=\"h-4 w-4 text-red-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-red-600\">\n                {Array.isArray(locations) ? \n                  locations.filter((item: any) => \n                    item.location && !item.location.isWithinGeofence\n                  ).length : 0\n                }\n              </div>\n              <p className=\"text-xs text-muted-foreground\">need attention</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Main Content Grid */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          {/* Employee List */}\n          <div className=\"lg:col-span-1 space-y-4\">\n            <h2 className=\"text-lg font-semibold text-gray-900\">Employee Status</h2>\n            {isLoading ? (\n              <div className=\"space-y-3\">\n                {[...Array(5)].map((_, i) => (\n                  <Skeleton key={i} className=\"h-20 w-full\" />\n                ))}\n              </div>\n            ) : (\n              <div className=\"space-y-3 max-h-96 overflow-y-auto\">\n                {Array.isArray(locations) && locations.length === 0 ? (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    No employees currently tracked\n                  </div>\n                ) : (\n                  Array.isArray(locations) && locations.map((item: any) => (\n                    <Card key={item.employee.id} className=\"cursor-pointer hover:shadow-md transition-shadow\">\n                      <CardContent className=\"p-4\" onClick={() => goToEmployeeProfile(item.employee.id)}>\n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"flex items-center space-x-3\">\n                            <div className=\"relative\">\n                              {item.employee.profileImage ? (\n                                <img\n                                  src={item.employee.profileImage}\n                                  alt={`${item.employee.firstName} ${item.employee.lastName}`}\n                                  className=\"w-10 h-10 rounded-full object-cover cursor-pointer hover:opacity-80 transition-opacity\"\n                                  onClick={(e) => {\n                                    e.stopPropagation();\n                                    setSelectedProfileImage({\n                                      url: item.employee.profileImage!,\n                                      name: `${item.employee.firstName} ${item.employee.lastName}`\n                                    });\n                                    setProfileImageModalOpen(true);\n                                  }}\n                                />\n                              ) : (\n                                <div className=\"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center\">\n                                  <span className=\"text-gray-600 font-medium text-sm\">\n                                    {item.employee.firstName[0]}{item.employee.lastName[0]}\n                                  </span>\n                                </div>\n                              )}\n                              <div className={`absolute -bottom-0.5 -right-0.5 w-3 h-3 rounded-full border-2 border-white ${getStatusColor(item.employee, item.location)}`}></div>\n                            </div>\n                            <div>\n                              <p className=\"font-medium text-gray-900 hover:text-blue-600\">\n                                {item.employee.firstName} {item.employee.lastName}\n                              </p>\n                              <p className=\"text-sm text-gray-500\">{item.employee.email}</p>\n                            </div>\n                          </div>\n                          <Badge variant={getStatusColor(item.employee, item.location) === 'bg-green-500' ? 'default' : 'destructive'}>\n                            {getStatusText(item.employee, item.location)}\n                          </Badge>\n                        </div>\n                        \n                        {item.location && (\n                          <div className=\"mt-2 text-xs text-gray-500\">\n                            Last updated: {new Date(item.location.timestamp).toLocaleTimeString()}\n                          </div>\n                        )}\n                      </CardContent>\n                    </Card>\n                  ))\n                )}\n              </div>\n            )}\n          </div>\n          \n          {/* Interactive Map */}\n          <div className=\"lg:col-span-2\">\n            <div className=\"bg-white rounded-lg shadow p-4\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h2 className=\"text-lg font-semibold text-gray-900\">Real-time Map</h2>\n                <div className=\"flex items-center space-x-4\">\n                  <div className=\"flex items-center space-x-4 text-sm\">\n                    <div className=\"flex items-center space-x-1\">\n                      <div className=\"w-3 h-3 bg-red-500 rounded-full\"></div>\n                      <span>Employees</span>\n                    </div>\n                    <div className=\"flex items-center space-x-1\">\n                      <div className=\"w-3 h-3 bg-green-500 rounded-full\"></div>\n                      <span>Work Sites</span>\n                    </div>\n                    <div className=\"flex items-center space-x-1\">\n                      <div className=\"w-3 h-3 bg-blue-500 rounded-full opacity-30\"></div>\n                      <span>Site Boundary</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              \n              {/* Interactive Map Container */}\n              <div className={`${isFullscreen ? 'fixed inset-0 z-50 bg-white' : 'h-96 lg:h-[500px]'} relative`}>\n                {mapLoaded ? (\n                  <GoogleMap\n                    center={mapCenter}\n                    zoom={mapZoom}\n                    mapType={mapType}\n                    markers={getMapMarkers()}\n                    geofences={getMapGeofences()}\n                    className=\"w-full h-full\"\n                  />\n                ) : (\n                  <div className=\"w-full h-full flex items-center justify-center bg-gray-100 rounded-lg\">\n                    <div className=\"text-center\">\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2\"></div>\n                      <p className=\"text-gray-600\">Loading map...</p>\n                    </div>\n                  </div>\n                )}\n                \n                {/* Map Controls */}\n                <div className=\"absolute top-4 right-4 bg-white rounded-lg shadow-lg p-2 space-y-2\">\n                  <Button variant=\"ghost\" size=\"sm\" onClick={() => handleZoom('in')} title=\"Zoom In\">\n                    <Plus className=\"h-4 w-4\" />\n                  </Button>\n                  <Button variant=\"ghost\" size=\"sm\" onClick={() => handleZoom('out')} title=\"Zoom Out\">\n                    <Minus className=\"h-4 w-4\" />\n                  </Button>\n                  <Button variant=\"ghost\" size=\"sm\" onClick={toggleMapType} title=\"Toggle Satellite View\">\n                    {mapType === 'roadmap' ? 'Satellite' : 'Map'}\n                  </Button>\n                  <Button variant=\"ghost\" size=\"sm\" onClick={toggleFullscreen} title=\"Toggle Fullscreen\">\n                    <Maximize className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Profile Image Modal */}\n      <Dialog open={profileImageModalOpen} onOpenChange={setProfileImageModalOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Profile Picture</DialogTitle>\n            <DialogDescription>\n              {selectedProfileImage?.name}\n            </DialogDescription>\n          </DialogHeader>\n          {selectedProfileImage && (\n            <div className=\"flex justify-center p-4\">\n              <img\n                src={selectedProfileImage.url}\n                alt={selectedProfileImage.name}\n                className=\"max-w-full max-h-96 object-contain rounded-lg\"\n              />\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":20952},"client/src/pages/mobile-worker.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useLocation } from 'wouter';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\nimport { getAuthToken, getUser, logout, getUserType } from '@/lib/auth';\nimport { useGeolocation } from '@/hooks/use-geolocation';\nimport { useWebSocket } from '@/hooks/use-websocket';\nimport GoogleMap from '@/components/google-map';\nimport { loadGoogleMapsAPI } from '@/lib/google-maps';\nimport { \n  Settings, \n  MapPin, \n  LogIn, \n  LogOut, \n  AlertTriangle,\n  Clock,\n  Hammer,\n  Phone\n} from 'lucide-react';\n\nexport default function MobileWorker() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const user = getUser();\n  const userType = getUserType();\n  const [mapLoaded, setMapLoaded] = useState(false);\n\n  const {\n    latitude,\n    longitude,\n    error: locationError,\n    loading: locationLoading,\n    requestPermission,\n  } = useGeolocation({ watch: true });\n\n  useEffect(() => {\n    if (!getAuthToken() || userType !== 'employee') {\n      toast({\n        title: 'Unauthorized',\n        description: 'Please log in as an employee to access this page.',\n        variant: 'destructive',\n      });\n      setLocation('/admin/login');\n    }\n\n    // Load Google Maps API\n    loadGoogleMapsAPI()\n      .then(() => setMapLoaded(true))\n      .catch((error) => {\n        console.error('Failed to load Google Maps:', error);\n      });\n  }, []);\n\n  // Get employee status and assigned site\n  const { data: status = {}, isLoading: statusLoading } = useQuery({\n    queryKey: ['/api/employee/status'],\n    enabled: !!getAuthToken() && userType === 'employee',\n    refetchInterval: 30000,\n  });\n\n  const { data: assignedSite = {} } = useQuery({\n    queryKey: ['/api/admin/sites', status?.assignedSite],\n    enabled: !!status?.assignedSite,\n  });\n\n  // Location tracking mutation\n  const updateLocationMutation = useMutation({\n    mutationFn: async ({ latitude, longitude }: { latitude: number; longitude: number }) => {\n      const response = await apiRequest('POST', '/api/employee/location', {\n        latitude: latitude.toString(),\n        longitude: longitude.toString(),\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/employee/status'] });\n    },\n    onError: (error: any) => {\n      console.error('Failed to update location:', error);\n    },\n  });\n\n  // WebSocket for location updates\n  const { sendMessage, isConnected } = useWebSocket({\n    onMessage: (data) => {\n      if (data.type === 'location_confirmed') {\n        queryClient.invalidateQueries({ queryKey: ['/api/employee/status'] });\n      }\n    },\n  });\n\n  // Send location updates automatically every 30 seconds when available\n  useEffect(() => {\n    if (latitude && longitude) {\n      // Send immediate location update\n      updateLocationMutation.mutate({ latitude, longitude });\n      \n      // Set up periodic location updates\n      const interval = setInterval(() => {\n        if (latitude && longitude) {\n          updateLocationMutation.mutate({ latitude, longitude });\n        }\n      }, 30000); // Every 30 seconds\n\n      return () => clearInterval(interval);\n    }\n  }, [latitude, longitude]);\n\n  // Send location updates via WebSocket when available\n  useEffect(() => {\n    if (latitude && longitude && isConnected && status?.isCheckedIn) {\n      sendMessage({\n        type: 'location_update',\n        latitude: latitude.toString(),\n        longitude: longitude.toString(),\n      });\n    }\n  }, [latitude, longitude, isConnected, status?.isCheckedIn, sendMessage]);\n\n  const checkInMutation = useMutation({\n    mutationFn: async () => {\n      if (!latitude || !longitude) {\n        throw new Error('Location access is required for check-in');\n      }\n      if (!status?.assignedSite) {\n        throw new Error('No work site assigned. Contact your supervisor.');\n      }\n      \n      const response = await apiRequest('POST', '/api/employee/checkin', {\n        latitude: latitude.toString(),\n        longitude: longitude.toString(),\n        siteId: status.assignedSite,\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/employee/status'] });\n      toast({\n        title: 'Checked In',\n        description: 'Successfully checked in to work site',\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: 'Check-in Failed',\n        description: error.message || 'Unable to check in',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const checkOutMutation = useMutation({\n    mutationFn: async () => {\n      if (!latitude || !longitude) {\n        throw new Error('Location access is required for check-out');\n      }\n      \n      const response = await apiRequest('POST', '/api/employee/checkout', {\n        latitude: latitude.toString(),\n        longitude: longitude.toString(),\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/employee/status'] });\n      toast({\n        title: 'Checked Out',\n        description: 'Successfully checked out from work site',\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: 'Check-out Failed',\n        description: error.message || 'Unable to check out',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const handleCheckIn = () => {\n    if (locationError) {\n      toast({\n        title: 'Location Required',\n        description: 'Please enable location access to check in',\n        variant: 'destructive',\n      });\n      requestPermission();\n      return;\n    }\n    checkInMutation.mutate();\n  };\n\n  const handleCheckOut = () => {\n    if (locationError) {\n      toast({\n        title: 'Location Required',\n        description: 'Please enable location access to check out',\n        variant: 'destructive',\n      });\n      requestPermission();\n      return;\n    }\n    checkOutMutation.mutate();\n  };\n\n  const handleEmergencyContact = () => {\n    // In a real implementation, this would trigger an emergency protocol\n    toast({\n      title: 'Emergency Contact',\n      description: 'Emergency services have been notified',\n      variant: 'destructive',\n    });\n  };\n\n  const handleLogout = () => {\n    logout();\n    toast({\n      title: 'Logged out',\n      description: 'You have been successfully logged out.',\n    });\n    setLocation('/admin/login');\n  };\n\n  const formatTime = (dateString: string) => {\n    return new Date(dateString).toLocaleTimeString('en-US', {\n      hour: 'numeric',\n      minute: '2-digit',\n      hour12: true,\n    });\n  };\n\n  if (!user || userType !== 'employee') {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Mobile Header */}\n      <div className=\"bg-primary text-white p-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center\">\n              <Hammer className=\"text-white text-sm\" />\n            </div>\n            <div>\n              <h1 className=\"font-semibold\">WorkSite Tracker</h1>\n              <p className=\"text-sm opacity-90\">\n                {user.firstName} {user.lastName}\n              </p>\n            </div>\n          </div>\n          <Button \n            variant=\"ghost\" \n            size=\"sm\" \n            className=\"text-white hover:bg-white hover:bg-opacity-10\"\n            onClick={handleLogout}\n          >\n            <Settings className=\"text-white\" />\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"p-4\">\n        {/* Status Card */}\n        <Card className=\"mb-6\">\n          <CardContent className=\"p-6\">\n            <div className=\"text-center\">\n              <div className={`w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 ${\n                status?.isCheckedIn ? 'bg-success bg-opacity-10' : 'bg-gray-100'\n              }`}>\n                <MapPin className={`text-2xl ${\n                  status?.isCheckedIn ? 'text-success' : 'text-gray-400'\n                }`} />\n              </div>\n              <h2 className=\"text-xl font-semibold text-gray-900 mb-2\">\n                {statusLoading ? 'Loading...' : status?.isCheckedIn ? 'On Site' : 'Off Site'}\n              </h2>\n              {assignedSite && (\n                <p className=\"text-gray-600 mb-1\">{assignedSite.name}</p>\n              )}\n              {status?.attendance?.checkInTime && (\n                <p className=\"text-sm text-gray-500\">\n                  Checked in at {formatTime(status.attendance.checkInTime)}\n                </p>\n              )}\n              {!status?.assignedSite && (\n                <p className=\"text-sm text-warning\">No work site assigned</p>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Location Permission Warning */}\n        {locationError && (\n          <Card className=\"mb-6 border-warning\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center space-x-3\">\n                <AlertTriangle className=\"text-warning\" />\n                <div>\n                  <p className=\"text-sm font-medium text-gray-900\">Location Access Required</p>\n                  <p className=\"text-xs text-gray-600\">{locationError}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Quick Actions */}\n        <div className=\"grid grid-cols-2 gap-4 mb-6\">\n          <Button\n            onClick={handleCheckIn}\n            disabled={\n              !status?.assignedSite ||\n              status?.isCheckedIn ||\n              checkInMutation.isPending ||\n              locationLoading ||\n              !!locationError\n            }\n            className=\"bg-success hover:bg-green-600 text-white p-4 h-auto flex flex-col items-center space-y-2\"\n          >\n            <LogIn className=\"text-xl\" />\n            <span className=\"font-medium\">\n              {checkInMutation.isPending ? 'Checking In...' : 'Check In'}\n            </span>\n          </Button>\n          <Button\n            onClick={handleCheckOut}\n            disabled={\n              !status?.isCheckedIn ||\n              checkOutMutation.isPending ||\n              locationLoading ||\n              !!locationError\n            }\n            className=\"bg-error hover:bg-red-600 text-white p-4 h-auto flex flex-col items-center space-y-2\"\n          >\n            <LogOut className=\"text-xl\" />\n            <span className=\"font-medium\">\n              {checkOutMutation.isPending ? 'Checking Out...' : 'Check Out'}\n            </span>\n          </Button>\n        </div>\n\n        {/* Today's Activity */}\n        <Card className=\"mb-6\">\n          <div className=\"p-4 border-b border-gray-200\">\n            <h3 className=\"font-semibold text-gray-900\">Today's Activity</h3>\n          </div>\n          <CardContent className=\"p-4\">\n            <div className=\"space-y-4\">\n              {status?.attendance ? (\n                <>\n                  <div className=\"flex items-center space-x-4\">\n                    <div className=\"w-2 h-2 bg-success rounded-full\"></div>\n                    <div className=\"flex-1\">\n                      <p className=\"text-sm font-medium text-gray-900\">Checked In</p>\n                      <p className=\"text-xs text-gray-600\">\n                        {formatTime(status.attendance.checkInTime)} • {assignedSite?.name || 'Work Site'}\n                      </p>\n                    </div>\n                  </div>\n                  {status.attendance.checkOutTime && (\n                    <div className=\"flex items-center space-x-4\">\n                      <div className=\"w-2 h-2 bg-error rounded-full\"></div>\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm font-medium text-gray-900\">Checked Out</p>\n                        <p className=\"text-xs text-gray-600\">\n                          {formatTime(status.attendance.checkOutTime)} • {assignedSite?.name || 'Work Site'}\n                        </p>\n                      </div>\n                    </div>\n                  )}\n                </>\n              ) : (\n                <div className=\"text-center py-4\">\n                  <Clock className=\"mx-auto h-8 w-8 text-gray-400 mb-2\" />\n                  <p className=\"text-sm text-gray-500\">No activity today</p>\n                  <p className=\"text-xs text-gray-400\">Check in to start tracking your work day</p>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Current Location */}\n        <Card className=\"mb-6\">\n          <div className=\"p-4 border-b border-gray-200\">\n            <div className=\"flex justify-between items-center\">\n              <h3 className=\"font-semibold text-gray-900\">Current Location</h3>\n              <div className=\"flex items-center space-x-2\">\n                <div className={`w-2 h-2 rounded-full ${\n                  isConnected && !locationError ? 'bg-success animate-pulse' : 'bg-gray-400'\n                }`}></div>\n                <span className=\"text-xs text-gray-600\">\n                  {isConnected && !locationError ? 'Live' : 'Offline'}\n                </span>\n              </div>\n            </div>\n          </div>\n          <CardContent className=\"p-4\">\n            {latitude && longitude && mapLoaded ? (\n              <div className=\"h-40 bg-gray-100 rounded-lg mb-4\">\n                <GoogleMap\n                  center={{ lat: latitude, lng: longitude }}\n                  zoom={16}\n                  markers={[\n                    {\n                      id: 'current',\n                      position: { lat: latitude, lng: longitude },\n                      title: 'Your Location',\n                      color: 'blue',\n                    },\n                  ]}\n                  geofences={assignedSite ? [\n                    {\n                      id: 'worksite',\n                      center: {\n                        lat: parseFloat(assignedSite.latitude),\n                        lng: parseFloat(assignedSite.longitude),\n                      },\n                      radius: assignedSite.geofenceRadius,\n                      color: '#1976D2',\n                    },\n                  ] : []}\n                  className=\"w-full h-full rounded-lg\"\n                />\n              </div>\n            ) : (\n              <div className=\"h-40 bg-gray-100 rounded-lg mb-4 flex items-center justify-center\">\n                <div className=\"text-center\">\n                  <MapPin className=\"mx-auto h-8 w-8 text-gray-400 mb-2\" />\n                  <p className=\"text-sm text-gray-500\">\n                    {locationLoading ? 'Getting location...' : 'Location unavailable'}\n                  </p>\n                </div>\n              </div>\n            )}\n            \n            <div className=\"space-y-2\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-gray-600\">Coordinates</span>\n                <span className=\"font-medium text-gray-900\">\n                  {latitude && longitude \n                    ? `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`\n                    : 'N/A'\n                  }\n                </span>\n              </div>\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-gray-600\">Last Updated</span>\n                <span className=\"font-medium text-gray-900\">\n                  {latitude && longitude ? 'Just now' : 'Never'}\n                </span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Emergency Contact */}\n        <Button\n          onClick={handleEmergencyContact}\n          className=\"w-full bg-error hover:bg-red-600 text-white py-3 px-4 h-auto\"\n        >\n          <AlertTriangle className=\"mr-2\" />\n          Emergency Contact\n        </Button>\n      </div>\n    </div>\n  );\n}\n","size_bytes":16343},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/pages/notifications.tsx":{"content":"import { useQuery } from '@tanstack/react-query';\nimport { Link } from 'wouter';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { ArrowLeft, Bell, AlertCircle, CheckCircle, Clock, MapPin } from 'lucide-react';\nimport { getAuthToken } from '@/lib/auth';\n\ninterface Notification {\n  id: number;\n  type: 'attendance' | 'geofence' | 'system' | 'alert';\n  title: string;\n  message: string;\n  employeeName?: string;\n  siteName?: string;\n  timestamp: string;\n  isRead: boolean;\n}\n\n// Mock notifications data for now - replace with real API call\nconst mockNotifications: Notification[] = [\n  {\n    id: 1,\n    type: 'geofence',\n    title: 'Employee Entered Work Site',\n    message: 'John Doe has entered the Main Construction Site geofence',\n    employeeName: 'John Doe',\n    siteName: 'Main Construction Site',\n    timestamp: new Date(Date.now() - 10 * 60 * 1000).toISOString(),\n    isRead: false,\n  },\n  {\n    id: 2,\n    type: 'attendance',\n    title: 'Late Check-in Alert',\n    message: 'Jane Smith checked in 30 minutes late to Downtown Office',\n    employeeName: 'Jane Smith',\n    siteName: 'Downtown Office',\n    timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),\n    isRead: false,\n  },\n  {\n    id: 3,\n    type: 'geofence',\n    title: 'Employee Left Work Site',\n    message: 'Mike Johnson has left the Warehouse District geofence',\n    employeeName: 'Mike Johnson',\n    siteName: 'Warehouse District',\n    timestamp: new Date(Date.now() - 4 * 60 * 60 * 1000).toISOString(),\n    isRead: true,\n  },\n  {\n    id: 4,\n    type: 'system',\n    title: 'New Employee Added',\n    message: 'A new employee has been successfully added to the system',\n    timestamp: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),\n    isRead: true,\n  },\n  {\n    id: 5,\n    type: 'alert',\n    title: 'Geofence Violation',\n    message: 'Employee is outside designated work area during work hours',\n    employeeName: 'Alex Brown',\n    siteName: 'Industrial Park',\n    timestamp: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),\n    isRead: true,\n  },\n];\n\nexport default function Notifications() {\n  // For now using mock data, replace with real API call\n  const notifications = mockNotifications;\n\n  const getIcon = (type: string) => {\n    switch (type) {\n      case 'geofence':\n        return <MapPin className=\"h-5 w-5 text-blue-600\" />;\n      case 'attendance':\n        return <Clock className=\"h-5 w-5 text-orange-600\" />;\n      case 'alert':\n        return <AlertCircle className=\"h-5 w-5 text-red-600\" />;\n      case 'system':\n        return <CheckCircle className=\"h-5 w-5 text-green-600\" />;\n      default:\n        return <Bell className=\"h-5 w-5 text-gray-600\" />;\n    }\n  };\n\n  const getTimeAgo = (timestamp: string) => {\n    const now = new Date();\n    const time = new Date(timestamp);\n    const diffInMinutes = Math.floor((now.getTime() - time.getTime()) / (1000 * 60));\n    \n    if (diffInMinutes < 60) {\n      return `${diffInMinutes} minutes ago`;\n    } else if (diffInMinutes < 1440) {\n      return `${Math.floor(diffInMinutes / 60)} hours ago`;\n    } else {\n      return `${Math.floor(diffInMinutes / 1440)} days ago`;\n    }\n  };\n\n  const unreadCount = notifications.filter(n => !n.isRead).length;\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div className=\"flex items-center\">\n          <Link href=\"/admin/dashboard\">\n            <Button variant=\"ghost\" size=\"sm\" className=\"mr-4\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Dashboard\n            </Button>\n          </Link>\n          <h1 className=\"text-2xl font-bold flex items-center\">\n            <Bell className=\"h-6 w-6 mr-2\" />\n            Notifications\n          </h1>\n        </div>\n        <div className=\"flex items-center space-x-3\">\n          {unreadCount > 0 && (\n            <Badge variant=\"destructive\" className=\"text-sm\">\n              {unreadCount} unread\n            </Badge>\n          )}\n          <Button variant=\"outline\" size=\"sm\">\n            Mark All Read\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        {notifications.length === 0 ? (\n          <Card>\n            <CardContent className=\"p-8 text-center\">\n              <Bell className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <p className=\"text-gray-500\">No notifications yet</p>\n              <p className=\"text-sm text-gray-400 mt-1\">\n                You'll see updates about employee activity, geofence events, and system alerts here\n              </p>\n            </CardContent>\n          </Card>\n        ) : (\n          notifications.map((notification) => (\n            <Card \n              key={notification.id} \n              className={`hover:shadow-md transition-shadow ${\n                !notification.isRead ? 'border-l-4 border-l-blue-500 bg-blue-50/50' : ''\n              }`}\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-start space-x-4\">\n                  <div className=\"flex-shrink-0 mt-1\">\n                    {getIcon(notification.type)}\n                  </div>\n                  \n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <h3 className={`font-medium ${!notification.isRead ? 'text-gray-900' : 'text-gray-700'}`}>\n                          {notification.title}\n                        </h3>\n                        <p className=\"text-gray-600 mt-1 text-sm\">\n                          {notification.message}\n                        </p>\n                        \n                        {(notification.employeeName || notification.siteName) && (\n                          <div className=\"flex items-center space-x-4 mt-2 text-xs text-gray-500\">\n                            {notification.employeeName && (\n                              <span>Employee: {notification.employeeName}</span>\n                            )}\n                            {notification.siteName && (\n                              <span>Site: {notification.siteName}</span>\n                            )}\n                          </div>\n                        )}\n                      </div>\n                      \n                      <div className=\"flex items-center space-x-2 ml-4\">\n                        <span className=\"text-sm text-gray-500 whitespace-nowrap\">\n                          {getTimeAgo(notification.timestamp)}\n                        </span>\n                        {!notification.isRead && (\n                          <div className=\"w-2 h-2 bg-blue-500 rounded-full\"></div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))\n        )}\n      </div>\n\n      {notifications.length > 0 && (\n        <div className=\"mt-6 text-center\">\n          <Button variant=\"outline\">\n            Load More Notifications\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":7292},"client/src/pages/on-site-now.tsx":{"content":"import { useQuery } from '@tanstack/react-query';\nimport { Link } from 'wouter';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { ArrowLeft, MapPin, Clock, User } from 'lucide-react';\nimport { getAuthToken } from '@/lib/auth';\nimport { Employee } from '@shared/schema';\n\ninterface Site {\n  id: number;\n  name: string;\n  address: string;\n}\n\ninterface LocationRecord {\n  id: number;\n  employeeId: number;\n  latitude: string;\n  longitude: string;\n  timestamp: string;\n  isWithinGeofence: boolean;\n  employee: Employee;\n}\n\nexport default function OnSiteNow() {\n  const { data: locations, isLoading: locationsLoading } = useQuery({\n    queryKey: ['/api/admin/locations'],\n    queryFn: async () => {\n      const response = await fetch('/api/admin/locations', {\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to fetch locations');\n      return response.json();\n    },\n    staleTime: 0, // Always refetch for real-time data\n    gcTime: 0, // Don't cache the response\n    refetchInterval: 30000, // Refetch every 30 seconds\n  });\n\n  const { data: sites } = useQuery({\n    queryKey: ['/api/admin/sites'],\n    queryFn: async () => {\n      const response = await fetch('/api/admin/sites', {\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to fetch sites');\n      return response.json();\n    },\n  });\n\n  const getSiteName = (siteId: number) => {\n    const site = sites?.find((s: Site) => s.id === siteId);\n    return site?.name || 'Unknown Site';\n  };\n\n  // Filter for employees currently on site (within geofence)\n  const onSiteEmployees = locations?.filter((item: any) => \n    item.location?.isWithinGeofence && item.employee?.isActive\n  ) || [];\n\n  if (locationsLoading) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <div className=\"flex items-center mb-6\">\n          <Link href=\"/admin/dashboard\">\n            <Button variant=\"ghost\" size=\"sm\" className=\"mr-4\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Dashboard\n            </Button>\n          </Link>\n          <h1 className=\"text-2xl font-bold\">Employees On Site Now</h1>\n        </div>\n        <div className=\"grid gap-4\">\n          {[1, 2, 3].map((i) => (\n            <Card key={i} className=\"animate-pulse\">\n              <CardContent className=\"p-6\">\n                <div className=\"h-4 bg-gray-200 rounded w-1/3 mb-2\"></div>\n                <div className=\"h-3 bg-gray-200 rounded w-1/2\"></div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div className=\"flex items-center\">\n          <Link href=\"/admin/dashboard\">\n            <Button variant=\"ghost\" size=\"sm\" className=\"mr-4\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Dashboard\n            </Button>\n          </Link>\n          <h1 className=\"text-2xl font-bold\">Employees On Site Now</h1>\n        </div>\n        <Badge variant=\"secondary\" className=\"text-lg px-3 py-1 bg-orange-100 text-orange-800\">\n          {onSiteEmployees.length} On Site\n        </Badge>\n      </div>\n\n      <div className=\"grid gap-4\">\n        {onSiteEmployees.length === 0 ? (\n          <Card>\n            <CardContent className=\"p-8 text-center\">\n              <MapPin className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <p className=\"text-gray-500\">No employees are currently on site</p>\n              <p className=\"text-sm text-gray-400 mt-1\">\n                Employees will appear here when they are within their work site geofence\n              </p>\n            </CardContent>\n          </Card>\n        ) : (\n          onSiteEmployees.map((item: any) => (\n            <Card key={item.location?.id || item.employee.id} className=\"hover:shadow-md transition-shadow\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center space-x-4\">\n                    <div className=\"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center\">\n                      {item.employee.profileImage ? (\n                        <img\n                          src={item.employee.profileImage}\n                          alt={`${item.employee.firstName} ${item.employee.lastName}`}\n                          className=\"w-12 h-12 rounded-full object-cover\"\n                        />\n                      ) : (\n                        <span className=\"text-orange-600 font-semibold text-lg\">\n                          {item.employee.firstName[0]}{item.employee.lastName[0]}\n                        </span>\n                      )}\n                    </div>\n                    <div>\n                      <Link href={`/admin/employees/${item.employee.id}/profile`}>\n                        <h3 className=\"font-semibold text-lg hover:text-blue-600 cursor-pointer\">\n                          {item.employee.firstName} {item.employee.lastName}\n                        </h3>\n                      </Link>\n                      <p className=\"text-gray-600\">{item.employee.email}</p>\n                      <div className=\"flex items-center space-x-4 text-sm text-gray-500 mt-1\">\n                        <div className=\"flex items-center\">\n                          <MapPin className=\"h-4 w-4 mr-1\" />\n                          <span>{getSiteName(item.employee.siteId)}</span>\n                        </div>\n                        {item.location && (\n                          <div className=\"flex items-center\">\n                            <Clock className=\"h-4 w-4 mr-1\" />\n                            <span>Last update: {new Date(item.location.timestamp).toLocaleTimeString()}</span>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div className=\"text-right space-y-2\">\n                    <Badge className=\"bg-green-100 text-green-800 hover:bg-green-200\">\n                      <User className=\"h-3 w-3 mr-1\" />\n                      On Site\n                    </Badge>\n                    {item.location && (\n                      <div className=\"text-sm text-gray-500\">\n                        <div>Lat: {parseFloat(item.location.latitude).toFixed(4)}</div>\n                        <div>Lng: {parseFloat(item.location.longitude).toFixed(4)}</div>\n                      </div>\n                    )}\n                    <div className=\"space-x-2\">\n                      <Link href={`/admin/live-tracking?employeeId=${item.employee.id}`}>\n                        <Button variant=\"outline\" size=\"sm\">\n                          Track Live\n                        </Button>\n                      </Link>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))\n        )}\n      </div>\n\n      <div className=\"mt-6 text-center\">\n        <Link href=\"/admin/live-tracking\">\n          <Button>\n            View All on Live Map\n          </Button>\n        </Link>\n      </div>\n    </div>\n  );\n}","size_bytes":7492},"client/src/pages/site-management-fixed.tsx":{"content":"import { useState, useEffect, useMemo, useCallback } from 'react';\nimport { Link, useLocation } from 'wouter';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Badge } from '@/components/ui/badge';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\nimport { getAuthToken, getUserType } from '@/lib/auth';\nimport GoogleMap from '@/components/google-map';\nimport { loadGoogleMapsAPI } from '@/lib/google-maps';\nimport { ObjectUploader } from '@/components/ObjectUploader';\nimport { AuthenticatedImage } from '@/components/AuthenticatedImage';\nimport { AdaptiveImage } from '../components/AdaptiveImage';\nimport { \n  ArrowLeft, \n  Plus, \n  MapPin, \n  Edit, \n  Building2,\n  Users,\n  Trash2,\n  Camera,\n  Image\n} from 'lucide-react';\n\nconst siteSchema = z.object({\n  name: z.string().min(1, 'Site name is required'),\n  address: z.string().min(1, 'Address is required'),\n  latitude: z.string().min(1, 'Latitude is required'),\n  longitude: z.string().min(1, 'Longitude is required'),\n  geofenceRadius: z.string().min(1, 'Geofence radius is required'),\n  areaId: z.string().optional(),\n  siteImage: z.string().optional(),\n});\n\nconst areaSchema = z.object({\n  name: z.string().min(1, 'Area name is required'),\n  description: z.string().optional(),\n});\n\ntype SiteForm = z.infer<typeof siteSchema>;\ntype AreaForm = z.infer<typeof areaSchema>;\n\nexport default function SiteManagement() {\n  // All hooks must be declared unconditionally at the top\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [isAreaDialogOpen, setIsAreaDialogOpen] = useState(false);\n  const [editingSite, setEditingSite] = useState<any>(null);\n  const [editingArea, setEditingArea] = useState<any>(null);\n  const [mapLoaded, setMapLoaded] = useState(false);\n  const [selectedLocation, setSelectedLocation] = useState({ lat: 28.4595, lng: 77.0266 });\n  const [siteImageURL, setSiteImageURL] = useState<string>('');\n  const [selectedAreaView, setSelectedAreaView] = useState<any>(null);\n  \n  // Check authentication\n  const isAuthenticated = Boolean(getAuthToken() && getUserType() === 'admin');\n\n  // All queries\n  const { data: areas = [], isLoading: loadingAreas } = useQuery({\n    queryKey: ['/api/admin/areas'],\n    enabled: isAuthenticated,\n    staleTime: 5 * 60 * 1000,\n    gcTime: 10 * 60 * 1000,\n  });\n\n  const { data: sites = [], isLoading: loadingSites } = useQuery({\n    queryKey: ['/api/admin/sites'],\n    enabled: isAuthenticated,\n    staleTime: 2 * 60 * 1000,\n    gcTime: 5 * 60 * 1000,\n  });\n\n  // All forms\n  const form = useForm<SiteForm>({\n    resolver: zodResolver(siteSchema),\n    defaultValues: {\n      name: '',\n      address: '',\n      latitude: '',\n      longitude: '',\n      geofenceRadius: '200',\n      areaId: 'none',\n    },\n  });\n\n  const areaForm = useForm<AreaForm>({\n    resolver: zodResolver(areaSchema),\n    defaultValues: {\n      name: '',\n      description: '',\n    },\n  });\n\n  // All mutations\n  const createSiteMutation = useMutation({\n    mutationFn: async (data: SiteForm) => {\n      const payload = {\n        name: data.name,\n        address: data.address,\n        latitude: parseFloat(data.latitude),\n        longitude: parseFloat(data.longitude),\n        geofenceRadius: parseInt(data.geofenceRadius),\n        areaId: data.areaId && data.areaId !== 'none' ? parseInt(data.areaId) : null,\n        siteImage: siteImageURL || undefined,\n      };\n      \n      if (editingSite) {\n        return apiRequest('PUT', `/api/admin/sites/${editingSite.id}`, payload);\n      } else {\n        return apiRequest('POST', '/api/admin/sites', payload);\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/sites'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/dashboard'] });\n      setIsDialogOpen(false);\n      setEditingSite(null);\n      form.reset();\n      setSiteImageURL('');\n      toast({\n        title: 'Success',\n        description: editingSite ? 'Work site updated successfully' : 'Work site created successfully',\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: 'Error',\n        description: error.message || `Failed to ${editingSite ? 'update' : 'create'} work site`,\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const deleteSiteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest('DELETE', `/api/admin/sites/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/sites'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/dashboard'] });\n      toast({\n        title: 'Success',\n        description: 'Work site deleted successfully',\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to delete work site',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const createAreaMutation = useMutation({\n    mutationFn: async (data: AreaForm) => {\n      if (editingArea) {\n        return apiRequest('PUT', `/api/admin/areas/${editingArea.id}`, data);\n      } else {\n        return apiRequest('POST', '/api/admin/areas', data);\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/areas'] });\n      setIsAreaDialogOpen(false);\n      setEditingArea(null);\n      areaForm.reset();\n      toast({\n        title: 'Success',\n        description: editingArea ? 'Area updated successfully' : 'Area created successfully',\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: 'Error',\n        description: error.message || `Failed to ${editingArea ? 'update' : 'create'} area`,\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const deleteAreaMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest('DELETE', `/api/admin/areas/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/areas'] });\n      toast({\n        title: 'Success',\n        description: 'Area deleted successfully',\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: 'Error',\n        description: error.message || 'Failed to delete area',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  // All useEffect hooks\n  useEffect(() => {\n    if (!isAuthenticated) {\n      toast({\n        title: 'Unauthorized',\n        description: 'Please log in as an admin to access this page.',\n        variant: 'destructive',\n      });\n      setLocation('/admin/login');\n      return;\n    }\n\n    loadGoogleMapsAPI()\n      .then(() => setMapLoaded(true))\n      .catch((error) => {\n        console.error('Failed to load Google Maps:', error);\n        toast({\n          title: 'Error',\n          description: 'Failed to load Google Maps. Some features may not work.',\n          variant: 'destructive',\n        });\n      });\n  }, [isAuthenticated, setLocation, toast]);\n\n  // All useCallback hooks\n  const handleGetUploadParameters = useCallback(async () => {\n    try {\n      const response = await fetch('/api/objects/upload', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n          'Content-Type': 'application/json',\n        },\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to get upload parameters');\n      }\n      \n      const { uploadURL } = await response.json();\n      console.log('Got upload parameters for site image:', { uploadURL });\n      \n      return {\n        method: 'PUT' as const,\n        url: uploadURL,\n      };\n    } catch (error) {\n      console.error('Upload parameters error:', error);\n      throw error;\n    }\n  }, []);\n\n  const handleUploadComplete = useCallback((result: any) => {\n    console.log('Site image upload complete:', result);\n    if (result.successful && result.successful.length > 0) {\n      const uploadedFile = result.successful[0];\n      console.log('Site uploaded file details:', uploadedFile);\n      \n      // Try multiple possible fields for the upload URL\n      const imageURL = uploadedFile.uploadURL || uploadedFile.response?.uploadURL || uploadedFile.url;\n      \n      if (imageURL) {\n        setSiteImageURL(imageURL);\n        toast({\n          title: 'Success',\n          description: 'Site image uploaded successfully',\n        });\n      } else {\n        console.error('No upload URL found in site upload result:', uploadedFile);\n        toast({\n          title: 'Upload Error',\n          description: 'Image uploaded but URL not found. Please try again.',\n          variant: 'destructive',\n        });\n      }\n    } else {\n      console.error('Site image upload failed:', result);\n      toast({\n        title: 'Upload Failed',\n        description: 'Site image upload was not successful. Please try again.',\n        variant: 'destructive',\n      });\n    }\n  }, [toast]);\n\n  const handleLocationSelect = useCallback((lat: number, lng: number) => {\n    setSelectedLocation({ lat, lng });\n    form.setValue('latitude', lat.toString());\n    form.setValue('longitude', lng.toString());\n  }, [form]);\n\n  const handleEditSite = useCallback((site: any) => {\n    setEditingSite(site);\n    form.reset({\n      name: site.name,\n      address: site.address,\n      latitude: site.latitude.toString(),\n      longitude: site.longitude.toString(),\n      geofenceRadius: site.geofenceRadius.toString(),\n      areaId: site.areaId ? site.areaId.toString() : 'none',\n    });\n    setSiteImageURL(site.siteImage || '');\n    setSelectedLocation({ lat: Number(site.latitude), lng: Number(site.longitude) });\n    setIsDialogOpen(true);\n  }, [form]);\n\n  const handleDeleteSite = useCallback((site: any) => {\n    if (window.confirm(`Are you sure you want to delete \"${site.name}\"? This action cannot be undone.`)) {\n      deleteSiteMutation.mutate(site.id);\n    }\n  }, [deleteSiteMutation]);\n\n  const handleEditArea = useCallback((area: any) => {\n    setEditingArea(area);\n    areaForm.reset({\n      name: area.name,\n      description: area.description || '',\n    });\n    setIsAreaDialogOpen(true);\n  }, [areaForm]);\n\n  const handleDeleteArea = useCallback((area: any) => {\n    const areaSites = Array.isArray(sites) ? sites.filter((site: any) => site.areaId === area.id) : [];\n    \n    if (areaSites.length > 0) {\n      toast({\n        title: 'Cannot Delete Area',\n        description: `This area has ${areaSites.length} work sites. Please reassign them first.`,\n        variant: 'destructive',\n      });\n      return;\n    }\n\n    if (window.confirm(`Are you sure you want to delete \"${area.name}\"? This action cannot be undone.`)) {\n      deleteAreaMutation.mutate(area.id);\n    }\n  }, [sites, toast, deleteAreaMutation]);\n\n  const onSubmit = useCallback((data: SiteForm) => {\n    createSiteMutation.mutate(data);\n  }, [createSiteMutation]);\n\n  const onAreaSubmit = useCallback((data: AreaForm) => {\n    createAreaMutation.mutate(data);\n  }, [createAreaMutation]);\n\n  // All useMemo hooks\n  const filteredSites = useMemo(() => {\n    if (!selectedAreaView || !Array.isArray(sites)) return [];\n    return sites.filter((site: any) => site.areaId === selectedAreaView.id);\n  }, [sites, selectedAreaView]);\n\n  // Early return only after all hooks\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Header */}\n      <header className=\"bg-white shadow-sm border-b\">\n        <div className=\"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8\">\n          <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center py-3 sm:py-4 gap-2 sm:gap-0\">\n            <div className=\"flex items-center\">\n              <Link href=\"/admin/dashboard\">\n                <Button variant=\"ghost\" size=\"sm\" className=\"mr-2 sm:mr-4\">\n                  <ArrowLeft className=\"h-4 w-4 mr-1 sm:mr-0\" />\n                  <span className=\"sm:hidden\">Back</span>\n                </Button>\n              </Link>\n              {selectedAreaView && (\n                <Button \n                  variant=\"ghost\" \n                  size=\"sm\"\n                  onClick={() => setSelectedAreaView(null)}\n                  className=\"flex items-center mr-2 sm:mr-4\"\n                >\n                  <ArrowLeft className=\"mr-1 sm:mr-2 h-4 w-4\" />\n                  <span className=\"hidden sm:inline\">Back to Areas</span>\n                  <span className=\"sm:hidden\">Areas</span>\n                </Button>\n              )}\n              <h1 className=\"text-lg sm:text-xl font-semibold text-gray-900\">\n                {selectedAreaView ? `${selectedAreaView.name} - Sites` : 'Areas & Sites Management'}\n              </h1>\n            </div>\n\n            {selectedAreaView && (\n              <Dialog open={isDialogOpen} onOpenChange={(open) => {\n                setIsDialogOpen(open);\n                if (!open) {\n                  setEditingSite(null);\n                  form.reset();\n                  setSiteImageURL('');\n                }\n              }}>\n                <DialogTrigger asChild>\n                  <Button>\n                    <Plus className=\"mr-2 h-4 w-4\" />\n                    Add Site\n                  </Button>\n                </DialogTrigger>\n                <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto mx-4\">\n                  <DialogHeader>\n                    <DialogTitle className=\"text-lg sm:text-xl\">{editingSite ? 'Edit Work Site' : 'Add New Work Site'}</DialogTitle>\n                  </DialogHeader>\n                  <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                    <div>\n                      <Label htmlFor=\"name\">Site Name</Label>\n                      <Input\n                        id=\"name\"\n                        {...form.register('name')}\n                        placeholder=\"Main Office\"\n                      />\n                      {form.formState.errors.name && (\n                        <p className=\"text-error text-sm mt-1\">\n                          {form.formState.errors.name.message}\n                        </p>\n                      )}\n                    </div>\n\n                    <div>\n                      <Label htmlFor=\"address\">Address</Label>\n                      <Textarea\n                        id=\"address\"\n                        {...form.register('address')}\n                        placeholder=\"123 Main St, City, State\"\n                        rows={3}\n                      />\n                      {form.formState.errors.address && (\n                        <p className=\"text-error text-sm mt-1\">\n                          {form.formState.errors.address.message}\n                        </p>\n                      )}\n                    </div>\n\n                    {mapLoaded && (\n                      <div>\n                        <Label>Location (Click on map to select)</Label>\n                        <div className=\"h-64 rounded-lg overflow-hidden border\">\n                          <GoogleMap\n                            center={selectedLocation}\n                            zoom={15}\n                            markers={[{\n                              position: selectedLocation,\n                              title: form.watch('name') || 'New Site',\n                              type: 'site'\n                            }]}\n                          />\n                        </div>\n                      </div>\n                    )}\n\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                      <div>\n                        <Label htmlFor=\"latitude\">Latitude</Label>\n                        <Input\n                          id=\"latitude\"\n                          {...form.register('latitude')}\n                          placeholder=\"40.7128\"\n                          step=\"any\"\n                        />\n                        {form.formState.errors.latitude && (\n                          <p className=\"text-error text-sm mt-1\">\n                            {form.formState.errors.latitude.message}\n                          </p>\n                        )}\n                      </div>\n                      <div>\n                        <Label htmlFor=\"longitude\">Longitude</Label>\n                        <Input\n                          id=\"longitude\"\n                          {...form.register('longitude')}\n                          placeholder=\"-74.0060\"\n                          step=\"any\"\n                        />\n                        {form.formState.errors.longitude && (\n                          <p className=\"text-error text-sm mt-1\">\n                            {form.formState.errors.longitude.message}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                    \n                    <div>\n                      <Label htmlFor=\"area\">Area (Optional)</Label>\n                      <Select value={form.watch('areaId')} onValueChange={(value) => form.setValue('areaId', value)}>\n                        <SelectTrigger>\n                          <SelectValue placeholder=\"Select an area (optional)\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"none\">No Area</SelectItem>\n                          {Array.isArray(areas) && areas.map((area: any) => (\n                            <SelectItem key={area.id} value={area.id.toString()}>\n                              {area.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    \n                    <div>\n                      <Label htmlFor=\"geofenceRadius\">Geofence Radius (meters)</Label>\n                      <Input\n                        id=\"geofenceRadius\"\n                        {...form.register('geofenceRadius')}\n                        placeholder=\"200\"\n                        type=\"number\"\n                      />\n                      {form.formState.errors.geofenceRadius && (\n                        <p className=\"text-error text-sm mt-1\">\n                          {form.formState.errors.geofenceRadius.message}\n                        </p>\n                      )}\n                    </div>\n                    \n                    <div>\n                      <Label>Site Image</Label>\n                      {siteImageURL && (\n                        <div className=\"mb-3\">\n                          <p className=\"text-sm text-gray-600 mb-2\">Current Image:</p>\n                          <img \n                            src={siteImageURL} \n                            alt=\"Site preview\"\n                            className=\"w-full h-32 object-cover rounded-lg border\"\n                          />\n                        </div>\n                      )}\n                      <ObjectUploader\n                        maxNumberOfFiles={1}\n                        maxFileSize={10485760}\n                        allowedFileTypes={['image/*']}\n                        onGetUploadParameters={handleGetUploadParameters}\n                        onComplete={handleUploadComplete}\n                        buttonClassName=\"w-full\"\n                      >\n                        Upload Site Image\n                      </ObjectUploader>\n                      {siteImageURL && (\n                        <Button\n                          type=\"button\"\n                          variant=\"outline\"\n                          onClick={() => setSiteImageURL('')}\n                          className=\"mt-2 w-full\"\n                        >\n                          Remove Image\n                        </Button>\n                      )}\n                    </div>\n                    \n                    <div className=\"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2\">\n                      <Button type=\"submit\" className=\"flex-1\" disabled={createSiteMutation.isPending}>\n                        {createSiteMutation.isPending \n                          ? (editingSite ? 'Updating...' : 'Creating...') \n                          : (editingSite ? 'Update Site' : 'Create Site')\n                        }\n                      </Button>\n                      <Button type=\"button\" variant=\"outline\" onClick={() => setIsDialogOpen(false)}>\n                        Cancel\n                      </Button>\n                    </div>\n                  </form>\n                </DialogContent>\n              </Dialog>\n            )}\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-8\">\n        {selectedAreaView ? (\n          <div>\n            <div className=\"flex justify-between items-center mb-6\">\n              <div>\n                <h2 className=\"text-2xl font-semibold text-gray-900\">{selectedAreaView.name}</h2>\n                {selectedAreaView.description && (\n                  <p className=\"text-gray-600 mt-1\">{selectedAreaView.description}</p>\n                )}\n              </div>\n            </div>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {filteredSites.length === 0 ? (\n                <div className=\"col-span-full text-center py-8\">\n                  <Building2 className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n                  <p className=\"text-gray-500\">No sites in this area yet</p>\n                  <p className=\"text-sm text-gray-400\">Add the first site to get started</p>\n                </div>\n              ) : (\n                filteredSites.map((site: any) => (\n                  <Card key={site.id} className=\"overflow-hidden\">\n                    <div className=\"h-48 bg-gray-200 flex items-center justify-center overflow-hidden\">\n                      {site.siteImage ? (\n                        <AdaptiveImage\n                          src={site.siteImage}\n                          alt={site.name}\n                          className=\"w-full h-full object-cover\"\n                          sizes=\"medium\"\n                          fallback={\n                            <div className=\"text-center\">\n                              <Building2 className=\"mx-auto h-12 w-12 text-gray-400 mb-2\" />\n                              <p className=\"text-sm text-gray-600\">Work Site</p>\n                            </div>\n                          }\n                        />\n                      ) : (\n                        <div className=\"text-center\">\n                          <Building2 className=\"mx-auto h-12 w-12 text-gray-400 mb-2\" />\n                          <p className=\"text-sm text-gray-600\">Work Site</p>\n                        </div>\n                      )}\n                    </div>\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex justify-between items-start mb-4\">\n                        <h3 className=\"text-lg font-semibold text-gray-900\">{site.name}</h3>\n                        <Badge variant={site.isActive ? \"default\" : \"secondary\"}>\n                          {site.isActive ? 'Active' : 'Inactive'}\n                        </Badge>\n                      </div>\n                      <p className=\"text-gray-600 text-sm mb-4\">{site.address}</p>\n                      <div className=\"flex justify-between items-center text-sm text-gray-500 mb-4\">\n                        <span className=\"flex items-center\">\n                          <MapPin className=\"h-4 w-4 mr-1\" />\n                          {Number(site.latitude).toFixed(4)}, {Number(site.longitude).toFixed(4)}\n                        </span>\n                        <span>Radius: {site.geofenceRadius}m</span>\n                      </div>\n                      <div className=\"flex space-x-2\">\n                        <Button variant=\"outline\" size=\"sm\" onClick={() => handleEditSite(site)} className=\"flex-1\">\n                          <Edit className=\"h-4 w-4 mr-1\" />\n                          Edit\n                        </Button>\n                        <Button \n                          variant=\"outline\" \n                          size=\"sm\" \n                          onClick={() => handleDeleteSite(site)}\n                          className=\"text-red-600 hover:text-red-700\"\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))\n              )}\n            </div>\n          </div>\n        ) : (\n          <div>\n            <div className=\"flex justify-between items-center mb-6\">\n              <h2 className=\"text-2xl font-semibold text-gray-900\">Areas Management</h2>\n              <Dialog open={isAreaDialogOpen} onOpenChange={(open) => {\n                setIsAreaDialogOpen(open);\n                if (!open) {\n                  setEditingArea(null);\n                  areaForm.reset();\n                }\n              }}>\n                <DialogTrigger asChild>\n                  <Button>\n                    <Plus className=\"mr-2 h-4 w-4\" />\n                    Add Area\n                  </Button>\n                </DialogTrigger>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle>{editingArea ? 'Edit Area' : 'Add New Area'}</DialogTitle>\n                  </DialogHeader>\n                  <form onSubmit={areaForm.handleSubmit(onAreaSubmit)} className=\"space-y-6\">\n                    <div>\n                      <Label htmlFor=\"areaName\">Area Name</Label>\n                      <Input\n                        id=\"areaName\"\n                        {...areaForm.register('name')}\n                        placeholder=\"Downtown District\"\n                      />\n                      {areaForm.formState.errors.name && (\n                        <p className=\"text-error text-sm mt-1\">\n                          {areaForm.formState.errors.name.message}\n                        </p>\n                      )}\n                    </div>\n\n                    <div>\n                      <Label htmlFor=\"areaDescription\">Description (Optional)</Label>\n                      <Textarea\n                        id=\"areaDescription\"\n                        {...areaForm.register('description')}\n                        placeholder=\"Description of the area\"\n                        rows={3}\n                      />\n                      {areaForm.formState.errors.description && (\n                        <p className=\"text-error text-sm mt-1\">\n                          {areaForm.formState.errors.description.message}\n                        </p>\n                      )}\n                    </div>\n                    \n                    <div className=\"flex space-x-2\">\n                      <Button type=\"submit\" className=\"flex-1\" disabled={createAreaMutation.isPending}>\n                        {createAreaMutation.isPending \n                          ? (editingArea ? 'Updating...' : 'Creating...') \n                          : (editingArea ? 'Update Area' : 'Create Area')\n                        }\n                      </Button>\n                      <Button type=\"button\" variant=\"outline\" onClick={() => setIsAreaDialogOpen(false)}>\n                        Cancel\n                      </Button>\n                    </div>\n                  </form>\n                </DialogContent>\n              </Dialog>\n            </div>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8\">\n              {loadingAreas ? (\n                <div className=\"col-span-full text-center py-4\">\n                  <p>Loading areas...</p>\n                </div>\n              ) : !Array.isArray(areas) || areas.length === 0 ? (\n                <div className=\"col-span-full text-center py-4\">\n                  <p className=\"text-gray-500\">No areas created yet</p>\n                  <p className=\"text-sm text-gray-400\">Areas help organize your work sites</p>\n                </div>\n              ) : (\n                Array.isArray(areas) && areas.map((area: any) => (\n                  <Card \n                    key={area.id} \n                    className=\"p-4 cursor-pointer hover:shadow-md hover:bg-gray-50 transition-all duration-200 relative\"\n                    onClick={() => setSelectedAreaView(area)}\n                  >\n                    <div className=\"flex justify-between items-start mb-2\">\n                      <h3 className=\"font-medium text-gray-900\">{area.name}</h3>\n                      <div \n                        className=\"flex space-x-1 relative z-10\"\n                        onClick={(e) => e.stopPropagation()}\n                      >\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\"\n                          onClick={() => handleEditArea(area)}\n                          title=\"Edit area\"\n                        >\n                          <Edit className=\"h-3 w-3\" />\n                        </Button>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\"\n                          onClick={() => handleDeleteArea(area)}\n                          className=\"text-red-600 hover:text-red-700\"\n                          title=\"Delete area\"\n                        >\n                          <Trash2 className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                    </div>\n                    {area.description && (\n                      <p className=\"text-sm text-gray-600 mb-2\">{area.description}</p>\n                    )}\n                    <div className=\"flex justify-between items-center\">\n                      <p className=\"text-xs text-gray-500\">\n                        {Array.isArray(sites) ? sites.filter((site: any) => site.areaId === area.id).length : 0} sites\n                      </p>\n                      <div className=\"flex items-center text-xs text-blue-600\">\n                        <span>Click to view sites</span>\n                        <Building2 className=\"h-3 w-3 ml-1\" />\n                      </div>\n                    </div>\n                  </Card>\n                ))\n              )}\n            </div>\n          </div>\n        )}\n      </main>\n    </div>\n  );\n}","size_bytes":31082},"client/src/pages/site-management.tsx":{"content":"export { default } from './site-management-fixed';","size_bytes":50},"client/src/pages/work-sites-list.tsx":{"content":"import { useQuery } from '@tanstack/react-query';\nimport { Link } from 'wouter';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { ArrowLeft, MapPin, Users, Navigation, Building2 } from 'lucide-react';\nimport { getAuthToken } from '@/lib/auth';\nimport { AdaptiveImage } from '@/components/AdaptiveImage';\n\ninterface WorkSite {\n  id: number;\n  name: string;\n  address: string;\n  latitude: string;\n  longitude: string;\n  geofenceRadius: number;\n  siteImage?: string;\n  isActive: boolean;\n  adminId: number;\n  createdAt: string;\n}\n\ninterface Employee {\n  id: number;\n  firstName: string;\n  lastName: string;\n  siteId: number;\n  isActive: boolean;\n}\n\nexport default function WorkSitesList() {\n\n  const { data: sites, isLoading: sitesLoading } = useQuery({\n    queryKey: ['/api/admin/sites'],\n    queryFn: async () => {\n      const response = await fetch('/api/admin/sites', {\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to fetch work sites');\n      return response.json();\n    },\n  });\n\n  const { data: employees } = useQuery({\n    queryKey: ['/api/admin/employees'],\n    queryFn: async () => {\n      const response = await fetch('/api/admin/employees', {\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to fetch employees');\n      return response.json();\n    },\n  });\n\n  const getEmployeeCount = (siteId: number) => {\n    if (!employees) return 0;\n    return employees.filter((emp: Employee) => emp.siteId === siteId && emp.isActive).length;\n  };\n\n\n\n  const activeSites = Array.isArray(sites) ? sites.filter((site: WorkSite) => site.isActive) : [];\n\n  if (sitesLoading) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <div className=\"flex items-center mb-6\">\n          <Link href=\"/admin/dashboard\">\n            <Button variant=\"ghost\" size=\"sm\" className=\"mr-4\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Dashboard\n            </Button>\n          </Link>\n          <h1 className=\"text-2xl font-bold\">Work Sites</h1>\n        </div>\n        <div className=\"grid gap-4\">\n          {[1, 2, 3].map((i) => (\n            <Card key={i} className=\"animate-pulse\">\n              <CardContent className=\"p-6\">\n                <div className=\"h-4 bg-gray-200 rounded w-1/3 mb-2\"></div>\n                <div className=\"h-3 bg-gray-200 rounded w-1/2\"></div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div className=\"flex items-center\">\n          <Link href=\"/admin/dashboard\">\n            <Button variant=\"ghost\" size=\"sm\" className=\"mr-4\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Dashboard\n            </Button>\n          </Link>\n          <h1 className=\"text-2xl font-bold\">Work Sites</h1>\n        </div>\n        <Badge variant=\"secondary\" className=\"text-lg px-3 py-1 bg-blue-100 text-blue-800\">\n          {activeSites.length} Sites\n        </Badge>\n      </div>\n\n      <div className=\"grid gap-4\">\n        {activeSites.length === 0 ? (\n          <Card>\n            <CardContent className=\"p-8 text-center\">\n              <MapPin className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <p className=\"text-gray-500\">No work sites found</p>\n              <p className=\"text-sm text-gray-400 mt-1\">\n                Create work sites to track employee locations and attendance\n              </p>\n            </CardContent>\n          </Card>\n        ) : (\n          activeSites.map((site: WorkSite) => (\n            <Card key={site.id} className=\"hover:shadow-md transition-shadow\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center space-x-4\">\n                    <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center overflow-hidden\">\n                      {site.siteImage ? (\n                        <AdaptiveImage \n                          src={site.siteImage} \n                          alt={site.name}\n                          className=\"w-full h-full object-cover\"\n                          sizes=\"thumbnail\"\n                          fallback={\n                            <div className=\"w-full h-full bg-blue-100 flex items-center justify-center\">\n                              <Building2 className=\"text-blue-600 h-6 w-6\" />\n                            </div>\n                          }\n                        />\n                      ) : (\n                        <MapPin className=\"text-blue-600 h-6 w-6\" />\n                      )}\n                    </div>\n                    <div>\n                      <h3 className=\"font-semibold text-lg\">\n                        {site.name}\n                      </h3>\n                      <p className=\"text-gray-600 flex items-center\">\n                        <Navigation className=\"h-4 w-4 mr-1\" />\n                        {site.address}\n                      </p>\n                      <div className=\"flex items-center space-x-4 text-sm text-gray-500 mt-1\">\n                        <div className=\"flex items-center\">\n                          <Users className=\"h-4 w-4 mr-1\" />\n                          <span>{getEmployeeCount(site.id)} employees</span>\n                        </div>\n                        <span>Radius: {site.geofenceRadius}m</span>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div className=\"text-right space-y-2\">\n                    <Badge className=\"bg-green-100 text-green-800 hover:bg-green-200\">\n                      <MapPin className=\"h-3 w-3 mr-1\" />\n                      Active\n                    </Badge>\n                    <div className=\"text-sm text-gray-500\">\n                      <div>Lat: {parseFloat(site.latitude).toFixed(4)}</div>\n                      <div>Lng: {parseFloat(site.longitude).toFixed(4)}</div>\n                    </div>\n                    <div className=\"flex flex-wrap gap-2\">\n                      <Link href={`/admin/live-tracking?siteId=${site.id}`}>\n                        <Button variant=\"outline\" size=\"sm\">\n                          <MapPin className=\"h-4 w-4 mr-1\" />\n                          View Map\n                        </Button>\n                      </Link>\n\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))\n        )}\n      </div>\n\n      <div className=\"mt-6 text-center\">\n        <Link href=\"/admin/sites\">\n          <Button>\n            Manage Work Sites\n          </Button>\n        </Link>\n      </div>\n    </div>\n  );\n}","size_bytes":7076},"client/src/types/globals.d.ts":{"content":"declare namespace google {\n  namespace maps {\n    class Map {\n      constructor(element: HTMLElement, options?: any);\n      setCenter(latLng: any): void;\n      addListener(event: string, handler: Function): void;\n    }\n\n    class Marker {\n      constructor(options: any);\n      setMap(map: Map | null): void;\n    }\n\n    class Circle {\n      constructor(options: any);\n      setMap(map: Map | null): void;\n    }\n\n    namespace event {\n      function addListener(instance: any, eventName: string, handler: Function): void;\n    }\n\n    interface MapMouseEvent {\n      latLng?: {\n        lat(): number;\n        lng(): number;\n      };\n    }\n\n    namespace geometry {\n      // Add geometry namespace if needed\n    }\n\n    enum SymbolPath {\n      CIRCLE = 0,\n    }\n  }\n}\n\ndeclare var google: typeof google;","size_bytes":798},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-4 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg sm:p-6 max-h-[90vh] overflow-y-auto mx-4\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3889},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }","size_bytes":260},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/EmployeeProfileDialog.tsx":{"content":"import { useState } from 'react';\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useToast } from '@/hooks/use-toast';\nimport { getAuthToken } from '@/lib/auth';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { Camera, Upload, X } from 'lucide-react';\nimport { ObjectUploader } from '@/components/ObjectUploader';\nimport { AuthenticatedImage } from '@/components/AuthenticatedImage';\n// import type { UploadResult } from '@uppy/core';\n\ninterface EmployeeData {\n  id: number;\n  firstName: string;\n  lastName: string;\n  email: string;\n  phone: string;\n  address?: string;\n  profileImage?: string;\n}\n\ninterface EmployeeProfileDialogProps {\n  employee: EmployeeData;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst updateProfileSchema = z.object({\n  phone: z.string().min(10, \"Phone number must be at least 10 digits\"),\n  address: z.string().optional(),\n});\n\nexport function EmployeeProfileDialog({ employee, isOpen, onClose }: EmployeeProfileDialogProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isImageDialogOpen, setIsImageDialogOpen] = useState(false);\n\n  const form = useForm<z.infer<typeof updateProfileSchema>>({\n    resolver: zodResolver(updateProfileSchema),\n    defaultValues: {\n      phone: employee.phone || '',\n      address: employee.address || '',\n    },\n  });\n\n  // Update profile mutation\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof updateProfileSchema>) => {\n      return await apiRequest('/api/employee/profile', 'PUT', data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Profile Updated\",\n        description: \"Your profile has been updated successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/employee/profile'] });\n      onClose();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Update Failed\",\n        description: error.message || \"Failed to update profile.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Profile image mutations\n  const uploadImageMutation = useMutation({\n    mutationFn: async (imageURL: string) => {\n      const response = await fetch('/api/employee/profile-image', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ imageURL }),\n      });\n      if (!response.ok) throw new Error('Failed to upload image');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Image Uploaded\",\n        description: \"Profile image has been updated successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/employee/profile'] });\n      setIsImageDialogOpen(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Upload Failed\",\n        description: error.message || \"Failed to upload profile image.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const removeImageMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch('/api/employee/profile-image', {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${getAuthToken()}`,\n        },\n      });\n      if (!response.ok) throw new Error('Failed to remove image');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Image Removed\",\n        description: \"Profile image has been removed successfully.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/employee/profile'] });\n      setIsImageDialogOpen(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Removal Failed\",\n        description: error.message || \"Failed to remove profile image.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleGetUploadParameters = async () => {\n    const response = await fetch('/api/objects/upload', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${getAuthToken()}`,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        path: `profile-images/${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n        contentType: 'image/*',\n      }),\n    });\n    \n    if (!response.ok) throw new Error('Failed to get upload parameters');\n    return response.json();\n  };\n\n  const handleUploadComplete = (result: any) => {\n    if (result && result.length > 0 && result[0].successful) {\n      const uploadedFile = result[0];\n      if (uploadedFile.uploadURL) {\n        uploadImageMutation.mutate(uploadedFile.uploadURL);\n      }\n    }\n  };\n\n  const onSubmit = (data: z.infer<typeof updateProfileSchema>) => {\n    updateProfileMutation.mutate(data);\n  };\n\n  return (\n    <>\n      <Dialog open={isOpen} onOpenChange={onClose}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Update Profile</DialogTitle>\n            <DialogDescription>\n              Update your personal information and profile picture.\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-6\">\n            {/* Profile Image Section */}\n            <div className=\"flex items-center justify-center\">\n              <div className=\"relative\">\n                {employee.profileImage ? (\n                  <AuthenticatedImage\n                    src={employee.profileImage}\n                    alt=\"Profile\"\n                    className=\"w-20 h-20 rounded-full object-cover\"\n                    fallback={\n                      <div className=\"w-20 h-20 bg-gray-300 rounded-full flex items-center justify-center\">\n                        <span className=\"text-2xl font-medium text-gray-700\">\n                          {employee.firstName[0]}{employee.lastName[0]}\n                        </span>\n                      </div>\n                    }\n                  />\n                ) : (\n                  <div className=\"w-20 h-20 bg-gray-300 rounded-full flex items-center justify-center\">\n                    <span className=\"text-2xl font-medium text-gray-700\">\n                      {employee.firstName[0]}{employee.lastName[0]}\n                    </span>\n                  </div>\n                )}\n                <Button\n                  size=\"sm\"\n                  className=\"absolute -bottom-1 -right-1 rounded-full w-6 h-6 p-0\"\n                  onClick={() => setIsImageDialogOpen(true)}\n                >\n                  <Camera className=\"h-3 w-3\" />\n                </Button>\n              </div>\n            </div>\n\n            {/* Profile Form */}\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium text-gray-700\">Name</label>\n                  <div className=\"text-sm text-gray-900\">{employee.firstName} {employee.lastName}</div>\n                  <p className=\"text-xs text-gray-500\">Name cannot be changed</p>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <label className=\"text-sm font-medium text-gray-700\">Email</label>\n                  <div className=\"text-sm text-gray-900\">{employee.email}</div>\n                  <p className=\"text-xs text-gray-500\">Email cannot be changed</p>\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"phone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Phone Number</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Enter phone number\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"address\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Address (Optional)</FormLabel>\n                      <FormControl>\n                        <Textarea \n                          placeholder=\"Enter your address\" \n                          rows={3}\n                          {...field} \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <DialogFooter>\n                  <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n                    Cancel\n                  </Button>\n                  <Button type=\"submit\" disabled={updateProfileMutation.isPending}>\n                    {updateProfileMutation.isPending ? 'Updating...' : 'Update Profile'}\n                  </Button>\n                </DialogFooter>\n              </form>\n            </Form>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Image Upload Dialog */}\n      <Dialog open={isImageDialogOpen} onOpenChange={setIsImageDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Profile Image</DialogTitle>\n            <DialogDescription>\n              Upload a new profile image or remove the current one.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <ObjectUploader\n              maxNumberOfFiles={1}\n              maxFileSize={5242880} // 5MB\n              allowedFileTypes={[\"image/*\"]}\n              onGetUploadParameters={handleGetUploadParameters}\n              onComplete={handleUploadComplete}\n              buttonClassName=\"w-full\"\n            >\n              <Upload className=\"h-4 w-4 mr-2\" />\n              {uploadImageMutation.isPending ? 'Processing...' : 'Upload New Image'}\n            </ObjectUploader>\n            {employee.profileImage && (\n              <Button\n                variant=\"destructive\"\n                onClick={() => removeImageMutation.mutate()}\n                disabled={removeImageMutation.isPending}\n                className=\"w-full\"\n              >\n                <X className=\"h-4 w-4 mr-2\" />\n                {removeImageMutation.isPending ? 'Removing...' : 'Remove Image'}\n              </Button>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}","size_bytes":10923},"FORM_STRUCTURE_VERIFICATION.md":{"content":"# Employee Form Structure Verification\n\n## ✅ ALL FIELDS ARE IMPLEMENTED AND WORKING:\n\n### 1. Employee ID Field (Line 512-522)\n- **Label**: \"Employee ID\" \n- **Placeholder**: \"EMP001\"\n- **Field Name**: `employeeId`\n- **Status**: ✅ VISIBLE IN FORM\n\n### 2. First Name & Last Name Fields (Lines 526-552)\n- **Layout**: Side by side grid\n- **Labels**: \"First Name\" & \"Last Name\"\n- **Placeholders**: \"John\" & \"Doe\"\n- **Status**: ✅ VISIBLE IN FORM\n\n### 3. Email Field (Lines 556-567)\n- **Label**: \"Email\"\n- **Type**: email\n- **Placeholder**: \"john.doe@example.com\"\n- **Status**: ✅ VISIBLE IN FORM\n\n### 4. Phone Number Field (Lines 571-581) \n- **Label**: \"Phone Number\"\n- **Type**: tel\n- **Placeholder**: \"+1 (555) 123-4567\"\n- **Field Name**: `phone`\n- **Status**: ✅ VISIBLE IN FORM\n\n### 5. Password Field (Lines 585-611)\n- **Label**: \"Password\"\n- **Type**: password with show/hide toggle\n- **Show/Hide Button**: Eye icon toggle\n- **Status**: ✅ VISIBLE IN FORM\n\n### 6. Department Selection (Lines 617-639)\n- **Label**: \"Department\"\n- **Type**: Select dropdown\n- **Options**: All available departments + \"No Department\"\n- **Status**: ✅ VISIBLE IN FORM\n\n### 7. Work Site Assignment (Lines 643-666)\n- **Label**: \"Work Site Assignment\"\n- **Type**: Select dropdown  \n- **Options**: All available work sites + \"No Site Assignment\"\n- **Field Name**: `siteId`\n- **Status**: ✅ VISIBLE IN FORM\n\n## Form Layout:\n```\n[Employee ID Field]\n[First Name] [Last Name]\n[Email Field]\n[Phone Number Field] \n[Password Field with toggle]\n[Department] [Work Site Assignment]\n[Cancel] [Create Employee]\n```\n\n## Form Configuration:\n- **Dialog Width**: `sm:max-w-2xl` (large enough for all fields)\n- **Scroll**: `max-h-[95vh] overflow-y-auto` (scrollable if needed)\n- **Spacing**: `space-y-6` (proper spacing between fields)\n- **Reset**: Form resets when dialog closes to prevent old data\n\n## Backend Integration:\n- All fields properly mapped to database schema\n- Site assignment sends `siteId` as integer to backend\n- Form validation with Zod schema\n- Proper error handling and success messages\n\n**CONCLUSION: All requested fields are implemented and should be visible in the form!**\n\nIf you're not seeing these fields, please:\n1. Clear browser cache and refresh\n2. Check if dialog is scrollable (scroll down in the form)\n3. Ensure the form dialog is fully loaded before inspecting","size_bytes":2361},"client/src/components/loading/DashboardSkeleton.tsx":{"content":"import { Skeleton } from \"@/components/ui/skeleton\"\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\"\n\nexport function DashboardStatsSkeleton() {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n      {Array.from({ length: 4 }).map((_, i) => (\n        <Card key={i}>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center\">\n              <Skeleton className=\"h-8 w-8 rounded\" />\n              <div className=\"ml-4\">\n                <Skeleton className=\"h-4 w-16 mb-2\" />\n                <Skeleton className=\"h-8 w-12\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      ))}\n    </div>\n  )\n}\n\nexport function DashboardChartSkeleton() {\n  return (\n    <Card>\n      <CardHeader>\n        <Skeleton className=\"h-6 w-48\" />\n      </CardHeader>\n      <CardContent>\n        <Skeleton className=\"h-80 w-full\" />\n      </CardContent>\n    </Card>\n  )\n}\n\nexport function RecentActivitiesSkeleton() {\n  return (\n    <Card>\n      <CardHeader>\n        <Skeleton className=\"h-6 w-32\" />\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-4\">\n          {Array.from({ length: 5 }).map((_, i) => (\n            <div key={i} className=\"flex items-center space-x-4\">\n              <Skeleton className=\"h-10 w-10 rounded-full\" />\n              <div className=\"space-y-2\">\n                <Skeleton className=\"h-4 w-48\" />\n                <Skeleton className=\"h-3 w-24\" />\n              </div>\n            </div>\n          ))}\n        </div>\n      </CardContent>\n    </Card>\n  )\n}","size_bytes":1607},"client/src/components/loading/EmployeeCardSkeleton.tsx":{"content":"import { Skeleton } from \"@/components/ui/skeleton\"\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\"\n\nexport function EmployeeCardSkeleton() {\n  return (\n    <Card className=\"hover:shadow-lg transition-shadow\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex items-center space-x-3\">\n            <Skeleton className=\"h-12 w-12 rounded-full\" />\n            <div className=\"space-y-2\">\n              <Skeleton className=\"h-5 w-24\" />\n              <Skeleton className=\"h-4 w-32\" />\n            </div>\n          </div>\n          <Skeleton className=\"h-6 w-16 rounded-full\" />\n        </div>\n      </CardHeader>\n      <CardContent className=\"pt-0\">\n        <div className=\"space-y-3\">\n          <div className=\"flex items-center space-x-2\">\n            <Skeleton className=\"h-4 w-4\" />\n            <Skeleton className=\"h-4 w-40\" />\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <Skeleton className=\"h-4 w-4\" />\n            <Skeleton className=\"h-4 w-32\" />\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <Skeleton className=\"h-4 w-4\" />\n            <Skeleton className=\"h-4 w-36\" />\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <Skeleton className=\"h-4 w-4\" />\n            <Skeleton className=\"h-4 w-28\" />\n          </div>\n        </div>\n        <div className=\"flex space-x-2 mt-4\">\n          <Skeleton className=\"h-8 flex-1\" />\n          <Skeleton className=\"h-8 w-8\" />\n        </div>\n      </CardContent>\n    </Card>\n  )\n}","size_bytes":1638},"client/src/components/loading/SiteCardSkeleton.tsx":{"content":"import { Skeleton } from \"@/components/ui/skeleton\"\nimport { Card, CardContent } from \"@/components/ui/card\"\n\nexport function SiteCardSkeleton() {\n  return (\n    <Card className=\"overflow-hidden\">\n      <Skeleton className=\"h-48 w-full\" />\n      <CardContent className=\"p-6\">\n        <div className=\"flex justify-between items-start mb-4\">\n          <Skeleton className=\"h-6 w-32\" />\n          <Skeleton className=\"h-6 w-16 rounded-full\" />\n        </div>\n        <Skeleton className=\"h-4 w-full mb-2\" />\n        <Skeleton className=\"h-4 w-2/3 mb-4\" />\n        <div className=\"flex justify-between items-center text-sm mb-4\">\n          <div className=\"flex items-center\">\n            <Skeleton className=\"h-4 w-4 mr-1\" />\n            <Skeleton className=\"h-4 w-24\" />\n          </div>\n          <Skeleton className=\"h-4 w-20\" />\n        </div>\n        <div className=\"flex space-x-2\">\n          <Skeleton className=\"h-8 flex-1\" />\n          <Skeleton className=\"h-8 w-8\" />\n        </div>\n      </CardContent>\n    </Card>\n  )\n}","size_bytes":1027},"client/src/components/AdaptiveImage.tsx":{"content":"import { useState, useEffect } from 'react';\n\ninterface AdaptiveImageProps {\n  src: string;\n  alt: string;\n  className?: string;\n  fallback?: React.ReactNode;\n  sizes?: 'thumbnail' | 'medium' | 'large' | 'auto';\n  lazy?: boolean;\n}\n\nexport function AdaptiveImage({ \n  src, \n  alt, \n  className = '', \n  fallback, \n  sizes = 'auto',\n  lazy = true \n}: AdaptiveImageProps) {\n  const [imageSrc, setImageSrc] = useState<string>('');\n  const [isLoading, setIsLoading] = useState(true);\n  const [hasError, setHasError] = useState(false);\n  const [connectionSpeed, setConnectionSpeed] = useState<string>('fast');\n\n  // Detect connection speed\n  useEffect(() => {\n    // @ts-ignore - Navigator.connection is experimental\n    const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;\n    if (connection) {\n      const effectiveType = connection.effectiveType;\n      setConnectionSpeed(effectiveType);\n    }\n  }, []);\n\n  // Generate optimized image URL\n  const getOptimizedImageSrc = (originalSrc: string, size?: string): string => {\n    if (!originalSrc.includes('/objects/')) return originalSrc;\n    \n    const params = new URLSearchParams();\n    params.append('compress', 'true');\n    \n    // Auto-detect size based on connection and viewport\n    if (sizes === 'auto') {\n      const isSlowConnection = connectionSpeed === 'slow-2g' || connectionSpeed === '2g';\n      const isMobile = window.innerWidth < 768;\n      \n      if (isSlowConnection || isMobile) {\n        size = 'thumbnail';\n      } else if (window.innerWidth >= 1200) {\n        size = 'large';\n      } else {\n        size = 'medium';\n      }\n    } else {\n      size = sizes;\n    }\n    \n    if (size) {\n      params.append('size', size);\n    }\n    \n    return `${originalSrc}?${params.toString()}`;\n  };\n\n  // Progressive image loading\n  useEffect(() => {\n    if (!src) return;\n    \n    setIsLoading(true);\n    setHasError(false);\n    \n    // First, try to load a thumbnail for instant feedback\n    if (sizes === 'auto' && src.includes('/objects/')) {\n      const thumbnailSrc = getOptimizedImageSrc(src, 'thumbnail');\n      const thumbnailImg = new Image();\n      \n      thumbnailImg.onload = () => {\n        setImageSrc(thumbnailSrc);\n        setIsLoading(false);\n        \n        // Then load the full-quality image in the background\n        const fullImg = new Image();\n        const fullSrc = getOptimizedImageSrc(src);\n        \n        fullImg.onload = () => {\n          setImageSrc(fullSrc);\n        };\n        \n        fullImg.onerror = () => {\n          // Keep the thumbnail if full image fails\n        };\n        \n        if (!lazy || isElementInViewport()) {\n          fullImg.src = fullSrc;\n        }\n      };\n      \n      thumbnailImg.onerror = () => {\n        // Fallback to original image\n        loadOriginalImage();\n      };\n      \n      thumbnailImg.src = thumbnailSrc;\n    } else {\n      loadOriginalImage();\n    }\n  }, [src, sizes, connectionSpeed]);\n\n  const loadOriginalImage = () => {\n    const img = new Image();\n    const optimizedSrc = getOptimizedImageSrc(src);\n    \n    img.onload = () => {\n      setImageSrc(optimizedSrc);\n      setIsLoading(false);\n    };\n    \n    img.onerror = () => {\n      setHasError(true);\n      setIsLoading(false);\n    };\n    \n    img.src = optimizedSrc;\n  };\n\n  const isElementInViewport = (): boolean => {\n    // Simple viewport detection with null check to prevent IntersectionObserver errors\n    // Note: This is simplified - proper implementation would use IntersectionObserver with DOM validation\n    return true; // Always load images for now to prevent errors\n  };\n\n  if (hasError && fallback) {\n    return <>{fallback}</>;\n  }\n\n  if (hasError && !fallback) {\n    return (\n      <div className={`bg-gray-200 flex items-center justify-center ${className}`}>\n        <span className=\"text-gray-500 text-sm\">Image failed to load</span>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`relative overflow-hidden ${className}`}>\n      {isLoading && (\n        <div className=\"absolute inset-0 bg-gradient-to-r from-gray-200 to-gray-300 animate-pulse flex items-center justify-center\">\n          <div className=\"text-gray-500 text-xs font-medium\">\n            Optimizing...\n          </div>\n        </div>\n      )}\n      {imageSrc && (\n        <img\n          src={imageSrc}\n          alt={alt}\n          className={`w-full h-full object-cover ${isLoading ? 'opacity-0' : 'opacity-100'} transition-all duration-500 ease-out`}\n          onError={() => setHasError(true)}\n          loading={lazy ? 'lazy' : 'eager'}\n          style={{ \n            filter: isLoading ? 'blur(8px) brightness(0.8)' : 'none',\n            transform: isLoading ? 'scale(1.05)' : 'scale(1)',\n            transition: 'all 0.5s ease-out'\n          }}\n        />\n      )}\n      {/* Debug info for development */}\n      {process.env.NODE_ENV === 'development' && imageSrc && (\n        <div className=\"absolute bottom-0 right-0 bg-black bg-opacity-50 text-white text-xs px-1 py-0.5\">\n          {connectionSpeed} | {sizes}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// Hook for detecting connection speed\nexport function useConnectionSpeed() {\n  const [connectionSpeed, setConnectionSpeed] = useState<{\n    effectiveType: string;\n    downlink: number;\n    rtt: number;\n  } | null>(null);\n\n  useEffect(() => {\n    // @ts-ignore\n    const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;\n    \n    if (connection) {\n      const updateConnectionInfo = () => {\n        setConnectionSpeed({\n          effectiveType: connection.effectiveType,\n          downlink: connection.downlink,\n          rtt: connection.rtt\n        });\n      };\n      \n      updateConnectionInfo();\n      connection.addEventListener('change', updateConnectionInfo);\n      \n      return () => {\n        connection.removeEventListener('change', updateConnectionInfo);\n      };\n    }\n  }, []);\n\n  return connectionSpeed;\n}","size_bytes":5952},"client/src/components/CompressedImagePreview.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { AdaptiveImage } from './AdaptiveImage';\n\ninterface CompressedImagePreviewProps {\n  src?: string;\n  alt: string;\n  className?: string;\n  fallback?: React.ReactNode;\n  showCompressionInfo?: boolean;\n}\n\nexport function CompressedImagePreview({ \n  src, \n  alt, \n  className = 'w-20 h-20 rounded-lg',\n  fallback,\n  showCompressionInfo = true \n}: CompressedImagePreviewProps) {\n  const [originalSize, setOriginalSize] = useState<number>(0);\n  const [compressedSize, setCompressedSize] = useState<number>(0);\n  const [compressionRatio, setCompressionRatio] = useState<number>(0);\n\n  useEffect(() => {\n    if (!src || !showCompressionInfo) return;\n\n    const measureImageSizes = async () => {\n      try {\n        // Get original image size\n        const originalResponse = await fetch(src, { method: 'HEAD' });\n        const originalBytes = parseInt(originalResponse.headers.get('content-length') || '0');\n        \n        // Get compressed image size  \n        const compressedResponse = await fetch(`${src}?compress=true&size=thumbnail`, { method: 'HEAD' });\n        const compressedBytes = parseInt(compressedResponse.headers.get('content-length') || '0');\n        \n        if (originalBytes && compressedBytes) {\n          setOriginalSize(originalBytes);\n          setCompressedSize(compressedBytes);\n          setCompressionRatio(((originalBytes - compressedBytes) / originalBytes) * 100);\n        }\n      } catch (error) {\n        console.log('Could not measure compression ratio:', error);\n      }\n    };\n\n    measureImageSizes();\n  }, [src, showCompressionInfo]);\n\n  const formatFileSize = (bytes: number): string => {\n    if (bytes < 1024) return bytes + ' B';\n    if (bytes < 1024 * 1024) return Math.round(bytes / 1024) + ' KB';\n    return Math.round(bytes / (1024 * 1024)) + ' MB';\n  };\n\n  if (!src) {\n    return fallback ? <>{fallback}</> : null;\n  }\n\n  return (\n    <div className=\"relative\">\n      <AdaptiveImage\n        src={src}\n        alt={alt}\n        className={className}\n        sizes=\"thumbnail\"\n        fallback={fallback}\n      />\n      \n      {showCompressionInfo && compressionRatio > 0 && (\n        <div className=\"absolute -bottom-1 -right-1 bg-green-500 text-white text-xs px-1.5 py-0.5 rounded-full font-medium shadow-sm\">\n          -{Math.round(compressionRatio)}%\n        </div>\n      )}\n      \n      {showCompressionInfo && originalSize > 0 && compressedSize > 0 && (\n        <div className=\"mt-1 text-xs text-gray-500 text-center\">\n          <span className=\"line-through\">{formatFileSize(originalSize)}</span>\n          {' → '}\n          <span className=\"font-medium text-green-600\">{formatFileSize(compressedSize)}</span>\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":2749},"client/src/components/ProfileImage.tsx":{"content":"interface ProfileImageProps {\n  src?: string;\n  alt: string;\n  className?: string;\n  initials?: string;\n}\n\nexport function ProfileImage({ src, alt, className = \"w-12 h-12 rounded-full\", initials }: ProfileImageProps) {\n  if (src) {\n    return (\n      <img \n        src={src} \n        alt={alt} \n        className={`${className} object-cover`}\n        onError={(e) => {\n          console.error('Image failed to load:', src);\n          // Hide the image and show initials fallback\n          e.currentTarget.style.display = 'none';\n          const fallback = e.currentTarget.nextElementSibling as HTMLElement;\n          if (fallback) fallback.style.display = 'flex';\n        }}\n      />\n    );\n  }\n\n  return (\n    <div className={`${className} bg-blue-100 flex items-center justify-center`}>\n      <span className=\"text-blue-600 font-bold text-sm\">\n        {initials}\n      </span>\n    </div>\n  );\n}","size_bytes":896},"client/src/hooks/useConnectionSpeed.ts":{"content":"import { useState, useEffect } from 'react';\n\ninterface ConnectionInfo {\n  effectiveType?: string;\n  downlink?: number;\n  rtt?: number;\n  saveData?: boolean;\n}\n\nexport function useConnectionSpeed() {\n  const [connectionInfo, setConnectionInfo] = useState<ConnectionInfo>({});\n  const [isSlowConnection, setIsSlowConnection] = useState(false);\n\n  useEffect(() => {\n    // @ts-ignore - Navigator.connection is experimental but widely supported\n    const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;\n    \n    if (connection) {\n      const updateConnectionInfo = () => {\n        const info: ConnectionInfo = {\n          effectiveType: connection.effectiveType,\n          downlink: connection.downlink,\n          rtt: connection.rtt,\n          saveData: connection.saveData\n        };\n        \n        setConnectionInfo(info);\n        \n        // Determine if connection is slow\n        const isSlow = \n          connection.effectiveType === 'slow-2g' ||\n          connection.effectiveType === '2g' ||\n          connection.downlink < 1 ||\n          connection.rtt > 500 ||\n          connection.saveData;\n          \n        setIsSlowConnection(isSlow);\n      };\n      \n      updateConnectionInfo();\n      connection.addEventListener('change', updateConnectionInfo);\n      \n      return () => {\n        connection.removeEventListener('change', updateConnectionInfo);\n      };\n    } else {\n      // Fallback detection based on user agent for older browsers\n      const userAgent = navigator.userAgent.toLowerCase();\n      const isMobile = /mobile|android|iphone|ipad/.test(userAgent);\n      setIsSlowConnection(isMobile); // Assume mobile connections are potentially slower\n    }\n  }, []);\n\n  return {\n    connectionInfo,\n    isSlowConnection,\n    effectiveType: connectionInfo.effectiveType || 'unknown',\n    downlink: connectionInfo.downlink || 0,\n    rtt: connectionInfo.rtt || 0,\n    saveData: connectionInfo.saveData || false\n  };\n}","size_bytes":1976},"server/imageCompression.ts":{"content":"import sharp from 'sharp';\nimport { Request, Response } from 'express';\n\ninterface CompressionOptions {\n  width?: number;\n  height?: number;\n  quality?: number;\n  format?: 'webp' | 'jpeg' | 'png';\n  progressive?: boolean;\n}\n\nexport class ImageCompressionService {\n  // Get optimal compression settings based on user agent and accept headers\n  getOptimalSettings(req: Request): CompressionOptions {\n    const userAgent = req.get('User-Agent') || '';\n    const acceptHeader = req.get('Accept') || '';\n    \n    // Check if browser supports WebP\n    const supportsWebP = acceptHeader.includes('image/webp');\n    \n    // Detect mobile devices\n    const isMobile = /Mobile|Android|iPhone|iPad/.test(userAgent);\n    \n    // Base settings\n    let settings: CompressionOptions = {\n      format: supportsWebP ? 'webp' : 'jpeg',\n      progressive: true,\n    };\n    \n    // Adjust quality and size based on device\n    if (isMobile) {\n      settings.quality = 75; // Lower quality for mobile\n      settings.width = 800; // Max width for mobile\n    } else {\n      settings.quality = 85; // Higher quality for desktop\n      settings.width = 1200; // Max width for desktop\n    }\n    \n    // Check for slow connection hints\n    const connectionHeader = req.get('Downlink') || req.get('Connection');\n    if (connectionHeader && (connectionHeader.includes('slow') || parseFloat(connectionHeader) < 1)) {\n      settings.quality = Math.max(60, settings.quality! - 15);\n      settings.width = Math.min(600, settings.width!);\n    }\n    \n    return settings;\n  }\n  \n  // Compress image buffer\n  async compressImage(imageBuffer: Buffer, options: CompressionOptions): Promise<Buffer> {\n    let transformer = sharp(imageBuffer);\n    \n    // Resize if width/height specified\n    if (options.width || options.height) {\n      transformer = transformer.resize(options.width, options.height, {\n        fit: 'inside',\n        withoutEnlargement: true\n      });\n    }\n    \n    // Apply format-specific compression\n    switch (options.format) {\n      case 'webp':\n        transformer = transformer.webp({ \n          quality: options.quality\n        });\n        break;\n      case 'jpeg':\n        transformer = transformer.jpeg({ \n          quality: options.quality,\n          progressive: options.progressive \n        });\n        break;\n      case 'png':\n        transformer = transformer.png({ \n          compressionLevel: 9,\n          progressive: options.progressive \n        });\n        break;\n    }\n    \n    return await transformer.toBuffer();\n  }\n  \n  // Get content type for format\n  getContentType(format: string): string {\n    switch (format) {\n      case 'webp': return 'image/webp';\n      case 'jpeg': return 'image/jpeg';\n      case 'png': return 'image/png';\n      default: return 'image/jpeg';\n    }\n  }\n  \n  // Generate multiple sizes for responsive images\n  async generateResponsiveSizes(imageBuffer: Buffer): Promise<{\n    thumbnail: Buffer;\n    medium: Buffer;\n    large: Buffer;\n    format: string;\n  }> {\n    const format = 'webp'; // Use WebP for best compression\n    \n    const [thumbnail, medium, large] = await Promise.all([\n      this.compressImage(imageBuffer, { width: 150, height: 150, quality: 70, format }),\n      this.compressImage(imageBuffer, { width: 400, quality: 80, format }),\n      this.compressImage(imageBuffer, { width: 800, quality: 85, format })\n    ]);\n    \n    return { thumbnail, medium, large, format };\n  }\n}","size_bytes":3421}},"version":1}